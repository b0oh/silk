import{r as jn,a as M_,g as Yu,R as L,b as Ei,c as D_}from"./react-a1bbe633.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();var Em={exports:{}},Li={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var L_=jn,k_=Symbol.for("react.element"),I_=Symbol.for("react.fragment"),F_=Object.prototype.hasOwnProperty,G_=L_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,B_={key:!0,ref:!0,__self:!0,__source:!0};function Am(e,t,n){var r,o={},a=null,s=null;n!==void 0&&(a=""+n),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(s=t.ref);for(r in t)F_.call(t,r)&&!B_.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps,t)o[r]===void 0&&(o[r]=t[r]);return{$$typeof:k_,type:e,key:a,ref:s,props:o,_owner:G_.current}}Li.Fragment=I_;Li.jsx=Am;Li.jsxs=Am;Em.exports=Li;var fn=Em.exports,Tu={},D1=M_;Tu.createRoot=D1.createRoot,Tu.hydrateRoot=D1.hydrateRoot;const Tm=e=>e.reduce((t,n)=>Array.isArray(n)?t.concat(Tm(n)):t.concat(n),[]);var nt=Tm;const z_=e=>Object.assign({},e);var V_=z_;const j_=(e,t,n)=>(e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e);var U_=j_;const q_=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var Zu=q_;const X_=Zu,H_=e=>{const t=X_();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t};var W_=H_;const Y_=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e);var $m=Y_;const Z_=(e,t)=>{const n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],i=t[5],c=t[6],l=t[7],u=t[8],f=t[9],h=t[10],p=t[11],g=t[12],v=t[13],m=t[14],x=t[15],P=n*i-r*s,S=n*c-o*s,O=n*l-a*s,R=r*c-o*i,N=r*l-a*i,I=o*l-a*c,X=u*v-f*g,W=u*m-h*g,J=u*x-p*g,G=f*m-h*v,ce=f*x-p*v,_e=h*x-p*m;let de=P*_e-S*ce+O*G+R*J-N*W+I*X;return de?(de=1/de,e[0]=(i*_e-c*ce+l*G)*de,e[1]=(o*ce-r*_e-a*G)*de,e[2]=(v*I-m*N+x*R)*de,e[3]=(h*N-f*I-p*R)*de,e[4]=(c*J-s*_e-l*W)*de,e[5]=(n*_e-o*J+a*W)*de,e[6]=(m*O-g*I-x*S)*de,e[7]=(u*I-h*O+p*S)*de,e[8]=(s*ce-i*J+l*X)*de,e[9]=(r*J-n*ce-a*X)*de,e[10]=(g*N-v*O+x*P)*de,e[11]=(f*O-u*N-p*P)*de,e[12]=(i*W-s*G-c*X)*de,e[13]=(n*G-r*W+o*X)*de,e[14]=(v*S-g*R-m*P)*de,e[15]=(u*R-f*S+h*P)*de,e):null};var K_=Z_;const Q_=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15];var J_=Q_;const ex=1e5,tx=1e-5,nx=1e-13,rx=Math.PI*2;var mt={EPS:tx,NEPS:nx,TAU:rx,spatialResolution:ex};const{NEPS:ox}=mt,Sm=e=>Math.abs(e)<ox?0:e,ax=e=>Sm(Math.sin(e)),sx=e=>Sm(Math.cos(e));var un={sin:ax,cos:sx};const ix=e=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e);var Pm=ix;const{EPS:cx}=mt,{sin:lx,cos:ux}=un,fx=Pm,dx=(e,t,n)=>{let[r,o,a]=n;const s=r*r+o*o+a*a;if(Math.abs(s)<cx)return fx(e);const i=1/Math.sqrt(s);r*=i,o*=i,a*=i;const c=lx(t),l=ux(t),u=1-l;return e[0]=r*r*u+l,e[1]=o*r*u+a*c,e[2]=a*r*u-o*c,e[3]=0,e[4]=r*o*u-a*c,e[5]=o*o*u+l,e[6]=a*o*u+r*c,e[7]=0,e[8]=r*a*u+o*c,e[9]=o*a*u-r*c,e[10]=a*a*u+l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var Cm=dx;const hx=(e,t)=>(e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e);var px=hx;const{sin:ll,cos:ul}=un,mx=(e,t,n,r)=>{const o=ll(t),a=ul(t),s=ll(n),i=ul(n),c=ll(r),l=ul(r);return e[0]=i*a,e[1]=i*o,e[2]=-s,e[3]=0,e[4]=c*s*a-l*o,e[5]=l*a+c*s*o,e[6]=c*i,e[7]=0,e[8]=c*o+l*s*a,e[9]=l*s*o-c*a,e[10]=l*i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var vx=mx;const gx=(e,t)=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e);var yx=gx;const bx=Zu,_x=(e,t,n,r,o,a,s,i,c,l,u,f,h,p,g,v)=>{const m=bx();return m[0]=e,m[1]=t,m[2]=n,m[3]=r,m[4]=o,m[5]=a,m[6]=s,m[7]=i,m[8]=c,m[9]=l,m[10]=u,m[11]=f,m[12]=h,m[13]=p,m[14]=g,m[15]=v,m};var xx=_x;const wx=(e,t)=>(e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e[2]=Math.abs(t[2]),e);var Om=wx;const Ex=(e,t,n)=>(e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e);var Rm=Ex;const Ax=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2];var ki=Ax;const Tx=ki,$x=(e,t)=>{const n=e[0],r=e[1],o=e[2],a=t[0],s=t[1],i=t[2],c=Math.sqrt(n*n+r*r+o*o),l=Math.sqrt(a*a+s*s+i*i),u=c*l,f=u&&Tx(e,t)/u;return Math.acos(Math.min(Math.max(f,-1),1))};var Sx=$x;const Px=()=>[0,0,0];var Ii=Px;const Cx=Ii,Ox=e=>{const t=Cx();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t};var Rx=Ox;const Nx=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e);var Nm=Nx;const Mx=(e,t,n)=>{const r=t[0],o=t[1],a=t[2],s=n[0],i=n[1],c=n[2];return e[0]=o*c-a*i,e[1]=a*s-r*c,e[2]=r*i-o*s,e};var as=Mx;const Dx=(e,t)=>{const n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+r*r+o*o)};var Mm=Dx;const Lx=(e,t,n)=>(e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e);var kx=Lx;const Ix=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2];var Fx=Ix;const Gx=(e,t)=>(e[0]=t,e[1]=t,e[2]=t,e);var Bx=Gx;const zx=Ii,Vx=(e,t,n)=>{const r=zx();return r[0]=e,r[1]=t,r[2]=n,r};var jx=Vx;const Ux=(e,t,n=0)=>(e[0]=t[0],e[1]=t[1],e[2]=n,e);var qx=Ux;const Xx=e=>{const t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)};var Dm=Xx;const Hx=(e,t,n,r)=>(e[0]=t[0]+r*(n[0]-t[0]),e[1]=t[1]+r*(n[1]-t[1]),e[2]=t[2]+r*(n[2]-t[2]),e);var Wx=Hx;const Yx=(e,t,n)=>(e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e);var Lm=Yx;const Zx=(e,t,n)=>(e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e);var km=Zx;const Kx=(e,t,n)=>(e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e);var Qx=Kx;const Jx=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e);var e5=Jx;const t5=(e,t)=>{const n=t[0],r=t[1],o=t[2];let a=n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=n*a,e[1]=r*a,e[2]=o*a,e};var Ku=t5;const n5=Om,r5=Ii,o5=as,a5=(e,t)=>{const n=n5(r5(),t),r=0+(n[0]<n[1]&&n[0]<n[2]),o=0+(n[1]<=n[0]&&n[1]<n[2]),a=0+(n[2]<=n[0]&&n[2]<=n[1]);return o5(e,t,[r,o,a])};var s5=a5;const i5=(e,t,n,r)=>{const o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[0],a[1]=o[1]*Math.cos(r)-o[2]*Math.sin(r),a[2]=o[1]*Math.sin(r)+o[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e};var c5=i5;const l5=(e,t,n,r)=>{const o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],o[2]=t[2]-n[2],a[0]=o[2]*Math.sin(r)+o[0]*Math.cos(r),a[1]=o[1],a[2]=o[2]*Math.cos(r)-o[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e};var u5=l5;const f5=(e,t,n,r)=>{const o=[],a=[];return o[0]=t[0]-n[0],o[1]=t[1]-n[1],a[0]=o[0]*Math.cos(r)-o[1]*Math.sin(r),a[1]=o[0]*Math.sin(r)+o[1]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=t[2],e};var d5=f5;const h5=(e,t,n)=>(e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e);var Im=h5;const p5=(e,t,n)=>(e[0]=Math.round(t[0]/n)*n+0,e[1]=Math.round(t[1]/n)*n+0,e[2]=Math.round(t[2]/n)*n+0,e);var m5=p5;const v5=(e,t)=>{const n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o};var Fm=v5;const g5=e=>{const t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r};var Gm=g5;const y5=(e,t,n)=>(e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e);var Fi=y5;const b5=e=>`[${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)}]`;var _5=b5;const x5=(e,t,n)=>{const r=t[0],o=t[1],a=t[2];let s=n[3]*r+n[7]*o+n[11]*a+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*o+n[8]*a+n[12])/s,e[1]=(n[1]*r+n[5]*o+n[9]*a+n[13])/s,e[2]=(n[2]*r+n[6]*o+n[10]*a+n[14])/s,e};var w5=x5,He={abs:Om,add:Rm,angle:Sx,clone:Rx,copy:Nm,create:Ii,cross:as,distance:Mm,divide:kx,dot:ki,equals:Fx,fromScalar:Bx,fromValues:jx,fromVec2:qx,length:Dm,lerp:Wx,max:Lm,min:km,multiply:Qx,negate:e5,normalize:Ku,orthogonal:s5,rotateX:c5,rotateY:u5,rotateZ:d5,scale:Im,snap:m5,squaredDistance:Fm,squaredLength:Gm,subtract:Fi,toString:_5,transform:w5};const _r=He,E5=Cm,A5=(e,t,n)=>{const r=_r.normalize(_r.create(),t),o=_r.normalize(_r.create(),n),a=_r.cross(_r.create(),o,r),s=_r.dot(o,r);if(s===-1)return E5(e,Math.PI,_r.orthogonal(a,r));const i=1/(1+s);return e[0]=a[0]*a[0]*i+s,e[1]=a[1]*a[0]*i-a[2],e[2]=a[2]*a[0]*i+a[1],e[3]=0,e[4]=a[0]*a[1]*i+a[2],e[5]=a[1]*a[1]*i+s,e[6]=a[2]*a[1]*i-a[0],e[7]=0,e[8]=a[0]*a[2]*i-a[1],e[9]=a[1]*a[2]*i+a[0],e[10]=a[2]*a[2]*i+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var T5=A5;const{sin:$5,cos:S5}=un,P5=(e,t)=>{const n=$5(t),r=S5(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var C5=P5;const{sin:O5,cos:R5}=un,N5=(e,t)=>{const n=O5(t),r=R5(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var M5=N5;const{sin:D5,cos:L5}=un,k5=(e,t)=>{const n=D5(t),r=L5(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e};var I5=k5;const F5=e=>e[0]===1&&e[1]===0&&e[2]===0&&e[3]===0&&e[4]===0&&e[5]===1&&e[6]===0&&e[7]===0&&e[8]===0&&e[9]===0&&e[10]===1&&e[11]===0&&e[12]===0&&e[13]===0&&e[14]===0&&e[15]===1;var G5=F5;const B5=e=>ar(e[1])&&ar(e[2])&&ar(e[3])&&ar(e[4])&&ar(e[6])&&ar(e[7])&&ar(e[8])&&ar(e[9])&&ar(e[11])&&e[15]===1,ar=e=>Math.abs(e)<Number.EPSILON;var z5=B5;const V5=e=>{const t=e[4]*e[9]-e[8]*e[5],n=e[8]*e[1]-e[0]*e[9],r=e[0]*e[5]-e[4]*e[1];return t*e[2]+n*e[6]+r*e[10]<0};var j5=V5;const U5=(e,t)=>{const[n,r,o,a]=t;return e[0]=1-2*n*n,e[1]=-2*r*n,e[2]=-2*o*n,e[3]=0,e[4]=-2*n*r,e[5]=1-2*r*r,e[6]=-2*o*r,e[7]=0,e[8]=-2*n*o,e[9]=-2*r*o,e[10]=1-2*o*o,e[11]=0,e[12]=2*n*a,e[13]=2*r*a,e[14]=2*o*a,e[15]=1,e};var q5=U5;const X5=(e,t,n)=>{const r=t[0],o=t[1],a=t[2],s=t[3],i=t[4],c=t[5],l=t[6],u=t[7],f=t[8],h=t[9],p=t[10],g=t[11],v=t[12],m=t[13],x=t[14],P=t[15];let S=n[0],O=n[1],R=n[2],N=n[3];return e[0]=S*r+O*i+R*f+N*v,e[1]=S*o+O*c+R*h+N*m,e[2]=S*a+O*l+R*p+N*x,e[3]=S*s+O*u+R*g+N*P,S=n[4],O=n[5],R=n[6],N=n[7],e[4]=S*r+O*i+R*f+N*v,e[5]=S*o+O*c+R*h+N*m,e[6]=S*a+O*l+R*p+N*x,e[7]=S*s+O*u+R*g+N*P,S=n[8],O=n[9],R=n[10],N=n[11],e[8]=S*r+O*i+R*f+N*v,e[9]=S*o+O*c+R*h+N*m,e[10]=S*a+O*l+R*p+N*x,e[11]=S*s+O*u+R*g+N*P,S=n[12],O=n[13],R=n[14],N=n[15],e[12]=S*r+O*i+R*f+N*v,e[13]=S*o+O*c+R*h+N*m,e[14]=S*a+O*l+R*p+N*x,e[15]=S*s+O*u+R*g+N*P,e};var H5=X5;const{EPS:W5}=mt,{sin:Y5,cos:Z5}=un,K5=$m,Q5=(e,t,n,r)=>{let[o,a,s]=r;const i=o*o+a*a+s*s;if(Math.abs(i)<W5)return K5(e,t);const c=1/Math.sqrt(i);o*=c,a*=c,s*=c;const l=Y5(n),u=Z5(n),f=1-u,h=t[0],p=t[1],g=t[2],v=t[3],m=t[4],x=t[5],P=t[6],S=t[7],O=t[8],R=t[9],N=t[10],I=t[11],X=o*o*f+u,W=a*o*f+s*l,J=s*o*f-a*l,G=o*a*f-s*l,ce=a*a*f+u,_e=s*a*f+o*l,de=o*s*f+a*l,De=a*s*f-o*l,be=s*s*f+u;return e[0]=h*X+m*W+O*J,e[1]=p*X+x*W+R*J,e[2]=g*X+P*W+N*J,e[3]=v*X+S*W+I*J,e[4]=h*G+m*ce+O*_e,e[5]=p*G+x*ce+R*_e,e[6]=g*G+P*ce+N*_e,e[7]=v*G+S*ce+I*_e,e[8]=h*de+m*De+O*be,e[9]=p*de+x*De+R*be,e[10]=g*de+P*De+N*be,e[11]=v*de+S*De+I*be,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e};var J5=Q5;const{sin:ew,cos:tw}=un,nw=(e,t,n)=>{const r=ew(n),o=tw(n),a=t[4],s=t[5],i=t[6],c=t[7],l=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+l*r,e[5]=s*o+u*r,e[6]=i*o+f*r,e[7]=c*o+h*r,e[8]=l*o-a*r,e[9]=u*o-s*r,e[10]=f*o-i*r,e[11]=h*o-c*r,e};var rw=nw;const{sin:ow,cos:aw}=un,sw=(e,t,n)=>{const r=ow(n),o=aw(n),a=t[0],s=t[1],i=t[2],c=t[3],l=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-l*r,e[1]=s*o-u*r,e[2]=i*o-f*r,e[3]=c*o-h*r,e[8]=a*r+l*o,e[9]=s*r+u*o,e[10]=i*r+f*o,e[11]=c*r+h*o,e};var iw=sw;const{sin:cw,cos:lw}=un,uw=(e,t,n)=>{const r=cw(n),o=lw(n),a=t[0],s=t[1],i=t[2],c=t[3],l=t[4],u=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+l*r,e[1]=s*o+u*r,e[2]=i*o+f*r,e[3]=c*o+h*r,e[4]=l*o-a*r,e[5]=u*o-s*r,e[6]=f*o-i*r,e[7]=h*o-c*r,e};var fw=uw;const dw=(e,t,n)=>{const r=n[0],o=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e};var hw=dw;const pw=(e,t,n)=>(e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e);var mw=pw;const vw=e=>e.map(t=>t.toFixed(7)).toString();var gw=vw;const yw=(e,t,n)=>{const r=n[0],o=n[1],a=n[2];let s,i,c,l,u,f,h,p,g,v,m,x;return t===e?(e[12]=t[0]*r+t[4]*o+t[8]*a+t[12],e[13]=t[1]*r+t[5]*o+t[9]*a+t[13],e[14]=t[2]*r+t[6]*o+t[10]*a+t[14],e[15]=t[3]*r+t[7]*o+t[11]*a+t[15]):(s=t[0],i=t[1],c=t[2],l=t[3],u=t[4],f=t[5],h=t[6],p=t[7],g=t[8],v=t[9],m=t[10],x=t[11],e[0]=s,e[1]=i,e[2]=c,e[3]=l,e[4]=u,e[5]=f,e[6]=h,e[7]=p,e[8]=g,e[9]=v,e[10]=m,e[11]=x,e[12]=s*r+u*o+g*a+t[12],e[13]=i*r+f*o+v*a+t[13],e[14]=c*r+h*o+m*a+t[14],e[15]=l*r+p*o+x*a+t[15]),e};var bw=yw,Tt={add:U_,clone:W_,copy:$m,create:Zu,invert:K_,equals:J_,fromRotation:Cm,fromScaling:px,fromTaitBryanRotation:vx,fromTranslation:yx,fromValues:xx,fromVectorRotation:T5,fromXRotation:C5,fromYRotation:M5,fromZRotation:I5,identity:Pm,isIdentity:G5,isOnlyTransformScale:z5,isMirroring:j5,mirrorByPlane:q5,multiply:H5,rotate:J5,rotateX:rw,rotateY:iw,rotateZ:fw,scale:hw,subtract:mw,toString:gw,translate:bw};const _w=Tt,xw=e=>(e===void 0&&(e=[]),{sides:e,transforms:_w.create()});var Gi=xw;const ww=(e,t)=>(e[0]=Math.abs(t[0]),e[1]=Math.abs(t[1]),e);var Ew=ww;const Aw=(e,t,n)=>(e[0]=t[0]+n[0],e[1]=t[1]+n[1],e);var Tw=Aw;const $w=e=>Math.atan2(e[1],e[0]);var Qu=$w,Sw=Qu;const Pw=Qu,Cw=e=>Pw(e)*57.29577951308232;var Ow=Cw;const Rw=()=>[0,0];var Bi=Rw;const Nw=Bi,Mw=e=>{const t=Nw();return t[0]=e[0],t[1]=e[1],t};var Dw=Mw;const Lw=(e,t)=>(e[0]=t[0],e[1]=t[1],e);var kw=Lw;const Iw=(e,t,n)=>(e[0]=0,e[1]=0,e[2]=t[0]*n[1]-t[1]*n[0],e);var Fw=Iw;const Gw=(e,t)=>{const n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)};var Bw=Gw;const zw=(e,t,n)=>(e[0]=t[0]/n[0],e[1]=t[1]/n[1],e);var Vw=zw;const jw=(e,t)=>e[0]*t[0]+e[1]*t[1];var Uw=jw;const qw=(e,t)=>e[0]===t[0]&&e[1]===t[1];var Xw=qw;const{sin:Hw,cos:Ww}=un,Yw=(e,t)=>(e[0]=Ww(t),e[1]=Hw(t),e);var Bm=Yw;const Zw=Bm,Kw=(e,t)=>Zw(e,t*.017453292519943295);var Qw=Kw;const Jw=(e,t)=>(e[0]=t,e[1]=t,e);var eE=Jw;const tE=Bi,nE=(e,t)=>{const n=tE();return n[0]=e,n[1]=t,n};var rE=nE;const oE=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]);var aE=oE;const sE=(e,t,n,r)=>{const o=t[0],a=t[1];return e[0]=o+r*(n[0]-o),e[1]=a+r*(n[1]-a),e};var iE=sE;const cE=(e,t,n)=>(e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e);var lE=cE;const uE=(e,t,n)=>(e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e);var fE=uE;const dE=(e,t,n)=>(e[0]=t[0]*n[0],e[1]=t[1]*n[1],e);var hE=dE;const pE=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e);var mE=pE;const vE=(e,t,n,r)=>{const o=t[0]-n[0],a=t[1]-n[1],s=Math.cos(r),i=Math.sin(r);return e[0]=o*s-a*i+n[0],e[1]=o*i+a*s+n[1],e};var zm=vE;const{TAU:gE}=mt,yE=Bi,bE=zm,_E=(e,t)=>bE(e,t,yE(),gE/4);var xE=_E;const wE=(e,t)=>{const n=t[0],r=t[1];let o=n*n+r*r;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e};var EE=wE;const AE=(e,t,n)=>(e[0]=t[0]*n,e[1]=t[1]*n,e);var TE=AE;const $E=(e,t,n)=>(e[0]=Math.round(t[0]/n)*n+0,e[1]=Math.round(t[1]/n)*n+0,e);var SE=$E;const PE=(e,t)=>{const n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r};var CE=PE;const OE=e=>{const t=e[0],n=e[1];return t*t+n*n};var RE=OE;const NE=(e,t,n)=>(e[0]=t[0]-n[0],e[1]=t[1]-n[1],e);var ME=NE;const DE=e=>`[${e[0].toFixed(7)}, ${e[1].toFixed(7)}]`;var LE=DE;const kE=(e,t,n)=>{const r=t[0],o=t[1];return e[0]=n[0]*r+n[4]*o+n[12],e[1]=n[1]*r+n[5]*o+n[13],e};var IE=kE,ut={abs:Ew,add:Tw,angle:Sw,angleDegrees:Ow,angleRadians:Qu,clone:Dw,copy:kw,create:Bi,cross:Fw,distance:Bw,divide:Vw,dot:Uw,equals:Xw,fromAngleDegrees:Qw,fromAngleRadians:Bm,fromScalar:eE,fromValues:rE,length:aE,lerp:iE,max:lE,min:fE,multiply:hE,negate:mE,normal:xE,normalize:EE,rotate:zm,scale:TE,snap:SE,squaredDistance:CE,squaredLength:RE,subtract:ME,toString:LE,transform:IE};const fl=ut,FE=Gi,GE=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");let t=e.length;if(t<3)throw new Error("the given points must define a closed geometry with three or more points");fl.equals(e[0],e[t-1])&&--t;const n=[];let r=e[t-1];for(let o=0;o<t;o++){const a=e[o];n.push([fl.clone(r),fl.clone(a)]),r=a}return FE(n)};var BE=GE;const zE=Tt,L1=ut,VE=Gi,jE=e=>{if(e[0]!==0)throw new Error("invalid compact binary data");const t=VE();t.transforms=zE.clone(e.slice(1,17));for(let n=21;n<e.length;n+=4){const r=L1.fromValues(e[n+0],e[n+1]),o=L1.fromValues(e[n+2],e[n+3]);t.sides.push([r,o])}return e[17]>=0&&(t.color=[e[17],e[18],e[19],e[20]]),t};var UE=jE;const qE=e=>!!(e&&typeof e=="object"&&"sides"in e&&"transforms"in e&&Array.isArray(e.sides)&&"length"in e.transforms);var Vm=qE;const k1=Tt,Us=ut,XE=e=>(k1.isIdentity(e.transforms)||(e.sides=e.sides.map(t=>{const n=Us.transform(Us.create(),t[0],e.transforms),r=Us.transform(Us.create(),t[1],e.transforms);return[n,r]}),e.transforms=k1.create()),e);var HE=XE;const WE=HE,YE=e=>WE(e).sides;var ss=YE;const ZE=Gi,KE=ss,QE=e=>{const n=KE(e).map(r=>[r[1],r[0]]);return n.reverse(),ZE(n)};var JE=QE;const Ca=ut,e3=ss,t3=e=>{const t=new Map,n=r=>{const o=r.toString();return t.has(o)?t.get(o):(t.set(o,r),r)};return e.map(r=>r.map(n))},n3=e=>{const t=new Map;return t3(e).forEach(r=>{t.has(r[0])?t.get(r[0]).push(r):t.set(r[0],[r])}),t},r3=e=>{const t=n3(e3(e)),n=[];for(;;){let r;for(const[s,i]of t){if(r=i.shift(),!r){t.delete(s);continue}break}if(r===void 0)break;const o=[],a=r[0];for(;;){o.push(r[0]);const s=r[1];if(s===a)break;const i=t.get(s);if(!i)throw new Error(`geometry is not closed at vertex ${s}`);const c=o3(r,i);i.length===0&&t.delete(s),r=c}o.length>0&&o.push(o.shift()),n.push(o)}return t.clear(),n},o3=(e,t)=>{if(t.length===1)return t.pop();const n=Ca.create(),r=Ca.angleDegrees(Ca.subtract(n,e[1],e[0]));let o,a;t.forEach((i,c)=>{let u=Ca.angleDegrees(Ca.subtract(n,i[1],i[0]))-r;u<-180&&(u+=360),u>=180&&(u-=360),(a===void 0||u>o)&&(a=c,o=u)});const s=t[a];return t.splice(a,1),s};var jm=r3;const a3=ss,s3=e=>{const n=a3(e).map(r=>r[0]);return n.length>0&&n.push(n.shift()),n};var i3=s3;const I1=ut,c3=ss,l3=e=>{const t=c3(e);let n="geom2 ("+t.length+` sides):
[
`;return t.forEach(r=>{n+="  ["+I1.toString(r[0])+", "+I1.toString(r[1])+`]
`}),n+=`]
`,n};var u3=l3;const f3=e=>{const t=e.sides,n=e.transforms;let r=[-1,-1,-1,-1];e.color&&(r=e.color);const o=new Float32Array(1+16+4+t.length*4);o[0]=0,o[1]=n[0],o[2]=n[1],o[3]=n[2],o[4]=n[3],o[5]=n[4],o[6]=n[5],o[7]=n[6],o[8]=n[7],o[9]=n[8],o[10]=n[9],o[11]=n[10],o[12]=n[11],o[13]=n[12],o[14]=n[13],o[15]=n[14],o[16]=n[15],o[17]=r[0],o[18]=r[1],o[19]=r[2],o[20]=r[3];for(let a=0;a<t.length;a++){const s=a*4+21,i=t[a][0],c=t[a][1];o[s+0]=i[0],o[s+1]=i[1],o[s+2]=c[0],o[s+3]=c[1]}return o};var d3=f3;const F1=Tt,h3=(e,t)=>{const n=F1.multiply(F1.create(),e,t.transforms);return Object.assign({},t,{transforms:n})};var p3=h3;const m3=ut,v3=Vm,g3=jm,y3=e=>{if(!v3(e))throw new Error("invalid geom2 structure");if(g3(e),e.sides.forEach(t=>{if(m3.equals(t[0],t[1]))throw new Error(`geom2 self-edge ${t[0]}`)}),!e.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${e.transforms}`)};var b3=y3,at={clone:V_,create:Gi,fromPoints:BE,fromCompactBinary:UE,isA:Vm,reverse:JE,toOutlines:jm,toPoints:i3,toSides:ss,toString:u3,toCompactBinary:d3,transform:p3,validate:b3};const _3=e=>Object.assign({},e);var x3=_3;const w3=Tt,E3=e=>(e===void 0&&(e=[]),{polygons:e,transforms:w3.create()});var zi=E3;const A3=e=>((e===void 0||e.length<3)&&(e=[]),{vertices:e});var Jo=A3;const T3=Jo,$3=He,S3=(...e)=>{let t,n;return e.length===1?(t=T3(),n=e[0]):(t=e[0],n=e[1]),t.vertices=n.vertices.map(r=>$3.clone(r)),t};var P3=S3;const C3=He,O3=Jo,R3=e=>{const t=e.map(n=>C3.clone(n));return O3(t)};var N3=R3;const M3=Jo,D3=(e,t)=>{const n=M3(e);return n.plane=t,n};var L3=D3;const k3=()=>[0,0,0,0];var Vi=k3;const I3=Vi,F3=e=>{const t=I3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};var Um=F3;const G3=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e);var qm=G3;const B3=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3];var Xm=B3;const z3=(e,t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e);var Hm=z3;const dl=He,V3=(e,t,n)=>{const r=dl.normalize(dl.create(),t),o=dl.dot(n,r);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=o,e};var j3=V3;const U3=Vi,q3=(e,t,n,r)=>{const o=U3();return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o};var Wm=q3;const Yn=He,X3=(e,...t)=>{const n=t.length,r=Yn.create(),o=Yn.create(),a=s=>{const i=t[s],c=t[(s+1)%n],l=t[(s+2)%n];return Yn.subtract(r,c,i),Yn.subtract(o,l,i),Yn.cross(r,r,o),Yn.normalize(r,r),r};return e[0]=0,e[1]=0,e[2]=0,n===3?Yn.copy(e,a(0)):(t.forEach((s,i)=>{Yn.add(e,e,a(i))}),Yn.normalize(e,e)),e[3]=Yn.dot(e,t[0]),e};var Ym=X3;const{EPS:hl}=mt,dn=He,H3=(e,t,n,r)=>{let o=dn.subtract(dn.create(),n,t),a=dn.subtract(dn.create(),r,t);dn.length(o)<hl&&(o=dn.orthogonal(o,a)),dn.length(a)<hl&&(a=dn.orthogonal(a,o));let s=dn.cross(dn.create(),o,a);dn.length(s)<hl&&(a=dn.orthogonal(a,o),s=dn.cross(s,o,a)),s=dn.normalize(s,s);const i=dn.dot(s,t);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=i,e};var W3=H3;const Y3=He,Z3=(e,t)=>{const n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]-e[3],r=t[0]-n*e[0],o=t[1]-n*e[1],a=t[2]-n*e[2];return Y3.fromValues(r,o,a)};var K3=Z3;const Q3=He,J3=(e,t)=>Q3.dot(e,t)-e[3];var Zm=J3;const eA=e=>`(${e[0].toFixed(9)}, ${e[1].toFixed(9)}, ${e[2].toFixed(9)}, ${e[3].toFixed(9)})`;var Km=eA;const tA=Tt,hn=He,nA=Ym,rA=Hm,oA=(e,t,n)=>{const r=tA.isMirroring(n),o=hn.orthogonal(hn.create(),t),a=hn.cross(o,t,o),s=hn.cross(hn.create(),t,a);let i=hn.fromScalar(hn.create(),t[3]);hn.multiply(i,i,t);let c=hn.add(hn.create(),i,a),l=hn.add(hn.create(),i,s);return i=hn.transform(i,i,n),c=hn.transform(c,c,n),l=hn.transform(l,l,n),nA(e,i,c,l),r&&rA(e,e),e};var aA=oA,er={clone:Um,copy:qm,create:Vi,equals:Xm,flip:Hm,fromNormalAndPoint:j3,fromValues:Wm,fromPoints:Ym,fromPointsRandom:W3,projectionOfPoint:K3,signedDistanceToPoint:Zm,toString:Km,transform:aA};const G1=er,sA=Jo,iA=e=>{const t=e.vertices.slice().reverse(),n=sA(t);return e.plane&&(n.plane=G1.flip(G1.create(),e.plane)),n};var cA=iA;const lA=e=>!!(e&&typeof e=="object"&&"vertices"in e&&Array.isArray(e.vertices));var Qm=lA;const B1=er,Yr=He,uA=e=>fA(e.vertices),fA=e=>{const t=e.length;if(t>2){const n=B1.fromPoints(B1.create(),...e);let r=e[t-2],o=e[t-1];for(let a=0;a<t;a++){const s=e[a];if(!dA(r,o,s,n))return!1;r=o,o=s}}return!0},dA=(e,t,n,r)=>{const o=Yr.cross(Yr.create(),Yr.subtract(Yr.create(),t,e),Yr.subtract(Yr.create(),n,t));return Yr.dot(o,r)>=0};var Jm=uA;const z1=er,hA=e=>(e.plane||(e.plane=z1.fromPoints(z1.create(),...e.vertices)),e.plane);var Ju=hA;const pA=Ju,mA=e=>{const t=e.vertices.length;if(t<3)return 0;const n=e.vertices,r=pA(e),o=Math.abs(r[0]),a=Math.abs(r[1]),s=Math.abs(r[2]);if(o+a+s===0)return 0;let i=3;o>a&&o>s?i=1:a>s&&(i=2);let c=0,l=0,u=1,f=2;switch(i){case 1:for(u=1;u<t;u++)l=u-1,f=(u+1)%t,c+=n[u][1]*(n[f][2]-n[l][2]);c+=n[0][1]*(n[1][2]-n[t-1][2]),c/=2*r[0];break;case 2:for(u=1;u<t;u++)l=u-1,f=(u+1)%t,c+=n[u][2]*(n[f][0]-n[l][0]);c+=n[0][2]*(n[1][0]-n[t-1][0]),c/=2*r[1];break;case 3:default:for(u=1;u<t;u++)l=u-1,f=(u+1)%t,c+=n[u][0]*(n[f][1]-n[l][1]);c+=n[0][0]*(n[1][1]-n[t-1][1]),c/=2*r[2];break}return c};var ev=mA;const Oa=He,vA=e=>{const t=e.vertices,n=t.length,r=n===0?Oa.create():Oa.clone(t[0]),o=Oa.clone(r);for(let a=1;a<n;a++)Oa.min(r,r,t[a]),Oa.max(o,o,t[a]);return[r,o]};var gA=vA;const yA=(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];var bA=yA;const _A=(e,t)=>(e[0]=t,e[1]=t,e[2]=t,e[3]=t,e);var xA=_A;const wA=(e,t,n)=>{const[r,o,a,s]=t;return e[0]=n[0]*r+n[4]*o+n[8]*a+n[12]*s,e[1]=n[1]*r+n[5]*o+n[9]*a+n[13]*s,e[2]=n[2]*r+n[6]*o+n[10]*a+n[14]*s,e[3]=n[3]*r+n[7]*o+n[11]*a+n[15]*s,e};var EA=wA,tv={clone:Um,copy:qm,create:Vi,dot:bA,equals:Xm,fromScalar:xA,fromValues:Wm,toString:Km,transform:EA};const AA=tv,V1=new WeakMap,TA=e=>{const t=V1.get(e);if(t)return t;const n=e.vertices,r=AA.create();if(n.length===0)return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r;let o=n[0],a=o,s=o,i=o,c=o,l=o;n.forEach(p=>{o[0]>p[0]&&(o=p),a[1]>p[1]&&(a=p),s[2]>p[2]&&(s=p),i[0]<p[0]&&(i=p),c[1]<p[1]&&(c=p),l[2]<p[2]&&(l=p)}),r[0]=(o[0]+i[0])*.5,r[1]=(a[1]+c[1])*.5,r[2]=(s[2]+l[2])*.5;const u=r[0]-i[0],f=r[1]-c[1],h=r[2]-l[2];return r[3]=Math.sqrt(u*u+f*f+h*h),V1.set(e,r),r};var $A=TA;const pl=He,SA=e=>{let t=0;const n=e.vertices,r=pl.create();for(let o=0;o<n.length-2;o++)pl.cross(r,n[o+1],n[o+2]),t+=pl.dot(n[0],r);return t/=6,t};var PA=SA;const CA=e=>e.vertices;var OA=CA;const RA=He,NA=e=>{let t="poly3: vertices: [";return e.vertices.forEach(n=>{t+=`${RA.toString(n)}, `}),t+="]",t};var MA=NA;const DA=Tt,j1=He,LA=Jo,kA=(e,t)=>{const n=t.vertices.map(r=>j1.transform(j1.create(),r,e));return DA.isMirroring(e)&&n.reverse(),LA(n)};var IA=kA;const FA=Zm,{NEPS:GA}=mt,BA=He,zA=Qm,VA=Jm,jA=ev,UA=Ju,qA=e=>{if(!zA(e))throw new Error("invalid poly3 structure");if(e.vertices.length<3)throw new Error(`poly3 not enough vertices ${e.vertices.length}`);if(jA(e)<=0)throw new Error("poly3 area must be greater than zero");for(let t=0;t<e.vertices.length;t++)if(BA.equals(e.vertices[t],e.vertices[(t+1)%e.vertices.length]))throw new Error(`poly3 duplicate vertex ${e.vertices[t]}`);if(!VA(e))throw new Error("poly3 must be convex");if(e.vertices.forEach(t=>{if(!t.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${t}`)}),e.vertices.length>3){const t=UA(e);e.vertices.forEach(n=>{const r=Math.abs(FA(t,n));if(r>GA)throw new Error(`poly3 must be coplanar: vertex ${n} distance ${r}`)})}};var XA=qA,vt={clone:P3,create:Jo,fromPoints:N3,fromPointsAndPlane:L3,invert:cA,isA:Qm,isConvex:Jm,measureArea:ev,measureBoundingBox:gA,measureBoundingSphere:$A,measureSignedVolume:PA,plane:Ju,toPoints:OA,toString:MA,transform:IA,validate:XA};const HA=vt,WA=zi,YA=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");const t=e.map((r,o)=>HA.create(r));return WA(t)};var ZA=YA;const KA=He,QA=Tt,JA=vt,eT=zi,tT=e=>{if(e[0]!==1)throw new Error("invalid compact binary data");const t=eT();t.transforms=QA.clone(e.slice(1,17));const n=e[21];let r=22,o=e.length-n*3;for(;o<e.length;){const a=e[r];r++;const s=[];for(let i=0;i<a;i++)s.push(KA.fromValues(e[o],e[o+1],e[o+2])),o+=3;t.polygons.push(JA.create(s))}return e[17]>=0&&(t.color=[e[17],e[18],e[19],e[20]]),t};var nT=tT;const U1=Tt,rT=vt,oT=e=>(U1.isIdentity(e.transforms)||(e.polygons=e.polygons.map(t=>rT.transform(e.transforms,t)),e.transforms=U1.create()),e);var aT=oT;const sT=aT,iT=e=>sT(e).polygons;var ji=iT;const cT=vt,lT=zi,uT=ji,fT=e=>{const n=uT(e).map(r=>cT.invert(r));return lT(n)};var dT=fT;const hT=e=>!!(e&&typeof e=="object"&&"polygons"in e&&"transforms"in e&&Array.isArray(e.polygons)&&"length"in e.transforms);var nv=hT;const pT=vt,mT=ji,vT=e=>mT(e).map(r=>pT.toPoints(r));var gT=vT;const yT=vt,bT=ji,_T=e=>{const t=bT(e);let n="geom3 ("+t.length+` polygons):
`;return t.forEach(r=>{n+="  "+yT.toString(r)+`
`}),n};var xT=_T;const wT=vt,ET=e=>{const t=e.polygons,n=e.transforms,r=t.length,o=t.reduce((l,u)=>l+u.vertices.length,0);let a=[-1,-1,-1,-1];e.color&&(a=e.color);const s=new Float32Array(1+16+4+1+r+o*3);s[0]=1,s[1]=n[0],s[2]=n[1],s[3]=n[2],s[4]=n[3],s[5]=n[4],s[6]=n[5],s[7]=n[6],s[8]=n[7],s[9]=n[8],s[10]=n[9],s[11]=n[10],s[12]=n[11],s[13]=n[12],s[14]=n[13],s[15]=n[14],s[16]=n[15],s[17]=a[0],s[18]=a[1],s[19]=a[2],s[20]=a[3],s[21]=o;let i=22,c=i+r;return t.forEach(l=>{const u=wT.toPoints(l);s[i]=u.length,i++;for(let f=0;f<u.length;f++){const h=u[f];s[c+0]=h[0],s[c+1]=h[1],s[c+2]=h[2],c+=3}}),s};var AT=ET;const q1=Tt,TT=(e,t)=>{const n=q1.multiply(q1.create(),e,t.transforms);return Object.assign({},t,{transforms:n})};var $T=TT;const ST=vt,PT=nv,CT=e=>{if(!PT(e))throw new Error("invalid geom3 structure");if(e.polygons.forEach(ST.validate),OT(e),!e.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${e.transforms}`)},OT=e=>{const t=new Map;e.polygons.forEach(({vertices:r})=>{r.forEach((o,a)=>{const s=`${o}`,i=`${r[(a+1)%r.length]}`,c=`${s}/${i}`,l=t.has(c)?t.get(c):0;t.set(c,l+1)})});const n=[];if(t.forEach((r,o)=>{const a=o.split("/").reverse().join("/"),s=t.get(a);r!==s&&n.push(o.replace("/"," -> "))}),n.length>0)throw new Error(`non-manifold edges ${n.length}
${n.join(`
`)}`)};var RT=CT,st={clone:x3,create:zi,fromPoints:ZA,fromCompactBinary:nT,invert:dT,isA:nv,toPoints:gT,toPolygons:ji,toString:xT,toCompactBinary:AT,transform:$T,validate:RT};const NT=e=>Object.assign({},e);var ef=NT;const{EPS:X1}=mt,MT=ut,DT=ef,LT=e=>{if(e.isClosed)return e;const t=DT(e);if(t.isClosed=!0,t.points.length>1){const n=t.points,r=n[0];let o=n[n.length-1];for(;MT.distance(r,o)<X1*X1&&(n.pop(),n.length!==1);)o=n[n.length-1]}return t};var rv=LT;const kT=Tt,IT=e=>(e===void 0&&(e=[]),{points:e,isClosed:!1,transforms:kT.create()});var Ui=IT;const{EPS:H1}=mt,W1=ut,FT=rv,GT=Ui,BT=(e,t)=>{const n={closed:!1};let{closed:r}=Object.assign({},n,e),o=GT();if(o.points=t.map(a=>W1.clone(a)),o.points.length>1){const a=o.points[0],s=o.points[o.points.length-1];W1.distance(a,s)<H1*H1&&(r=!0)}return r===!0&&(o=FT(o)),o};var tf=BT;const Y1=Tt,Z1=ut,zT=e=>(Y1.isIdentity(e.transforms)||(e.points=e.points.map(t=>Z1.transform(Z1.create(),t,e.transforms)),e.transforms=Y1.create()),e);var VT=zT;const jT=VT,UT=e=>jT(e).points;var ea=UT;const{TAU:qs}=mt,Zt=ut,qT=tf,XT=ea,HT=(e,t)=>{const n={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16};let{endpoint:r,radius:o,xaxisrotation:a,clockwise:s,large:i,segments:c}=Object.assign({},n,e);if(!Array.isArray(r))throw new Error("endpoint must be an array of X and Y values");if(r.length<2)throw new Error("endpoint must contain X and Y values");if(r=Zt.clone(r),!Array.isArray(o))throw new Error("radius must be an array of X and Y values");if(o.length<2)throw new Error("radius must contain X and Y values");if(c<4)throw new Error("segments must be four or more");const l=1e5;if(t.isClosed)throw new Error("the given path cannot be closed");const u=XT(t);if(u.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let f=o[0],h=o[1];const p=u[u.length-1];f=Math.round(f*l)/l,h=Math.round(h*l)/l,r=Zt.fromValues(Math.round(r[0]*l)/l,Math.round(r[1]*l)/l);const g=!s;let v=[];if(f===0||h===0)v.push(r);else{f=Math.abs(f),h=Math.abs(h);const x=a,P=Math.cos(x),S=Math.sin(x),O=Zt.subtract(Zt.create(),p,r);Zt.scale(O,O,.5);const R=Math.round((P*O[0]+S*O[1])*l)/l,N=Math.round((-S*O[0]+P*O[1])*l)/l,I=Zt.fromValues(R,N),X=I[0]*I[0]/(f*f)+I[1]*I[1]/(h*h);if(X>1){const Fe=Math.sqrt(X);f*=Fe,h*=Fe,f=Math.round(f*l)/l,h=Math.round(h*l)/l}let W=Math.sqrt((f*f*h*h-f*f*I[1]*I[1]-h*h*I[0]*I[0])/(f*f*I[1]*I[1]+h*h*I[0]*I[0]));g===i&&(W=-W);const J=Zt.fromValues(f*I[1]/h,-h*I[0]/f);Zt.scale(J,J,W);let G=Zt.fromValues(P*J[0]-S*J[1],S*J[0]+P*J[1]);G=Zt.add(G,G,Zt.scale(Zt.create(),Zt.add(Zt.create(),p,r),.5));const ce=Zt.fromValues((I[0]-J[0])/f,(I[1]-J[1])/h),_e=Zt.fromValues((-I[0]-J[0])/f,(-I[1]-J[1])/h),de=Zt.angleRadians(ce);let be=Zt.angleRadians(_e)-de;be=be%qs,!g&&be>0?be-=qs:g&&be<0&&(be+=qs);let Ve=Math.ceil(Math.abs(be)/qs*c)+1;Ve<1&&(Ve=1);for(let Fe=1;Fe<Ve;Fe++){const et=de+Fe/Ve*be,dt=Math.cos(et),bt=Math.sin(et),$t=Zt.fromValues(P*f*dt-S*h*bt,S*f*dt+P*h*bt);Zt.add($t,$t,G),v.push($t)}Ve&&v.push(e.endpoint)}return v=u.concat(v),qT({},v)};var WT=HT;const YT=tf,ZT=ea,{equals:KT}=ut,QT=(...e)=>{let t=!1,n=[];return e.forEach((r,o)=>{const a=ZT(r).slice();if(n.length>0&&a.length>0&&KT(a[0],n[n.length-1])&&a.shift(),a.length>0&&t)throw new Error(`Cannot concatenate to a closed path; check the ${o}th path`);t=r.isClosed,n=n.concat(a)}),YT({closed:t},n)};var ov=QT;const JT=ov,e$=Ui,t$=(e,t)=>JT(t,e$(e));var av=t$;const{TAU:n$}=mt,Cn=ut,r$=ut,o$=av,a$=ea,s$=(e,t)=>{const n={segments:16};let{controlPoints:r,segments:o}=Object.assign({},n,e);if(!Array.isArray(r))throw new Error("controlPoints must be an array of one or more points");if(r.length<1)throw new Error("controlPoints must be an array of one or more points");if(o<4)throw new Error("segments must be four or more");if(t.isClosed)throw new Error("the given geometry cannot be closed");const a=a$(t);if(a.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(r=r.slice(),r[0]===null){if(r.length<2)throw new Error("a null control point must be passed with one more control points");let N=a[a.length-2];if("lastBezierControlPoint"in t&&(N=t.lastBezierControlPoint),!Array.isArray(N))throw new Error("the given path must contain TWO or more points if given a null control point");const I=Cn.scale(Cn.create(),a[a.length-1],2);Cn.subtract(I,I,N),r[0]=I}r.unshift(a[a.length-1]);const i=r.length-1,c=[];let l=1;for(let N=0;N<=i;++N)N>0&&(l*=N),c.push(l);const u=[];for(let N=0;N<=i;++N){const I=c[i]/(c[N]*c[i-N]);u.push(I)}const f=Cn.create(),h=Cn.create(),p=r$.create(),g=N=>{let I=1,X=Math.pow(1-N,i);const W=N!==1?1/(1-N):1,J=Cn.create();for(let G=0;G<=i;++G){G===i&&(X=1);const ce=u[G]*I*X,_e=Cn.scale(f,r[G],ce);Cn.add(J,J,_e),I*=N,X*=W}return J},v=[],m=[],x=i+1;for(let N=0;N<x;++N){const I=N/(x-1),X=g(I);v.push(X),m.push(I)}let P=1;const S=n$/o,O=Math.sin(S);for(;P<v.length-1;){const N=Cn.subtract(f,v[P],v[P-1]);Cn.normalize(N,N);const I=Cn.subtract(h,v[P+1],v[P]);Cn.normalize(I,I);const X=Cn.cross(p,N,I);if(Math.abs(X[2])>O){const W=m[P-1],J=m[P+1],G=W+(J-W)*1/3,ce=W+(J-W)*2/3,_e=g(G),de=g(ce);v.splice(P,1,_e,de),m.splice(P,1,G,ce),P--,P<1&&(P=1)}else++P}v.shift();const R=o$(v,t);return R.lastBezierControlPoint=r[r.length-2],R};var i$=s$;const c$=ut,K1=ea,l$=(e,t)=>{if(e.isClosed!==t.isClosed||e.points.length!==t.points.length)return!1;const n=K1(e),r=K1(t),o=n.length;let a=0;do{let s=!1;for(let i=0;i<o;i++)if(!c$.equals(n[i],r[(i+a)%o])){s=!0;break}if(s===!1)return!0;if(!e.isClosed)return!1}while(++a<o);return!1};var u$=l$;const f$=Tt,d$=ut,h$=Ui,p$=e=>{if(e[0]!==2)throw new Error("invalid compact binary data");const t=h$();t.transforms=f$.clone(e.slice(1,17)),t.isClosed=!!e[17];for(let n=22;n<e.length;n+=2){const r=d$.fromValues(e[n],e[n+1]);t.points.push(r)}return e[18]>=0&&(t.color=[e[18],e[19],e[20],e[21]]),t};var m$=p$;const v$=e=>!!(e&&typeof e=="object"&&"points"in e&&"transforms"in e&&"isClosed"in e&&Array.isArray(e.points)&&"length"in e.transforms);var sv=v$;const g$=ef,y$=e=>{const t=g$(e);return t.points=e.points.slice().reverse(),t};var b$=y$;const _$=ut,x$=ea,w$=e=>{const t=x$(e);let n="path ("+t.length+" points, "+e.isClosed+`):
[
`;return t.forEach(r=>{n+="  "+_$.toString(r)+`,
`}),n+=`]
`,n};var E$=w$;const A$=e=>{const t=e.points,n=e.transforms;let r=[-1,-1,-1,-1];e.color&&(r=e.color);const o=new Float32Array(1+16+1+4+t.length*2);o[0]=2,o[1]=n[0],o[2]=n[1],o[3]=n[2],o[4]=n[3],o[5]=n[4],o[6]=n[5],o[7]=n[6],o[8]=n[7],o[9]=n[8],o[10]=n[9],o[11]=n[10],o[12]=n[11],o[13]=n[12],o[14]=n[13],o[15]=n[14],o[16]=n[15],o[17]=e.isClosed?1:0,o[18]=r[0],o[19]=r[1],o[20]=r[2],o[21]=r[3];for(let a=0;a<t.length;a++){const s=a*2+22,i=t[a];o[s]=i[0],o[s+1]=i[1]}return o};var T$=A$;const Q1=Tt,$$=(e,t)=>{const n=Q1.multiply(Q1.create(),e,t.transforms);return Object.assign({},t,{transforms:n})};var S$=$$;const P$=ut,C$=sv,O$=e=>{if(!C$(e))throw new Error("invalid path2 structure");if(e.points.length>1){for(let t=0;t<e.points.length;t++)if(P$.equals(e.points[t],e.points[(t+1)%e.points.length]))throw new Error(`path2 duplicate points ${e.points[t]}`)}if(e.points.forEach(t=>{if(!t.every(Number.isFinite))throw new Error(`path2 invalid point ${t}`)}),!e.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${e.transforms}`)};var R$=O$,Et={appendArc:WT,appendBezier:i$,appendPoints:av,clone:ef,close:rv,concat:ov,create:Ui,equals:u$,fromPoints:tf,fromCompactBinary:m$,isA:sv,reverse:b$,toPoints:ea,toString:E$,toCompactBinary:T$,transform:S$,validate:R$};const N$=nt,iv=at,cv=st,lv=Et,uv=vt,M$=(e,t)=>{const n=iv.clone(t);return n.color=e,n},D$=(e,t)=>{const n=cv.clone(t);return n.color=e,n},L$=(e,t)=>{const n=lv.clone(t);return n.color=e,n},k$=(e,t)=>{const n=uv.clone(t);return n.color=e,n},I$=(e,...t)=>{if(!Array.isArray(e))throw new Error("color must be an array");if(e.length<3)throw new Error("color must contain R, G and B values");if(e.length===3&&(e=[e[0],e[1],e[2],1]),t=N$(t),t.length===0)throw new Error("wrong number of arguments");const n=t.map(r=>iv.isA(r)?M$(e,r):cv.isA(r)?D$(e,r):lv.isA(r)?L$(e,r):uv.isA(r)?k$(e,r):(r.color=e,r));return n.length===1?n[0]:n};var F$=I$;const G$={black:[0/255,0/255,0/255],silver:[192/255,192/255,192/255],gray:[128/255,128/255,128/255],white:[255/255,255/255,255/255],maroon:[128/255,0/255,0/255],red:[255/255,0/255,0/255],purple:[128/255,0/255,128/255],fuchsia:[255/255,0/255,255/255],green:[0/255,128/255,0/255],lime:[0/255,255/255,0/255],olive:[128/255,128/255,0/255],yellow:[255/255,255/255,0/255],navy:[0/255,0/255,128/255],blue:[0/255,0/255,255/255],teal:[0/255,128/255,128/255],aqua:[0/255,255/255,255/255],aliceblue:[240/255,248/255,255/255],antiquewhite:[250/255,235/255,215/255],aquamarine:[127/255,255/255,212/255],azure:[240/255,255/255,255/255],beige:[245/255,245/255,220/255],bisque:[255/255,228/255,196/255],blanchedalmond:[255/255,235/255,205/255],blueviolet:[138/255,43/255,226/255],brown:[165/255,42/255,42/255],burlywood:[222/255,184/255,135/255],cadetblue:[95/255,158/255,160/255],chartreuse:[127/255,255/255,0/255],chocolate:[210/255,105/255,30/255],coral:[255/255,127/255,80/255],cornflowerblue:[100/255,149/255,237/255],cornsilk:[255/255,248/255,220/255],crimson:[220/255,20/255,60/255],cyan:[0/255,255/255,255/255],darkblue:[0/255,0/255,139/255],darkcyan:[0/255,139/255,139/255],darkgoldenrod:[184/255,134/255,11/255],darkgray:[169/255,169/255,169/255],darkgreen:[0/255,100/255,0/255],darkgrey:[169/255,169/255,169/255],darkkhaki:[189/255,183/255,107/255],darkmagenta:[139/255,0/255,139/255],darkolivegreen:[85/255,107/255,47/255],darkorange:[255/255,140/255,0/255],darkorchid:[153/255,50/255,204/255],darkred:[139/255,0/255,0/255],darksalmon:[233/255,150/255,122/255],darkseagreen:[143/255,188/255,143/255],darkslateblue:[72/255,61/255,139/255],darkslategray:[47/255,79/255,79/255],darkslategrey:[47/255,79/255,79/255],darkturquoise:[0/255,206/255,209/255],darkviolet:[148/255,0/255,211/255],deeppink:[255/255,20/255,147/255],deepskyblue:[0/255,191/255,255/255],dimgray:[105/255,105/255,105/255],dimgrey:[105/255,105/255,105/255],dodgerblue:[30/255,144/255,255/255],firebrick:[178/255,34/255,34/255],floralwhite:[255/255,250/255,240/255],forestgreen:[34/255,139/255,34/255],gainsboro:[220/255,220/255,220/255],ghostwhite:[248/255,248/255,255/255],gold:[255/255,215/255,0/255],goldenrod:[218/255,165/255,32/255],greenyellow:[173/255,255/255,47/255],grey:[128/255,128/255,128/255],honeydew:[240/255,255/255,240/255],hotpink:[255/255,105/255,180/255],indianred:[205/255,92/255,92/255],indigo:[75/255,0/255,130/255],ivory:[255/255,255/255,240/255],khaki:[240/255,230/255,140/255],lavender:[230/255,230/255,250/255],lavenderblush:[255/255,240/255,245/255],lawngreen:[124/255,252/255,0/255],lemonchiffon:[255/255,250/255,205/255],lightblue:[173/255,216/255,230/255],lightcoral:[240/255,128/255,128/255],lightcyan:[224/255,255/255,255/255],lightgoldenrodyellow:[250/255,250/255,210/255],lightgray:[211/255,211/255,211/255],lightgreen:[144/255,238/255,144/255],lightgrey:[211/255,211/255,211/255],lightpink:[255/255,182/255,193/255],lightsalmon:[255/255,160/255,122/255],lightseagreen:[32/255,178/255,170/255],lightskyblue:[135/255,206/255,250/255],lightslategray:[119/255,136/255,153/255],lightslategrey:[119/255,136/255,153/255],lightsteelblue:[176/255,196/255,222/255],lightyellow:[255/255,255/255,224/255],limegreen:[50/255,205/255,50/255],linen:[250/255,240/255,230/255],magenta:[255/255,0/255,255/255],mediumaquamarine:[102/255,205/255,170/255],mediumblue:[0/255,0/255,205/255],mediumorchid:[186/255,85/255,211/255],mediumpurple:[147/255,112/255,219/255],mediumseagreen:[60/255,179/255,113/255],mediumslateblue:[123/255,104/255,238/255],mediumspringgreen:[0/255,250/255,154/255],mediumturquoise:[72/255,209/255,204/255],mediumvioletred:[199/255,21/255,133/255],midnightblue:[25/255,25/255,112/255],mintcream:[245/255,255/255,250/255],mistyrose:[255/255,228/255,225/255],moccasin:[255/255,228/255,181/255],navajowhite:[255/255,222/255,173/255],oldlace:[253/255,245/255,230/255],olivedrab:[107/255,142/255,35/255],orange:[255/255,165/255,0/255],orangered:[255/255,69/255,0/255],orchid:[218/255,112/255,214/255],palegoldenrod:[238/255,232/255,170/255],palegreen:[152/255,251/255,152/255],paleturquoise:[175/255,238/255,238/255],palevioletred:[219/255,112/255,147/255],papayawhip:[255/255,239/255,213/255],peachpuff:[255/255,218/255,185/255],peru:[205/255,133/255,63/255],pink:[255/255,192/255,203/255],plum:[221/255,160/255,221/255],powderblue:[176/255,224/255,230/255],rosybrown:[188/255,143/255,143/255],royalblue:[65/255,105/255,225/255],saddlebrown:[139/255,69/255,19/255],salmon:[250/255,128/255,114/255],sandybrown:[244/255,164/255,96/255],seagreen:[46/255,139/255,87/255],seashell:[255/255,245/255,238/255],sienna:[160/255,82/255,45/255],skyblue:[135/255,206/255,235/255],slateblue:[106/255,90/255,205/255],slategray:[112/255,128/255,144/255],slategrey:[112/255,128/255,144/255],snow:[255/255,250/255,250/255],springgreen:[0/255,255/255,127/255],steelblue:[70/255,130/255,180/255],tan:[210/255,180/255,140/255],thistle:[216/255,191/255,216/255],tomato:[255/255,99/255,71/255],turquoise:[64/255,224/255,208/255],violet:[238/255,130/255,238/255],wheat:[245/255,222/255,179/255],whitesmoke:[245/255,245/255,245/255],yellowgreen:[154/255,205/255,50/255]};var fv=G$;const B$=fv,z$=e=>B$[e.toLowerCase()];var V$=z$;const j$=e=>{if(e=e.replace("#",""),e.length<6)throw new Error("the given notation must contain 3 or more hex values");const t=parseInt(e.substring(0,2),16)/255,n=parseInt(e.substring(2,4),16)/255,r=parseInt(e.substring(4,6),16)/255;if(e.length>=8){const o=parseInt(e.substring(6,8),16)/255;return[t,n,r,o]}return[t,n,r]};var U$=j$;const q$=(e,t,n)=>(n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e);var dv=q$;const X$=nt,ml=dv,H$=(...e)=>{if(e=X$(e),e.length<3)throw new Error("values must contain H, S and L values");const t=e[0],n=e[1],r=e[2];let o=r,a=r,s=r;if(n!==0){const i=r<.5?r*(1+n):r+n-r*n,c=2*r-i;o=ml(c,i,t+1/3),a=ml(c,i,t),s=ml(c,i,t-1/3)}if(e.length>3){const i=e[3];return[o,a,s,i]}return[o,a,s]};var W$=H$;const Y$=nt,Z$=(...e)=>{if(e=Y$(e),e.length<3)throw new Error("values must contain H, S and V values");const t=e[0],n=e[1],r=e[2];let o=0,a=0,s=0;const i=Math.floor(t*6),c=t*6-i,l=r*(1-n),u=r*(1-c*n),f=r*(1-(1-c)*n);switch(i%6){case 0:o=r,a=f,s=l;break;case 1:o=u,a=r,s=l;break;case 2:o=l,a=r,s=f;break;case 3:o=l,a=u,s=r;break;case 4:o=f,a=l,s=r;break;case 5:o=r,a=l,s=u;break}if(e.length>3){const h=e[3];return[o,a,s,h]}return[o,a,s]};var K$=Z$;const Q$=nt,J$=(...e)=>{if(e=Q$(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0]*255,n=e[1]*255,r=e[2]*255;let o=`#${Number(16777216+t*65536+n*256+r).toString(16).substring(1,7)}`;return e.length>3&&(o=o+Number(e[3]*255).toString(16)),o};var eS=J$;const tS=nt,nS=(...e)=>{if(e=tS(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0],n=e[1],r=e[2],o=Math.max(t,n,r),a=Math.min(t,n,r);let s,i;const c=(o+a)/2;if(o===a)s=i=0;else{const l=o-a;switch(i=c>.5?l/(2-o-a):l/(o+a),o){case t:s=(n-r)/l+(n<r?6:0);break;case n:s=(r-t)/l+2;break;case r:s=(t-n)/l+4;break}s/=6}if(e.length>3){const l=e[3];return[s,i,c,l]}return[s,i,c]};var rS=nS;const oS=nt,aS=(...e)=>{if(e=oS(e),e.length<3)throw new Error("values must contain R, G and B values");const t=e[0],n=e[1],r=e[2],o=Math.max(t,n,r),a=Math.min(t,n,r);let s;const i=o,c=o-a,l=o===0?0:c/o;if(o===a)s=0;else{switch(o){case t:s=(n-r)/c+(n<r?6:0);break;case n:s=(r-t)/c+2;break;case r:s=(t-n)/c+4;break}s/=6}if(e.length>3){const u=e[3];return[s,l,i,u]}return[s,l,i]};var sS=aS,iS={colorize:F$,colorNameToRgb:V$,cssColors:fv,hexToRgb:U$,hslToRgb:W$,hsvToRgb:K$,hueToColorComponent:dv,rgbToHex:eS,rgbToHsl:rS,rgbToHsv:sS};const cS=e=>{if(!Array.isArray(e))throw new Error("Bezier points must be a valid array/");if(e.length<2)throw new Error("Bezier points must contain at least 2 values.");const t=lS(e);return{points:e,pointType:t,dimensions:t==="float_single"?0:e[0].length,permutations:J1(e.length-1),tangentPermutations:J1(e.length-2)}},lS=function(e){let t=null;return e.forEach(n=>{let r="";if(Number.isFinite(n))r="float_single";else if(Array.isArray(n))n.forEach(o=>{if(!Number.isFinite(o))throw new Error("Bezier point values must all be numbers.")}),r="float_"+n.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(t==null)t=r;else if(t!==r)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),t},J1=function(e){const t=[];for(let n=0;n<=e;n++)t.push(vl(e)/(vl(n)*vl(e-n)));return t},vl=function(e){let t=1;for(let n=2;n<=e;n++)t*=n;return t};var uS=cS;const fS=(e,t)=>{if(e<0||e>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(t.pointType==="float_single")return eh(t,t.points,e);{const n=[];for(let r=0;r<t.dimensions;r++){const o=[];for(let a=0;a<t.points.length;a++)o.push(t.points[a][r]);n.push(eh(t,o,e))}return n}},eh=function(e,t,n){const r=t.length-1;let o=0;for(let a=0;a<=r;a++)o+=e.permutations[a]*Math.pow(1-n,r-a)*Math.pow(n,a)*t[a];return o};var hv=fS;const dS=(e,t)=>{if(e<0||e>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(t.pointType==="float_single")return th(t,t.points,e);{const n=[];for(let r=0;r<t.dimensions;r++){const o=[];for(let a=0;a<t.points.length;a++)o.push(t.points[a][r]);n.push(th(t,o,e))}return n}},th=function(e,t,n){const r=t.length-1;let o=0;for(let a=0;a<r;a++){const s=r*(t[a+1]-t[a]);o+=e.tangentPermutations[a]*Math.pow(1-n,r-1-a)*Math.pow(n,a)*s}return o};var hS=dS;const nh=hv,pS=(e,t)=>{let n=0;const r=[0];let o=nh(0,t);for(let a=1;a<=e;a++){const s=nh(a/e,t);n+=mS(s,o),r.push(n),o=s}return r},mS=(e,t)=>{if(Number.isFinite(e)&&Number.isFinite(t))return Math.abs(e-t);if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)throw new Error("The operands must have the same number of dimensions.");let n=0;for(let r=0;r<e.length;r++)n+=(t[r]-e[r])*(t[r]-e[r]);return Math.sqrt(n)}else throw new Error("The operands must be of the same type, either number or array.")};var nf=pS;const vS=nf,gS=(e,t)=>vS(e,t)[e];var yS=gS;const bS=nf,_S=(e,t)=>{const n={distance:0,segments:100},{distance:r,segments:o}=Object.assign({},n,e),a=bS(o,t);let s=0,i=o;for(;s<=i;){const p=Math.floor(s+(i-s)/2),g=a[p]-r;if(g<0)s=p+1;else if(g>0)i=p-1;else{i=p;break}}const c=i;if(a[c]===r)return c/o;const l=a[c],f=a[c+1]-l,h=(r-l)/f;return(c+h)/o};var xS=_S,wS={create:uS,valueAt:hv,tangentAt:hS,lengths:nf,length:yS,arcLengthToT:xS},ES={bezier:wS};const AS=e=>{let t=0;for(let n=0;n<e.length;n++){const r=(n+1)%e.length;t+=e[n][0]*e[r][1],t-=e[r][0]*e[n][1]}return t/2};var qi=AS;const TS=qi,$S=e=>TS(e.vertices);var pv=$S;const SS=e=>((e===void 0||e.length<3)&&(e=[]),{vertices:e});var mv=SS;const PS=mv,CS=e=>{const t=e.vertices.slice().reverse();return PS(t)};var vv=CS;const OS=pv,RS=vv,NS=(e,t)=>{if(e.length===0)return 0;const n=t.vertices;return n.length<3?0:(OS(t)<0&&(t=RS(t)),e.reduce((o,a)=>o+MS(a,n),0)===e.length?1:0)},MS=(e,t)=>{const n=t.length,r=e[0],o=e[1];let a=t[n-1],s=t[0],i=a[1]>o,c=0,l=0;for(let u=n+1;--u;){const f=s[1]>o;if(i!==f){const h=a[0]>r,p=s[0]>r;(h&&p||s[0]-(s[1]-o)*(a[0]-s[0])/(a[1]-s[1])>=r)&&(c=!c)}i=f,a=s,s=t[++l]}return c};var DS=NS,rf={arePointsInside:DS,create:mv,flip:vv,measureArea:pv},of={geom2:at,geom3:st,path2:Et,poly2:rf,poly3:vt};const LS=()=>[0,1,0];var af=LS;const kS=af,IS=e=>{const t=kS();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t};var FS=IS;const gl=ut,GS=e=>{const t=gl.normal(gl.create(),e);return gl.negate(t,t),t};var sf=GS;const rh=ut,BS=e=>rh.scale(rh.create(),e,e[2]);var Xi=BS;const Ra=ut,zS=sf,VS=Xi,jS=(e,t)=>{const n=VS(e),r=zS(e),o=Ra.subtract(Ra.create(),t,n),a=Ra.dot(o,r);return Ra.scale(o,r,a),Ra.add(o,o,n),o};var US=jS;const qS=(e,t)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e);var gv=qS;const XS=ut,HS=(e,t)=>{let n=XS.dot(t,e);return n=Math.abs(n-e[2]),n};var WS=HS;const YS=(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2];var ZS=YS;const Na=ut,KS=(e,t,n)=>{const r=Na.subtract(Na.create(),n,t);Na.normal(r,r),Na.normalize(r,r);const o=Na.dot(t,r);return e[0]=r[0],e[1]=r[1],e[2]=o,e};var yv=KS;const QS=af,JS=(e,t,n)=>{const r=QS();return r[0]=e,r[1]=t,r[2]=n,r};var bv=JS;const{NEPS:yl}=mt,eP=(e,t)=>Math.abs(e[0]-t[0])<=yl&&Math.abs(e[1]-t[1])<=yl&&Math.abs(e[2]-t[2])<=yl;var cf=eP;const tP=(e,t,n)=>{let r=n-e[1],o=t[1]-e[1];o<0&&(r=-r,o=-o);let a;return r<=0?a=0:r>=o?a=1:o<1e-10?a=.5:a=r/o,e[0]+a*(t[0]-e[0])};var _v=tP;const nP=(e,t,n,r)=>{if(e[0]===t[0]&&e[1]===t[1]||n[0]===r[0]&&n[1]===r[1])return;const o=(r[1]-n[1])*(t[0]-e[0])-(r[0]-n[0])*(t[1]-e[1]);if(Math.abs(o)<Number.MIN_VALUE)return;const a=((r[0]-n[0])*(e[1]-n[1])-(r[1]-n[1])*(e[0]-n[0]))/o,s=((t[0]-e[0])*(e[1]-n[1])-(t[1]-e[1])*(e[0]-n[0]))/o;if(a<0||a>1||s<0||s>1)return;const i=e[0]+a*(t[0]-e[0]),c=e[1]+a*(t[1]-e[1]);return[i,c]};var xv=nP;const rP=(e,t,n,r,o,a)=>{const i=1/(e*r-t*n);let c=o*r-t*a,l=-o*n+e*a;return c*=i,l*=i,[c,l]};var oP=rP,is={aboutEqualNormals:cf,area:qi,cos:un.cos,interpolateBetween2DPointsForY:_v,intersect:xv,sin:un.sin,solve2Linear:oP};const aP=ut,{solve2Linear:sP}=is,iP=(e,t)=>{const n=sP(e[0],e[1],t[0],t[1],e[2],t[2]);return aP.clone(n)};var cP=iP;const oh=ut,lP=gv,uP=bv,fP=(e,t)=>{const n=oh.negate(oh.create(),t),r=-t[2];return lP(e,uP(n[0],n[1],r))};var dP=fP;const hP=e=>`line2: (${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)})`;var pP=hP;const ah=ut,mP=yv,vP=Xi,gP=sf,yP=(e,t,n)=>{const r=vP(t),o=gP(t);return ah.transform(r,r,n),ah.transform(o,o,n),mP(e,r,o)};var bP=yP;const _P=Xi,xP=(e,t)=>{let n=(e[2]-e[1]*t)/e[0];return Number.isNaN(n)&&(n=_P(e)[0]),n};var wP=xP,lf={clone:FS,closestPoint:US,copy:gv,create:af,direction:sf,distanceToPoint:WS,equals:ZS,fromPoints:yv,fromValues:bv,intersectPointOfLines:cP,origin:Xi,reverse:dP,toString:pP,transform:bP,xAtY:wP};const sh=He,EP=()=>[sh.fromValues(0,0,0),sh.fromValues(0,0,1)];var wv=EP;const ih=He,AP=wv,TP=e=>{const t=AP();return ih.copy(t[0],e[0]),ih.copy(t[1],e[1]),t};var $P=TP;const Zr=He,SP=(e,t)=>{const n=e[0],r=e[1],o=Zr.dot(Zr.subtract(Zr.create(),t,n),r),a=Zr.dot(r,r),s=o/a,i=Zr.scale(Zr.create(),r,s);return Zr.add(i,i,n),i};var Ev=SP;const ch=He,PP=(e,t)=>(ch.copy(e[0],t[0]),ch.copy(e[1],t[1]),e);var CP=PP;const OP=e=>e[1];var RP=OP;const bl=He,NP=Ev,MP=(e,t)=>{const n=NP(e,t),r=bl.subtract(bl.create(),t,n);return bl.length(r)};var DP=MP;const lh=He,LP=(e,t)=>!(!lh.equals(e[1],t[1])||!lh.equals(e[0],t[0]));var kP=LP;const Xs=He,IP=(e,t,n)=>{const r=Xs.normalize(Xs.create(),n);return Xs.copy(e[0],t),Xs.copy(e[1],r),e};var cs=IP;const Kr=He,{solve2Linear:_l}=is,{EPS:FP}=mt,GP=cs,BP=(e,t,n)=>{let r=Kr.cross(Kr.create(),t,n),o=Kr.length(r);if(o<FP)throw new Error("parallel planes do not intersect");o=1/o,r=Kr.scale(r,r,o);const a=Math.abs(r[0]),s=Math.abs(r[1]),i=Math.abs(r[2]);let c,l;return a>=s&&a>=i?(l=_l(t[1],t[2],n[1],n[2],t[3],n[3]),c=Kr.fromValues(0,l[0],l[1])):s>=a&&s>=i?(l=_l(t[0],t[2],n[0],n[2],t[3],n[3]),c=Kr.fromValues(l[0],0,l[1])):(l=_l(t[0],t[1],n[0],n[1],t[3],n[3]),c=Kr.fromValues(l[0],l[1],0)),GP(e,c,r)};var zP=BP;const uh=He,VP=cs,jP=(e,t,n)=>{const r=uh.subtract(uh.create(),n,t);return VP(e,t,r)};var UP=jP;const Oo=He,qP=(e,t)=>{const n=t,r=t[3],o=e[0],a=e[1],s=(r-Oo.dot(n,o))/Oo.dot(n,a);return Oo.add(Oo.create(),o,Oo.scale(Oo.create(),a,s))};var XP=qP;const HP=e=>e[0];var WP=HP;const xl=He,YP=cs,ZP=(e,t)=>{const n=xl.clone(t[0]),r=xl.negate(xl.create(),t[1]);return YP(e,n,r)};var KP=ZP;const QP=e=>{const t=e[0],n=e[1];return`line3: point: (${t[0].toFixed(7)}, ${t[1].toFixed(7)}, ${t[2].toFixed(7)}) direction: (${n[0].toFixed(7)}, ${n[1].toFixed(7)}, ${n[2].toFixed(7)})`};var JP=QP;const Ro=He,e4=cs,t4=(e,t,n)=>{const r=t[0],o=t[1],a=Ro.add(Ro.create(),r,o),s=Ro.transform(Ro.create(),r,n),i=Ro.transform(a,a,n),c=Ro.subtract(i,i,s);return e4(e,s,c)};var n4=t4,r4={clone:$P,closestPoint:Ev,copy:CP,create:wv,direction:RP,distanceToPoint:DP,equals:kP,fromPlanes:zP,fromPointAndDirection:cs,fromPoints:UP,intersectPointOfLineAndPlane:XP,origin:WP,reverse:KP,toString:JP,transform:n4},o4={constants:mt,line2:lf,line3:r4,mat4:Tt,plane:er,utils:is,vec2:ut,vec3:He,vec4:tv};const a4=nt,Av=at,Tv=st,s4=Et,i4=vt,Ai=new WeakMap,c4=()=>0,l4=e=>{let t=Ai.get(e);return t||(t=Av.toSides(e).reduce((r,o)=>r+(o[0][0]*o[1][1]-o[0][1]*o[1][0]),0),t*=.5,Ai.set(e,t),t)},u4=e=>{let t=Ai.get(e);return t||(t=Tv.toPolygons(e).reduce((r,o)=>r+i4.measureArea(o),0),Ai.set(e,t),t)},f4=(...e)=>{if(e=a4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(n=>s4.isA(n)?c4():Av.isA(n)?l4(n):Tv.isA(n)?u4(n):0);return t.length===1?t[0]:t};var $v=f4;const d4=nt,h4=$v,p4=(...e)=>{if(e=d4(e),e.length===0)throw new Error("measureAggregateArea: no geometries supplied");const t=h4(e);if(e.length===1)return t;const n=0;return t.reduce((r,o)=>r+o,n)};var m4=p4;const v4=nt,Jn=ut,Ma=He,Sv=at,Pv=st,Cv=Et,fh=vt,qo=new WeakMap,g4=e=>{let t=qo.get(e);if(t)return t;const n=Cv.toPoints(e);let r;n.length===0?r=Jn.create():r=Jn.clone(n[0]);let o=Jn.clone(r);return n.forEach(a=>{Jn.min(r,r,a),Jn.max(o,o,a)}),r=[r[0],r[1],0],o=[o[0],o[1],0],t=[r,o],qo.set(e,t),t},y4=e=>{let t=qo.get(e);if(t)return t;const n=Sv.toPoints(e);let r;n.length===0?r=Jn.create():r=Jn.clone(n[0]);let o=Jn.clone(r);return n.forEach(a=>{Jn.min(r,r,a),Jn.max(o,o,a)}),r=[r[0],r[1],0],o=[o[0],o[1],0],t=[r,o],qo.set(e,t),t},b4=e=>{let t=qo.get(e);if(t)return t;const n=Pv.toPolygons(e);let r=Ma.create();if(n.length>0){const a=fh.toPoints(n[0]);Ma.copy(r,a[0])}let o=Ma.clone(r);return n.forEach(a=>{fh.toPoints(a).forEach(s=>{Ma.min(r,r,s),Ma.max(o,o,s)})}),r=[r[0],r[1],r[2]],o=[o[0],o[1],o[2]],t=[r,o],qo.set(e,t),t},_4=(...e)=>{if(e=v4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(n=>Cv.isA(n)?g4(n):Sv.isA(n)?y4(n):Pv.isA(n)?b4(n):[[0,0,0],[0,0,0]]);return t.length===1?t[0]:t};var fo=_4;const x4=nt,w4=km,E4=Lm,A4=fo,T4=(...e)=>{if(e=x4(e),e.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");const t=A4(e);if(e.length===1)return t;const n=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return t.reduce((r,o)=>(r=[w4(r[0],r[0],o[0]),E4(r[1],r[1],o[1])],r),n)};var uf=T4;const{EPS:$4}=mt,S4=(e,t)=>{let n=0;for(let r=0;r<t;r++)n+=e[1][r]-e[0][r];return $4*n/t};var Ov=S4;const P4=nt,C4=uf,O4=Ov,{geom2:R4,geom3:N4,path2:M4}=of,D4=(...e)=>{if(e=P4(e),e.length===0)throw new Error("measureAggregateEpsilon: no geometries supplied");const t=C4(e);let n=0;return n=e.reduce((r,o)=>M4.isA(o)||R4.isA(o)?Math.max(r,2):N4.isA(o)?Math.max(r,3):0,n),O4(t,n)};var L4=D4;const k4=nt,I4=at,Rv=st,F4=Et,G4=vt,dh=new WeakMap,B4=()=>0,z4=()=>0,V4=e=>{let t=dh.get(e);return t||(t=Rv.toPolygons(e).reduce((r,o)=>r+G4.measureSignedVolume(o),0),dh.set(e,t),t)},j4=(...e)=>{if(e=k4(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(n=>F4.isA(n)?B4():I4.isA(n)?z4():Rv.isA(n)?V4(n):0);return t.length===1?t[0]:t};var Nv=j4;const U4=nt,q4=Nv,X4=(...e)=>{if(e=U4(e),e.length===0)throw new Error("measureAggregateVolume: no geometries supplied");const t=q4(e);if(e.length===1)return t;const n=0;return t.reduce((r,o)=>r+o,n)};var H4=X4;const W4=nt,Mv=ut,wn=He,Dv=at,Lv=st,kv=Et,hh=vt,Xo=new WeakMap,Y4=e=>{let t=Xo.get(e);if(t!==void 0)return t;const n=wn.create();let r=0;const o=kv.toPoints(e);if(o.length>0){let a=0;const s=wn.create();o.forEach(i=>{wn.add(n,n,wn.fromVec2(s,i,0)),a++}),wn.scale(n,n,1/a),o.forEach(i=>{r=Math.max(r,Mv.squaredDistance(n,i))}),r=Math.sqrt(r)}return t=[n,r],Xo.set(e,t),t},Z4=e=>{let t=Xo.get(e);if(t!==void 0)return t;const n=wn.create();let r=0;const o=Dv.toSides(e);if(o.length>0){let a=0;const s=wn.create();o.forEach(i=>{wn.add(n,n,wn.fromVec2(s,i[0],0)),a++}),wn.scale(n,n,1/a),o.forEach(i=>{r=Math.max(r,Mv.squaredDistance(n,i[0]))}),r=Math.sqrt(r)}return t=[n,r],Xo.set(e,t),t},K4=e=>{let t=Xo.get(e);if(t!==void 0)return t;const n=wn.create();let r=0;const o=Lv.toPolygons(e);if(o.length>0){let a=0;o.forEach(s=>{hh.toPoints(s).forEach(i=>{wn.add(n,n,i),a++})}),wn.scale(n,n,1/a),o.forEach(s=>{hh.toPoints(s).forEach(i=>{r=Math.max(r,wn.squaredDistance(n,i))})}),r=Math.sqrt(r)}return t=[n,r],Xo.set(e,t),t},Q4=(...e)=>{e=W4(e);const t=e.map(n=>kv.isA(n)?Y4(n):Dv.isA(n)?Z4(n):Lv.isA(n)?K4(n):[[0,0,0],0]);return t.length===1?t[0]:t};var J4=Q4;const eC=nt,tC=fo,nC=(...e)=>{e=eC(e);const t=e.map(n=>{const r=tC(n);return[r[0][0]+(r[1][0]-r[0][0])/2,r[0][1]+(r[1][1]-r[0][1])/2,r[0][2]+(r[1][2]-r[0][2])/2]});return t.length===1?t[0]:t};var rC=nC;const oC=nt,Qn=He,Iv=at,Fv=st,Ti=new WeakMap,aC=e=>{let t=Ti.get(e);if(t!==void 0)return t;const n=Iv.toSides(e);let r=0,o=0,a=0;if(n.length>0){for(let i=0;i<n.length;i++){const c=n[i][0],l=n[i][1],u=c[0]*l[1]-c[1]*l[0];r+=u,o+=(c[0]+l[0])*u,a+=(c[1]+l[1])*u}r/=2;const s=1/(r*6);o*=s,a*=s}return t=Qn.fromValues(o,a,0),Ti.set(e,t),t},sC=e=>{let t=Ti.get(e);if(t!==void 0)return t;t=Qn.create();const n=Fv.toPolygons(e);if(n.length===0)return t;let r=0;const o=Qn.create();return n.forEach(a=>{const s=a.vertices;for(let i=0;i<s.length-2;i++){Qn.cross(o,s[i+1],s[i+2]);const c=Qn.dot(s[0],o)/6;r+=c,Qn.add(o,s[0],s[i+1]),Qn.add(o,o,s[i+2]);const l=Qn.scale(o,o,1/4*c);Qn.add(t,t,l)}}),Qn.scale(t,t,1/r),Ti.set(e,t),t},iC=(...e)=>{e=oC(e);const t=e.map(n=>Iv.isA(n)?aC(n):Fv.isA(n)?sC(n):[0,0,0]);return t.length===1?t[0]:t};var cC=iC;const lC=nt,uC=fo,fC=(...e)=>{e=lC(e);const t=e.map(n=>{const r=uC(n);return[r[1][0]-r[0][0],r[1][1]-r[0][1],r[1][2]-r[0][2]]});return t.length===1?t[0]:t};var dC=fC;const hC=nt,{geom2:pC,geom3:mC,path2:vC}=of,ff=Ov,df=fo,gC=e=>ff(df(e),2),yC=e=>ff(df(e),2),bC=e=>ff(df(e),3),_C=(...e)=>{if(e=hC(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(n=>vC.isA(n)?gC(n):pC.isA(n)?yC(n):mC.isA(n)?bC(n):0);return t.length===1?t[0]:t};var Nr=_C,xC={measureAggregateArea:m4,measureAggregateBoundingBox:uf,measureAggregateEpsilon:L4,measureAggregateVolume:H4,measureArea:$v,measureBoundingBox:fo,measureBoundingSphere:J4,measureCenter:rC,measureCenterOfMass:cC,measureDimensions:dC,measureEpsilon:Nr,measureVolume:Nv};const wC=(e,t)=>Array.isArray(e)&&e.length>=t?e.every(n=>Number.isFinite(n)):!1,EC=(e,t)=>Number.isFinite(e)&&e>t,AC=(e,t)=>Number.isFinite(e)&&e>=t;var Jt={isNumberArray:wC,isGT:EC,isGTE:AC};const{EPS:ph,TAU:No}=mt,sr=ut,TC=Et,{isGT:$C,isGTE:wl,isNumberArray:SC}=Jt,PC=e=>{const t={center:[0,0],radius:1,startAngle:0,endAngle:No,makeTangent:!1,segments:32};let{center:n,radius:r,startAngle:o,endAngle:a,makeTangent:s,segments:i}=Object.assign({},t,e);if(!SC(n,2))throw new Error("center must be an array of X and Y values");if(!$C(r,0))throw new Error("radius must be greater than zero");if(!wl(o,0))throw new Error("startAngle must be positive");if(!wl(a,0))throw new Error("endAngle must be positive");if(!wl(i,4))throw new Error("segments must be four or more");o=o%No,a=a%No;let c=No;o<a&&(c=a-o),o>a&&(c=a+(No-o));const l=Math.acos((r*r+r*r-ph*ph)/(2*r*r)),u=sr.clone(n);let f;const h=[];if(c<l)f=sr.fromAngleRadians(sr.create(),o),sr.scale(f,f,r),sr.add(f,f,u),h.push(f);else{const p=Math.max(1,Math.floor(i*(c/No)))+1;let g=p*.5/c;g>.25&&(g=.25);const v=s?p+2:p;for(let m=0;m<=v;m++){let x=m;s&&(x=(m-1)*(p-2*g)/p+g,x<0&&(x=0),x>p&&(x=p));const P=o+x*(c/p);f=sr.fromAngleRadians(sr.create(),P),sr.scale(f,f,r),sr.add(f,f,u),h.push(f)}}return TC.fromPoints({closed:!1},h)};var CC=PC;const{EPS:mh,TAU:xr}=mt,El=ut,vh=at,{sin:OC,cos:RC}=un,{isGTE:Al,isNumberArray:gh}=Jt,NC=e=>{const t={center:[0,0],radius:[1,1],startAngle:0,endAngle:xr,segments:32};let{center:n,radius:r,startAngle:o,endAngle:a,segments:s}=Object.assign({},t,e);if(!gh(n,2))throw new Error("center must be an array of X and Y values");if(!gh(r,2))throw new Error("radius must be an array of X and Y values");if(!r.every(p=>p>=0))throw new Error("radius values must be positive");if(!Al(o,0))throw new Error("startAngle must be positive");if(!Al(a,0))throw new Error("endAngle must be positive");if(!Al(s,3))throw new Error("segments must be three or more");if(r[0]===0||r[1]===0)return vh.create();o=o%xr,a=a%xr;let i=xr;o<a&&(i=a-o),o>a&&(i=a+(xr-o));const c=Math.min(r[0],r[1]),l=Math.acos((c*c+c*c-mh*mh)/(2*c*c));if(i<l)throw new Error("startAngle and endAngle do not define a significant rotation");s=Math.floor(s*(i/xr));const u=El.clone(n),f=i/s,h=[];s=i<xr?s+1:s;for(let p=0;p<s;p++){const g=f*p+o,v=El.fromValues(r[0]*RC(g),r[1]*OC(g));El.add(v,u,v),h.push(v)}return i<xr&&h.push(u),vh.fromPoints(h)};var Gv=NC;const{TAU:MC}=mt,DC=Gv,{isGTE:LC}=Jt,kC=e=>{const t={center:[0,0],radius:1,startAngle:0,endAngle:MC,segments:32};let{center:n,radius:r,startAngle:o,endAngle:a,segments:s}=Object.assign({},t,e);if(!LC(r,0))throw new Error("radius must be positive");return r=[r,r],DC({center:n,radius:r,startAngle:o,endAngle:a,segments:s})};var Bv=kC;const yh=st,IC=vt,{isNumberArray:bh}=Jt,FC=e=>{const t={center:[0,0,0],size:[2,2,2]},{center:n,size:r}=Object.assign({},t,e);if(!bh(n,3))throw new Error("center must be an array of X, Y and Z values");if(!bh(r,3))throw new Error("size must be an array of width, depth and height values");if(!r.every(a=>a>=0))throw new Error("size values must be positive");return r[0]===0||r[1]===0||r[2]===0?yh.create():yh.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(a=>{const s=a[0].map(i=>[n[0]+r[0]/2*(2*!!(i&1)-1),n[1]+r[1]/2*(2*!!(i&2)-1),n[2]+r[2]/2*(2*!!(i&4)-1)]);return IC.create(s)}))};var hf=FC;const GC=hf,{isGTE:BC}=Jt,zC=e=>{const t={center:[0,0,0],size:2};let{center:n,size:r}=Object.assign({},t,e);if(!BC(r,0))throw new Error("size must be positive");return r=[r,r,r],GC({center:n,size:r})};var VC=zC;const{EPS:_h,TAU:wr}=mt,an=He,jC=st,UC=vt,{sin:qC,cos:XC}=un,{isGT:HC,isGTE:Tl,isNumberArray:$l}=Jt,WC=e=>{const t={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:wr,segments:32};let{center:n,height:r,startRadius:o,startAngle:a,endRadius:s,endAngle:i,segments:c}=Object.assign({},t,e);if(!$l(n,3))throw new Error("center must be an array of X, Y and Z values");if(!HC(r,0))throw new Error("height must be greater then zero");if(!$l(o,2))throw new Error("startRadius must be an array of X and Y values");if(!o.every(W=>W>=0))throw new Error("startRadius values must be positive");if(!$l(s,2))throw new Error("endRadius must be an array of X and Y values");if(!s.every(W=>W>=0))throw new Error("endRadius values must be positive");if(s.every(W=>W===0)&&o.every(W=>W===0))throw new Error("at least one radius must be positive");if(!Tl(a,0))throw new Error("startAngle must be positive");if(!Tl(i,0))throw new Error("endAngle must be positive");if(!Tl(c,4))throw new Error("segments must be four or more");a=a%wr,i=i%wr;let l=wr;a<i&&(l=i-a),a>i&&(l=i+(wr-a));const u=Math.min(o[0],o[1],s[0],s[1]),f=Math.acos((u*u+u*u-_h*_h)/(2*u*u));if(l<f)throw new Error("startAngle and endAngle do not define a significant rotation");const h=Math.floor(c*(l/wr)),p=an.fromValues(0,0,-(r/2)),g=an.fromValues(0,0,r/2),v=an.subtract(an.create(),g,p),m=an.fromValues(1,0,0),x=an.fromValues(0,1,0),P=an.create(),S=an.create(),O=an.create(),R=(W,J,G)=>{const ce=J*l+a;return an.scale(P,m,G[0]*XC(ce)),an.scale(S,x,G[1]*qC(ce)),an.add(P,P,S),an.scale(O,v,W),an.add(O,O,p),an.add(an.create(),P,O)},N=(...W)=>{const J=W.map(G=>an.add(an.create(),G,n));return UC.create(J)},I=[];for(let W=0;W<h;W++){const J=W/h;let G=(W+1)/h;l===wr&&W===h-1&&(G=0),s[0]===o[0]&&s[1]===o[1]?(I.push(N(p,R(0,G,s),R(0,J,s))),I.push(N(R(0,G,s),R(1,G,s),R(1,J,s),R(0,J,s))),I.push(N(g,R(1,J,s),R(1,G,s)))):(o[0]>0&&o[1]>0&&I.push(N(p,R(0,G,o),R(0,J,o))),(o[0]>0||o[1]>0)&&I.push(N(R(0,J,o),R(0,G,o),R(1,J,s))),s[0]>0&&s[1]>0&&I.push(N(g,R(1,J,s),R(1,G,s))),(s[0]>0||s[1]>0)&&I.push(N(R(1,J,s),R(0,G,o),R(1,G,s))))}return l<wr&&(I.push(N(p,R(0,0,o),g)),I.push(N(R(0,0,o),R(1,0,s),g)),I.push(N(p,g,R(0,1,o))),I.push(N(R(0,1,o),g,R(1,1,s)))),jC.create(I)};var zv=WC;const YC=st,ZC=zv,{isGTE:KC}=Jt,QC=e=>{const t={center:[0,0,0],height:2,radius:1,segments:32},{center:n,height:r,radius:o,segments:a}=Object.assign({},t,e);if(!KC(o,0))throw new Error("radius must be positive");return r===0||o===0?YC.create():ZC({center:n,height:r,startRadius:[o,o],endRadius:[o,o],segments:a})};var Vv=QC;const{TAU:xh}=mt,We=He,wh=st,Eh=vt,{sin:Ah,cos:Th}=un,{isGTE:JC,isNumberArray:$h}=Jt,eO=e=>{const t={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:n,radius:r,segments:o,axes:a}=Object.assign({},t,e);if(!$h(n,3))throw new Error("center must be an array of X, Y and Z values");if(!$h(r,3))throw new Error("radius must be an array of X, Y and Z values");if(!r.every(g=>g>=0))throw new Error("radius values must be positive");if(!JC(o,4))throw new Error("segments must be four or more");if(r[0]===0||r[1]===0||r[2]===0)return wh.create();const s=We.scale(We.create(),We.normalize(We.create(),a[0]),r[0]),i=We.scale(We.create(),We.normalize(We.create(),a[1]),r[1]),c=We.scale(We.create(),We.normalize(We.create(),a[2]),r[2]),l=Math.round(o/4);let u;const f=[],h=We.create(),p=We.create();for(let g=0;g<=o;g++){const v=xh*g/o,m=We.add(We.create(),We.scale(h,s,Th(v)),We.scale(p,i,Ah(v)));if(g>0){let x,P;for(let S=0;S<=l;S++){const O=xh/4*S/l,R=Th(O),N=Ah(O);if(S>0){let I=[],X;X=We.subtract(We.create(),We.scale(h,u,x),We.scale(p,c,P)),I.push(We.add(X,X,n)),X=We.subtract(We.create(),We.scale(h,m,x),We.scale(p,c,P)),I.push(We.add(X,X,n)),S<l&&(X=We.subtract(We.create(),We.scale(h,m,R),We.scale(p,c,N)),I.push(We.add(X,X,n))),X=We.subtract(We.create(),We.scale(h,u,R),We.scale(p,c,N)),I.push(We.add(X,X,n)),f.push(Eh.create(I)),I=[],X=We.add(We.create(),We.scale(h,u,x),We.scale(p,c,P)),I.push(We.add(We.create(),n,X)),X=We.add(X,We.scale(h,m,x),We.scale(p,c,P)),I.push(We.add(We.create(),n,X)),S<l&&(X=We.add(X,We.scale(h,m,R),We.scale(p,c,N)),I.push(We.add(We.create(),n,X))),X=We.add(X,We.scale(h,u,R),We.scale(p,c,N)),I.push(We.add(We.create(),n,X)),I.reverse(),f.push(Eh.create(I))}x=R,P=N}}u=m}return wh.create(f)};var jv=eO;const tO=st,nO=vt,{isNumberArray:Sh}=Jt,rO=e=>{const t={points:[],faces:[],colors:void 0,orientation:"outward"},{points:n,faces:r,colors:o,orientation:a}=Object.assign({},t,e);if(!(Array.isArray(n)&&Array.isArray(r)))throw new Error("points and faces must be arrays");if(n.length<3)throw new Error("three or more points are required");if(r.length<1)throw new Error("one or more faces are required");if(o){if(!Array.isArray(o))throw new Error("colors must be an array");if(o.length!==r.length)throw new Error("faces and colors must have the same length")}n.forEach((i,c)=>{if(!Sh(i,3))throw new Error(`point ${c} must be an array of X, Y, Z values`)}),r.forEach((i,c)=>{if(i.length<3)throw new Error(`face ${c} must contain 3 or more indexes`);if(!Sh(i,i.length))throw new Error(`face ${c} must be an array of numbers`)}),a!=="outward"&&r.forEach(i=>i.reverse());const s=r.map((i,c)=>{const l=nO.create(i.map(u=>n[u]));return o&&o[c]&&(l.color=o[c]),l});return tO.create(s)};var Uv=rO;const Ph=Tt,Ch=He,Oh=st,oO=Uv,{isGTE:Rh}=Jt,aO=e=>{const t={radius:1,frequency:6};let{radius:n,frequency:r}=Object.assign({},t,e);if(!Rh(n,0))throw new Error("radius must be positive");if(!Rh(r,6))throw new Error("frequency must be six or more");if(n===0)return Oh.create();r=Math.floor(r/6);const o=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],a=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],s=(h,p,g)=>{const v=h[0],m=h[1],x=h[2];let P=g;const S=[],O=[];for(let R=0;R<p;R++)for(let N=0;N<p-R;N++){const I=R/p,X=(R+1)/p,W=N/(p-R),J=(N+1)/(p-R),G=p-R-1?N/(p-R-1):1,ce=[];ce[0]=i(i(v,m,W),x,I),ce[1]=i(i(v,m,J),x,I),ce[2]=i(i(v,m,G),x,X);for(let _e=0;_e<3;_e++){const de=Ch.length(ce[_e]);for(let De=0;De<3;De++)ce[_e][De]/=de}if(S.push(ce[0],ce[1],ce[2]),O.push([P,P+1,P+2]),P+=3,N<p-R-1){const _e=p-R-1?(N+1)/(p-R-1):1;ce[0]=i(i(v,m,J),x,I),ce[1]=i(i(v,m,_e),x,X),ce[2]=i(i(v,m,G),x,X);for(let de=0;de<3;de++){const De=Ch.length(ce[de]);for(let be=0;be<3;be++)ce[de][be]/=De}S.push(ce[0],ce[1],ce[2]),O.push([P,P+1,P+2]),P+=3}}return{points:S,triangles:O,offset:P}},i=(h,p,g)=>{const v=1-g,m=[];for(let x=0;x<3;x++)m[x]=h[x]*v+p[x]*g;return m};let c=[],l=[],u=0;for(let h=0;h<a.length;h++){const p=s([o[a[h][0]],o[a[h][1]],o[a[h][2]]],r,u);c=c.concat(p.points),l=l.concat(p.triangles),u=p.offset}let f=oO({points:c,faces:l,orientation:"inward"});return n!==1&&(f=Oh.transform(Ph.fromScaling(Ph.create(),[n,n,n]),f)),f};var sO=aO;const iO=Et,cO=e=>{if(!Array.isArray(e))throw new Error("points must be an array");return iO.fromPoints({},e)};var lO=cO;const Sl=at,uO=e=>{const t={points:[],paths:[]},{points:n,paths:r}=Object.assign({},t,e);if(!(Array.isArray(n)&&Array.isArray(r)))throw new Error("points and paths must be arrays");let o=n;Array.isArray(n[0])&&(Array.isArray(n[0][0])||(o=[n])),o.forEach((c,l)=>{if(!Array.isArray(c))throw new Error("list of points "+l+" must be an array");if(c.length<3)throw new Error("list of points "+l+" must contain three or more points");c.forEach((u,f)=>{if(!Array.isArray(u))throw new Error("list of points "+l+", point "+f+" must be an array");if(u.length<2)throw new Error("list of points "+l+", point "+f+" must contain by X and Y values")})});let a=r;if(r.length===0){let c=0;a=o.map(l=>l.map(u=>c++))}const s=[];o.forEach(c=>c.forEach(l=>s.push(l)));let i=[];return a.forEach(c=>{const l=c.map(f=>s[f]),u=Sl.fromPoints(l);i=i.concat(Sl.toSides(u))}),Sl.create(i)};var fO=uO;const Er=ut,Nh=at,{isNumberArray:Mh}=Jt,dO=e=>{const t={center:[0,0],size:[2,2]},{center:n,size:r}=Object.assign({},t,e);if(!Mh(n,2))throw new Error("center must be an array of X and Y values");if(!Mh(r,2))throw new Error("size must be an array of X and Y values");if(!r.every(i=>i>=0))throw new Error("size values must be positive");if(r[0]===0||r[1]===0)return Nh.create();const o=[r[0]/2,r[1]/2],a=[o[0],-o[1]],s=[Er.subtract(Er.create(),n,o),Er.add(Er.create(),n,a),Er.add(Er.create(),n,o),Er.subtract(Er.create(),n,a)];return Nh.fromPoints(s)};var pf=dO;const{EPS:gi,TAU:Da}=mt,Pl=ut,Wt=He,Dh=st,Ho=vt,{sin:hO,cos:pO}=un,{isGTE:Lh,isNumberArray:kh}=Jt,mO=hf,Ih=(e,t,n,r,o,a)=>{const s=Da/4*o/r,i=pO(s),c=hO(s),l=r-o;let u=n*i,f=t[2]-(n-n*c);a||(f=n-n*c-t[2]),u=u>gi?u:0;const h=Wt.add(Wt.create(),e,[t[0]-n,t[1]-n,f]),p=Wt.add(Wt.create(),e,[n-t[0],t[1]-n,f]),g=Wt.add(Wt.create(),e,[n-t[0],n-t[1],f]),v=Wt.add(Wt.create(),e,[t[0]-n,n-t[1],f]),m=[],x=[],P=[],S=[];for(let O=0;O<=l;O++){const R=l>0?Da/4*O/l:0,N=Pl.fromAngleRadians(Pl.create(),R);Pl.scale(N,N,u);const I=Wt.fromVec2(Wt.create(),N);m.push(Wt.add(Wt.create(),h,I)),Wt.rotateZ(I,I,[0,0,0],Da/4),x.push(Wt.add(Wt.create(),p,I)),Wt.rotateZ(I,I,[0,0,0],Da/4),P.push(Wt.add(Wt.create(),g,I)),Wt.rotateZ(I,I,[0,0,0],Da/4),S.push(Wt.add(Wt.create(),v,I))}return a?[m,x,P,S]:(m.reverse(),x.reverse(),P.reverse(),S.reverse(),[S,P,x,m])},Fh=(e,t)=>{const n=[];for(let r=0;r<e.length;r++){const o=e[r],a=t[r];for(let s=0;s<o.length-1;s++)n.push(Ho.create([o[s],o[s+1],a[s]])),s<a.length-1&&n.push(Ho.create([a[s],o[s+1],a[s+1]]))}return n},Gh=(e,t)=>{const n=[];for(let r=0;r<e.length;r++){let o=e[r],a=t[r];const s=o[o.length-1],i=a[a.length-1],c=(r+1)%e.length;o=e[c],a=t[c];const l=o[0],u=a[0];n.push(Ho.create([s,l,u,i]))}return n},vO=(e,t)=>{e=[e[3],e[2],e[1],e[0]],e=e.map(a=>a.slice().reverse());const n=[];e.forEach(a=>{a.forEach(s=>n.push(s))});const r=[];t.forEach(a=>{a.forEach(s=>r.push(s))});const o=[];for(let a=0;a<r.length;a++){const s=(a+1)%r.length;o.push(Ho.create([n[a],n[s],r[s],r[a]]))}return o},gO=e=>{const t={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32};let{center:n,size:r,roundRadius:o,segments:a}=Object.assign({},t,e);if(!kh(n,3))throw new Error("center must be an array of X, Y and Z values");if(!kh(r,3))throw new Error("size must be an array of X, Y and Z values");if(!r.every(l=>l>=0))throw new Error("size values must be positive");if(!Lh(o,0))throw new Error("roundRadius must be positive");if(!Lh(a,4))throw new Error("segments must be four or more");if(r[0]===0||r[1]===0||r[2]===0)return Dh.create();if(o===0)return mO({center:n,size:r});if(r=r.map(l=>l/2),o>r[0]-gi||o>r[1]-gi||o>r[2]-gi)throw new Error("roundRadius must be smaller then the radius of all dimensions");a=Math.floor(a/4);let s=null,i=null,c=[];for(let l=0;l<=a;l++){const u=Ih(n,r,o,a,l,!0),f=Ih(n,r,o,a,l,!1);if(l===0&&(c=c.concat(vO(f,u))),s&&(c=c.concat(Fh(s,u),Gh(s,u))),i&&(c=c.concat(Fh(i,f),Gh(i,f))),l===a){let h=u.map(p=>p[0]);c.push(Ho.create(h)),h=f.map(p=>p[0]),c.push(Ho.create(h))}s=u,i=f}return Dh.create(c)};var yO=gO;const{EPS:bO,TAU:Bh}=mt,ke=He,zh=st,_O=vt,{sin:Vh,cos:jh}=un,{isGTE:Hs,isNumberArray:xO}=Jt,wO=Vv,EO=e=>{const t={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:n,height:r,radius:o,roundRadius:a,segments:s}=Object.assign({},t,e);if(!xO(n,3))throw new Error("center must be an array of X, Y and Z values");if(!Hs(r,0))throw new Error("height must be positive");if(!Hs(o,0))throw new Error("radius must be positive");if(!Hs(a,0))throw new Error("roundRadius must be positive");if(a>o)throw new Error("roundRadius must be smaller then the radius");if(!Hs(s,4))throw new Error("segments must be four or more");if(r===0||o===0)return zh.create();if(a===0)return wO({center:n,height:r,radius:o});const i=[0,0,-(r/2)],c=[0,0,r/2],l=ke.subtract(ke.create(),c,i),u=ke.length(l);if(2*a>u-bO)throw new Error("height must be larger than twice roundRadius");let f;Math.abs(l[0])>Math.abs(l[1])?f=ke.fromValues(0,1,0):f=ke.fromValues(1,0,0);const h=ke.scale(ke.create(),ke.normalize(ke.create(),l),a),p=ke.scale(ke.create(),ke.normalize(ke.create(),ke.cross(ke.create(),h,f)),o),g=ke.scale(ke.create(),ke.normalize(ke.create(),ke.cross(ke.create(),p,h)),o);ke.add(i,i,h),ke.subtract(c,c,h);const v=Math.floor(.25*s),m=N=>{const I=N.map(X=>ke.add(X,X,n));return _O.create(I)},x=[],P=ke.create(),S=ke.create();let O;for(let N=0;N<=s;N++){const I=Bh*N/s,X=ke.add(ke.create(),ke.scale(P,p,jh(I)),ke.scale(S,g,Vh(I)));if(N>0){let W=[];W.push(ke.add(ke.create(),i,X)),W.push(ke.add(ke.create(),i,O)),W.push(ke.add(ke.create(),c,O)),W.push(ke.add(ke.create(),c,X)),x.push(m(W));let J,G;for(let ce=0;ce<=v;ce++){const _e=Bh/4*ce/v,de=jh(_e),De=Vh(_e);if(ce>0){W=[];let be;be=ke.add(ke.create(),i,ke.subtract(P,ke.scale(P,O,J),ke.scale(S,h,G))),W.push(be),be=ke.add(ke.create(),i,ke.subtract(P,ke.scale(P,X,J),ke.scale(S,h,G))),W.push(be),ce<v&&(be=ke.add(ke.create(),i,ke.subtract(P,ke.scale(P,X,de),ke.scale(S,h,De))),W.push(be)),be=ke.add(ke.create(),i,ke.subtract(P,ke.scale(P,O,de),ke.scale(S,h,De))),W.push(be),x.push(m(W)),W=[],be=ke.add(ke.create(),ke.scale(P,O,J),ke.scale(S,h,G)),ke.add(be,be,c),W.push(be),be=ke.add(ke.create(),ke.scale(P,X,J),ke.scale(S,h,G)),ke.add(be,be,c),W.push(be),ce<v&&(be=ke.add(ke.create(),ke.scale(P,X,de),ke.scale(S,h,De)),ke.add(be,be,c),W.push(be)),be=ke.add(ke.create(),ke.scale(P,O,de),ke.scale(S,h,De)),ke.add(be,be,c),W.push(be),W.reverse(),x.push(m(W))}J=de,G=De}}O=X}return zh.create(x)};var AO=EO;const{EPS:Uh,TAU:Ws}=mt,Mt=ut,qh=at,{isGTE:Xh,isNumberArray:Hh}=Jt,TO=pf,$O=e=>{const t={center:[0,0],size:[2,2],roundRadius:.2,segments:32};let{center:n,size:r,roundRadius:o,segments:a}=Object.assign({},t,e);if(!Hh(n,2))throw new Error("center must be an array of X and Y values");if(!Hh(r,2))throw new Error("size must be an array of X and Y values");if(!r.every(v=>v>=0))throw new Error("size values must be positive");if(!Xh(o,0))throw new Error("roundRadius must be positive");if(!Xh(a,4))throw new Error("segments must be four or more");if(r[0]===0||r[1]===0)return qh.create();if(o===0)return TO({center:n,size:r});if(r=r.map(v=>v/2),o>r[0]-Uh||o>r[1]-Uh)throw new Error("roundRadius must be smaller then the radius of all dimensions");const s=Math.floor(a/4),i=Mt.add(Mt.create(),n,[r[0]-o,r[1]-o]),c=Mt.add(Mt.create(),n,[o-r[0],r[1]-o]),l=Mt.add(Mt.create(),n,[o-r[0],o-r[1]]),u=Mt.add(Mt.create(),n,[r[0]-o,o-r[1]]),f=[],h=[],p=[],g=[];for(let v=0;v<=s;v++){const m=Ws/4*v/s,x=Mt.fromAngleRadians(Mt.create(),m);Mt.scale(x,x,o),f.push(Mt.add(Mt.create(),i,x)),Mt.rotate(x,x,Mt.create(),Ws/4),h.push(Mt.add(Mt.create(),c,x)),Mt.rotate(x,x,Mt.create(),Ws/4),p.push(Mt.add(Mt.create(),l,x)),Mt.rotate(x,x,Mt.create(),Ws/4),g.push(Mt.add(Mt.create(),u,x))}return qh.fromPoints(f.concat(h,p,g))};var SO=$O;const PO=jv,{isGTE:CO}=Jt,OO=e=>{const t={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]};let{center:n,radius:r,segments:o,axes:a}=Object.assign({},t,e);if(!CO(r,0))throw new Error("radius must be positive");return r=[r,r,r],PO({center:n,radius:r,segments:o,axes:a})};var qv=OO;const RO=pf,{isGTE:NO}=Jt,MO=e=>{const t={center:[0,0],size:2};let{center:n,size:r}=Object.assign({},t,e);if(!NO(r,0))throw new Error("size must be positive");return r=[r,r],RO({center:n,size:r})};var DO=MO;const{TAU:Xv}=mt,Ua=ut,LO=at,{isGT:kO,isGTE:Ys,isNumberArray:IO}=Jt,FO=(e,t)=>e>0&&t>1&&t<e/2?Math.cos(Math.PI*t/e)/Math.cos(Math.PI*(t-1)/e):0,Wh=(e,t,n,r)=>{const o=Xv/e,a=[];for(let s=0;s<e;s++){const i=Ua.fromAngleRadians(Ua.create(),o*s+n);Ua.scale(i,i,t),Ua.add(i,r,i),a.push(i)}return a},GO=e=>{const t={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0};let{center:n,vertices:r,outerRadius:o,innerRadius:a,density:s,startAngle:i}=Object.assign({},t,e);if(!IO(n,2))throw new Error("center must be an array of X and Y values");if(!Ys(r,2))throw new Error("vertices must be two or more");if(!kO(o,0))throw new Error("outerRadius must be greater than zero");if(!Ys(a,0))throw new Error("innerRadius must be greater than zero");if(!Ys(i,0))throw new Error("startAngle must be greater than zero");if(r=Math.floor(r),s=Math.floor(s),i=i%Xv,a===0){if(!Ys(s,2))throw new Error("density must be two or more");a=o*FO(r,s)}const c=Ua.clone(n),l=Wh(r,o,i,c),u=Wh(r,a,i+Math.PI/r,c),f=[];for(let h=0;h<r;h++)f.push(l[h]),f.push(u[h]);return LO.fromPoints(f)};var BO=GO;const zO=nt,Yh=Tt,Zh=er,Kh=at,Qh=st,Jh=Et,Hi=(e,...t)=>{const n={origin:[0,0,0],normal:[0,0,1]},{origin:r,normal:o}=Object.assign({},n,e);if(t=zO(t),t.length===0)throw new Error("wrong number of arguments");const a=Zh.fromNormalAndPoint(Zh.create(),o,r);if(Number.isNaN(a[0]))throw new Error("the given origin and normal do not define a proper plane");const s=Yh.mirrorByPlane(Yh.create(),a),i=t.map(c=>Jh.isA(c)?Jh.transform(s,c):Kh.isA(c)?Kh.transform(s,c):Qh.isA(c)?Qh.transform(s,c):c);return i.length===1?i[0]:i},VO=(...e)=>Hi({normal:[1,0,0]},e),jO=(...e)=>Hi({normal:[0,1,0]},e),UO=(...e)=>Hi({normal:[0,0,1]},e);var qa={mirror:Hi,mirrorX:VO,mirrorY:jO,mirrorZ:UO};const ep=er,Qr=He,qO=e=>{const t=e.edges;if(t.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");const n=t.reduce((s,i)=>Qr.add(Qr.create(),s,i[0]),Qr.create());Qr.scale(n,n,1/t.length);let r,o=0;t.forEach(s=>{if(!Qr.equals(s[0],s[1])){const i=Qr.squaredDistance(n,s[0]);i>o&&(r=s,o=i)}});const a=t.find(s=>Qr.equals(s[1],r[0]));return ep.fromPoints(ep.create(),a[0],r[0],r[1])};var Hv=qO;const XO=e=>(e||(e=[]),{edges:e});var ho=XO;const HO=ho,tp=He,WO=(...e)=>{let t,n;return e.length===1?(t=HO(),n=e[0]):(t=e[0],n=e[1]),t.edges=n.edges.map(r=>[tp.clone(r[0]),tp.clone(r[1])]),t};var YO=WO;const ZO=He,KO=(e,t)=>{const n=e.edges,r=t.edges;return n.length!==r.length?!1:n.reduce((a,s,i)=>{const c=r[i],l=ZO.squaredDistance(s[0],c[0]);return a&&l<Number.EPSILON},!0)};var QO=KO;const Zs=He,JO=ho,eR=e=>{if(!Array.isArray(e))throw new Error("the given points must be an array");if(e.length<3)throw new Error("the given points must contain THREE or more points");const t=[];let n=e[e.length-1];return e.forEach(r=>{r.length===2&&t.push([Zs.fromVec2(Zs.create(),n),Zs.fromVec2(Zs.create(),r)]),r.length===3&&t.push([n,r]),n=r}),JO(t)};var tR=eR;const Ks=He,nR=ho,rR=e=>{if(!Array.isArray(e))throw new Error("the given sides must be an array");const t=[];return e.forEach(n=>{t.push([Ks.fromVec2(Ks.create(),n[0]),Ks.fromVec2(Ks.create(),n[1])])}),nR(t)};var oR=rR;const aR=e=>!!(e&&typeof e=="object"&&"edges"in e&&Array.isArray(e.edges));var sR=aR;const iR=ho,cR=(...e)=>{let t,n;return e.length===1?(t=iR(),n=e[0]):(t=e[0],n=e[1]),t.edges=n.edges.map(r=>[r[1],r[0]]),t};var lR=cR;const uR=e=>e.edges;var fR=uR;const dR=(e,t)=>{let n,r,o,a,s,i=1;do{r=e,e=null;let c=null;for(s=0;r;){s++,o=r;let l=0;for(n=0;n<i&&(l++,o=o.nextZ,!!o);n++);let u=i;for(;l>0||u>0&&o;)l!==0&&(u===0||!o||t(r)<=t(o))?(a=r,r=r.nextZ,l--):(a=o,o=o.nextZ,u--),c?c.nextZ=a:e=a,a.prevZ=c,c=a;r=o}c.nextZ=null,i*=2}while(s>1);return e};var hR=dR;const pR=hR;let Wv=class{constructor(t,n,r){this.i=t,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}};const mR=(e,t,n,r)=>{const o=new Wv(e,t,n);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o},vR=e=>{e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)};var Yv={Node:Wv,insertNode:mR,removeNode:vR,sortLinked:pR};const gR=(e,t,n,r,o,a,s,i)=>(o-s)*(t-i)-(e-s)*(a-i)>=0&&(e-s)*(r-i)-(n-s)*(t-i)>=0&&(n-s)*(a-i)-(o-s)*(r-i)>=0,yR=(e,t,n)=>(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);var mf={area:yR,pointInTriangle:gR};const{Node:np,insertNode:rp,removeNode:$i}=Yv,{area:En}=mf,bR=(e,t,n,r,o)=>{let a;if(o===TR(e,t,n,r)>0)for(let s=t;s<n;s+=r)a=rp(s,e[s],e[s+1],a);else for(let s=n-r;s>=t;s-=r)a=rp(s,e[s],e[s+1],a);return a&&Wi(a,a.next)&&($i(a),a=a.next),a},Zv=(e,t)=>{if(!e)return e;t||(t=e);let n=e,r;do if(r=!1,!n.steiner&&(Wi(n,n.next)||En(n.prev,n,n.next)===0)){if($i(n),n=t=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==t);return t},_R=(e,t,n)=>{let r=e;do{const o=r.prev,a=r.next.next;!Wi(o,a)&&Kv(o,r,r.next,a)&&Ka(o,a)&&Ka(a,o)&&(t.push(o.i/n),t.push(r.i/n),t.push(a.i/n),$i(r),$i(r.next),r=e=a),r=r.next}while(r!==e);return Zv(r)},xR=(e,t)=>{let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Kv(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1},Ka=(e,t)=>En(e.prev,e,e.next)<0?En(e,t,e.next)>=0&&En(e,e.prev,t)>=0:En(e,t,e.prev)<0||En(e,e.next,t)<0,wR=(e,t)=>{let n=e,r=!1;const o=(e.x+t.x)/2,a=(e.y+t.y)/2;do n.y>a!=n.next.y>a&&n.next.y!==n.y&&o<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==e);return r},ER=(e,t)=>{const n=new np(e.i,e.x,e.y),r=new np(t.i,t.x,t.y),o=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r},AR=(e,t)=>e.next.i!==t.i&&e.prev.i!==t.i&&!xR(e,t)&&(Ka(e,t)&&Ka(t,e)&&wR(e,t)&&(En(e.prev,e,t.prev)||En(e,t.prev,t))||Wi(e,t)&&En(e.prev,e,e.next)>0&&En(t.prev,t,t.next)>0),Kv=(e,t,n,r)=>{const o=Math.sign(En(e,t,n)),a=Math.sign(En(e,t,r)),s=Math.sign(En(n,r,e)),i=Math.sign(En(n,r,t));return!!(o!==a&&s!==i||o===0&&Qs(e,n,t)||a===0&&Qs(e,r,t)||s===0&&Qs(n,e,r)||i===0&&Qs(n,t,r))},Qs=(e,t,n)=>t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y),TR=(e,t,n,r)=>{let o=0;for(let a=t,s=n-r;a<n;a+=r)o+=(e[s]-e[a])*(e[a+1]+e[s+1]),s=a;return o},Wi=(e,t)=>e.x===t.x&&e.y===t.y;var Qv={cureLocalIntersections:_R,filterPoints:Zv,isValidDiagonal:AR,linkedPolygon:bR,locallyInside:Ka,splitPolygon:ER};const{filterPoints:$u,linkedPolygon:$R,locallyInside:SR,splitPolygon:PR}=Qv,{area:op,pointInTriangle:CR}=mf,OR=(e,t,n,r)=>{const o=[];for(let a=0,s=t.length;a<s;a++){const i=t[a]*r,c=a<s-1?t[a+1]*r:e.length,l=$R(e,i,c,r,!1);l===l.next&&(l.steiner=!0),o.push(DR(l))}o.sort((a,s)=>a.x-s.x);for(let a=0;a<o.length;a++)n=RR(o[a],n),n=$u(n,n.next);return n},RR=(e,t)=>{const n=NR(e,t);if(!n)return t;const r=PR(n,e),o=$u(n,n.next);return $u(r,r.next),t===n?o:t},NR=(e,t)=>{let n=t;const r=e.x,o=e.y;let a=-1/0,s;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const f=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(f<=r&&f>a){if(a=f,f===r){if(o===n.y)return n;if(o===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!s)return null;if(r===a)return s;const i=s,c=s.x,l=s.y;let u=1/0;n=s;do{if(r>=n.x&&n.x>=c&&r!==n.x&&CR(o<l?r:a,o,c,l,o<l?a:r,o,n.x,n.y)){const f=Math.abs(o-n.y)/(r-n.x);SR(n,e)&&(f<u||f===u&&(n.x>s.x||n.x===s.x&&MR(s,n)))&&(s=n,u=f)}n=n.next}while(n!==i);return s},MR=(e,t)=>op(e.prev,e,t.prev)<0&&op(t.next,e,e.next)<0,DR=e=>{let t=e,n=e;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==e);return n};var LR=OR;const kR=LR,{removeNode:IR,sortLinked:FR}=Yv,{cureLocalIntersections:GR,filterPoints:Si,isValidDiagonal:BR,linkedPolygon:zR,splitPolygon:VR}=Qv,{area:oo,pointInTriangle:Xa}=mf,jR=(e,t,n=2)=>{const r=t&&t.length,o=r?t[0]*n:e.length;let a=zR(e,0,o,n,!0);const s=[];if(!a||a.next===a.prev)return s;let i,c,l,u,f;if(r&&(a=kR(e,t,a,n)),e.length>80*n){i=l=e[0],c=u=e[1];for(let h=n;h<o;h+=n){const p=e[h],g=e[h+1];p<i&&(i=p),g<c&&(c=g),p>l&&(l=p),g>u&&(u=g)}f=Math.max(l-i,u-c),f=f!==0?1/f:0}return Qa(a,s,n,i,c,f),s},Qa=(e,t,n,r,o,a,s)=>{if(!e)return;!s&&a&&HR(e,r,o,a);let i=e,c,l;for(;e.prev!==e.next;){if(c=e.prev,l=e.next,a?qR(e,r,o,a):UR(e)){t.push(c.i/n),t.push(e.i/n),t.push(l.i/n),IR(e),e=l.next,i=l.next;continue}if(e=l,e===i){s?s===1?(e=GR(Si(e),t,n),Qa(e,t,n,r,o,a,2)):s===2&&XR(e,t,n,r,o,a):Qa(Si(e),t,n,r,o,a,1);break}}},UR=e=>{const t=e.prev,n=e,r=e.next;if(oo(t,n,r)>=0)return!1;let o=e.next.next;for(;o!==e.prev;){if(Xa(t.x,t.y,n.x,n.y,r.x,r.y,o.x,o.y)&&oo(o.prev,o,o.next)>=0)return!1;o=o.next}return!0},qR=(e,t,n,r)=>{const o=e.prev,a=e,s=e.next;if(oo(o,a,s)>=0)return!1;const i=o.x<a.x?o.x<s.x?o.x:s.x:a.x<s.x?a.x:s.x,c=o.y<a.y?o.y<s.y?o.y:s.y:a.y<s.y?a.y:s.y,l=o.x>a.x?o.x>s.x?o.x:s.x:a.x>s.x?a.x:s.x,u=o.y>a.y?o.y>s.y?o.y:s.y:a.y>s.y?a.y:s.y,f=Su(i,c,t,n,r),h=Su(l,u,t,n,r);let p=e.prevZ,g=e.nextZ;for(;p&&p.z>=f&&g&&g.z<=h;){if(p!==e.prev&&p!==e.next&&Xa(o.x,o.y,a.x,a.y,s.x,s.y,p.x,p.y)&&oo(p.prev,p,p.next)>=0||(p=p.prevZ,g!==e.prev&&g!==e.next&&Xa(o.x,o.y,a.x,a.y,s.x,s.y,g.x,g.y)&&oo(g.prev,g,g.next)>=0))return!1;g=g.nextZ}for(;p&&p.z>=f;){if(p!==e.prev&&p!==e.next&&Xa(o.x,o.y,a.x,a.y,s.x,s.y,p.x,p.y)&&oo(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;g&&g.z<=h;){if(g!==e.prev&&g!==e.next&&Xa(o.x,o.y,a.x,a.y,s.x,s.y,g.x,g.y)&&oo(g.prev,g,g.next)>=0)return!1;g=g.nextZ}return!0},XR=(e,t,n,r,o,a)=>{let s=e;do{let i=s.next.next;for(;i!==s.prev;){if(s.i!==i.i&&BR(s,i)){let c=VR(s,i);s=Si(s,s.next),c=Si(c,c.next),Qa(s,t,n,r,o,a),Qa(c,t,n,r,o,a);return}i=i.next}s=s.next}while(s!==e)},HR=(e,t,n,r)=>{let o=e;do o.z===null&&(o.z=Su(o.x,o.y,t,n,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,FR(o,a=>a.z)},Su=(e,t,n,r,o)=>(e=32767*(e-n)*o,t=32767*(t-r)*o,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1);var WR=jR;const{area:YR}=is,{toOutlines:ZR}=at,{arePointsInside:KR}=rf,QR=e=>{const t=ZR(e),n=[],r=[];t.forEach((s,i)=>{const c=YR(s);c<0?r.push(i):c>0&&n.push(i)});const o=[],a=[];return n.forEach((s,i)=>{const c=t[s];o[i]=[],r.forEach((l,u)=>{const f=t[l];KR([f[0]],{vertices:c})&&(o[i].push(l),a[u]||(a[u]=[]),a[u].push(i))})}),r.forEach((s,i)=>{if(a[i]&&a[i].length>1){const c=JR(a[i],l=>o[l].length);a[i].forEach((l,u)=>{u!==c&&(o[l]=o[l].filter(f=>f!==s))})}}),o.map((s,i)=>({solid:t[n[i]],holes:s.map(c=>t[c])}))},JR=(e,t)=>{let n,r;return e.forEach((o,a)=>{const s=t(o);(r===void 0||s<r)&&(n=a,r=s)}),n};var eN=QR;const tN=at,ap=er,nN=ut,ln=He,rN=Hv,oN=eN;let aN=class{constructor(t){this.plane=rN(t);const n=ln.orthogonal(ln.create(),this.plane),r=ln.cross(ln.create(),this.plane,n);this.v=ln.normalize(r,r),this.u=ln.cross(ln.create(),this.v,this.plane),this.basisMap=new Map;const o=t.edges.map(s=>s.map(i=>this.to2D(i))),a=tN.create(o);this.roots=oN(a)}to2D(t){const n=nN.fromValues(ln.dot(t,this.u),ln.dot(t,this.v));return this.basisMap.set(n,t),n}to3D(t){const n=this.basisMap.get(t);if(n)return n;{console.log("Warning: point not in original slice");const r=ln.scale(ln.create(),this.u,t[0]),o=ln.scale(ln.create(),this.v,t[1]),a=ln.scale(ln.create(),ap,ap[3]),s=ln.add(r,r,a);return ln.add(o,o,s)}}};var sN=aN;const iN=vt,cN=WR,lN=sN,uN=e=>{const t=new lN(e),n=[];return t.roots.forEach(({solid:r,holes:o})=>{let a=r.length;const s=[];o.forEach((f,h)=>{s.push(a),a+=f.length});const i=[r,...o].flat(),c=i.flat(),l=f=>t.to3D(i[f]),u=cN(c,s);for(let f=0;f<u.length;f+=3){const h=u.slice(f,f+3).map(l);n.push(iN.fromPointsAndPlane(h,t.plane))}}),n};var fN=uN;const sp=He,dN=e=>e.reduce((t,n)=>t+=`[${sp.toString(n[0])}, ${sp.toString(n[1])}], `,""),hN=e=>`[${dN(e.edges)}]`;var pN=hN;const Js=He,mN=ho,vN=(e,t)=>{const n=t.edges.map(r=>[Js.transform(Js.create(),r[0],e),Js.transform(Js.create(),r[1],e)]);return mN(n)};var gN=vN,ta={calculatePlane:Hv,clone:YO,create:ho,equals:QO,fromPoints:tR,fromSides:oR,isA:sR,reverse:lR,toEdges:fR,toPolygons:fN,toString:pN,transform:gN};const ip=He,yN=ho,bN=e=>{if(!e.edges)return e;let t=e.edges;const n=new Map,r=new Map;t=t.filter(s=>!ip.equals(s[0],s[1])),t.forEach(s=>{const i=s[0].toString(),c=s[1].toString();n.set(i,s[0]),n.set(c,s[1]),r.set(i,(r.get(i)||0)+1),r.set(c,(r.get(c)||0)-1)});const o=[],a=[];return r.forEach((s,i)=>{s<0&&o.push(i),s>0&&a.push(i)}),o.forEach(s=>{const i=n.get(s);let c=1/0,l;a.forEach(u=>{const f=n.get(u),h=ip.distance(i,f);h<c&&(c=h,l=f)}),console.warn(`slice.repair: repairing vertex gap ${i} to ${l} distance ${c}`),t=t.map(u=>u[0].toString()===s?[l,u[1]]:u[1].toString()===s?[u[0],l]:u)}),yN(t)};var _N=bN;const{EPS:cp}=mt,Mo=He,ei=vt,lp=ta,Pu=(e,t)=>e===t?e:e<t?Pu(t,e):t===1?1:t===0?e:Pu(t,e%t),xN=(e,t)=>e*t/Pu(e,t),up=(e,t)=>{const n=e/t.length;if(n===1)return t;const r=Mo.fromValues(n,n,n),o=[];return t.forEach(a=>{const s=Mo.subtract(Mo.create(),a[1],a[0]);Mo.divide(s,s,r);let i=a[0];for(let c=1;c<=n;++c){const l=Mo.add(Mo.create(),i,s);o.push([i,l]),i=l}}),o},fp=cp*cp/2*Math.sin(Math.PI/3),wN=(e,t)=>{let n=lp.toEdges(e),r=lp.toEdges(t);if(n.length!==r.length){const a=xN(n.length,r.length);a!==n.length&&(n=up(a,n)),a!==r.length&&(r=up(a,r))}const o=[];return n.forEach((a,s)=>{const i=r[s],c=ei.create([a[0],a[1],i[1]]),l=ei.measureArea(c);Number.isFinite(l)&&l>fp&&o.push(c);const u=ei.create([a[0],i[1],i[0]]),f=ei.measureArea(u);Number.isFinite(f)&&f>fp&&o.push(u)}),o};var EN=wN;const dp=Tt,hp=at,AN=st,Cu=vt,Cr=ta,TN=_N,pp=EN,$N=(e,t,n)=>{let r=null;return hp.isA(n)&&(r=Cr.fromSides(hp.toSides(n))),Cu.isA(n)&&(r=Cr.fromPoints(Cu.toPoints(n))),e===0||e===1?Cr.transform(dp.fromTranslation(dp.create(),[0,0,e]),r):null},SN=(e,t)=>{const n={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:$N},{numberOfSlices:r,capStart:o,capEnd:a,close:s,repair:i,callback:c}=Object.assign({},n,e);if(r<2)throw new Error("numberOfSlices must be 2 or more");i&&(t=TN(t));const l=r-1;let u=null,f=null,h=null,p=[];for(let g=0;g<r;g++){const v=c(g/l,g,t);if(v){if(!Cr.isA(v))throw new Error("the callback function must return slice objects");if(Cr.toEdges(v).length===0)throw new Error("the callback function must return slices with one or more edges");h&&(p=p.concat(pp(h,v))),g===0&&(u=v),g===r-1&&(f=v),h=v}}if(a){const g=Cr.toPolygons(f);p=p.concat(g)}if(o){const g=Cr.toPolygons(u).map(Cu.invert);p=p.concat(g)}return!o&&!a&&s&&!Cr.equals(f,u)&&(p=p.concat(pp(f,u))),AN.create(p)};var Yi=SN;const{TAU:On}=mt,La=Tt,{mirrorX:PN}=qa,ka=at,Cl=ta,CN=Yi,ON=(e,t)=>{const n={segments:12,startAngle:0,angle:On,overflow:"cap"};let{segments:r,startAngle:o,angle:a,overflow:s}=Object.assign({},n,e);if(r<3)throw new Error("segments must be greater then 3");o=Math.abs(o)>On?o%On:o,a=Math.abs(a)>On?a%On:a;let i=o+a;if(i=Math.abs(i)>On?i%On:i,i<o){const P=o;o=i,i=P}let c=i-o;if(c<=0&&(c=On),Math.abs(c)<On){const P=On/r;r=Math.floor(Math.abs(c)/P),Math.abs(c)>r*P&&r++}let l=ka.toSides(t);if(l.length===0)throw new Error("the given geometry cannot be empty");const u=l.filter(P=>P[0][0]<0),f=l.filter(P=>P[0][0]>=0);u.length>0&&f.length>0&&s==="cap"&&(u.length>f.length?(l=l.map(P=>{let S=P[0],O=P[1];return S=[Math.min(S[0],0),S[1]],O=[Math.min(O[0],0),O[1]],[S,O]}),t=ka.reverse(ka.create(l)),t=PN(t)):f.length>=u.length&&(l=l.map(P=>{let S=P[0],O=P[1];return S=[Math.max(S[0],0),S[1]],O=[Math.max(O[0],0),O[1]],[S,O]}),t=ka.create(l)));const p=c/r,g=Math.abs(c)<On,v=Cl.fromSides(ka.toSides(t));Cl.reverse(v,v);const m=La.create(),x=(P,S,O)=>{let R=p*S+o;return c===On&&S===r&&(R=o),La.multiply(m,La.fromZRotation(m,R),La.fromXRotation(La.create(),On/4)),Cl.transform(m,O)};return e={numberOfSlices:r+1,capStart:g,capEnd:g,close:!g,callback:x},CN(e,v)};var Jv=ON;const RN=nt,mp=Tt,vp=at,gp=st,yp=Et,Zi=(e,...t)=>{if(!Array.isArray(e))throw new Error("angles must be an array");if(t=RN(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(0);const n=e[2],r=e[1],o=e[0],a=mp.fromTaitBryanRotation(mp.create(),n,r,o),s=t.map(i=>yp.isA(i)?yp.transform(a,i):vp.isA(i)?vp.transform(a,i):gp.isA(i)?gp.transform(a,i):i);return s.length===1?s[0]:s},NN=(e,...t)=>Zi([e,0,0],t),MN=(e,...t)=>Zi([0,e,0],t),DN=(e,...t)=>Zi([0,0,e],t);var Ha={rotate:Zi,rotateX:NN,rotateY:MN,rotateZ:DN};const LN=nt,bp=Tt,_p=at,xp=st,wp=Et,Ki=(e,...t)=>{if(!Array.isArray(e))throw new Error("offset must be an array");if(t=LN(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(0);const n=bp.fromTranslation(bp.create(),e),r=t.map(o=>wp.isA(o)?wp.transform(n,o):_p.isA(o)?_p.transform(n,o):xp.isA(o)?xp.transform(n,o):o);return r.length===1?r[0]:r},kN=(e,...t)=>Ki([e,0,0],t),IN=(e,...t)=>Ki([0,e,0],t),FN=(e,...t)=>Ki([0,0,e],t);var so={translate:Ki,translateX:kN,translateY:IN,translateZ:FN};const{TAU:GN}=mt,BN=Jv,{rotate:zN}=Ha,{translate:VN}=so,jN=Bv,{isGT:Ol,isGTE:Rl}=Jt,UN=e=>{const t={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:GN},{innerRadius:n,innerSegments:r,outerRadius:o,outerSegments:a,innerRotation:s,startAngle:i,outerRotation:c}=Object.assign({},t,e);if(!Ol(n,0))throw new Error("innerRadius must be greater than zero");if(!Rl(r,3))throw new Error("innerSegments must be three or more");if(!Ol(o,0))throw new Error("outerRadius must be greater than zero");if(!Rl(a,3))throw new Error("outerSegments must be three or more");if(!Rl(i,0))throw new Error("startAngle must be positive");if(!Ol(c,0))throw new Error("outerRotation must be greater than zero");if(n>=o)throw new Error("inner circle is two large to rotate about the outer circle");let l=jN({radius:n,segments:r});return s!==0&&(l=zN([0,0,s],l)),l=VN([o,0],l),BN({startAngle:i,angle:c,segments:a},l)};var qN=UN;const{NEPS:Wo}=mt,Ia=ut,XN=at,{isNumberArray:HN}=Jt,Ou=(e,t,n)=>Math.acos((e*e+t*t-n*n)/(2*e*t)),WN=(e,t,n)=>t>Wo?Math.sqrt(e*e+n*n-2*e*n*Math.cos(t)):Math.sqrt((e-n)*(e-n)+e*n*t*t*(1-t*t/12)),YN=e=>{if(Math.abs(e[0]+e[1]+e[2]-Math.PI)>Wo)throw new Error("AAA triangles require angles that sum to PI");const n=e[0],r=e[1],o=Math.PI-n-r,a=1,s=a/Math.sin(o)*Math.sin(n),i=a/Math.sin(o)*Math.sin(r);return na(n,r,o,s,i,a)},ZN=e=>{const t=e[0],n=e[1],r=Math.PI+Wo-t-n;if(r<Wo)throw new Error("AAS triangles require angles that sum to PI");const o=e[2],a=o/Math.sin(t)*Math.sin(n),s=o/Math.sin(t)*Math.sin(r);return na(t,n,r,o,a,s)},KN=e=>{const t=e[0],n=e[2],r=Math.PI+Wo-t-n;if(r<Wo)throw new Error("ASA triangles require angles that sum to PI");const o=e[1],a=o/Math.sin(r)*Math.sin(t),s=o/Math.sin(r)*Math.sin(n);return na(t,n,r,a,s,o)},QN=e=>{const t=e[0],n=e[1],r=e[2],o=WN(t,n,r),a=Ou(o,t,r),s=Math.PI-a-n;return na(a,n,s,r,o,t)},JN=e=>{const t=e[0],n=e[1],r=e[2],o=Math.asin(n*Math.sin(r)/t),a=Math.PI-o-r,s=t/Math.sin(r)*Math.sin(a);return na(o,a,r,n,s,t)},eM=e=>{const t=e[1],n=e[2],r=e[0];if(t+n<=r||n+r<=t||r+t<=n)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");const o=Ou(n,r,t),a=Ou(r,t,n),s=Math.PI-o-a;return na(o,a,s,t,n,r)},na=(e,t,n,r,o,a)=>{const s=Ia.fromValues(0,0),i=Ia.fromValues(a,0),c=Ia.fromValues(r,0);return Ia.add(c,Ia.rotate(c,c,[0,0],Math.PI-t),i),XN.fromPoints([s,i,c])},tM=e=>{const t={type:"SSS",values:[1,1,1]};let{type:n,values:r}=Object.assign({},t,e);if(typeof n!="string")throw new Error("triangle type must be a string");if(n=n.toUpperCase(),!((n[0]==="A"||n[0]==="S")&&(n[1]==="A"||n[1]==="S")&&(n[2]==="A"||n[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!HN(r,3))throw new Error("triangle values must contain three values");if(!r.every(o=>o>0))throw new Error("triangle values must be greater than zero");switch(n){case"AAA":return YN(r);case"AAS":return ZN(r);case"ASA":return KN(r);case"SAS":return QN(r);case"SSA":return JN(r);case"SSS":return eM(r);default:throw new Error("invalid triangle type, try again")}};var nM=tM,rM={arc:CC,circle:Bv,cube:VC,cuboid:hf,cylinder:Vv,cylinderElliptic:zv,ellipse:Gv,ellipsoid:jv,geodesicSphere:sO,line:lO,polygon:fO,polyhedron:Uv,rectangle:pf,roundedCuboid:yO,roundedCylinder:AO,roundedRectangle:SO,sphere:qv,square:DO,star:BO,torus:qN,triangle:nM},oM={height:14,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]};const aM=oM,sM={xOffset:0,yOffset:0,input:"?",align:"left",font:aM,height:14,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0},iM=(e,t)=>{!t&&typeof e=="string"&&(e={input:e}),e=e||{};const n=Object.assign({},sM,e);return n.input=t||n.input,n};var eg=iM;const cM=eg,lM=(e,t)=>{const{xOffset:n,yOffset:r,input:o,font:a,height:s,extrudeOffset:i}=cM(e,t);let c=o.charCodeAt(0);(!c||!a[c])&&(c=63);const l=[].concat(a[c]),u=(s-i)/a.height,f=i/2,h=l.shift()*u,p=[];let g=[];for(let v=0,m=l.length;v<m;v+=2){const x=u*l[v]+n,P=u*l[v+1]+r+f;if(l[v]!==void 0){g.push([x,P]);continue}p.push(g),g=[],v--}return g.length&&p.push(g),{width:h,height:s,segments:p}};var tg=lM;const uM=tg,fM=eg,Ep=(e,t)=>{const{x:n,y:r}=Object.assign({x:0,y:0},e||{}),o=t.segments;let a=null,s=null;for(let i=0,c=o.length;i<c;i++){a=o[i];for(let l=0,u=a.length;l<u;l++)s=a[l],a[l]=[s[0]+n,s[1]+r]}return t},dM=(e,t)=>{const{xOffset:n,yOffset:r,input:o,font:a,height:s,align:i,extrudeOffset:c,lineSpacing:l,letterSpacing:u}=fM(e,t);let[f,h]=[n,r],p,g,v,m,x,P,S={width:0,segments:[]};const O=[];let R=[],N=0;const I=f,X=()=>{O.push(S),N=Math.max(N,S.width),S={width:0,segments:[]}};for(p=0,g=o.length;p<g;p++){if(v=o[p],m=uM({xOffset:f,yOffset:h,font:a,height:s,extrudeOffset:c},v),v===`
`){f=I,h-=m.height*l,X();continue}x=m.width*u,S.width+=x,f+=x,v!==" "&&(S.segments=S.segments.concat(m.segments))}for(S.segments.length&&X(),p=0,g=O.length;p<g;p++)S=O[p],N>S.width&&(P=N-S.width,i==="right"?S=Ep({x:P},S):i==="center"&&(S=Ep({x:P/2},S))),R=R.concat(S.segments);return R};var hM=dM,pM={vectorChar:tg,vectorText:hM};const mM=at,vM=st,gM=Et,yM=e=>{let t;for(const n of e){let r=0;if(mM.isA(n)&&(r=1),vM.isA(n)&&(r=2),gM.isA(n)&&(r=3),t&&r!==t)return!1;t=r}return!0};var ls=yM;const bM=e=>e*.017453292519943295;var _M=bM;const xM=(e,t)=>e-t;var ng=xM;const wM=(e,t,n)=>{let r=0,o=e.length;for(;o>r;){const a=Math.floor((r+o)/2),s=e[a];n(t,s)>0?r=a+1:o=a}e.splice(r,0,t)};var EM=wM;const{TAU:Ap}=mt,AM=(e,t,n)=>{const r=t>0?e*Ap/t:0,o=n>0?Ap/n:0;return Math.ceil(Math.max(r,o,4))};var TM=AM;const $M=e=>e*57.29577951308232;var SM=$M,rg={areAllShapesTheSameType:ls,degToRad:_M,flatten:nt,fnNumberSort:ng,insertSorted:EM,radiusToSegments:TM,radToDeg:SM};const Tp=ut,PM=at,CM=(e,t)=>{if(t.vertices.length<4)return null;const n=[],r=t.vertices.filter((s,i)=>s[2]>0?(n.push(i),!0):!1);if(r.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");const o=r.map(s=>{const i=Math.round(s[0]/e)*e+0,c=Math.round(s[1]/e)*e+0;return Tp.fromValues(i,c)});if(Tp.equals(o[0],o[1]))return null;const a=n[1]-n[0];if(a===1||a===3)a===1&&o.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return o},OM=(e,t)=>{const n=t.map(r=>CM(e,r)).filter(r=>r!==null);return PM.create(n)};var vf=OM;const Ar=He,RM=at,NM=st,MM=vt,DM=(e,t,n)=>{const r=[Ar.fromVec2(Ar.create(),n[0],e),Ar.fromVec2(Ar.create(),n[1],e),Ar.fromVec2(Ar.create(),n[1],t),Ar.fromVec2(Ar.create(),n[0],t)];return MM.create(r)},LM=(e,t)=>{const r=RM.toSides(t).map(a=>DM(e.z0,e.z1,a));return NM.create(r)};var gf=LM;const $p=Tt,kM=ut,Kt=He,lo=function(e,t){arguments.length<2&&(t=Kt.orthogonal(Kt.create(),e)),this.v=Kt.normalize(Kt.create(),Kt.cross(Kt.create(),e,t)),this.u=Kt.cross(Kt.create(),this.v,e),this.plane=e,this.planeorigin=Kt.scale(Kt.create(),e,e[3])};lo.GetCartesian=function(e,t){const n=e+"/"+t;let r,o;if(n==="X/Y")r=[0,0,1],o=[1,0,0];else if(n==="Y/-X")r=[0,0,1],o=[0,1,0];else if(n==="-X/-Y")r=[0,0,1],o=[-1,0,0];else if(n==="-Y/X")r=[0,0,1],o=[0,-1,0];else if(n==="-X/Y")r=[0,0,-1],o=[-1,0,0];else if(n==="-Y/-X")r=[0,0,-1],o=[0,-1,0];else if(n==="X/-Y")r=[0,0,-1],o=[1,0,0];else if(n==="Y/X")r=[0,0,-1],o=[0,1,0];else if(n==="X/Z")r=[0,-1,0],o=[1,0,0];else if(n==="Z/-X")r=[0,-1,0],o=[0,0,1];else if(n==="-X/-Z")r=[0,-1,0],o=[-1,0,0];else if(n==="-Z/X")r=[0,-1,0],o=[0,0,-1];else if(n==="-X/Z")r=[0,1,0],o=[-1,0,0];else if(n==="-Z/-X")r=[0,1,0],o=[0,0,-1];else if(n==="X/-Z")r=[0,1,0],o=[1,0,0];else if(n==="Z/X")r=[0,1,0],o=[0,0,1];else if(n==="Y/Z")r=[1,0,0],o=[0,1,0];else if(n==="Z/-Y")r=[1,0,0],o=[0,0,1];else if(n==="-Y/-Z")r=[1,0,0],o=[0,-1,0];else if(n==="-Z/Y")r=[1,0,0],o=[0,0,-1];else if(n==="-Y/Z")r=[-1,0,0],o=[0,-1,0];else if(n==="-Z/-Y")r=[-1,0,0],o=[0,0,-1];else if(n==="Y/-Z")r=[-1,0,0],o=[0,1,0];else if(n==="Z/Y")r=[-1,0,0],o=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new lo(new Plane(new Vector3D(r),0),new Vector3D(o))};lo.Z0Plane=function(){const e=new Plane(new Vector3D([0,0,1]),0);return new lo(e,new Vector3D([1,0,0]))};lo.prototype={getProjectionMatrix:function(){return $p.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){const e=Kt.scale(Kt.create(),this.plane,this.plane[3]);return $p.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,e[0],e[1],e[2],1)},to2D:function(e){return kM.fromValues(Kt.dot(e,this.u),Kt.dot(e,this.v))},to3D:function(e){const t=Kt.scale(Kt.create(),this.u,e[0]),n=Kt.scale(Kt.create(),this.v,e[1]),r=Kt.add(t,t,this.planeorigin);return Kt.add(n,n,r)},line3Dto2D:function(e){const t=e.point,n=e.direction.plus(t),r=this.to2D(t),o=this.to2D(n);return Line2D.fromPoints(r,o)},line2Dto3D:function(e){const t=e.origin(),n=e.direction().plus(t),r=this.to3D(t),o=this.to3D(n);return Line3D.fromPoints(r,o)},transform:function(e){const t=this.plane.transform(e),n=this.u.transform(e),r=new Vector3D(0,0,0).transform(e),o=n.minus(r);return new lo(t,o)}};var IM=lo;const{EPS:ir}=mt,Tr=lf,Vn=ut,FM=IM,Do=_v,{insertSorted:GM,fnNumberSort:BM}=rg,Sp=vt,zM=e=>{if(e.length<2)return e;const t=[],n=e.length,r=Sp.plane(e[0]),o=new FM(r),a=[],s=[],i=new Map,c=new Map,l=new Map,u=10/ir;for(let g=0;g<n;g++){const v=e[g];let m=[],x=v.vertices.length,P=-1;if(x>0){let S,O;for(let R=0;R<x;R++){let N=o.to2D(v.vertices[R]);const I=Math.floor(N[1]*u);let X;l.has(I)?X=l.get(I):l.has(I+1)?X=l.get(I+1):l.has(I-1)?X=l.get(I-1):(X=N[1],l.set(I,N[1])),N=Vn.fromValues(N[0],X),m.push(N);const W=N[1];(R===0||W<S)&&(S=W,P=R),(R===0||W>O)&&(O=W);let J=c.get(W);J||(J={},c.set(W,J)),J[g]=!0}if(S>=O)m=[],x=0,P=-1;else{let R=i.get(S);R||(R=[],i.set(S,R)),R.push(g)}}m.reverse(),P=x-P-1,a.push(m),s.push(P)}const f=[];c.forEach((g,v)=>f.push(v)),f.sort(BM);let h=[],p=[];for(let g=0;g<f.length;g++){const v=[],m=f[g],x=c.get(m);for(let S=0;S<h.length;++S){const O=h[S],R=O.polygonindex;if(x[R]){const N=a[R],I=N.length;let X=O.leftvertexindex,W=O.rightvertexindex;for(;;){let G=X+1;if(G>=I&&(G=0),N[G][1]!==m)break;X=G}let J=W-1;if(J<0&&(J=I-1),N[J][1]===m&&(W=J),X!==O.leftvertexindex&&X===W)h.splice(S,1),--S;else{O.leftvertexindex=X,O.rightvertexindex=W,O.topleft=N[X],O.topright=N[W];let G=X+1;G>=I&&(G=0),O.bottomleft=N[G];let ce=W-1;ce<0&&(ce=I-1),O.bottomright=N[ce]}}}let P;if(g>=f.length-1)h=[],P=null;else{P=Number(f[g+1]);const S=.5*(m+P),O=i.get(m);for(const R in O){const N=O[R],I=a[N],X=I.length,W=s[N];let J=W;for(;;){let De=J+1;if(De>=X&&(De=0),I[De][1]!==m||De===W)break;J=De}let G=W;for(;;){let De=G-1;if(De<0&&(De=X-1),I[De][1]!==m||De===J)break;G=De}let ce=J+1;ce>=X&&(ce=0);let _e=G-1;_e<0&&(_e=X-1);const de={polygonindex:N,leftvertexindex:J,rightvertexindex:G,topleft:I[J],topright:I[G],bottomleft:I[ce],bottomright:I[_e]};GM(h,de,(De,be)=>{const Ve=Do(De.topleft,De.bottomleft,S),Fe=Do(be.topleft,be.bottomleft,S);return Ve>Fe?1:Ve<Fe?-1:0})}}for(const S in h){const O=h[S];let R=Do(O.topleft,O.bottomleft,m);const N=Vn.fromValues(R,m);R=Do(O.topright,O.bottomright,m);const I=Vn.fromValues(R,m);R=Do(O.topleft,O.bottomleft,P);const X=Vn.fromValues(R,P);R=Do(O.topright,O.bottomright,P);const W=Vn.fromValues(R,P),J={topleft:N,topright:I,bottomleft:X,bottomright:W,leftline:Tr.fromPoints(Tr.create(),N,X),rightline:Tr.fromPoints(Tr.create(),W,I)};if(v.length>0){const G=v[v.length-1],ce=Vn.distance(J.topleft,G.topright),_e=Vn.distance(J.bottomleft,G.bottomright);ce<ir&&_e<ir&&(J.topleft=G.topleft,J.leftline=G.leftline,J.bottomleft=G.bottomleft,v.splice(v.length-1,1))}v.push(J)}if(g>0){const S=new Set,O=new Set;for(let R=0;R<v.length;R++){const N=v[R];for(let I=0;I<p.length;I++)if(!O.has(I)){const X=p[I];if(Vn.distance(X.bottomleft,N.topleft)<ir&&Vn.distance(X.bottomright,N.topright)<ir){O.add(I);const W=Tr.direction(N.leftline),J=Tr.direction(X.leftline),G=W[0]-J[0],ce=Tr.direction(N.rightline),_e=Tr.direction(X.rightline),de=ce[0]-_e[0],De=Math.abs(G)<ir,be=Math.abs(de)<ir,Ve=De||G>=0,Fe=be||de>=0;Ve&&Fe&&(N.outpolygon=X.outpolygon,N.leftlinecontinues=De,N.rightlinecontinues=be,S.add(I));break}}}for(let R=0;R<p.length;R++)if(!S.has(R)){const N=p[R];N.outpolygon.rightpoints.push(N.bottomright),Vn.distance(N.bottomright,N.bottomleft)>ir&&N.outpolygon.leftpoints.push(N.bottomleft),N.outpolygon.leftpoints.reverse();const X=N.outpolygon.rightpoints.concat(N.outpolygon.leftpoints).map(J=>o.to3D(J)),W=Sp.fromPointsAndPlane(X,r);W.vertices.length&&t.push(W)}}for(let S=0;S<v.length;S++){const O=v[S];O.outpolygon?(O.leftlinecontinues||O.outpolygon.leftpoints.push(O.topleft),O.rightlinecontinues||O.outpolygon.rightpoints.push(O.topright)):(O.outpolygon={leftpoints:[],rightpoints:[]},O.outpolygon.leftpoints.push(O.topleft),Vn.distance(O.topleft,O.topright)>ir&&O.outpolygon.rightpoints.push(O.topright))}p=v}return t};var VM=zM;const Pp=st,jM=vt,{NEPS:UM}=mt,qM=VM,XM=e=>{if(e.isRetesselated)return e;const t=Pp.toPolygons(e).map((a,s)=>({vertices:a.vertices,plane:jM.plane(a),index:s})),n=HM(t),r=[];n.forEach(a=>{if(Array.isArray(a)){const s=qM(a);r.push(...s)}else r.push(a)});const o=Pp.create(r);return o.isRetesselated=!0,o},HM=e=>{let t=[e];const n=[];for(let o=3;o>=0;o--){const a=[],s=o===3?15e-9:UM;t.forEach(i=>{i.sort(WM(o,s));let c=0;for(let l=1;l<i.length;l++)i[l].plane[o]-i[c].plane[o]>s&&(l-c===1?n.push(i[c]):a.push(i.slice(c,l)),c=l);i.length-c===1?n.push(i[c]):a.push(i.slice(c))}),t=a}const r=[];return t.forEach(o=>{o[0]&&(r[o[0].index]=o)}),n.forEach(o=>{r[o.index]=o}),r},WM=(e,t)=>(n,r)=>n.plane[e]-r.plane[e]>t?1:r.plane[e]-n.plane[e]>t?-1:0;var us=XM;const{EPS:Lo}=mt,Cp=fo,YM=(e,t)=>{if(e.polygons.length===0||t.polygons.length===0)return!1;const n=Cp(e),r=n[0],o=n[1],a=Cp(t),s=a[0],i=a[1];return!(s[0]-o[0]>Lo||r[0]-i[0]>Lo||s[1]-o[1]>Lo||r[1]-i[1]>Lo||s[2]-o[2]>Lo||r[2]-i[2]>Lo)};var yf=YM;const Op=er,ZM=vt;let KM=class Ru{constructor(t){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=t}invert(){const t=[this];let n;for(let r=0;r<t.length;r++){n=t[r],n.plane&&(n.plane=Op.flip(Op.create(),n.plane)),n.front&&t.push(n.front),n.back&&t.push(n.back);const o=n.front;n.front=n.back,n.back=o}}clipPolygons(t,n){let r={node:this,polygontreenodes:t},o;const a=[];do{if(o=r.node,t=r.polygontreenodes,o.plane){const s=o.plane,i=[],c=[],l=n?i:c,u=t.length;for(let h=0;h<u;h++){const p=t[h];p.isRemoved()||p.splitByPlane(s,l,i,c,i)}o.front&&c.length>0&&a.push({node:o.front,polygontreenodes:c});const f=i.length;if(o.back&&f>0)a.push({node:o.back,polygontreenodes:i});else for(let h=0;h<f;h++)i[h].remove()}r=a.pop()}while(r!==void 0)}clipTo(t,n){let r=this;const o=[];do r.polygontreenodes.length>0&&t.rootnode.clipPolygons(r.polygontreenodes,n),r.front&&o.push(r.front),r.back&&o.push(r.back),r=o.pop();while(r!==void 0)}addPolygonTreeNodes(t){let n={node:this,polygontreenodes:t};const r=[];do{const o=n.node,a=n.polygontreenodes;if(a.length===0){n=r.pop();continue}if(!o.plane){let l=0;l=Math.floor(a.length/2);const u=a[l].getPolygon();o.plane=ZM.plane(u)}const s=[],i=[],c=a.length;for(let l=0;l<c;++l)a[l].splitByPlane(o.plane,o.polygontreenodes,i,s,i);s.length>0&&(o.front||(o.front=new Ru(o)),c===s.length&&i.length===0?o.front.polygontreenodes=s:r.push({node:o.front,polygontreenodes:s})),i.length>0&&(o.back||(o.back=new Ru(o)),c===i.length&&s.length===0?o.back.polygontreenodes=i:r.push({node:o.back,polygontreenodes:i})),n=r.pop()}while(n!==void 0)}};var QM=KM;const ko=He,JM=(e,t,n)=>{const r=ko.subtract(ko.create(),n,t);let o=(e[3]-ko.dot(e,t))/ko.dot(e,r);return Number.isNaN(o)&&(o=0),o>1&&(o=1),o<0&&(o=0),ko.scale(r,r,o),ko.add(r,t,r),r};var eD=JM;const{EPS:ti}=mt,tD=er,ni=He,Nl=vt,nD=eD,rD=(e,t)=>{const n={type:null,front:null,back:null},r=t.vertices,o=r.length,a=Nl.plane(t);if(tD.equals(a,e))n.type=0;else{let s=!1,i=!1;const c=[],l=-ti;for(let u=0;u<o;u++){const f=ni.dot(e,r[u])-e[3],h=f<l;c.push(h),f>ti&&(s=!0),f<l&&(i=!0)}if(!s&&!i){const u=ni.dot(e,a);n.type=u>=0?0:1}else if(!i)n.type=2;else if(!s)n.type=3;else{n.type=4;const u=[],f=[];let h=c[0];for(let g=0;g<o;g++){const v=r[g];let m=g+1;m>=o&&(m=0);const x=c[m];if(h===x)h?f.push(v):u.push(v);else{const P=r[m],S=nD(e,v,P);h?(f.push(v),f.push(S),u.push(S)):(u.push(v),u.push(S),f.push(S))}h=x}const p=ti*ti;if(f.length>=3){let g=f[f.length-1];for(let v=0;v<f.length;v++){const m=f[v];ni.squaredDistance(m,g)<p&&(f.splice(v,1),v--),g=m}}if(u.length>=3){let g=u[u.length-1];for(let v=0;v<u.length;v++){const m=u[v];ni.squaredDistance(m,g)<p&&(u.splice(v,1),v--),g=m}}u.length>=3&&(n.front=Nl.fromPointsAndPlane(u,a)),f.length>=3&&(n.back=Nl.fromPointsAndPlane(f,a))}}return n};var oD=rD;const{EPS:aD}=mt,sD=He,Rp=vt,iD=oD;let cD=class og{constructor(t,n){this.parent=t,this.children=[],this.polygon=n,this.removed=!1}addPolygons(t){if(!this.isRootNode())throw new Error("Assertion failed");const n=this;t.forEach(r=>{n.addChild(r)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;const t=this.parent.children,n=t.indexOf(this);if(n<0)throw new Error("Assertion failed");t.splice(n,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(t){let n=[this];const r=[n];let o,a,s,i;for(o=0;o<r.length;++o)for(n=r[o],a=0,s=n.length;a<s;a++)i=n[a],i.polygon?t.push(i.polygon):i.children.length>0&&r.push(i.children)}splitByPlane(t,n,r,o,a){if(this.children.length){const s=[this.children];let i,c,l,u,f;for(i=0;i<s.length;i++)for(f=s[i],c=0,l=f.length;c<l;c++)u=f[c],u.children.length>0?s.push(u.children):u._splitByPlane(t,n,r,o,a)}else this._splitByPlane(t,n,r,o,a)}_splitByPlane(t,n,r,o,a){const s=this.polygon;if(s){const i=Rp.measureBoundingSphere(s),c=i[3]+aD,l=i,u=sD.dot(t,l)-t[3];if(u>c)o.push(this);else if(u<-c)a.push(this);else{const f=iD(t,s);switch(f.type){case 0:n.push(this);break;case 1:r.push(this);break;case 2:o.push(this);break;case 3:a.push(this);break;case 4:if(f.front){const h=this.addChild(f.front);o.push(h)}if(f.back){const h=this.addChild(f.back);a.push(h)}break}}}}addChild(t){const n=new og(this,t);return this.children.push(n),n}invertSub(){let t=[this];const n=[t];let r,o,a,s;for(r=0;r<n.length;r++)for(t=n[r],o=0,a=t.length;o<a;o++)s=t[o],s.polygon&&(s.polygon=Rp.invert(s.polygon)),s.children.length>0&&n.push(s.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let t=[this];const n=[t];for(let r=0;r<n.length;++r){t=n[r];const o=t.length;for(let a=0;a<o;a++){const s=t[a];s.polygon&&(s.polygon=null),s.parent&&(s.parent=null),s.children.length>0&&n.push(s.children),s.children=[]}}}toString(){let t="",n=[this];const r=[n];let o,a,s,i;for(o=0;o<r.length;++o){n=r[o];const c=" ".repeat(o);for(a=0,s=n.length;a<s;a++)i=n[a],t+=`${c}PolygonTreeNode (${i.isRootNode()}): ${i.children.length}`,i.polygon?t+=`
 ${c}polygon: ${i.polygon.vertices}
`:t+=`
`,i.children.length>0&&r.push(i.children)}return t}};var lD=cD;const uD=QM,fD=lD;let dD=class{constructor(t){this.polygonTree=new fD,this.rootnode=new uD(null),t&&this.addPolygons(t)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(t,n=!1){this.rootnode.clipTo(t,n)}allPolygons(){const t=[];return this.polygonTree.getPolygons(t),t}addPolygons(t){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=this.polygonTree.addChild(t[r]);this.rootnode.addPolygonTreeNodes(n)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}};var hD=dD,bf={Tree:hD};const ri=st,pD=yf,{Tree:Np}=bf,mD=(e,t)=>{if(!pD(e,t))return ri.create();const n=new Np(ri.toPolygons(e)),r=new Np(ri.toPolygons(t));n.invert(),r.clipTo(n),r.invert(),n.clipTo(r),r.clipTo(n),n.addPolygons(r.allPolygons()),n.invert();const o=n.allPolygons();return ri.create(o)};var vD=mD;const gD=nt,yD=us,bD=vD,_D=(...e)=>{e=gD(e);let t=e.shift();return e.forEach(n=>{t=bD(t,n)}),t=yD(t),t};var ag=_D;const xD=nt,wD=st,ED=Nr,AD=vf,TD=gf,$D=ag,SD=(...e)=>{e=xD(e);const t=e.map(o=>TD({z0:-1,z1:1},o)),n=$D(t),r=ED(n);return AD(r,wD.toPolygons(n))};var PD=SD;const CD=nt,OD=ls,RD=at,ND=st,MD=PD,DD=ag,LD=(...e)=>{if(e=CD(e),e.length===0)throw new Error("wrong number of arguments");if(!OD(e))throw new Error("only intersect of the types are supported");const t=e[0];return RD.isA(t)?MD(e):ND.isA(t)?DD(e):t};var kD=LD;const Ml=He,ID=Nr,Mp=st,FD=e=>e.sort((t,n)=>t-n).filter((t,n,r)=>!n||t!==r[n-1]),GD=(e,t,n)=>{const r=`${t}`,o=e.get(r);o===void 0?e.set(r,[n]):o.push(n)},BD=(e,t)=>{const n=`${t}`;return e.get(n)},zD=e=>{const t=ID(e),n=Mp.toPolygons(e),r=n.length,o=new Map,a=Ml.create();n.forEach((u,f)=>{u.vertices.forEach(h=>{GD(o,Ml.snap(a,h,t),f)})});const s=n.map(u=>{let f=[];return u.vertices.forEach(h=>{f=f.concat(BD(o,Ml.snap(a,h,t)))}),{e:1,d:FD(f)}});o.clear();let i=0;const c=s.length;for(let u=0;u<c;u++){const f=s[u];if(f.e>0){const h=new Array(r);h[u]=!0;do i=0,h.forEach((p,g)=>{const v=s[g];if(v.e>0){v.e=-1;for(let m=0;m<v.d.length;m++)h[v.d[m]]=!0;i++}});while(i>0);f.indexes=h}}const l=[];for(let u=0;u<c;u++)if(s[u].indexes){const f=[];s[u].indexes.forEach((h,p)=>f.push(n[p])),l.push(Mp.create(f))}return l};var VD=zD;const jD=nt,UD=st,qD=VD,XD=(...e)=>{if(e=jD(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(n=>UD.isA(n)?qD(n):n);return t.length===1?t[0]:t};var HD=XD;const oi=st,WD=yf,{Tree:Dp}=bf,YD=(e,t)=>{if(!WD(e,t))return oi.clone(e);const n=new Dp(oi.toPolygons(e)),r=new Dp(oi.toPolygons(t));n.invert(),n.clipTo(r),r.clipTo(n,!0),n.addPolygons(r.allPolygons()),n.invert();const o=n.allPolygons();return oi.create(o)};var ZD=YD;const KD=nt,QD=us,JD=ZD,eL=(...e)=>{e=KD(e);let t=e.shift();return e.forEach(n=>{t=JD(t,n)}),t=QD(t),t};var sg=eL;const tL=nt,nL=st,rL=Nr,oL=vf,aL=gf,sL=sg,iL=(...e)=>{e=tL(e);const t=e.map(o=>aL({z0:-1,z1:1},o)),n=sL(t),r=rL(n);return oL(r,nL.toPolygons(n))};var cL=iL;const lL=nt,uL=ls,fL=at,dL=st,hL=cL,pL=sg,mL=(...e)=>{if(e=lL(e),e.length===0)throw new Error("wrong number of arguments");if(!uL(e))throw new Error("only subtract of the types are supported");const t=e[0];return fL.isA(t)?hL(e):dL.isA(t)?pL(e):t};var vL=mL;const jo=st,gL=yf,{Tree:Lp}=bf,yL=(e,t)=>{if(!gL(e,t))return bL(e,t);const n=new Lp(jo.toPolygons(e)),r=new Lp(jo.toPolygons(t));n.clipTo(r,!1),r.clipTo(n),r.invert(),r.clipTo(n),r.invert();const o=n.allPolygons().concat(r.allPolygons());return jo.create(o)},bL=(e,t)=>{let n=jo.toPolygons(e);return n=n.concat(jo.toPolygons(t)),jo.create(n)};var ig=yL;const _L=nt,xL=us,wL=ig,EL=(...e)=>{e=_L(e);let t;for(t=1;t<e.length;t+=2)e.push(wL(e[t-1],e[t]));let n=e[t-1];return n=xL(n),n};var cg=EL;const AL=nt,TL=st,$L=Nr,SL=vf,PL=gf,CL=cg,OL=(...e)=>{e=AL(e);const t=e.map(o=>PL({z0:-1,z1:1},o)),n=CL(t),r=$L(n);return SL(r,TL.toPolygons(n))};var lg=OL;const RL=nt,NL=ls,ML=at,DL=st,LL=lg,kL=cg,IL=(...e)=>{if(e=RL(e),e.length===0)throw new Error("wrong number of arguments");if(!NL(e))throw new Error("only unions of the same type are supported");const t=e[0];return ML.isA(t)?LL(e):DL.isA(t)?kL(e):t};var _f=IL,FL={intersect:kD,scission:HD,subtract:vL,union:_f};const{EPS:GL,TAU:BL}=mt,kp=xv,Fa=lf,Gt=ut,zL=qi,VL=(e,t)=>{const n={delta:1,corners:"edge",closed:!1,segments:16};let{delta:r,corners:o,closed:a,segments:s}=Object.assign({},n,e);if(Math.abs(r)<GL)return t;let i=e.closed?zL(t):1;i===0&&(i=1);const c=i>0&&r>=0||i<0&&r<0;r=Math.abs(r);let l=null,u=[];const f=[],h=Gt.create(),p=t.length;for(let g=0;g<p;g++){const v=(g+1)%p,m=t[g],x=t[v];c?Gt.subtract(h,m,x):Gt.subtract(h,x,m),Gt.normal(h,h),Gt.normalize(h,h),Gt.scale(h,h,r);const P=Gt.add(Gt.create(),m,h),S=Gt.add(Gt.create(),x,h),O=[P,S];if(l!=null&&(a||!a&&v!==0)){const R=kp(l[0],l[1],O[0],O[1]);R?(u.pop(),O[0]=R):f.push({c:m,s0:l,s1:O})}l=[P,S],!(v===0&&!a)&&(u.push(O[0]),u.push(O[1]))}if(a&&l!=null){const g=u[0],v=u[1],m=kp(l[0],l[1],g,v);if(m)u[0]=m,u.pop();else{const x=t[0],P=[g,v];f.push({c:x,s0:l,s1:P})}}if(o==="edge"){const g=new Map;u.forEach((x,P)=>g.set(x,P));const v=Fa.create(),m=Fa.create();f.forEach(x=>{Fa.fromPoints(v,x.s0[0],x.s0[1]),Fa.fromPoints(m,x.s1[0],x.s1[1]);const P=Fa.intersectPointOfLines(v,m);if(Number.isFinite(P[0])&&Number.isFinite(P[1])){const S=x.s0[1],O=g.get(S);u[O]=P,u[(O+1)%u.length]=void 0}else{const S=x.s1[0],O=g.get(S);u[O]=void 0}}),u=u.filter(x=>x!==void 0)}if(o==="round"){let g=Math.floor(s/4);const v=Gt.create();f.forEach(m=>{let x=Gt.angle(Gt.subtract(v,m.s1[0],m.c));if(x-=Gt.angle(Gt.subtract(v,m.s0[1],m.c)),c&&x<0&&(x=x+Math.PI,x<0&&(x=x+Math.PI)),!c&&x>0&&(x=x-Math.PI,x>0&&(x=x-Math.PI)),x!==0){g=Math.floor(s*(Math.abs(x)/BL));const P=x/g,S=Gt.angle(Gt.subtract(v,m.s0[1],m.c)),O=[];for(let R=1;R<g;R++){const N=S+P*R,I=Gt.fromAngleRadians(Gt.create(),N);Gt.scale(I,I,r),Gt.add(I,I,m.c),O.push(I)}if(O.length>0){const R=m.s0[1];let N=u.findIndex(I=>Gt.equals(R,I));N=(N+1)%u.length,u.splice(N,0,...O)}}else{const P=m.s1[0],S=u.findIndex(O=>Gt.equals(P,O));u.splice(S,1)}})}return u};var Qi=VL;const ai=at,jL=Qi,UL=(e,t)=>{const n={delta:1,corners:"edge",segments:16},{delta:r,corners:o,segments:a}=Object.assign({},n,e);if(!(o==="edge"||o==="chamfer"||o==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const c=ai.toOutlines(t).map(l=>(e={delta:r,corners:o,closed:!0,segments:a},jL(e,l))).reduce((l,u)=>l.concat(ai.toSides(ai.fromPoints(u))),[]);return ai.create(c)};var qL=UL;const Ip=Tt,XL=He,HL=st,Ga=vt,WL=(e,t)=>{XL.dot(Ga.plane(t),e)>0&&(t=Ga.invert(t));const r=[t],o=Ga.transform(Ip.fromTranslation(Ip.create(),e),t),a=t.vertices.length;for(let s=0;s<a;s++){const i=s<a-1?s+1:0,c=Ga.create([t.vertices[s],o.vertices[s],o.vertices[i],t.vertices[i]]);r.push(c)}return r.push(Ga.invert(o)),HL.create(r)};var YL=WL;const{EPS:ZL,TAU:Dl}=mt,Fp=Tt,Pt=He,KL=ng,Ll=st,Jr=vt,QL=qv,JL=us,kl=ig,e6=YL,t6=(e,t,n)=>{const r=t.toString();if(e.has(r))e.get(r)[1].push(n);else{const o=[t,[n]];e.set(r,o)}},n6=(e,t,n)=>{const r=t[0].toString(),o=t[1].toString(),a=r<o?`${r},${o}`:`${o},${r}`;if(e.has(a))e.get(a)[1].push(n);else{const s=[t,[n]];e.set(a,s)}},Il=(e,t)=>{e.findIndex(r=>r===t)<0&&e.push(t)},r6=(e,t)=>{const n={delta:1,segments:12},{delta:r,segments:o}=Object.assign({},n,e);let a=Ll.create();const s=new Map,i=new Map,c=Pt.create(),l=Pt.create();return Ll.toPolygons(t).forEach((f,h)=>{const p=Pt.scale(Pt.create(),Jr.plane(f),2*r),g=Jr.transform(Fp.fromTranslation(Fp.create(),Pt.scale(Pt.create(),p,-.5)),f),v=e6(p,g);a=kl(a,v);const m=f.vertices;for(let x=0;x<m.length;x++){t6(s,m[x],Jr.plane(f));const P=(x+1)%m.length,S=[m[x],m[P]];n6(i,S,Jr.plane(f))}}),i.forEach(f=>{const h=f[0],p=f[1],g=h[0],v=h[1],m=Pt.subtract(Pt.create(),v,g);Pt.normalize(m,m);const x=p[0],P=Pt.cross(Pt.create(),x,m);let S=[];for(let G=0;G<o;G++)Il(S,G*Dl/o);for(let G=0,ce=p.length;G<ce;G++){const _e=p[G],de=Pt.dot(P,_e),De=Pt.dot(x,_e);let be=Math.atan2(de,De);be<0&&(be+=Dl),Il(S,be),be=Math.atan2(-de,-De),be<0&&(be+=Dl),Il(S,be)}S=S.sort(KL);const O=S.length;let R,N;const I=[],X=[],W=[];for(let G=-1;G<O;G++){const ce=S[G<0?G+O:G],_e=Math.sin(ce),de=Math.cos(ce);Pt.scale(c,x,de*r),Pt.scale(l,P,_e*r),Pt.add(c,c,l);const De=Pt.add(Pt.create(),g,c),be=Pt.add(Pt.create(),v,c);let Ve=!1;if(G>=0&&Pt.distance(De,R)<ZL&&(Ve=!0),!Ve){if(G>=0){I.push(De),X.push(be);const Fe=[N,be,De,R],et=Jr.create(Fe);W.push(et)}R=De,N=be}}X.reverse(),W.push(Jr.create(I)),W.push(Jr.create(X));const J=Ll.create(W);a=kl(a,J)}),s.forEach(f=>{const h=f[0],p=f[1],g=p[0];let v=null,m=0;for(let O=1;O<p.length;O++){const R=p[O],N=Pt.cross(c,g,R),I=Pt.length(N);I>.05&&I>m&&(m=I,v=R)}v||(v=Pt.orthogonal(c,g));const x=Pt.cross(c,g,v);Pt.normalize(x,x);const P=Pt.cross(l,x,g),S=QL({center:[h[0],h[1],h[2]],radius:r,segments:o,axes:[g,x,P]});a=kl(a,S)}),JL(a)};var o6=r6;const a6=st,s6=_f,i6=o6,c6=(e,t)=>{const n={delta:1,corners:"round",segments:12},{delta:r,corners:o,segments:a}=Object.assign({},n,e);if(o!=="round")throw new Error('corners must be "round" for 3D geometries');if(a6.toPolygons(t).length===0)throw new Error("the given geometry cannot be empty");e={delta:r,corners:o,segments:a};const i=i6(e,t);return s6(t,i)};var l6=c6;const u6=qi,xn=ut,zo=at,Wa=Et,Gp=Qi,f6=e=>{let{external:t,internal:n}=e;u6(t)<0?t=t.reverse():n=n.reverse();const r=Wa.fromPoints({closed:!0},t),o=Wa.fromPoints({closed:!0},n),a=zo.toSides(zo.fromPoints(Wa.toPoints(r))),s=zo.toSides(zo.fromPoints(Wa.toPoints(o)));return a.push(...s),zo.create(a)},d6=(e,t,n,r)=>{const{points:o,external:a,internal:s}=e,i=Math.floor(t/2),c=[],l=[];if(n==="round"&&i>0){const f=Math.PI/i,h=o[o.length-1],p=xn.angle(xn.subtract(xn.create(),a[a.length-1],h)),g=o[0],v=xn.angle(xn.subtract(xn.create(),s[0],g));for(let m=1;m<i;m++){let x=p+f*m,P=xn.fromAngleRadians(xn.create(),x);xn.scale(P,P,r),xn.add(P,P,h),c.push(P),x=v+f*m,P=xn.fromAngleRadians(xn.create(),x),xn.scale(P,P,r),xn.add(P,P,g),l.push(P)}}const u=[];return u.push(...a,...c,...s.reverse(),...l),zo.fromPoints(u)},h6=(e,t)=>{e=Object.assign({},{delta:1,corners:"edge",segments:16},e);const{delta:r,corners:o,segments:a}=e;if(r<=0)throw new Error("the given delta must be positive for paths");if(!(o==="edge"||o==="chamfer"||o==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const s=t.isClosed,i=Wa.toPoints(t);if(i.length===0)throw new Error("the given geometry cannot be empty");const c={points:i,external:Gp({delta:r,corners:o,segments:a,closed:s},i),internal:Gp({delta:-r,corners:o,segments:a,closed:s},i)};return t.isClosed?f6(c):d6(c,a,o,r)};var p6=h6;const m6=nt,v6=at,g6=st,y6=Et,b6=qL,_6=l6,x6=p6,w6=(e,...t)=>{if(t=m6(t),t.length===0)throw new Error("wrong number of arguments");const n=t.map(r=>y6.isA(r)?x6(e,r):v6.isA(r)?b6(e,r):g6.isA(r)?_6(e,r):r);return n.length===1?n[0]:n};var xf=w6;const si=at,Bp=rf,E6=Qi,A6=(e,t)=>{const n={delta:1,corners:"edge",segments:0},{delta:r,corners:o,segments:a}=Object.assign({},n,e);if(!(o==="edge"||o==="chamfer"||o==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');const s=si.toOutlines(t),c=s.map(l=>(e={delta:s.reduce((h,p)=>h+Bp.arePointsInside(l,Bp.create(p)),0)%2===0?r:-r,corners:o,closed:!0,segments:a},E6(e,l))).reduce((l,u)=>l.concat(si.toSides(si.fromPoints(u))),[]);return si.create(c)};var T6=A6;const zp=Et,$6=Qi,S6=(e,t)=>{const n={delta:1,corners:"edge",closed:t.isClosed,segments:16},{delta:r,corners:o,closed:a,segments:s}=Object.assign({},n,e);if(!(o==="edge"||o==="chamfer"||o==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');e={delta:r,corners:o,closed:a,segments:s};const i=$6(e,zp.toPoints(t));return zp.fromPoints({closed:a},i)};var P6=S6;const C6=nt,O6=at,R6=Et,N6=T6,M6=P6,D6=(e,...t)=>{if(t=C6(t),t.length===0)throw new Error("wrong number of arguments");const n=t.map(r=>R6.isA(r)?M6(e,r):O6.isA(r)?N6(e,r):r);return n.length===1?n[0]:n};var L6=D6,k6={expand:xf,offset:L6};const Ba=Tt,Fl=He,I6=at,Gl=ta,F6=Yi,G6=(e,t)=>{const n={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0};let{offset:r,twistAngle:o,twistSteps:a,repair:s}=Object.assign({},n,e);if(a<1)throw new Error("twistSteps must be 1 or more");o===0&&(a=1);const i=Fl.clone(r),c=I6.toSides(t);if(c.length===0)throw new Error("the given geometry cannot be empty");const l=Gl.fromSides(c);i[2]<0&&Gl.reverse(l,l);const u=Ba.create(),f=(h,p,g)=>{const v=p/a*o,m=Fl.scale(Fl.create(),i,p/a);return Ba.multiply(u,Ba.fromZRotation(u,v),Ba.fromTranslation(Ba.create(),m)),Gl.transform(u,g)};return e={numberOfSlices:a+1,capStart:!0,capEnd:!0,repair:s,callback:f},F6(e,l)};var Ji=G6;const B6=at,z6=Et,V6=Ji,j6=(e,t)=>{if(!t.isClosed)throw new Error("extruded path must be closed");const n=z6.toPoints(t),r=B6.fromPoints(n);return V6(e,r)};var U6=j6;const q6=nt,X6=at,H6=Et,W6=Ji,Y6=U6,Z6=(e,...t)=>{const n={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:r,twistAngle:o,twistSteps:a,repair:s}=Object.assign({},n,e);if(t=q6(t),t.length===0)throw new Error("wrong number of arguments");e={offset:[0,0,r],twistAngle:o,twistSteps:a,repair:s};const i=t.map(c=>H6.isA(c)?Y6(e,c):X6.isA(c)?W6(e,c):c);return i.length===1?i[0]:i};var K6=Z6;const Q6=Et,J6=xf,ek=Ji,tk=(e,t)=>{const n={size:1,height:1},{size:r,height:o}=Object.assign({},n,e);if(e.delta=r,e.offset=[0,0,o],Q6.toPoints(t).length===0)throw new Error("the given geometry cannot be empty");const s=J6(e,t);return ek(e,s)};var nk=tk;const{area:rk}=is,Bl=at,ok=Et,ak=xf,sk=Ji,ik=(e,t)=>{const n={size:1,height:1},{size:r,height:o}=Object.assign({},n,e);e.delta=r,e.offset=[0,0,o];const a=Bl.toOutlines(t);if(a.length===0)throw new Error("the given geometry cannot be empty");const i=a.map(l=>(rk(l)<0&&l.reverse(),ak(e,ok.fromPoints({closed:!0},l)))).reduce((l,u)=>l.concat(Bl.toSides(u)),[]),c=Bl.create(i);return sk(e,c)};var ck=ik;const lk=nt,uk=at,fk=Et,dk=nk,hk=ck,pk=(e,...t)=>{const n={size:1,height:1},{size:r,height:o}=Object.assign({},n,e);if(t=lk(t),t.length===0)throw new Error("wrong number of arguments");if(r<=0)throw new Error("size must be positive");if(o<=0)throw new Error("height must be positive");const a=t.map(s=>fk.isA(s)?dk(e,s):uk.isA(s)?hk(e,s):s);return a.length===1?a[0]:a};var mk=pk;const{TAU:za}=mt,zl=ta,Zn=Tt,vk=Yi,gk=at,yk=(e,t)=>{const n={angle:za,startAngle:0,pitch:10,endOffset:0,segmentsPerRotation:32},{angle:r,endOffset:o,segmentsPerRotation:a,startAngle:s}=Object.assign({},n,e);let i;if(!e.pitch&&e.height?i=e.height/(r/za):i=e.pitch?e.pitch:n.pitch,a<3)throw new Error("The number of segments per rotation needs to be at least 3.");const l=gk.toSides(t);if(l.length===0)throw new Error("the given geometry cannot be empty");const u=l.filter(x=>x[0][0]>=0);let f=zl.fromSides(l);u.length===0&&(f=zl.reverse(f));const h=Math.round(a/za*Math.abs(r)),p=h>=2?h:2,g=Zn.create();let v;const m=(x,P,S)=>{const O=s+r/p*P,R=o/p*P,N=(O-s)/za*i;return Zn.multiply(g,Zn.fromTranslation(Zn.create(),[R,0,N*Math.sign(r)]),Zn.fromXRotation(Zn.create(),-za/4*Math.sign(r))),v=Zn.create(),Zn.multiply(v,Zn.fromZRotation(Zn.create(),O),g),zl.transform(v,S)};return vk({numberOfSlices:p+1,callback:m},f)};var bk=yk;const _k=nt,Vp=cf,Vl=er,jp=Tt,Up=at,ug=st,Io=vt,xk=Nr,wk=lg,Ek=(e,t)=>{const n=Vl.fromNormalAndPoint(Vl.create(),e.axis,e.origin);if(Number.isNaN(n[0])||Number.isNaN(n[1])||Number.isNaN(n[2])||Number.isNaN(n[3]))throw new Error("project: invalid axis or origin");const r=xk(t),o=r*r*Math.sqrt(3)/4;if(r===0)return Up.create();const a=ug.toPolygons(t);let s=[];for(let c=0;c<a.length;c++){const l=a[c].vertices.map(h=>Vl.projectionOfPoint(n,h)),u=Io.create(l),f=Io.plane(u);Vp(n,f)&&(Io.measureArea(u)<o||s.push(u))}if(!Vp(n,[0,0,1])){const c=jp.fromVectorRotation(jp.create(),n,[0,0,1]);s=s.map(l=>Io.transform(c,l))}s=s.sort((c,l)=>Io.measureArea(l)-Io.measureArea(c));const i=s.map(c=>Up.fromPoints(c.vertices));return wk(i)},Ak=(e,...t)=>{const n={axis:[0,0,1],origin:[0,0,0]},{axis:r,origin:o}=Object.assign({},n,e);if(t=_k(t),t.length===0)throw new Error("wrong number of arguments");e={axis:r,origin:o};const a=t.map(s=>ug.isA(s)?Ek(e,s):s);return a.length===1?a[0]:a};var Tk=Ak,$k={extrudeFromSlices:Yi,extrudeLinear:K6,extrudeRectangular:mk,extrudeRotate:Jv,extrudeHelical:bk,project:Tk,slice:ta};const qp=ut,Sk=e=>{let t=qp.fromValues(1/0,1/0);e.forEach(o=>{(o[1]<t[1]||o[1]===t[1]&&o[0]<t[0])&&(t=o)});const n=[];e.forEach(o=>{const a=Ck(o[1]-t[1],o[0]-t[0]),s=qp.squaredDistance(o,t);n.push({point:o,angle:a,distSq:s})}),n.sort((o,a)=>o.angle!==a.angle?o.angle-a.angle:o.distSq-a.distSq);const r=[];return n.forEach(o=>{let a=r.length;for(;a>1&&Pk(r[a-2],r[a-1],o.point)<=Number.EPSILON;)r.pop(),a=r.length;r.push(o.point)}),r},Pk=(e,t,n)=>(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0]),Ck=(e,t)=>e===0&&t===0?-1/0:-t/e;var fg=Sk;const Xp=at,Hp=st,Wp=Et,Ok=e=>{const t=new Set,n=[],r=o=>{const a=o.toString();t.has(a)||(n.push(o),t.add(a))};return e.forEach(o=>{Xp.isA(o)?Xp.toPoints(o).forEach(r):Hp.isA(o)?Hp.toPoints(o).forEach(a=>a.forEach(r)):Wp.isA(o)&&Wp.toPoints(o).forEach(r)}),n};var wf=Ok;const Rk=nt,Nk=Et,Mk=fg,Dk=wf,Lk=(...e)=>{e=Rk(e);const t=Dk(e),n=Mk(t);return Nk.fromPoints({closed:!0},n)};var kk=Lk;const Ik=nt,Yp=at,Fk=fg,Gk=wf,Bk=(...e)=>{e=Ik(e);const t=Gk(e),n=Fk(t);return n.length<3?Yp.create():Yp.fromPoints(n)};var zk=Bk;const Vk=as,Zp=Fi,Kp=Gm,jk=(e,t,n)=>{const r=[],o=[],a=[];Zp(r,n,t),Zp(o,e,t);const s=Kp(Vk(a,o,r)),i=Kp(r);if(i===0)throw Error("a and b are the same point");return s/i},Uk=(e,t,n)=>Math.sqrt(jk(e,t,n));var qk=Uk;const Xk=as,Hk=Ku,Qp=Fi,Wk=(e,t,n,r)=>{const o=[0,0,0];return Qp(e,t,n),Qp(o,n,r),Xk(e,e,o),Hk(e,e)};var Yk=Wk;let Zk=class{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(t,n){n.prev=t.prev,n.next=t,n.prev?n.prev.next=n:this.head=n,t.prev=n}insertAfter(t,n){n.prev=t,n.next=t.next,n.next?n.next.prev=n:this.tail=n,t.next=n}add(t){this.head?this.tail.next=t:this.head=t,t.prev=this.tail,t.next=null,this.tail=t}addAll(t){for(this.head?this.tail.next=t:this.head=t,t.prev=this.tail;t.next;)t=t.next;this.tail=t}remove(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev}removeChain(t,n){t.prev?t.prev.next=n.next:this.head=n.next,n.next?n.next.prev=t.prev:this.tail=t.prev}first(){return this.head}isEmpty(){return!this.head}};var Kk=Zk;let Qk=class{constructor(t,n){this.point=t,this.index=n,this.next=null,this.prev=null,this.face=null}};var Jk=Qk;const e8=Mm,t8=Fm;let n8=class{constructor(t,n){this.vertex=t,this.face=n,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?e8(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?t8(this.tail().point,this.head().point):-1}setOpposite(t){this.opposite=t,t.opposite=this}};var r8=n8;const jl=Rm,o8=Nm,a8=as,Ul=ki,s8=Dm,i8=Ku,ii=Im,ql=Fi,Xl=r8,dg=0,c8=1,Nu=2;let l8=class hg{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=dg,this.edge=null,this.nVertices=0}getEdge(t){if(typeof t!="number")throw Error("requires a number");let n=this.edge;for(;t>0;)n=n.next,t-=1;for(;t<0;)n=n.prev,t+=1;return n}computeNormal(){const t=this.edge,n=t.next;let r=n.next;const o=ql([],n.head().point,t.head().point),a=[],s=[];for(this.nVertices=2,this.normal=[0,0,0];r!==t;)o8(s,o),ql(o,r.head().point,t.head().point),jl(this.normal,this.normal,a8(a,s,o)),r=r.next,this.nVertices+=1;this.area=s8(this.normal),this.normal=ii(this.normal,this.normal,1/this.area)}computeNormalMinArea(t){if(this.computeNormal(),this.area<t){let n,r=0,o=this.edge;do{const u=o.lengthSquared();u>r&&(n=o,r=u),o=o.next}while(o!==this.edge);const a=n.tail().point,s=n.head().point,i=ql([],s,a),c=Math.sqrt(r);ii(i,i,1/c);const l=Ul(this.normal,i);ii(i,i,-l),jl(this.normal,this.normal,i),i8(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let t=this.edge;do jl(this.centroid,this.centroid,t.head().point),t=t.next;while(t!==this.edge);ii(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(t){typeof t<"u"?this.computeNormalMinArea(t):this.computeNormal(),this.computeCentroid(),this.offset=Ul(this.normal,this.centroid)}distanceToPlane(t){return Ul(this.normal,t)-this.offset}connectHalfEdges(t,n){let r;if(t.opposite.face===n.opposite.face){const o=n.opposite.face;let a;t===this.edge&&(this.edge=n),o.nVertices===3?(a=n.opposite.prev.opposite,o.mark=Nu,r=o):(a=n.opposite.next,o.edge===a.prev&&(o.edge=a),a.prev=a.prev.prev,a.prev.next=a),n.prev=t.prev,n.prev.next=n,n.setOpposite(a),o.computeNormalAndCentroid()}else t.next=n,n.prev=t;return r}mergeAdjacentFaces(t,n){const r=t.opposite,o=r.face;n.push(o),o.mark=Nu;let a=t.prev,s=t.next,i=r.prev,c=r.next;for(;a.opposite.face===o;)a=a.prev,c=c.next;for(;s.opposite.face===o;)s=s.next,i=i.prev;let l;for(l=c;l!==i.next;l=l.next)l.face=this;this.edge=s;let u;return u=this.connectHalfEdges(i,s),u&&n.push(u),u=this.connectHalfEdges(a,c),u&&n.push(u),this.computeNormalAndCentroid(),n}collectIndices(){const t=[];let n=this.edge;do t.push(n.head().index),n=n.next;while(n!==this.edge);return t}static createTriangle(t,n,r,o=0){const a=new hg,s=new Xl(t,a),i=new Xl(n,a),c=new Xl(r,a);return s.next=c.prev=i,i.next=s.prev=c,c.next=i.prev=s,a.edge=s,a.computeNormalAndCentroid(o),a}};var u8={VISIBLE:dg,NON_CONVEX:c8,DELETED:Nu,Face:l8};const Hl=ki,f8=qk,d8=Yk,Jp=Kk,h8=Jk,{Face:cr,VISIBLE:Fo,NON_CONVEX:e0,DELETED:p8}=u8,m8=1,t0=2;let v8=class{constructor(t){if(!Array.isArray(t))throw TypeError("input is not a valid array");if(t.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=t.length,this.faces=[],this.newFaces=[],this.claimed=new Jp,this.unclaimed=new Jp,this.vertices=[];for(let n=0;n<t.length;n+=1)this.vertices.push(new h8(t[n],n));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(t,n){t.face=n,n.outside?this.claimed.insertBefore(n.outside,t):this.claimed.add(t),n.outside=t}removeVertexFromFace(t,n){t===n.outside&&(t.next&&t.next.face===n?n.outside=t.next:n.outside=null),this.claimed.remove(t)}removeAllVerticesFromFace(t){if(t.outside){let n=t.outside;for(;n.next&&n.next.face===t;)n=n.next;return this.claimed.removeChain(t.outside,n),n.next=null,t.outside}}deleteFaceVertices(t,n){const r=this.removeAllVerticesFromFace(t);if(r)if(!n)this.unclaimed.addAll(r);else{let o;for(let a=r;a;a=o)o=a.next,n.distanceToPlane(a.point)>this.tolerance?this.addVertexToFace(a,n):this.unclaimed.add(a)}}resolveUnclaimedPoints(t){let n=this.unclaimed.first();for(let r=n;r;r=n){n=r.next;let o=this.tolerance,a;for(let s=0;s<t.length;s+=1){const i=t[s];if(i.mark===Fo){const c=i.distanceToPlane(r.point);if(c>o&&(o=c,a=i),o>1e3*this.tolerance)break}}a&&this.addVertexToFace(r,a)}}computeExtremes(){const t=[],n=[],r=[],o=[];let a,s;for(a=0;a<3;a+=1)r[a]=o[a]=this.vertices[0];for(a=0;a<3;a+=1)t[a]=n[a]=this.vertices[0].point[a];for(a=1;a<this.vertices.length;a+=1){const i=this.vertices[a],c=i.point;for(s=0;s<3;s+=1)c[s]<t[s]&&(t[s]=c[s],r[s]=i);for(s=0;s<3;s+=1)c[s]>n[s]&&(n[s]=c[s],o[s]=i)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t[0]),Math.abs(n[0]))+Math.max(Math.abs(t[1]),Math.abs(n[1]))+Math.max(Math.abs(t[2]),Math.abs(n[2]))),[r,o]}createInitialSimplex(){const t=this.vertices,[n,r]=this.computeExtremes();let o,a,s,i,c=0,l=0;for(s=0;s<3;s+=1){const v=r[s].point[s]-n[s].point[s];v>c&&(c=v,l=s)}const u=n[l],f=r[l];for(c=0,s=0;s<this.vertices.length;s+=1){const v=this.vertices[s];if(v!==u&&v!==f){const m=f8(v.point,u.point,f.point);m>c&&(c=m,o=v)}}const h=d8([],u.point,f.point,o.point),p=Hl(u.point,h);for(c=-1,s=0;s<this.vertices.length;s+=1){const v=this.vertices[s];if(v!==u&&v!==f&&v!==o){const m=Math.abs(Hl(h,v.point)-p);m>c&&(c=m,a=v)}}const g=[];if(Hl(a.point,h)-p<0)for(g.push(cr.createTriangle(u,f,o),cr.createTriangle(a,f,u),cr.createTriangle(a,o,f),cr.createTriangle(a,u,o)),s=0;s<3;s+=1){const v=(s+1)%3;g[s+1].getEdge(2).setOpposite(g[0].getEdge(v)),g[s+1].getEdge(1).setOpposite(g[v+1].getEdge(0))}else for(g.push(cr.createTriangle(u,o,f),cr.createTriangle(a,u,f),cr.createTriangle(a,f,o),cr.createTriangle(a,o,u)),s=0;s<3;s+=1){const v=(s+1)%3;g[s+1].getEdge(2).setOpposite(g[0].getEdge((3-s)%3)),g[s+1].getEdge(0).setOpposite(g[v+1].getEdge(1))}for(s=0;s<4;s+=1)this.faces.push(g[s]);for(s=0;s<t.length;s+=1){const v=t[s];if(v!==u&&v!==f&&v!==o&&v!==a){c=this.tolerance;let m;for(i=0;i<4;i+=1){const x=g[i].distanceToPlane(v.point);x>c&&(c=x,m=g[i])}m&&this.addVertexToFace(v,m)}}}reindexFaceAndVertices(){const t=[];for(let n=0;n<this.faces.length;n+=1){const r=this.faces[n];r.mark===Fo&&t.push(r)}this.faces=t}collectFaces(t){const n=[];for(let r=0;r<this.faces.length;r+=1){if(this.faces[r].mark!==Fo)throw Error("attempt to include a destroyed face in the hull");const o=this.faces[r].collectIndices();if(t)n.push(o);else for(let a=0;a<o.length-2;a+=1)n.push([o[0],o[a+1],o[a+2]])}return n}nextVertexToAdd(){if(!this.claimed.isEmpty()){let t,n,r=0;const o=this.claimed.first().face;for(n=o.outside;n&&n.face===o;n=n.next){const a=o.distanceToPlane(n.point);a>r&&(r=a,t=n)}return t}}computeHorizon(t,n,r,o){this.deleteFaceVertices(r),r.mark=p8;let a;n?a=n.next:a=n=r.getEdge(0);do{const s=a.opposite,i=s.face;i.mark===Fo&&(i.distanceToPlane(t)>this.tolerance?this.computeHorizon(t,s,i,o):o.push(a)),a=a.next}while(a!==n)}addAdjoiningFace(t,n){const r=cr.createTriangle(t,n.tail(),n.head());return this.faces.push(r),r.getEdge(-1).setOpposite(n.opposite),r.getEdge(0)}addNewFaces(t,n){this.newFaces=[];let r,o;for(let a=0;a<n.length;a+=1){const s=n[a],i=this.addAdjoiningFace(t,s);r?i.next.setOpposite(o):r=i,this.newFaces.push(i.face),o=i}r.next.setOpposite(o)}oppositeFaceDistance(t){return t.face.distanceToPlane(t.opposite.face.centroid)}doAdjacentMerge(t,n){let r=t.edge,o=!0,a=0;do{if(a>=t.nVertices)throw Error("merge recursion limit exceeded");const s=r.opposite.face;let i=!1;if(n===t0?(this.oppositeFaceDistance(r)>-this.tolerance||this.oppositeFaceDistance(r.opposite)>-this.tolerance)&&(i=!0):t.area>s.area?this.oppositeFaceDistance(r)>-this.tolerance?i=!0:this.oppositeFaceDistance(r.opposite)>-this.tolerance&&(o=!1):this.oppositeFaceDistance(r.opposite)>-this.tolerance?i=!0:this.oppositeFaceDistance(r)>-this.tolerance&&(o=!1),i){const c=t.mergeAdjacentFaces(r,[]);for(let l=0;l<c.length;l+=1)this.deleteFaceVertices(c[l],t);return!0}r=r.next,a+=1}while(r!==t.edge);return o||(t.mark=e0),!1}addVertexToHull(t){const n=[];this.unclaimed.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,n),this.addNewFaces(t,n);for(let r=0;r<this.newFaces.length;r+=1){const o=this.newFaces[r];if(o.mark===Fo)for(;this.doAdjacentMerge(o,m8););}for(let r=0;r<this.newFaces.length;r+=1){const o=this.newFaces[r];if(o.mark===e0)for(o.mark=Fo;this.doAdjacentMerge(o,t0););}this.resolveUnclaimedPoints(this.newFaces)}build(){let t;for(this.createInitialSimplex();t=this.nextVertexToAdd();)this.addVertexToHull(t);this.reindexFaceAndVertices()}};var g8=v8;const y8=g8,b8=(e,t={})=>{const n=new y8(e);return n.build(),n.collectFaces(t.skipTriangulation)};var _8=b8;const x8=nt,w8=st,E8=vt,A8=_8,T8=wf,$8=(...e)=>{if(e=x8(e),e.length===1)return e[0];const t=T8(e),r=A8(t,{skipTriangulation:!0}).map(o=>{const a=o.map(s=>t[s]);return E8.create(a)});return w8.create(r)};var S8=$8;const P8=nt,C8=ls,O8=at,R8=st,N8=Et,M8=kk,D8=zk,L8=S8,k8=(...e)=>{if(e=P8(e),e.length===0)throw new Error("wrong number of arguments");if(!C8(e))throw new Error("only hulls of the same type are supported");const t=e[0];return N8.isA(t)?M8(e):O8.isA(t)?D8(e):R8.isA(t)?L8(e):t};var pg=k8;const I8=nt,F8=_f,G8=pg,B8=(...e)=>{if(e=I8(e),e.length<2)throw new Error("wrong number of arguments");const t=[];for(let n=1;n<e.length;n++)t.push(G8(e[n-1],e[n]));return F8(t)};var z8=B8,V8={hull:pg,hullChain:z8};const Wl=He,mg=vt,j8=(e,t)=>{const n=Math.abs(mg.measureArea(t));return Number.isFinite(n)&&n>e},U8=(e,t)=>{let n=t.map(o=>{const a=o.vertices.map(c=>Wl.snap(Wl.create(),c,e)),s=[];for(let c=0;c<a.length;c++){const l=(c+1)%a.length;Wl.equals(a[c],a[l])||s.push(a[c])}const i=mg.create(s);return o.color&&(i.color=o.color),i});const r=e*e*Math.sqrt(3)/4;return n=n.filter(o=>j8(r,o)),n};var vg=U8;const q8=cf,Vo=He,Pi=vt,X8=e=>{const t=Pi.toPoints(e),n=[];for(let r=0;r<t.length;r++){const o=(r+1)%t.length,a={v1:t[r],v2:t[o]};n.push(a)}for(let r=0;r<n.length;r++){const o=(r+1)%t.length;n[r].next=n[o],n[o].prev=n[r]}return n},H8=(e,t)=>{const n=`${t.v1}:${t.v2}`;e.set(n,t)},Yl=(e,t)=>{const n=`${t.v1}:${t.v2}`;e.delete(n)},W8=(e,t)=>{const n=`${t.v2}:${t.v1}`;return e.get(n)},Y8=(e,t,n)=>{let r=e.prev.v1,o=e.prev.v2,a=t.next.v2;const s=n0(r,o,a,n);r=t.prev.v1,o=t.prev.v2,a=e.next.v2;const i=n0(r,o,a,n);return[s,i]},Z8=Vo.create(),K8=Vo.create(),n0=(e,t,n,r)=>{const o=Vo.subtract(Z8,t,e),a=Vo.subtract(K8,n,t);return Vo.cross(o,o,a),Vo.dot(o,r)},Q8=e=>{let t;const n=[];for(;e.next;){const r=e.next;n.push(e.v1),e.v1=null,e.v2=null,e.next=null,e.prev=null,e=r}return n.length>0&&(t=Pi.create(n)),t},J8=e=>{if(e.length<2)return e;const t=e[0].plane,n=e.slice(),r=new Map;for(;n.length>0;){const a=n.shift(),s=X8(a);for(let i=0;i<s.length;i++){const c=s[i],l=W8(r,c);if(l){const u=Y8(c,l,t);if(u[0]>=0&&u[1]>=0){const f=l.next,h=c.next;c.prev.next=l.next,c.next.prev=l.prev,l.prev.next=c.next,l.next.prev=c.prev,c.v1=null,c.v2=null,c.next=null,c.prev=null,Yl(r,l),l.v1=null,l.v2=null,l.next=null,l.prev=null;const p=(g,v,m)=>{const x={v1:m.v1,v2:v.v2,next:v.next,prev:m.prev};m.prev.next=x,v.next.prev=x,Yl(g,v),v.v1=null,v.v2=null,v.next=null,v.prev=null,Yl(g,m),m.v1=null,m.v2=null,m.next=null,m.prev=null};u[0]===0&&p(r,f,f.prev),u[1]===0&&p(r,h,h.prev)}}else c.next&&H8(r,c)}}const o=[];return r.forEach(a=>{const s=Q8(a);s&&o.push(s)}),r.clear(),o},eI=(e,t)=>Math.abs(e[3]-t[3])<15e-8?q8(e,t):!1,tI=(e,t)=>{const n=[];t.forEach(o=>{const a=n.find(s=>eI(s[0],Pi.plane(o)));a?a[1].push(o):n.push([Pi.plane(o),[o]])});let r=[];return n.forEach(o=>{const a=o[1],s=J8(a);r=r.concat(s)}),r};var nI=tI;const r0=mt,Kn=He,rI=vt,mn=e=>`${e}`,o0=(e,t,n,r,o,a)=>{const s=mn(r),i=mn(o),c=`${s}/${i}`,l=`${i}/${s}`;if(e.has(l))return yi(e,t,n,o,r,null),null;const u={vertex0:r,vertex1:o,polygonindex:a};return e.has(c)?e.get(c).push(u):e.set(c,[u]),t.has(s)?t.get(s).push(c):t.set(s,[c]),n.has(i)?n.get(i).push(c):n.set(i,[c]),c},yi=(e,t,n,r,o,a)=>{const s=mn(r),i=mn(o),c=`${s}/${i}`;let l=-1;const u=e.get(c);for(let f=0;f<u.length;f++){const h=u[f];let p=mn(h.vertex0);if(p===s&&(p=mn(h.vertex1),p===i&&!(a!==null&&h.polygonindex!==a))){l=f;break}}u.splice(l,1),u.length===0&&e.delete(c),l=t.get(s).indexOf(c),t.get(s).splice(l,1),t.get(s).length===0&&t.delete(s),l=n.get(i).indexOf(c),n.get(i).splice(l,1),n.get(i).length===0&&n.delete(i)},oI=e=>{const t=new Map;for(let n=0;n<e.length;n++){const r=e[n],o=r.vertices.length;if(o>=3){let a=r.vertices[0],s=mn(a);for(let i=0;i<o;i++){let c=i+1;c===o&&(c=0);const l=r.vertices[c],u=mn(l),f=`${s}/${u}`,h=`${u}/${s}`;if(t.has(h)){const p=t.get(h);p.splice(-1,1),p.length===0&&t.delete(h)}else{const p={vertex0:a,vertex1:l,polygonindex:n};t.has(f)?t.get(f).push(p):t.set(f,[p])}a=l,s=u}}else console.warn("warning: invalid polygon found during insertTjunctions")}if(t.size>0){const n=new Map,r=new Map,o=new Map;for(const[s,i]of t)o.set(s,!0),i.forEach(c=>{const l=mn(c.vertex0),u=mn(c.vertex1);n.has(l)?n.get(l).push(s):n.set(l,[s]),r.has(u)?r.get(u).push(s):r.set(u,[s])});const a=e.slice(0);for(;t.size!==0;){for(const i of t.keys())o.set(i,!0);let s=!1;for(;;){const i=Array.from(o.keys());if(i.length===0)break;const c=i[0];let l=!0;if(t.has(c)){const f=t.get(c)[0];for(let h=0;h<2;h++){const p=h===0?f.vertex0:f.vertex1,g=h===0?f.vertex1:f.vertex0,v=mn(p),m=mn(g);let x=[];h===0?r.has(v)&&(x=r.get(v)):n.has(v)&&(x=n.get(v));for(let P=0;P<x.length;P++){const S=x[P],O=t.get(S)[0],R=h===0?O.vertex0:O.vertex1;if(h===0?O.vertex1:O.vertex0,mn(R)===m){yi(t,n,r,p,g,null),yi(t,n,r,g,p,null),l=!1,h=2,s=!0;break}else{const I=p,X=g,W=R,J=Kn.subtract(Kn.create(),W,I),G=Kn.dot(Kn.subtract(Kn.create(),X,I),J)/Kn.dot(J,J);if(G>0&&G<1){const ce=Kn.scale(Kn.create(),J,G);if(Kn.add(ce,ce,I),Kn.squaredDistance(ce,X)<r0.EPS*r0.EPS){const de=O.polygonindex,De=a[de],be=mn(O.vertex1);let Ve=-1;for(let $t=0;$t<De.vertices.length;$t++)if(mn(De.vertices[$t])===be){Ve=$t;break}const Fe=De.vertices.slice(0);Fe.splice(Ve,0,g);const et=rI.create(Fe);a[de]=et,yi(t,n,r,O.vertex0,O.vertex1,de);const dt=o0(t,n,r,O.vertex0,g,de),bt=o0(t,n,r,g,O.vertex1,de);dt!==null&&o.set(dt,!0),bt!==null&&o.set(bt,!0),l=!1,h=2,s=!0;break}}}}}}l&&o.delete(c)}if(!s)break}e=a}return t.clear(),e};var aI=oI;const Zl=He,Kl=vt,sI=(e,t,n)=>{const r=t.vertices.length;if(r>3){if(r>4){const s=[0,0,0];t.vertices.forEach(i=>Zl.add(s,s,i)),Zl.snap(s,Zl.divide(s,s,[r,r,r]),e);for(let i=0;i<r;i++){const c=Kl.create([s,t.vertices[i],t.vertices[(i+1)%r]]);t.color&&(c.color=t.color),n.push(c)}return}const o=Kl.create([t.vertices[0],t.vertices[1],t.vertices[2]]),a=Kl.create([t.vertices[0],t.vertices[2],t.vertices[3]]);t.color&&(o.color=t.color,a.color=t.color),n.push(o,a);return}n.push(t)},iI=(e,t)=>{const n=[];return t.forEach(r=>{sI(e,r,n)}),n};var cI=iI;const lI=nt,uI=Nr,fI=at,gg=st,dI=Et,hI=vg,pI=nI,mI=aI,vI=cI,gI=(e,t)=>t,yI=(e,t)=>t,bI=(e,t)=>{const n={snap:!1,simplify:!1,triangulate:!1},{snap:r,simplify:o,triangulate:a}=Object.assign({},n,e),s=uI(t);let i=gg.toPolygons(t);r&&(i=hI(s,i)),o&&(i=pI(s,i)),a&&(i=mI(i),i=vI(s,i));const c=Object.assign({},t);return c.polygons=i,c},_I=(e,...t)=>{if(t=lI(t),t.length===0)throw new Error("wrong number of arguments");const n=t.map(r=>{if(dI.isA(r))return gI(e,r);if(fI.isA(r))return yI(e,r);if(gg.isA(r))return bI(e,r);throw new Error("invalid geometry")});return n.length===1?n[0]:n};var xI=_I;const wI=nt,ao=ut,Mu=at,Du=st,Lu=Et,Ef=Nr,EI=vg,AI=e=>{const t=Ef(e),r=Lu.toPoints(e).map(o=>ao.snap(ao.create(),o,t));return Lu.create(r)},TI=e=>{const t=Ef(e);let r=Mu.toSides(e).map(o=>[ao.snap(ao.create(),o[0],t),ao.snap(ao.create(),o[1],t)]);return r=r.filter(o=>!ao.equals(o[0],o[1])),Mu.create(r)},$I=e=>{const t=Ef(e),n=Du.toPolygons(e),r=EI(t,n);return Du.create(r)},SI=(...e)=>{if(e=wI(e),e.length===0)throw new Error("wrong number of arguments");const t=e.map(n=>Lu.isA(n)?AI(n):Mu.isA(n)?TI(n):Du.isA(n)?$I(n):n);return t.length===1?t[0]:t};var PI=SI,CI={generalize:xI,snap:PI,retessellate:us};const OI=(e,t,n)=>{for(e=e.slice();e.length<n;)e.push(t);return e};var RI=OI;const NI=nt,a0=RI,yg=uf,{translate:MI}=so,DI=e=>{if(!Array.isArray(e.modes)||e.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(e.modes=a0(e.modes,"none",3),e.modes.filter(t=>["center","max","min","none"].includes(t)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(e.relativeTo)||e.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(e.relativeTo=a0(e.relativeTo,0,3),e.relativeTo.filter(t=>Number.isFinite(t)||t==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof e.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return e},LI=(e,t,n)=>{for(let r=0;r<3;r++)e[r]==null&&(t[r]==="center"?e[r]=(n[0][r]+n[1][r])/2:t[r]==="max"?e[r]=n[1][r]:t[r]==="min"&&(e[r]=n[0][r]));return e},s0=(e,t,n)=>{const r=yg(e),o=[0,0,0];for(let a=0;a<3;a++)t[a]==="center"?o[a]=n[a]-(r[0][a]+r[1][a])/2:t[a]==="max"?o[a]=n[a]-r[1][a]:t[a]==="min"&&(o[a]=n[a]-r[0][a]);return MI(o,e)},kI=(e,...t)=>{e=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},e),e=DI(e);let{modes:r,relativeTo:o,grouped:a}=e;if(t=NI(t),t.length===0)throw new Error("align(): No geometries were provided to act upon");if(o.filter(s=>s==null).length){const s=yg(t);o=LI(o,r,s)}return a?t=s0(t,r,o):t=t.map(s=>s0(s,r,o)),t.length===1?t[0]:t};var II=kI;const FI=nt,GI=at,BI=st,zI=Et,VI=fo,{translate:jI}=so,Ql=(e,t)=>{const n={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:r,relativeTo:o}=Object.assign({},n,e),a=VI(t),s=[0,0,0];return r[0]&&(s[0]=o[0]-(a[0][0]+(a[1][0]-a[0][0])/2)),r[1]&&(s[1]=o[1]-(a[0][1]+(a[1][1]-a[0][1])/2)),r[2]&&(s[2]=o[2]-(a[0][2]+(a[1][2]-a[0][2])/2)),jI(s,t)},ec=(e,...t)=>{const n={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:r,relativeTo:o}=Object.assign({},n,e);if(t=FI(t),t.length===0)throw new Error("wrong number of arguments");if(o.length!==3)throw new Error("relativeTo must be an array of length 3");e={axes:r,relativeTo:o};const a=t.map(s=>zI.isA(s)||GI.isA(s)||BI.isA(s)?Ql(e,s):s);return a.length===1?a[0]:a},UI=(...e)=>ec({axes:[!0,!1,!1]},e),qI=(...e)=>ec({axes:[!1,!0,!1]},e),XI=(...e)=>ec({axes:[!1,!1,!0]},e);var ci={center:ec,centerX:UI,centerY:qI,centerZ:XI};const HI=nt,i0=Tt,c0=at,l0=st,u0=Et,tc=(e,...t)=>{if(!Array.isArray(e))throw new Error("factors must be an array");if(t=HI(t),t.length===0)throw new Error("wrong number of arguments");for(e=e.slice();e.length<3;)e.push(1);if(e[0]<=0||e[1]<=0||e[2]<=0)throw new Error("factors must be positive");const n=i0.fromScaling(i0.create(),e),r=t.map(o=>u0.isA(o)?u0.transform(n,o):c0.isA(o)?c0.transform(n,o):l0.isA(o)?l0.transform(n,o):o);return r.length===1?r[0]:r},WI=(e,...t)=>tc([e,1,1],t),YI=(e,...t)=>tc([1,e,1],t),ZI=(e,...t)=>tc([1,1,e],t);var li={scale:tc,scaleX:WI,scaleY:YI,scaleZ:ZI};const KI=nt,f0=at,d0=st,h0=Et,QI=(e,...t)=>{if(t=KI(t),t.length===0)throw new Error("wrong number of arguments");const n=t.map(r=>h0.isA(r)?h0.transform(e,r):f0.isA(r)?f0.transform(e,r):d0.isA(r)?d0.transform(e,r):r);return n.length===1?n[0]:n};var JI=QI,eF={align:II,center:ci.center,centerX:ci.centerX,centerY:ci.centerY,centerZ:ci.centerZ,mirror:qa.mirror,mirrorX:qa.mirrorX,mirrorY:qa.mirrorY,mirrorZ:qa.mirrorZ,rotate:Ha.rotate,rotateX:Ha.rotateX,rotateY:Ha.rotateY,rotateZ:Ha.rotateZ,scale:li.scale,scaleX:li.scaleX,scaleY:li.scaleY,scaleZ:li.scaleZ,transform:JI,translate:so.translate,translateX:so.translateX,translateY:so.translateY,translateZ:so.translateZ},io={colors:iS,curves:ES,geometries:of,maths:o4,measurements:xC,primitives:rM,text:pM,utils:rg,booleans:FL,expansions:k6,extrusions:$k,hulls:V8,modifiers:CI,transforms:eF};const bg=e=>e.reduce((t,n)=>Array.isArray(n)?t.concat(bg(n)):t.concat(n),[]);var tF=bg;const nF=(e,t)=>e-t;var rF=nF;const oF=e=>{if(!(!Array.isArray(e)||e.length===0))return e[0]};var aF=oF;const sF=(e,t,n)=>{let r=0,o=e.length;for(;o>r;){const a=Math.floor((r+o)/2),s=e[a];n(t,s)>0?r=a+1:o=a}return e.splice(r,0,t),e};var iF=sF;const cF=(e,t)=>{if(!(!Array.isArray(e)||e.length<t))return e[t]};var lF=cF;const uF=(e,t,n)=>{for(e=e.slice();e.length<n;)e.push(t);return e};var fF=uF;const dF=e=>Array.isArray(e)?e:e==null?[]:[e];var hF=dF,nc={flatten:tF,fnNumberSort:rF,head:aF,insertSorted:iF,nth:lF,padToLength:fF,toArray:hF};const{colors:p0,geometries:m0,modifiers:pF}=io,{flatten:mF,toArray:vF}=nc,gF="application/object",yF=(e,...t)=>{e=Object.assign({},{statusCallback:null,triangulate:!0},e),t=mF(t);let r=t.filter(i=>m0.geom3.isA(i));if(r.length===0)throw new Error("only 3D geometries can be serialized to OBJ");t.length!==r.length&&console.warn("some objects could not be serialized to OBJ"),r=vF(pF.generalize({snap:!0,triangulate:e.triangulate},r)),e.statusCallback&&e.statusCallback({progress:0});let o=`# Wavefront OBJ file generated by JSCAD
`;const a=[];let s="default";return r.forEach((i,c)=>{e.statusCallback&&e.statusCallback({progress:100*c/r.length}),o+=`
`;const l=g0(i),u=m0.geom3.toPolygons(i).filter(f=>f.vertices.length>=3);u.forEach(f=>{f.vertices.forEach(h=>{const p=v0(h);a.indexOf(p)<0&&(a.push(p),o+=`${p}
`)})}),o+=`
`,u.forEach(f=>{const h=f.vertices.map(g=>a.indexOf(v0(g))+1),p=g0(f)||l||"default";p!==s&&(o+=`usemtl ${p}
`,s=p),o+=`f ${h.join(" ")}
`})}),e.statusCallback&&e.statusCallback({progress:100}),[o]},v0=e=>`v ${e[0]} ${e[1]} ${e[2]}`,g0=e=>{let t;if(e.color){const n=e.color[0],r=e.color[1],o=e.color[2];let a=255+255+255;for(const s in p0.cssColors){const i=p0.cssColors[s],c=Math.abs(n-i[0])+Math.abs(r-i[1])+Math.abs(o-i[2]);if(c<a){if(t=s,c===0)break;a=c}}}return t};var bF={serialize:yF,mimeType:gF};const _F=Yu(bF),{geometries:Jl}=io,xF=(e,t)=>{t.statusCallback&&t.statusCallback({progress:0});const n=new ArrayBuffer(4),r=new Int32Array(n,0,1),o=new Int8Array(n,0,4);if(r[0]=287454020,o[0]!==68)throw new Error("Binary STL output is currently only supported on little-endian (Intel) processors");let a=0,s=0;e.forEach((m,x)=>{Jl.geom3.toPolygons(m).forEach(S=>{const O=S.vertices.length,R=O>=3?O-2:0;a+=R,s+=1})});const i=new Uint8Array(80);for(let m=0;m<80;m++)i[m]=65;const c=new Uint32Array(1);c[0]=a;const l=new ArrayBuffer(50*a),u=new Int8Array(l),f=new ArrayBuffer(50),h=new Int8Array(f),p=new Float32Array(f,0,12),g=new Uint16Array(f,48,1);let v=0;return e.forEach(m=>{Jl.geom3.toPolygons(m).forEach((P,S)=>{const O=P.vertices,R=O.length,N=Jl.poly3.plane(P);for(let I=0;I<R-2;I++){p[0]=N[0],p[1]=N[1],p[2]=N[2];let X=3;for(let W=0;W<3;W++){const J=W+(W>0?I:0),G=O[J];p[X++]=G[0],p[X++]=G[1],p[X++]=G[2]}g[0]=0,u.set(h,v),v+=50}t.statusCallback&&t.statusCallback({progress:100*S/s})})}),t.statusCallback&&t.statusCallback({progress:100}),[i.buffer,c.buffer,l]};var wF={serializeBinary:xF};const{geometries:_g}=io,EF=(e,t)=>{t.statusCallback&&t.statusCallback({progress:0});const n=`solid JSCAD
${AF(e,t)}
endsolid JSCAD
`;return t.statusCallback&&t.statusCallback({progress:100}),[n]},AF=(e,t)=>{const n=[];return e.forEach((r,o)=>{n.push(TF(r)),t.statusCallback&&t.statusCallback({progress:100*o/e.length})}),n.join(`
`)},TF=(e,t)=>{const n=[];return _g.geom3.toPolygons(e).forEach((o,a)=>{n.push($F(o))}),n.join(`
`)},xg=e=>`${e[0]} ${e[1]} ${e[2]}`,eu=e=>`vertex ${xg(e)}`,$F=e=>{const t=[];if(e.vertices.length>=3){const n=eu(e.vertices[0]);for(let r=0;r<e.vertices.length-2;r++){const o=`facet normal ${xg(_g.poly3.plane(e))}
outer loop
${n}
${eu(e.vertices[r+1])}
${eu(e.vertices[r+2])}
endloop
endfacet`;t.push(o)}}return t.join(`
`)};var SF={serializeText:EF};const{geometries:PF,modifiers:CF}=io,{flatten:OF,toArray:RF}=nc,{serializeBinary:NF}=wF,{serializeText:MF}=SF,DF="application/sla",LF=(e,...t)=>{e=Object.assign({},{binary:!0,statusCallback:null},e),t=OF(t);let r=t.filter(o=>PF.geom3.isA(o));if(r.length===0)throw new Error("only 3D geometries can be serialized to STL");return t.length!==r.length&&console.warn("some objects could not be serialized to STL"),r=RF(CF.generalize({snap:!0,triangulate:!0},r)),e.binary?NF(r,e):MF(r,e)};var kF={mimeType:DF,serialize:LF};const IF=Yu(kF);var wg={exports:{}},FF="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",GF=FF,BF=GF;function Eg(){}function Ag(){}Ag.resetWarningCache=Eg;var zF=function(){function e(r,o,a,s,i,c){if(c!==BF){var l=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:Ag,resetWarningCache:Eg};return n.PropTypes=n,n};wg.exports=zF();var VF=wg.exports;const Un=Yu(VF);var jF=UF()?L.useLayoutEffect:L.useEffect;function UF(){return!!(typeof window<"u"&&window.document&&window.document.createElement)}var tu=!1,qF=0,y0=function(){return++qF},XF=function(t){var n=t||(tu?y0():null),r=jn.useState(n),o=r[0],a=r[1];return jF(function(){o===null&&a(y0())},[]),jn.useEffect(function(){tu===!1&&(tu=!0)},[]),o!=null?String(o):void 0};function An(e,t){t===void 0&&(t={});var n=t.insertAt;if(!(!e||typeof document>"u")){var r=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css",n==="top"&&r.firstChild?r.insertBefore(o,r.firstChild):r.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}var HF=`.Stage_wrapper__1X5K_ {
  width: 100%;
  height: 100%;
  min-height: 100px;
  background-color: rgb(26, 28, 29);
  background-image: linear-gradient(
      0deg,
      transparent 24%,
      rgba(255, 255, 255, 0.04) 25%,
      rgba(255, 255, 255, 0.04) 26%,
      transparent 27%,
      transparent 74%,
      rgba(255, 255, 255, 0.04) 75%,
      rgba(255, 255, 255, 0.04) 76%,
      transparent 77%,
      transparent
    ),
    linear-gradient(
      90deg,
      transparent 24%,
      rgba(255, 255, 255, 0.04) 25%,
      rgba(255, 255, 255, 0.04) 26%,
      transparent 27%,
      transparent 74%,
      rgba(255, 255, 255, 0.04) 75%,
      rgba(255, 255, 255, 0.04) 76%,
      transparent 77%,
      transparent
    );
  color: #000;
  background-size: 30px 30px;
  position: relative;
  overflow: hidden;
  -webkit-overflow-scrolling: touch;
  font-family: Helvetica, sans-serif;
  text-align: left;
  line-height: 1;
  outline: none !important;
}
.Stage_wrapper__1X5K_ * {
  box-sizing: border-box;
}
.Stage_wrapper__1X5K_ input,
textarea,
select {
  font-family: Helvetica, sans-serif;
}
.Stage_transformWrapper__3CfIp {
  transform-origin: center center;
  position: absolute;
  left: 50%;
  top: 50%;
  width: 0px;
  height: 0px;
}
.Stage_scaleWrapper__2Y7Ck {
  position: absolute;
  left: 0px;
  top: 0px;
  width: 0px;
  height: 0px;
}
`,nu={wrapper:"Stage_wrapper__1X5K_",transformWrapper:"Stage_transformWrapper__3CfIp",scaleWrapper:"Stage_scaleWrapper__2Y7Ck"};An(HF);var WF=!!(typeof window<"u"&&window.document&&window.document.createElement),YF=function(){function e(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function ZF(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KF(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function QF(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var Tg=function(e){QF(t,e);function t(){return ZF(this,t),KF(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return YF(t,[{key:"componentWillUnmount",value:function(){this.defaultNode&&document.body.removeChild(this.defaultNode),this.defaultNode=null}},{key:"render",value:function(){return WF?(!this.props.node&&!this.defaultNode&&(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode)),Ei.createPortal(this.props.children,this.props.node||this.defaultNode)):null}}]),t}(L.Component);Tg.propTypes={children:Un.node.isRequired,node:Un.any};var JF=function(){function e(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function e7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t7(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function n7(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var $g=function(e){n7(t,e);function t(){return e7(this,t),t7(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return JF(t,[{key:"componentDidMount",value:function(){this.renderPortal()}},{key:"componentDidUpdate",value:function(r){this.renderPortal()}},{key:"componentWillUnmount",value:function(){Ei.unmountComponentAtNode(this.defaultNode||this.props.node),this.defaultNode&&document.body.removeChild(this.defaultNode),this.defaultNode=null,this.portal=null}},{key:"renderPortal",value:function(r){!this.props.node&&!this.defaultNode&&(this.defaultNode=document.createElement("div"),document.body.appendChild(this.defaultNode));var o=this.props.children;typeof this.props.children.type=="function"&&(o=L.cloneElement(this.props.children)),this.portal=Ei.unstable_renderSubtreeIntoContainer(this,o,this.props.node||this.defaultNode)}},{key:"render",value:function(){return null}}]),t}(L.Component);$g.propTypes={children:Un.node.isRequired,node:Un.any};var ku=void 0;Ei.createPortal?ku=Tg:ku=$g;var uo=ku,r7=function(){function e(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a7(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e}function s7(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i7={ESCAPE:27},Sg=function(e){s7(t,e);function t(n){o7(this,t);var r=a7(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.portalNode=null,r.state={active:!!n.defaultOpen},r.openPortal=r.openPortal.bind(r),r.closePortal=r.closePortal.bind(r),r.wrapWithPortal=r.wrapWithPortal.bind(r),r.handleOutsideMouseClick=r.handleOutsideMouseClick.bind(r),r.handleKeydown=r.handleKeydown.bind(r),r}return r7(t,[{key:"componentDidMount",value:function(){this.props.closeOnEsc&&document.addEventListener("keydown",this.handleKeydown),this.props.closeOnOutsideClick&&document.addEventListener("click",this.handleOutsideMouseClick)}},{key:"componentWillUnmount",value:function(){this.props.closeOnEsc&&document.removeEventListener("keydown",this.handleKeydown),this.props.closeOnOutsideClick&&document.removeEventListener("click",this.handleOutsideMouseClick)}},{key:"openPortal",value:function(r){this.state.active||(r&&r.nativeEvent&&r.nativeEvent.stopImmediatePropagation(),this.setState({active:!0},this.props.onOpen))}},{key:"closePortal",value:function(){this.state.active&&this.setState({active:!1},this.props.onClose)}},{key:"wrapWithPortal",value:function(r){var o=this;return this.state.active?L.createElement(uo,{node:this.props.node,key:"react-portal",ref:function(s){return o.portalNode=s}},r):null}},{key:"handleOutsideMouseClick",value:function(r){if(this.state.active){var o=this.portalNode&&(this.portalNode.props.node||this.portalNode.defaultNode);!o||o.contains(r.target)||r.button&&r.button!==0||this.closePortal()}}},{key:"handleKeydown",value:function(r){r.keyCode===i7.ESCAPE&&this.state.active&&this.closePortal()}},{key:"render",value:function(){return this.props.children({openPortal:this.openPortal,closePortal:this.closePortal,portal:this.wrapWithPortal,isOpen:this.state.active})}}]),t}(L.Component);Sg.propTypes={children:Un.func.isRequired,defaultOpen:Un.bool,node:Un.any,closeOnEsc:Un.bool,closeOnOutsideClick:Un.bool,onOpen:Un.func,onClose:Un.func};Sg.defaultProps={onOpen:function(){},onClose:function(){}};var c7=`.ContextMenu_menuWrapper__1BheJ{
  position: fixed;
  z-index: 9999;
  background: rgba(29, 32, 34, 0.95);
  border-radius: 5px;
  box-shadow: 0px 6px 7px rgba(0,0,0,.3);
  border: 1px solid rgba(0,0,0,.4);
  font-size: 14px;
  max-width: 300px;
  min-width: 150px;
  font-family: Helvetica, sans-serif;
  line-height: 1.15;
  outline: none;
}
@supports (backdrop-filter: blur(6px)){
  .ContextMenu_menuWrapper__1BheJ{
    backdrop-filter: blur(6px);
    background: rgba(29, 32, 34, 0.8);
  }
}
.ContextMenu_menuHeader__1Cw58{
  padding: 5px;
  border-bottom: 1px solid rgba(255,255,255,.1);
  display: flex;
  flex-direction: column;
}
.ContextMenu_menuLabel__158Pv{
  margin: 0px;
  color: #fff;
  font-size: 16px;
  font-weight: 600;
}
.ContextMenu_optionsWrapper__2YK_z{
  max-height: 300px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}
.ContextMenu_menuFilter__1goBp{
  border: none;
  background: none;
  height: 24px;
  flex: 1 1 auto;
  width: 100%;
  outline: none;
  color: #fff;
}
.ContextMenu_menuFilter__1goBp::placeholder{
    font-style: italic;
  }
.ContextMenu_option__33MDL{
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  padding: 5px;
  border-bottom: 1px solid rgba(255,255,255,.1);
  color: #ffffff;
}
.ContextMenu_option__33MDL:last-child{
    border-bottom: none;
  }
.ContextMenu_option__33MDL:hover{
    background: rgba(255,255,255,.05);
  }
.ContextMenu_option__33MDL label{
    margin-bottom: 5px;
    user-select: none;
  }
.ContextMenu_option__33MDL label:last-child{
      margin-bottom: 0px;
    }
.ContextMenu_option__33MDL p{
    margin: 0px;
    font-style: italic;
    font-size: 12px;
    color: rgb(182, 186, 194);
    user-select: none;
  }
.ContextMenu_option__33MDL[data-selected=true]{
    background: rgba(255,255,255,.05);
  }
.ContextMenu_emptyText__2rcXy{
  color: #fff;
  padding: 5px;
}
`,to={menuWrapper:"ContextMenu_menuWrapper__1BheJ",menuHeader:"ContextMenu_menuHeader__1Cw58",menuLabel:"ContextMenu_menuLabel__158Pv",optionsWrapper:"ContextMenu_optionsWrapper__2YK_z",menuFilter:"ContextMenu_menuFilter__1goBp",option:"ContextMenu_option__33MDL",emptyText:"ContextMenu_emptyText__2rcXy"};An(c7);function l7(e,t,n){return e===e&&(n!==void 0&&(e=e<=n?e:n),t!==void 0&&(e=e>=t?e:t)),e}var u7=l7,f7=/\s/;function d7(e){for(var t=e.length;t--&&f7.test(e.charAt(t)););return t}var h7=d7,p7=/^\s+/;function m7(e){return e&&e.slice(0,h7(e)+1).replace(p7,"")}var v7=m7;function g7(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ja=g7,ui=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pg(e,t){return t={exports:{}},e(t,t.exports),t.exports}var y7=typeof ui=="object"&&ui&&ui.Object===Object&&ui,Cg=y7,b7=typeof self=="object"&&self&&self.Object===Object&&self,_7=Cg||b7||Function("return this")(),fr=_7,x7=fr.Symbol,Rr=x7,Og=Object.prototype,w7=Og.hasOwnProperty,E7=Og.toString,Va=Rr?Rr.toStringTag:void 0;function A7(e){var t=w7.call(e,Va),n=e[Va];try{e[Va]=void 0}catch{}var r=E7.call(e);return t?e[Va]=n:delete e[Va],r}var T7=A7,$7=Object.prototype,S7=$7.toString;function P7(e){return S7.call(e)}var C7=P7,O7="[object Null]",R7="[object Undefined]",b0=Rr?Rr.toStringTag:void 0;function N7(e){return e==null?e===void 0?R7:O7:b0&&b0 in Object(e)?T7(e):C7(e)}var ra=N7;function M7(e){return e!=null&&typeof e=="object"}var Yo=M7,D7="[object Symbol]";function L7(e){return typeof e=="symbol"||Yo(e)&&ra(e)==D7}var Zo=L7,_0=0/0,k7=/^[-+]0x[0-9a-f]+$/i,I7=/^0b[01]+$/i,F7=/^0o[0-7]+$/i,G7=parseInt;function B7(e){if(typeof e=="number")return e;if(Zo(e))return _0;if(Ja(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=Ja(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=v7(e);var n=I7.test(e);return n||F7.test(e)?G7(e.slice(2),n?2:8):k7.test(e)?_0:+e}var ru=B7;function z7(e,t,n){return n===void 0&&(n=t,t=void 0),n!==void 0&&(n=ru(n),n=n===n?n:0),t!==void 0&&(t=ru(t),t=t===t?t:0),u7(ru(e),t,n)}var Or=z7;let V7="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",Ko=(e=21)=>{let t="",n=e;for(;n--;)t+=V7[Math.random()*64|0];return t};var x0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rc=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Rg=function(){function e(t,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),gn=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},Ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},j7=function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ur=function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},U7=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:e},wt=function(){function e(t,n){var r=[],o=!0,a=!1,s=void 0;try{for(var i=t[Symbol.iterator](),c;!(o=(c=i.next()).done)&&(r.push(c.value),!(n&&r.length===n));o=!0);}catch(l){a=!0,s=l}finally{try{!o&&i.return&&i.return()}finally{if(a)throw s}}return r}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),Nn=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}else return Array.from(e)},oc=function(t){var n=t.x,r=t.y,o=t.options,a=o===void 0?[]:o,s=t.onRequestClose,i=t.onOptionSelected,c=t.label,l=t.hideHeader,u=t.hideFilter,f=t.emptyText,h=L.useRef(),p=L.useRef(),g=L.useRef(),v=L.useState(""),m=wt(v,2),x=m[0],P=m[1],S=L.useState(0),O=wt(S,2),R=O[0],N=O[1],I=L.useState(0),X=wt(I,2),W=X[0],J=X[1],G=L.useRef(Ko(10)),ce=function(et){i(et),s()},_e=L.useCallback(function(Fe){h.current&&!h.current.contains(Fe.target)&&(s(),document.removeEventListener("click",_e,{capture:!0}),document.removeEventListener("contextmenu",_e,{capture:!0}))},[h,s]),de=L.useCallback(function(Fe){Fe.keyCode===27&&(s(),document.removeEventListener("keydown",de,{capture:!0}))},[s]);L.useEffect(function(){return g.current&&g.current.focus(),N(h.current.getBoundingClientRect().width),document.addEventListener("keydown",de,{capture:!0}),document.addEventListener("click",_e,{capture:!0}),document.addEventListener("contextmenu",_e,{capture:!0}),function(){document.removeEventListener("click",_e,{capture:!0}),document.removeEventListener("contextmenu",_e,{capture:!0}),document.removeEventListener("keydown",de,{capture:!0})}},[_e,de]);var De=L.useMemo(function(){if(!x)return a;var Fe=x.toLowerCase();return a.filter(function(et){return et.label.toLowerCase().includes(Fe)})},[x,a]),be=function(et){var dt=et.target.value;P(dt),J(0)},Ve=function(et){if(et.which===38&&(et.preventDefault(),W===null?J(0):W>0&&J(function(bt){return bt-1})),et.which===40&&(et.preventDefault(),W===null?J(0):W<De.length-1&&J(function(bt){return bt+1})),et.which===13&&W!==null){var dt=De[W];dt&&ce(dt)}};return L.useEffect(function(){(u||l)&&h.current.focus()},[u,l]),L.useEffect(function(){var Fe=document.getElementById(G.current+"-"+W);if(Fe){var et=p.current.getBoundingClientRect(),dt=Fe.getBoundingClientRect();(dt.y+dt.height>et.y+et.height||dt.y<et.y)&&Fe.scrollIntoView({block:"nearest"})}},[W]),L.createElement("div",{"data-flume-component":"ctx-menu",className:to.menuWrapper,onMouseDown:function(et){return et.stopPropagation()},onKeyDown:Ve,style:{left:n,top:r,width:x?R:"auto"},ref:h,tabIndex:0,role:"menu","aria-activedescendant":G.current+"-"+W},!l&&(c||a.length)?L.createElement("div",{className:to.menuHeader,"data-flume-component":"ctx-menu-header"},L.createElement("label",{className:to.menuLabel,"data-flume-component":"ctx-menu-title"},c),!u&&a.length?L.createElement("input",{"data-flume-component":"ctx-menu-input",type:"text",placeholder:"Filter options",value:x,onChange:be,className:to.menuFilter,autoFocus:!0,ref:g}):null):null,L.createElement("div",{"data-flume-component":"ctx-menu-list",className:to.optionsWrapper,role:"menu",ref:p,style:{maxHeight:Or(window.innerHeight-r-70,10,300)}},De.map(function(Fe,et){return L.createElement(q7,{menuId:G.current,selected:W===et,onClick:function(){return ce(Fe)},onMouseEnter:function(){return J(null)},index:et,key:Fe.value+et},L.createElement("label",null,Fe.label),Fe.description?L.createElement("p",null,Fe.description):null)}),a.length?null:L.createElement("span",{"data-flume-component":"ctx-menu-empty",className:to.emptyText},f)))},q7=function(t){var n=t.menuId,r=t.index,o=t.children,a=t.onClick,s=t.selected,i=t.onMouseEnter;return L.createElement("div",{"data-flume-component":"ctx-menu-option",className:to.option,role:"menuitem",onClick:a,onMouseEnter:i,"data-selected":s,id:n+"-"+r},o)},Af=L.createContext(),Tf=L.createContext(),oa=L.createContext(),Ng=L.createContext(),$f=L.createContext(),ac=L.createContext(),Mg=L.createContext(),Dg=L.createContext(),Lg=L.createContext(),Ci=function(e){var t=e.children,n=e.stageState,r=e.stageRect,o=e.onDragDelayStart,a=e.onDragStart,s=e.onDrag,i=e.onDragEnd,c=e.onMouseDown,l=e.onTouchStart,u=e.disabled,f=e.delay,h=f===void 0?6:f,p=e.innerRef,g=ur(e,["children","stageState","stageRect","onDragDelayStart","onDragStart","onDrag","onDragEnd","onMouseDown","onTouchStart","disabled","delay","innerRef"]),v=L.useRef(null),m=L.useRef(),x=L.useRef(),P=function(G){return 1/n.scale*G},S=function(G){var ce=P(G.clientX-(r?r.current.left:0)-m.current.x-(r?r.current.width:0)/2)+P(n.translate.x),_e=P(G.clientY-(r?r.current.top:0)-m.current.y-(r?r.current.height:0)/2)+P(n.translate.y);return{x:ce,y:_e}},O=function(G){var ce=S(G);s&&s(ce,G)},R=function J(G){var ce=S(G);i&&i(G,ce),window.removeEventListener("mouseup",J),window.removeEventListener("mousemove",O)},N=function(G){a&&a(G);var ce=x.current.getBoundingClientRect();m.current={x:v.current.x-ce.left,y:v.current.y-ce.top},window.addEventListener("mouseup",R),window.addEventListener("mousemove",O)},I=function(G){var ce=void 0,_e=void 0;"ontouchstart"in window&&G.touches?(ce=G.touches[0].clientX,_e=G.touches[0].clientY):(G.preventDefault(),ce=G.clientX,_e=G.clientY);var de=Math.abs(v.current.x-ce),De=Math.abs(v.current.y-_e),be=Math.round(Math.sqrt(Math.pow(de,2)+Math.pow(De,2))),Ve=h;be>=Ve&&(N(G),X())},X=function J(){document.removeEventListener("mouseup",J),document.removeEventListener("mousemove",I),v.current=null},W=function(G){o&&o(G),G.stopPropagation();var ce=void 0,_e=void 0;"ontouchstart"in window&&G.touches?(ce=G.touches[0].clientX,_e=G.touches[0].clientY):(G.preventDefault(),ce=G.clientX,_e=G.clientY),v.current={x:ce,y:_e},document.addEventListener("mouseup",X),document.addEventListener("mousemove",I)};return L.createElement("div",Ze({onMouseDown:function(G){u||W(G),c&&c(G)},onTouchStart:function(G){u||W(G),l&&l(G)},onDragStart:function(G){G.preventDefault(),G.stopPropagation()},ref:function(G){x.current=G,p&&(p.current=G)}},g),t)};function X7(e,t){for(var n=-1,r=e==null?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}var bi=X7,H7=Array.isArray,In=H7,W7=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Y7=/^\w*$/;function Z7(e,t){if(In(e))return!1;var n=typeof e;return n=="number"||n=="symbol"||n=="boolean"||e==null||Zo(e)?!0:Y7.test(e)||!W7.test(e)||t!=null&&e in Object(t)}var Sf=Z7,K7="[object AsyncFunction]",Q7="[object Function]",J7="[object GeneratorFunction]",eG="[object Proxy]";function tG(e){if(!Ja(e))return!1;var t=ra(e);return t==Q7||t==J7||t==K7||t==eG}var kg=tG,nG=fr["__core-js_shared__"],ou=nG,w0=function(){var e=/[^.]+$/.exec(ou&&ou.keys&&ou.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function rG(e){return!!w0&&w0 in e}var oG=rG,aG=Function.prototype,sG=aG.toString;function iG(e){if(e!=null){try{return sG.call(e)}catch{}try{return e+""}catch{}}return""}var po=iG,cG=/[\\^$.*+?()[\]{}|]/g,lG=/^\[object .+?Constructor\]$/,uG=Function.prototype,fG=Object.prototype,dG=uG.toString,hG=fG.hasOwnProperty,pG=RegExp("^"+dG.call(hG).replace(cG,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function mG(e){if(!Ja(e)||oG(e))return!1;var t=kg(e)?pG:lG;return t.test(po(e))}var vG=mG;function gG(e,t){return e==null?void 0:e[t]}var yG=gG;function bG(e,t){var n=yG(e,t);return vG(n)?n:void 0}var aa=bG,_G=aa(Object,"create"),es=_G;function xG(){this.__data__=es?es(null):{},this.size=0}var wG=xG;function EG(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var AG=EG,TG="__lodash_hash_undefined__",$G=Object.prototype,SG=$G.hasOwnProperty;function PG(e){var t=this.__data__;if(es){var n=t[e];return n===TG?void 0:n}return SG.call(t,e)?t[e]:void 0}var CG=PG,OG=Object.prototype,RG=OG.hasOwnProperty;function NG(e){var t=this.__data__;return es?t[e]!==void 0:RG.call(t,e)}var MG=NG,DG="__lodash_hash_undefined__";function LG(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=es&&t===void 0?DG:t,this}var kG=LG;function sa(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}sa.prototype.clear=wG;sa.prototype.delete=AG;sa.prototype.get=CG;sa.prototype.has=MG;sa.prototype.set=kG;var E0=sa;function IG(){this.__data__=[],this.size=0}var FG=IG;function GG(e,t){return e===t||e!==e&&t!==t}var Ig=GG;function BG(e,t){for(var n=e.length;n--;)if(Ig(e[n][0],t))return n;return-1}var sc=BG,zG=Array.prototype,VG=zG.splice;function jG(e){var t=this.__data__,n=sc(t,e);if(n<0)return!1;var r=t.length-1;return n==r?t.pop():VG.call(t,n,1),--this.size,!0}var UG=jG;function qG(e){var t=this.__data__,n=sc(t,e);return n<0?void 0:t[n][1]}var XG=qG;function HG(e){return sc(this.__data__,e)>-1}var WG=HG;function YG(e,t){var n=this.__data__,r=sc(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}var ZG=YG;function ia(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ia.prototype.clear=FG;ia.prototype.delete=UG;ia.prototype.get=XG;ia.prototype.has=WG;ia.prototype.set=ZG;var ic=ia,KG=aa(fr,"Map"),ts=KG;function QG(){this.size=0,this.__data__={hash:new E0,map:new(ts||ic),string:new E0}}var JG=QG;function eB(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var tB=eB;function nB(e,t){var n=e.__data__;return tB(t)?n[typeof t=="string"?"string":"hash"]:n.map}var cc=nB;function rB(e){var t=cc(this,e).delete(e);return this.size-=t?1:0,t}var oB=rB;function aB(e){return cc(this,e).get(e)}var sB=aB;function iB(e){return cc(this,e).has(e)}var cB=iB;function lB(e,t){var n=cc(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}var uB=lB;function ca(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ca.prototype.clear=JG;ca.prototype.delete=oB;ca.prototype.get=sB;ca.prototype.has=cB;ca.prototype.set=uB;var lc=ca,fB="Expected a function";function Pf(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(fB);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var s=e.apply(this,r);return n.cache=a.set(o,s)||a,s};return n.cache=new(Pf.Cache||lc),n}Pf.Cache=lc;var dB=Pf,hB=500;function pB(e){var t=dB(e,function(r){return n.size===hB&&n.clear(),r}),n=t.cache;return t}var mB=pB,vB=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gB=/\\(\\)?/g,yB=mB(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(vB,function(n,r,o,a){t.push(o?a.replace(gB,"$1"):r||n)}),t}),bB=yB,_B=1/0,A0=Rr?Rr.prototype:void 0,T0=A0?A0.toString:void 0;function Fg(e){if(typeof e=="string")return e;if(In(e))return bi(e,Fg)+"";if(Zo(e))return T0?T0.call(e):"";var t=e+"";return t=="0"&&1/e==-_B?"-0":t}var xB=Fg;function wB(e){return e==null?"":xB(e)}var EB=wB;function AB(e,t){return In(e)?e:Sf(e,t)?[e]:bB(EB(e))}var Gg=AB,TB=1/0;function $B(e){if(typeof e=="string"||Zo(e))return e;var t=e+"";return t=="0"&&1/e==-TB?"-0":t}var uc=$B;function SB(e,t){t=Gg(t,e);for(var n=0,r=t.length;e!=null&&n<r;)e=e[uc(t[n++])];return n&&n==r?e:void 0}var Cf=SB;function PB(){this.__data__=new ic,this.size=0}var CB=PB;function OB(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}var RB=OB;function NB(e){return this.__data__.get(e)}var MB=NB;function DB(e){return this.__data__.has(e)}var LB=DB,kB=200;function IB(e,t){var n=this.__data__;if(n instanceof ic){var r=n.__data__;if(!ts||r.length<kB-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new lc(r)}return n.set(e,t),this.size=n.size,this}var FB=IB;function la(e){var t=this.__data__=new ic(e);this.size=t.size}la.prototype.clear=CB;la.prototype.delete=RB;la.prototype.get=MB;la.prototype.has=LB;la.prototype.set=FB;var _i=la,GB="__lodash_hash_undefined__";function BB(e){return this.__data__.set(e,GB),this}var zB=BB;function VB(e){return this.__data__.has(e)}var jB=VB;function Oi(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new lc;++t<n;)this.add(e[t])}Oi.prototype.add=Oi.prototype.push=zB;Oi.prototype.has=jB;var UB=Oi;function qB(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}var XB=qB;function HB(e,t){return e.has(t)}var WB=HB,YB=1,ZB=2;function KB(e,t,n,r,o,a){var s=n&YB,i=e.length,c=t.length;if(i!=c&&!(s&&c>i))return!1;var l=a.get(e),u=a.get(t);if(l&&u)return l==t&&u==e;var f=-1,h=!0,p=n&ZB?new UB:void 0;for(a.set(e,t),a.set(t,e);++f<i;){var g=e[f],v=t[f];if(r)var m=s?r(v,g,f,t,e,a):r(g,v,f,e,t,a);if(m!==void 0){if(m)continue;h=!1;break}if(p){if(!XB(t,function(x,P){if(!WB(p,P)&&(g===x||o(g,x,n,r,a)))return p.push(P)})){h=!1;break}}else if(!(g===v||o(g,v,n,r,a))){h=!1;break}}return a.delete(e),a.delete(t),h}var Bg=KB,QB=fr.Uint8Array,$0=QB;function JB(e){var t=-1,n=Array(e.size);return e.forEach(function(r,o){n[++t]=[o,r]}),n}var e9=JB;function t9(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var n9=t9,r9=1,o9=2,a9="[object Boolean]",s9="[object Date]",i9="[object Error]",c9="[object Map]",l9="[object Number]",u9="[object RegExp]",f9="[object Set]",d9="[object String]",h9="[object Symbol]",p9="[object ArrayBuffer]",m9="[object DataView]",S0=Rr?Rr.prototype:void 0,au=S0?S0.valueOf:void 0;function v9(e,t,n,r,o,a,s){switch(n){case m9:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case p9:return!(e.byteLength!=t.byteLength||!a(new $0(e),new $0(t)));case a9:case s9:case l9:return Ig(+e,+t);case i9:return e.name==t.name&&e.message==t.message;case u9:case d9:return e==t+"";case c9:var i=e9;case f9:var c=r&r9;if(i||(i=n9),e.size!=t.size&&!c)return!1;var l=s.get(e);if(l)return l==t;r|=o9,s.set(e,t);var u=Bg(i(e),i(t),r,o,a,s);return s.delete(e),u;case h9:if(au)return au.call(e)==au.call(t)}return!1}var g9=v9;function y9(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}var b9=y9;function _9(e,t,n){var r=t(e);return In(e)?r:b9(r,n(e))}var x9=_9;function w9(e,t){for(var n=-1,r=e==null?0:e.length,o=0,a=[];++n<r;){var s=e[n];t(s,n,e)&&(a[o++]=s)}return a}var E9=w9;function A9(){return[]}var T9=A9,$9=Object.prototype,S9=$9.propertyIsEnumerable,P0=Object.getOwnPropertySymbols,P9=P0?function(e){return e==null?[]:(e=Object(e),E9(P0(e),function(t){return S9.call(e,t)}))}:T9,C9=P9;function O9(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}var R9=O9,N9="[object Arguments]";function M9(e){return Yo(e)&&ra(e)==N9}var C0=M9,zg=Object.prototype,D9=zg.hasOwnProperty,L9=zg.propertyIsEnumerable,k9=C0(function(){return arguments}())?C0:function(e){return Yo(e)&&D9.call(e,"callee")&&!L9.call(e,"callee")},Vg=k9;function I9(){return!1}var F9=I9,Iu=Pg(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===n,a=o?fr.Buffer:void 0,s=a?a.isBuffer:void 0,i=s||F9;e.exports=i}),G9=9007199254740991,B9=/^(?:0|[1-9]\d*)$/;function z9(e,t){var n=typeof e;return t=t??G9,!!t&&(n=="number"||n!="symbol"&&B9.test(e))&&e>-1&&e%1==0&&e<t}var jg=z9,V9=9007199254740991;function j9(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=V9}var Of=j9,U9="[object Arguments]",q9="[object Array]",X9="[object Boolean]",H9="[object Date]",W9="[object Error]",Y9="[object Function]",Z9="[object Map]",K9="[object Number]",Q9="[object Object]",J9="[object RegExp]",ez="[object Set]",tz="[object String]",nz="[object WeakMap]",rz="[object ArrayBuffer]",oz="[object DataView]",az="[object Float32Array]",sz="[object Float64Array]",iz="[object Int8Array]",cz="[object Int16Array]",lz="[object Int32Array]",uz="[object Uint8Array]",fz="[object Uint8ClampedArray]",dz="[object Uint16Array]",hz="[object Uint32Array]",Dt={};Dt[az]=Dt[sz]=Dt[iz]=Dt[cz]=Dt[lz]=Dt[uz]=Dt[fz]=Dt[dz]=Dt[hz]=!0;Dt[U9]=Dt[q9]=Dt[rz]=Dt[X9]=Dt[oz]=Dt[H9]=Dt[W9]=Dt[Y9]=Dt[Z9]=Dt[K9]=Dt[Q9]=Dt[J9]=Dt[ez]=Dt[tz]=Dt[nz]=!1;function pz(e){return Yo(e)&&Of(e.length)&&!!Dt[ra(e)]}var mz=pz;function vz(e){return function(t){return e(t)}}var Ug=vz,O0=Pg(function(e,t){var n=t&&!t.nodeType&&t,r=n&&!0&&e&&!e.nodeType&&e,o=r&&r.exports===n,a=o&&Cg.process,s=function(){try{var i=r&&r.require&&r.require("util").types;return i||a&&a.binding&&a.binding("util")}catch{}}();e.exports=s}),R0=O0&&O0.isTypedArray,gz=R0?Ug(R0):mz,qg=gz,yz=Object.prototype,bz=yz.hasOwnProperty;function _z(e,t){var n=In(e),r=!n&&Vg(e),o=!n&&!r&&Iu(e),a=!n&&!r&&!o&&qg(e),s=n||r||o||a,i=s?R9(e.length,String):[],c=i.length;for(var l in e)(t||bz.call(e,l))&&!(s&&(l=="length"||o&&(l=="offset"||l=="parent")||a&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||jg(l,c)))&&i.push(l);return i}var xz=_z,wz=Object.prototype;function Ez(e){var t=e&&e.constructor,n=typeof t=="function"&&t.prototype||wz;return e===n}var Az=Ez;function Tz(e,t){return function(n){return e(t(n))}}var $z=Tz,Sz=$z(Object.keys,Object),Pz=Sz,Cz=Object.prototype,Oz=Cz.hasOwnProperty;function Rz(e){if(!Az(e))return Pz(e);var t=[];for(var n in Object(e))Oz.call(e,n)&&n!="constructor"&&t.push(n);return t}var Nz=Rz;function Mz(e){return e!=null&&Of(e.length)&&!kg(e)}var Rf=Mz;function Dz(e){return Rf(e)?xz(e):Nz(e)}var Nf=Dz;function Lz(e){return x9(e,Nf,C9)}var N0=Lz,kz=1,Iz=Object.prototype,Fz=Iz.hasOwnProperty;function Gz(e,t,n,r,o,a){var s=n&kz,i=N0(e),c=i.length,l=N0(t),u=l.length;if(c!=u&&!s)return!1;for(var f=c;f--;){var h=i[f];if(!(s?h in t:Fz.call(t,h)))return!1}var p=a.get(e),g=a.get(t);if(p&&g)return p==t&&g==e;var v=!0;a.set(e,t),a.set(t,e);for(var m=s;++f<c;){h=i[f];var x=e[h],P=t[h];if(r)var S=s?r(P,x,h,t,e,a):r(x,P,h,e,t,a);if(!(S===void 0?x===P||o(x,P,n,r,a):S)){v=!1;break}m||(m=h=="constructor")}if(v&&!m){var O=e.constructor,R=t.constructor;O!=R&&"constructor"in e&&"constructor"in t&&!(typeof O=="function"&&O instanceof O&&typeof R=="function"&&R instanceof R)&&(v=!1)}return a.delete(e),a.delete(t),v}var Bz=Gz,zz=aa(fr,"DataView"),Fu=zz,Vz=aa(fr,"Promise"),Gu=Vz,jz=aa(fr,"Set"),Bu=jz,Uz=aa(fr,"WeakMap"),zu=Uz,M0="[object Map]",qz="[object Object]",D0="[object Promise]",L0="[object Set]",k0="[object WeakMap]",I0="[object DataView]",Xz=po(Fu),Hz=po(ts),Wz=po(Gu),Yz=po(Bu),Zz=po(zu),no=ra;(Fu&&no(new Fu(new ArrayBuffer(1)))!=I0||ts&&no(new ts)!=M0||Gu&&no(Gu.resolve())!=D0||Bu&&no(new Bu)!=L0||zu&&no(new zu)!=k0)&&(no=function(e){var t=ra(e),n=t==qz?e.constructor:void 0,r=n?po(n):"";if(r)switch(r){case Xz:return I0;case Hz:return M0;case Wz:return D0;case Yz:return L0;case Zz:return k0}return t});var F0=no,Kz=1,G0="[object Arguments]",B0="[object Array]",fi="[object Object]",Qz=Object.prototype,z0=Qz.hasOwnProperty;function Jz(e,t,n,r,o,a){var s=In(e),i=In(t),c=s?B0:F0(e),l=i?B0:F0(t);c=c==G0?fi:c,l=l==G0?fi:l;var u=c==fi,f=l==fi,h=c==l;if(h&&Iu(e)){if(!Iu(t))return!1;s=!0,u=!1}if(h&&!u)return a||(a=new _i),s||qg(e)?Bg(e,t,n,r,o,a):g9(e,t,c,n,r,o,a);if(!(n&Kz)){var p=u&&z0.call(e,"__wrapped__"),g=f&&z0.call(t,"__wrapped__");if(p||g){var v=p?e.value():e,m=g?t.value():t;return a||(a=new _i),o(v,m,n,r,a)}}return h?(a||(a=new _i),Bz(e,t,n,r,o,a)):!1}var eV=Jz;function Xg(e,t,n,r,o){return e===t?!0:e==null||t==null||!Yo(e)&&!Yo(t)?e!==e&&t!==t:eV(e,t,n,r,Xg,o)}var Hg=Xg,tV=1,nV=2;function rV(e,t,n,r){var o=n.length,a=o,s=!r;if(e==null)return!a;for(e=Object(e);o--;){var i=n[o];if(s&&i[2]?i[1]!==e[i[0]]:!(i[0]in e))return!1}for(;++o<a;){i=n[o];var c=i[0],l=e[c],u=i[1];if(s&&i[2]){if(l===void 0&&!(c in e))return!1}else{var f=new _i;if(r)var h=r(l,u,c,e,t,f);if(!(h===void 0?Hg(u,l,tV|nV,r,f):h))return!1}}return!0}var oV=rV;function aV(e){return e===e&&!Ja(e)}var Wg=aV;function sV(e){for(var t=Nf(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,Wg(o)]}return t}var iV=sV;function cV(e,t){return function(n){return n==null?!1:n[e]===t&&(t!==void 0||e in Object(n))}}var Yg=cV;function lV(e){var t=iV(e);return t.length==1&&t[0][2]?Yg(t[0][0],t[0][1]):function(n){return n===e||oV(n,e,t)}}var uV=lV;function fV(e,t,n){var r=e==null?void 0:Cf(e,t);return r===void 0?n:r}var dV=fV;function hV(e,t){return e!=null&&t in Object(e)}var pV=hV;function mV(e,t,n){t=Gg(t,e);for(var r=-1,o=t.length,a=!1;++r<o;){var s=uc(t[r]);if(!(a=e!=null&&n(e,s)))break;e=e[s]}return a||++r!=o?a:(o=e==null?0:e.length,!!o&&Of(o)&&jg(s,o)&&(In(e)||Vg(e)))}var vV=mV;function gV(e,t){return e!=null&&vV(e,t,pV)}var yV=gV,bV=1,_V=2;function xV(e,t){return Sf(e)&&Wg(t)?Yg(uc(e),t):function(n){var r=dV(n,e);return r===void 0&&r===t?yV(n,e):Hg(t,r,bV|_V)}}var wV=xV;function EV(e){return e}var Zg=EV;function AV(e){return function(t){return t==null?void 0:t[e]}}var TV=AV;function $V(e){return function(t){return Cf(t,e)}}var SV=$V;function PV(e){return Sf(e)?TV(uc(e)):SV(e)}var CV=PV;function OV(e){return typeof e=="function"?e:e==null?Zg:typeof e=="object"?In(e)?wV(e[0],e[1]):uV(e):CV(e)}var RV=OV;function NV(e){return function(t,n,r){for(var o=-1,a=Object(t),s=r(t),i=s.length;i--;){var c=s[e?i:++o];if(n(a[c],c,a)===!1)break}return t}}var MV=NV,DV=MV(),LV=DV;function kV(e,t){return e&&LV(e,t,Nf)}var IV=kV;function FV(e,t){return function(n,r){if(n==null)return n;if(!Rf(n))return e(n,r);for(var o=n.length,a=t?o:-1,s=Object(n);(t?a--:++a<o)&&r(s[a],a,s)!==!1;);return n}}var GV=FV,BV=GV(IV),zV=BV;function VV(e,t){var n=-1,r=Rf(e)?Array(e.length):[];return zV(e,function(o,a,s){r[++n]=t(o,a,s)}),r}var jV=VV;function UV(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}var qV=UV;function XV(e,t){if(e!==t){var n=e!==void 0,r=e===null,o=e===e,a=Zo(e),s=t!==void 0,i=t===null,c=t===t,l=Zo(t);if(!i&&!l&&!a&&e>t||a&&s&&c&&!i&&!l||r&&s&&c||!n&&c||!o)return 1;if(!r&&!a&&!l&&e<t||l&&n&&o&&!r&&!a||i&&n&&o||!s&&o||!c)return-1}return 0}var HV=XV;function WV(e,t,n){for(var r=-1,o=e.criteria,a=t.criteria,s=o.length,i=n.length;++r<s;){var c=HV(o[r],a[r]);if(c){if(r>=i)return c;var l=n[r];return c*(l=="desc"?-1:1)}}return e.index-t.index}var YV=WV;function ZV(e,t,n){t.length?t=bi(t,function(a){return In(a)?function(s){return Cf(s,a.length===1?a[0]:a)}:a}):t=[Zg];var r=-1;t=bi(t,Ug(RV));var o=jV(e,function(a,s,i){var c=bi(t,function(l){return l(a)});return{criteria:c,index:++r,value:a}});return qV(o,function(a,s){return YV(a,s,n)})}var KV=ZV;function QV(e,t,n,r){return e==null?[]:(In(t)||(t=t==null?[]:[t]),n=r?void 0:n,In(n)||(n=n==null?[]:[n]),KV(e,t,n))}var JV=QV,Mf="__node_editor_stage__",Kg="__node_editor_drag_connection__",Qg="__node_editor_connections__",ej=function(t){var n=t.scale,r=t.translate,o=t.editorId,a=t.dispatchStageState,s=t.children,i=t.outerStageChildren,c=t.numNodes,l=t.stageRef,u=t.spaceToPan,f=t.dispatchComments,h=t.disableComments,p=t.disablePan,g=t.disableZoom,v=L.useContext(Af),m=L.useContext(oa),x=L.useRef(),P=L.useRef(),S=L.useState(!1),O=wt(S,2),R=O[0],N=O[1],I=L.useState({x:0,y:0}),X=wt(I,2),W=X[0],J=X[1],G=L.useRef({x:0,y:0}),ce=L.useState(!1),_e=wt(ce,2),de=_e[0],De=_e[1],be=L.useCallback(function(){l.current=x.current.getBoundingClientRect()},[]);L.useEffect(function(){return l.current=x.current.getBoundingClientRect(),window.addEventListener("resize",be),function(){window.removeEventListener("resize",be)}},[l,be]);var Ve=L.useCallback(function(Je){(Je.target.nodeName==="TEXTAREA"||Je.target.dataset.comment)&&Je.target.clientHeight<Je.target.scrollHeight||(Je.preventDefault(),c!==0&&a(function(ze){var rt=ze.scale,pt=ze.translate,ht=Je.deltaY,xt=Or(rt-Or(ht,-10,10)*.005,.1,7),Ut=function(ua){return ua*(1/rt)},Mn=function(ua){return ua*(1/xt)},_t=x.current.getBoundingClientRect(),Gn=Ut(Je.clientX-_t.x-_t.width/2+pt.x),Dn=Ut(Je.clientY-_t.y-_t.height/2+pt.y),tr=Mn(Je.clientX-_t.x-_t.width/2+pt.x),dr=Mn(Je.clientY-_t.y-_t.height/2+pt.y),_=Gn-tr,Mr=Dn-dr;return{type:"SET_TRANSLATE_SCALE",scale:xt,translate:{x:pt.x+_*xt,y:pt.y+Mr*xt}}}))},[a,c]),Fe=function(ze){x.current.focus()},et=function(ze){ze.preventDefault(),G.current={x:ze.clientX,y:ze.clientY}},dt=function(ze,rt){var pt=G.current.x-rt.clientX,ht=G.current.y-rt.clientY,xt=r.x+pt,Ut=r.y+ht;x.current.style.backgroundPosition=-xt+"px "+-Ut+"px",P.current.style.transform="translate("+-(r.x+pt)+"px, "+-(r.y+ht)+"px)"},bt=function(ze){var rt=G.current.x-ze.clientX,pt=G.current.y-ze.clientY;G.current.x=ze.clientX,G.current.y=ze.clientY,a(function(ht){var xt=ht.translate;return{type:"SET_TRANSLATE",translate:{x:xt.x+rt,y:xt.y+pt}}})},$t=function(ze){return ze.preventDefault(),J({x:ze.clientX,y:ze.clientY}),N(!0),!1},en=function(){N(!1)},sn=function(ze){return 1/n*ze},cn=function(ze){var rt=ze.node,pt=ze.internalType,ht=x.current.getBoundingClientRect(),xt=sn(W.x-ht.x-ht.width/2)+sn(r.x),Ut=sn(W.y-ht.y-ht.height/2)+sn(r.y);pt==="comment"?f({type:"ADD_COMMENT",x:xt,y:Ut}):m({type:"ADD_NODE",x:xt,y:Ut,nodeType:rt.type})},Ct=function Je(ze){ze.which===32&&(De(!1),document.removeEventListener("keyup",Je))},Lt=function(ze){ze.which===32&&document.activeElement===x.current&&(ze.preventDefault(),ze.stopPropagation(),De(!0),document.addEventListener("keyup",Ct))},St=function(){x.current.contains(document.activeElement)||x.current.focus()};L.useEffect(function(){if(!g){var Je=x.current;return Je.addEventListener("wheel",Ve),function(){Je.removeEventListener("wheel",Ve)}}},[Ve,g]);var kt=L.useMemo(function(){var Je=JV(Object.values(v).filter(function(ze){return ze.addable!==!1}).map(function(ze){return{value:ze.type,label:ze.label,description:ze.description,sortIndex:ze.sortIndex,node:ze}}),["sortIndex","label"]);return h||Je.push({value:"comment",label:"Comment",description:"A comment for documenting nodes",internalType:"comment"}),Je},[v,h]);return L.createElement(Ci,{"data-flume-component":"stage",id:""+Mf+o,className:nu.wrapper,innerRef:x,onContextMenu:$t,onMouseEnter:St,onDragDelayStart:Fe,onDragStart:et,onDrag:dt,onDragEnd:bt,onKeyDown:Lt,tabIndex:-1,stageState:{scale:n,translate:r},style:{cursor:de&&u?"grab":""},disabled:p||u&&!de,"data-flume-stage":!0},R?L.createElement(uo,null,L.createElement(oc,{x:W.x,y:W.y,options:kt,onRequestClose:en,onOptionSelected:cn,label:"Add Node"})):null,L.createElement("div",{ref:P,className:nu.transformWrapper,style:{transform:"translate("+-r.x+"px, "+-r.y+"px)"}},L.createElement("div",{className:nu.scaleWrapper,style:{transform:"scale("+n+")"}},s)),i)},tj=`.Node_wrapper__3SmT7{
  background: rgba(91, 96, 99, 0.9);
  border-radius: 5px;
  box-shadow: 0px 4px 8px rgba(0,0,0,.4);
  position: absolute;
  left: 0px;
  top: 0px;
  user-select: none;
  display: flex;
  flex-direction: column;
  z-index: 1;
  cursor: default;
}
.Node_label__3MmhF{
  font-size: 13px;
  text-transform: uppercase;
  padding: 5px;
  background: #464b4e;
  border-radius: 5px 5px 0px 0px;
  margin: 0px;
  margin-bottom: 3px;
  border-bottom: 1px solid rgba(0,0,0,.15);
}
`,Jg={wrapper:"Node_wrapper__3SmT7",label:"Node_label__3MmhF"};An(tj);var nj=`.Connection_svg__-fKLY{
  position: absolute;
  left: 0px;
  top: 0px;
  pointer-events: none;
  z-index: 0;
  overflow: visible !important;
}
`,e2={svg:"Connection_svg__-fKLY"};An(nj);var Vu=Math.PI,ju=2*Vu,ro=1e-6,rj=ju-ro;function Uu(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function t2(){return new Uu}Uu.prototype=t2.prototype={constructor:Uu,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,n,r){this._+="Q"+ +e+","+ +t+","+(this._x1=+n)+","+(this._y1=+r)},bezierCurveTo:function(e,t,n,r,o,a){this._+="C"+ +e+","+ +t+","+ +n+","+ +r+","+(this._x1=+o)+","+(this._y1=+a)},arcTo:function(e,t,n,r,o){e=+e,t=+t,n=+n,r=+r,o=+o;var a=this._x1,s=this._y1,i=n-e,c=r-t,l=a-e,u=s-t,f=l*l+u*u;if(o<0)throw new Error("negative radius: "+o);if(this._x1===null)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(f>ro)if(!(Math.abs(u*i-c*l)>ro)||!o)this._+="L"+(this._x1=e)+","+(this._y1=t);else{var h=n-a,p=r-s,g=i*i+c*c,v=h*h+p*p,m=Math.sqrt(g),x=Math.sqrt(f),P=o*Math.tan((Vu-Math.acos((g+f-v)/(2*m*x)))/2),S=P/x,O=P/m;Math.abs(S-1)>ro&&(this._+="L"+(e+S*l)+","+(t+S*u)),this._+="A"+o+","+o+",0,0,"+ +(u*h>l*p)+","+(this._x1=e+O*i)+","+(this._y1=t+O*c)}},arc:function(e,t,n,r,o,a){e=+e,t=+t,n=+n,a=!!a;var s=n*Math.cos(r),i=n*Math.sin(r),c=e+s,l=t+i,u=1^a,f=a?r-o:o-r;if(n<0)throw new Error("negative radius: "+n);this._x1===null?this._+="M"+c+","+l:(Math.abs(this._x1-c)>ro||Math.abs(this._y1-l)>ro)&&(this._+="L"+c+","+l),n&&(f<0&&(f=f%ju+ju),f>rj?this._+="A"+n+","+n+",0,1,"+u+","+(e-s)+","+(t-i)+"A"+n+","+n+",0,1,"+u+","+(this._x1=c)+","+(this._y1=l):f>ro&&(this._+="A"+n+","+n+",0,"+ +(f>=Vu)+","+u+","+(this._x1=e+n*Math.cos(o))+","+(this._y1=t+n*Math.sin(o))))},rect:function(e,t,n,r){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +n+"v"+ +r+"h"+-n+"Z"},toString:function(){return this._}};function di(e){return function(){return e}}function n2(e){this._context=e}n2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function oj(e){return new n2(e)}function aj(e){return e[0]}function sj(e){return e[1]}function ij(){var e=aj,t=sj,n=di(!0),r=null,o=oj,a=null;function s(i){var c,l=i.length,u,f=!1,h;for(r==null&&(a=o(h=t2())),c=0;c<=l;++c)!(c<l&&n(u=i[c],c,i))===f&&((f=!f)?a.lineStart():a.lineEnd()),f&&a.point(+e(u,c,i),+t(u,c,i));if(h)return a=null,h+""||null}return s.x=function(i){return arguments.length?(e=typeof i=="function"?i:di(+i),s):e},s.y=function(i){return arguments.length?(t=typeof i=="function"?i:di(+i),s):t},s.defined=function(i){return arguments.length?(n=typeof i=="function"?i:di(!!i),s):n},s.curve=function(i){return arguments.length?(o=i,r!=null&&(a=o(r)),s):o},s.context=function(i){return arguments.length?(i==null?r=a=null:a=o(r=i),s):r},s}function V0(e,t,n){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+n)/6)}function r2(e){this._context=e}r2.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:V0(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:V0(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function cj(e){return new r2(e)}function j0(e){return e<0?-1:1}function U0(e,t,n){var r=e._x1-e._x0,o=t-e._x1,a=(e._y1-e._y0)/(r||o<0&&-0),s=(n-e._y1)/(o||r<0&&-0),i=(a*o+s*r)/(r+o);return(j0(a)+j0(s))*Math.min(Math.abs(a),Math.abs(s),.5*Math.abs(i))||0}function q0(e,t){var n=e._x1-e._x0;return n?(3*(e._y1-e._y0)/n-t)/2:t}function su(e,t,n){var r=e._x0,o=e._y0,a=e._x1,s=e._y1,i=(a-r)/3;e._context.bezierCurveTo(r+i,o+i*t,a-i,s-i*n,a,s)}function qu(e){this._context=e}qu.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:su(this,this._t0,q0(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var n=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,su(this,q0(this,n=U0(this,e,t)),n);break;default:su(this,this._t0,n=U0(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=n}}};Object.create(qu.prototype).point=function(e,t){qu.prototype.point.call(this,t,e)};var X0=function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"input";return document.querySelector('[data-node-id="'+t+'"] [data-port-name="'+n+'"][data-port-transput-type="'+r+'"]')},ns=function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"input",o=arguments[3];if(o){var a=t+n+r,s=o.current.ports[a];if(s)return s.getBoundingClientRect();var i=X0(t,n,r);return o.current.ports[a]=i,i&&i.getBoundingClientRect()}else{var c=X0(t,n,r);return c&&c.getBoundingClientRect()}},Qo=function(t,n){var r=n.x-t.x,o=r/3,a=ij().curve(cj)([[t.x,t.y],[t.x+o,t.y],[t.x+o*2,n.y],[n.x,n.y]]);return a},H0=function(t){var n=t.id,r=document.querySelector('[data-connection-id="'+n+'"]');r&&r.parentNode.remove()},lj=function(t){var n=document.querySelectorAll('[data-output-node-id="'+t+'"], [data-input-node-id="'+t+'"]'),r=!0,o=!1,a=void 0;try{for(var s=n[Symbol.iterator](),i;!(r=(i=s.next()).done);r=!0){var c=i.value;c.parentNode.remove()}}catch(l){o=!0,a=l}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}},uj=function(t){var n=t.line,r=t.from,o=t.to;n.setAttribute("d",Qo(r,o))},fj=function(t){var n=t.from,r=t.to,o=t.stage,a=t.id,s=t.outputNodeId,i=t.outputPortName,c=t.inputNodeId,l=t.inputPortName,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("class",e2.svg);var f=document.createElementNS("http://www.w3.org/2000/svg","path"),h=Qo(n,r);return f.setAttribute("d",h),f.setAttribute("stroke","rgb(185, 186, 189)"),f.setAttribute("stroke-width","3"),f.setAttribute("stroke-linecap","round"),f.setAttribute("fill","none"),f.setAttribute("data-connection-id",a),f.setAttribute("data-output-node-id",s),f.setAttribute("data-output-port-name",i),f.setAttribute("data-input-node-id",c),f.setAttribute("data-input-port-name",l),u.appendChild(f),o.appendChild(u),u},dj=function(t){return document.getElementById(""+Qg+t)},hj=function(t,n,r){var o=n.scale;n.stageId;var a=dj(r);if(a){var s=a.getBoundingClientRect(),i=s.width/2,c=s.height/2,l=function(f){return 1/o*f};Object.values(t).forEach(function(u){u.connections&&u.connections.inputs&&Object.entries(u.connections.inputs).forEach(function(f,h){var p=wt(f,2),g=p[0],v=p[1];v.forEach(function(m){var x=ns(m.nodeId,m.portName,"output"),P=ns(u.id,g,"input"),S=x?x.width/2:0;if(x&&P){var O=m.nodeId+m.portName+u.id+g,R=document.querySelector('[data-connection-id="'+O+'"]');R?uj({line:R,from:{x:l(x.x-s.x+S-i),y:l(x.y-s.y+S-c)},to:{x:l(P.x-s.x+S-i),y:l(P.y-s.y+S-c)}}):fj({id:O,outputNodeId:m.nodeId,outputPortName:m.portName,inputNodeId:u.id,inputPortName:g,from:{x:l(x.x-s.x+S-i),y:l(x.y-s.y+S-c)},to:{x:l(P.x-s.x+S-i),y:l(P.y-s.y+S-c)},stage:a})}})})})}},pj=`.IoPorts_wrapper__3d2hh{
  display: flex;
  flex-direction: column;
  margin-top: auto;
  width: 100%;
  padding: 5px;
}
.IoPorts_inputs__2etkb{
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
  width: 100%;
  margin-bottom: 10px;
}
.IoPorts_inputs__2etkb:last-child{
    margin-bottom: 0px;
  }
.IoPorts_inputs__2etkb .IoPorts_transput__1wbHA:first-child .IoPorts_portLabel__qOE7y, .IoPorts_inputs__2etkb .IoPorts_transput__1wbHA:first-child .IoPorts_port__1_a6J{
        margin-top: 5px;
      }
.IoPorts_inputs__2etkb .IoPorts_transput__1wbHA:last-child .IoPorts_portLabel__qOE7y, .IoPorts_inputs__2etkb .IoPorts_transput__1wbHA:last-child .IoPorts_port__1_a6J{
        margin-bottom: 5px;
      }
.IoPorts_outputs__3JGh-{
  display: flex;
  flex-direction: column;
  margin-left: auto;
  justify-content: flex-end;
  align-items: flex-end;
  width: 100%;
}
.IoPorts_outputs__3JGh- .IoPorts_transput__1wbHA:last-child .IoPorts_portLabel__qOE7y, .IoPorts_outputs__3JGh- .IoPorts_transput__1wbHA:last-child .IoPorts_port__1_a6J{
        margin-bottom: 5px;
      }
.IoPorts_outputs__3JGh-:first-child{
    margin-top: 5px;
  }
.IoPorts_transput__1wbHA{
  display: flex;
  align-items: center;
  margin-top: 6px;
  margin-bottom: 6px;
}
.IoPorts_transput__1wbHA:first-child{
    margin-top: 0px;
  }
.IoPorts_transput__1wbHA[data-controlless="true"]{
    margin-top: 6px;
    margin-bottom: 6px;
  }
.IoPorts_transput__1wbHA[data-controlless="true"]:first-child{
      margin-top: 0px;
    }
.IoPorts_transput__1wbHA[data-controlless="false"]{
    margin-top: 2px;
    margin-bottom: 2px;
  }
.IoPorts_controls__1dKFt{
  display: flex;
  flex-direction: column;
  width: 100%;
}
.IoPorts_portLabel__qOE7y{
  font-size: 13px;
  font-weight: 400;
}
.IoPorts_port__1_a6J{
  width: 12px;
  height: 12px;
  background: linear-gradient(to bottom, #acb1b4, #919699);
  border-radius: 100%;
  margin-right: 5px;
  margin-left: -11px;
  flex: 0 0 auto;
  box-shadow: 0px 2px 1px 0px rgba(0,0,0,.6);
}
.IoPorts_port__1_a6J:last-child{
    margin-right: -11px;
    margin-left: 5px;
  }
.IoPorts_port__1_a6J[data-port-color="red"]{
    background: linear-gradient(to bottom, #fa4a6f, #c22e4d);
  }
.IoPorts_port__1_a6J[data-port-color="purple"]{
    background: linear-gradient(to bottom, #9e55fb, #6024b6);
  }
.IoPorts_port__1_a6J[data-port-color="blue"]{
    background: linear-gradient(to bottom, #4284f7, #2867d4);
  }
.IoPorts_port__1_a6J[data-port-color="green"]{
    background: linear-gradient(to bottom, #31dd9f, #11ad7a);
  }
.IoPorts_port__1_a6J[data-port-color="yellow"]{
    background: linear-gradient(to bottom, #d6bf47, #9d8923);
  }
.IoPorts_port__1_a6J[data-port-color="orange"]{
    background: linear-gradient(to bottom, #fa7841, #c94b23);
  }
.IoPorts_port__1_a6J[data-port-color="pink"]{
    background: linear-gradient(to bottom, #fe8aeb, #e046c3);
  }
`,lr={wrapper:"IoPorts_wrapper__3d2hh",inputs:"IoPorts_inputs__2etkb",transput:"IoPorts_transput__1wbHA",portLabel:"IoPorts_portLabel__qOE7y",port:"IoPorts_port__1_a6J",outputs:"IoPorts_outputs__3JGh-",controls:"IoPorts_controls__1dKFt"};An(pj);var mj=`.Control_wrapper__VZIiC {
  width: 100%;
  padding-right: 3px;
  padding-top: 3px;
  padding-bottom: 5px;
}
.Control_label__1OX-Q {
  font-size: 14px;
}
.Control_controlLabel__3ga2- {
  font-size: 13px;
  display: inline-block;
  margin-left: 2px;
}
`,W0={wrapper:"Control_wrapper__VZIiC",label:"Control_label__1OX-Q",controlLabel:"Control_controlLabel__3ga2-"};An(mj);var vj=`.Checkbox_wrapper__aSqyY{
  display: flex;
  align-items: center;
}
.Checkbox_checkbox__Qv5gn{
  background: linear-gradient(to bottom, #5b5f62, #6f7477);
  border: 1px solid #3c3e40;
  border-radius: 4px;
  margin-right: 8px;
}
.Checkbox_label__2RxP-{
  padding-top: 2px;
  font-size: 13px;
}
`,iu={wrapper:"Checkbox_wrapper__aSqyY",checkbox:"Checkbox_checkbox__Qv5gn",label:"Checkbox_label__2RxP-"};An(vj);var gj=function(t){var n=t.label,r=t.data,o=t.onChange,a=L.useRef(Ko(10));return L.createElement("div",{className:iu.wrapper},L.createElement("input",{"data-flume-component":"checkbox",className:iu.checkbox,type:"checkbox",id:a,value:r,checked:r,onChange:function(i){return o(i.target.checked)}}),L.createElement("label",{"data-flume-component":"checkbox-label",className:iu.label,htmlFor:a},n))},yj=`.TextInput_wrapper__tefOZ{
  background: none;
  border: none;
}
.TextInput_input__1QHwS{
  background: linear-gradient(to bottom, #5b5f62, #6f7477);
  width: 100%;
  border: 1px solid #3c3e40;
  border-radius: 4px;
  font-size: 13px;
  padding: 5px;
  resize: vertical;
  outline: none;
}
.TextInput_input__1QHwS::placeholder{
    color: rgb(47, 49, 50);
  }
.TextInput_input__1QHwS:focus{
    background: linear-gradient(to bottom, #676b6e, #75797c);
  }
`,cu={wrapper:"TextInput_wrapper__tefOZ",input:"TextInput_input__1QHwS"};An(yj);var Y0=function(t){var n=t.placeholder,r=t.updateNodeConnections,o=t.onChange,a=t.data,s=t.step,i=t.type,c=L.useRef(),l=L.useContext(Dg),u=function p(){document.removeEventListener("mousemove",f),document.removeEventListener("mouseup",p)},f=function(g){g.stopPropagation(),r()},h=function(g){g.stopPropagation(),l(),document.addEventListener("mousemove",f),document.addEventListener("mouseup",u)};return L.createElement("div",{className:cu.wrapper,"data-flume-component":"text-input"},i==="number"?L.createElement("input",{"data-flume-component":"text-input-number",onKeyDown:function(g){if(g.keyCode===69)return g.preventDefault(),!1},onChange:function(g){var v=g.target.value.replace(/e/g,"");if(v){var m=parseFloat(v,10);Number.isNaN(m)?o(0):(o(m),c.current.value=m)}},onBlur:function(g){g.target.value||(o(0),c.current.value=0)},step:s||"1",onMouseDown:h,type:i||"text",placeholder:n,className:cu.input,defaultValue:a,onDragStart:function(g){return g.stopPropagation()},ref:c}):L.createElement("textarea",{"data-flume-component":"text-input-textarea",onChange:function(g){return o(g.target.value)},onMouseDown:h,type:"text",placeholder:n,className:cu.input,value:a,onDragStart:function(g){return g.stopPropagation()}}))},bj=`.Select_wrapper__eAPoQ{
  font-size: 14px;
  padding: 3px 6px;
  border-radius: 4px;
  background: linear-gradient(to top, #5b5f62, #6f7477);
  width: 100%;
  border: 1px solid #3c3e40;
  padding-right: 15px;
  position: relative;
}
  .Select_wrapper__eAPoQ::after{
    content: "";
    position: absolute;
    background: none;
    right: 5px;
    top: 8px;
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 6px 5px 0 5px;
    border-color: #191b1c transparent transparent transparent;
  }
  .Select_wrapper__eAPoQ:hover{
    background: linear-gradient(to top, #63676a, #777b7e);
  }
.Select_chipWrapper__3hK2u{
  font-size: 14px;
  padding: 3px 6px;
  border-radius: 4px;
  background: linear-gradient(to top, #5b5f62, #6f7477);
  border: 1px solid #3c3e40;
  margin: 2px;
  position: relative;
}
.Select_chipWrapper__3hK2u:hover .Select_deleteButton__1FnLK{
  opacity: 1;
}
.Select_chipsWrapper__4Alw8{
  display: flex;
  flex-direction: column;
  margin-bottom: 6px;
}
.Select_deleteButton__1FnLK{
  position: absolute;
  right: 0px;
  top: 0px;
  height: 100%;
  width: 22px;
  padding: 0px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(to top, #5b5f62, #6f7477);
  border-radius: 3px;
  border: none;
  font-weight: bold;
  opacity: 0;
}
.Select_deleteButton__1FnLK:focus{
  opacity: 1;
}
.Select_deleteButton__1FnLK:hover{
  background: linear-gradient(to top, #64696c, #797f82);
}
.Select_selectedWrapper__SUs4D{
  display: flex;
  flex-direction: column;
  border-radius: 4px;
  background: linear-gradient(to top, #5b5f62, #6f7477);
  width: 100%;
  border: 1px solid #3c3e40;
  font-size: 14px;
  padding: 3px 6px;
  padding-right: 15px;
  position: relative;
}
.Select_selectedWrapper__SUs4D::after{
    content: "";
    position: absolute;
    background: none;
    right: 5px;
    top: calc(50% - 4px);
    width: 0;
    height: 0;
    border-style: solid;
    border-width: 6px 5px 0 5px;
    border-color: #191b1c transparent transparent transparent;
  }
.Select_selectedWrapper__SUs4D label{
    margin: 0px;
  }
.Select_selectedWrapper__SUs4D p{
    margin: 0px;
    margin-top: 5px;
    font-size: 12px;
    font-style: italic;
    color: rgb(50, 50, 50);
  }
`,rs={wrapper:"Select_wrapper__eAPoQ",chipWrapper:"Select_chipWrapper__3hK2u",deleteButton:"Select_deleteButton__1FnLK",chipsWrapper:"Select_chipsWrapper__4Alw8",selectedWrapper:"Select_selectedWrapper__SUs4D"};An(bj);var Z0=50,K0=function(t){var n=t.options,r=n===void 0?[]:n,o=t.placeholder,a=o===void 0?"[Select an option]":o,s=t.onChange,i=t.data,c=t.allowMultiple,l=L.useState(!1),u=wt(l,2),f=u[0],h=u[1],p=L.useState({x:0,y:0}),g=wt(p,2),v=g[0],m=g[1],x=L.useRef(),P=function(){h(!1)},S=function(){if(!f){var W=x.current.getBoundingClientRect();m({x:W.x,y:W.y+W.height}),h(!0)}},O=function(W){s(c?[].concat(Nn(i),[W.value]):W.value)},R=function(W){s([].concat(Nn(i.slice(0,W)),Nn(i.slice(W+1))))},N=function(){return c?r.filter(function(W){return!i.includes(W.value)}):r},I=L.useMemo(function(){var X=r.find(function(W){return W.value===i});if(X)return Ze({},X,{label:X.label.length>Z0?X.label.slice(0,Z0)+"...":X.label})},[r,i]);return L.createElement(L.Fragment,null,c?i.length?L.createElement("div",{className:rs.chipsWrapper},i.map(function(X,W){var J=(r.find(function(G){return G.value===X})||{}).label||"";return L.createElement(xj,{onRequestDelete:function(){return R(W)},key:X},J)})):null:i?L.createElement(_j,{wrapperRef:x,option:I,onClick:S}):null,(c||!i)&&L.createElement("div",{className:rs.wrapper,ref:x,onClick:S},a),f&&L.createElement(uo,null,L.createElement(oc,{x:v.x,y:v.y,emptyText:"There are no options",options:N(),onOptionSelected:O,onRequestClose:P})))},_j=function(t){var n=t.option;n=n===void 0?{}:n;var r=n.label,o=n.description,a=t.wrapperRef,s=t.onClick;return L.createElement("div",{className:rs.selectedWrapper,onClick:s,ref:a,"data-flume-component":"select"},L.createElement("label",{"data-flume-component":"select-label"},r),o?L.createElement("p",{"data-flume-component":"select-desc"},o):null)},xj=function(t){var n=t.children,r=t.onRequestDelete;return L.createElement("div",{className:rs.chipWrapper},n,L.createElement("button",{className:rs.deleteButton,onMouseDown:function(a){a.stopPropagation()},onClick:r},""))},wj=function(t){var n=t.type,r=t.name,o=t.nodeId,a=t.portName,s=t.label,i=t.inputLabel,c=t.data,l=t.allData,u=t.render,f=t.step,h=t.options,p=h===void 0?[]:h,g=t.placeholder,v=t.inputData,m=t.triggerRecalculation,x=t.updateNodeConnections,P=t.getOptions,S=t.setValue,O=t.defaultValue,R=t.isMonoControl,N=L.useContext(oa),I=L.useContext($f),X=R?i:s,W=function(ce){N({type:"SET_PORT_DATA",data:ce,nodeId:o,portName:a,controlName:r,setValue:S}),m()},J=function(ce){var _e={triggerRecalculation:m,updateNodeConnections:x,onChange:W,data:c};switch(ce){case"select":return L.createElement(K0,Ze({},_e,{options:P?P(v,I):p,placeholder:g}));case"text":return L.createElement(Y0,Ze({},_e,{placeholder:g}));case"number":return L.createElement(Y0,Ze({},_e,{step:f,type:"number",placeholder:g}));case"checkbox":return L.createElement(gj,Ze({},_e,{label:X}));case"multiselect":return L.createElement(K0,Ze({allowMultiple:!0},_e,{options:P?P(v,I):p,placeholder:g,label:s}));case"custom":return u(c,W,I,m,{label:s,name:r,portName:a,inputLabel:i,defaultValue:O},l);default:return L.createElement("div",null,"Control")}};return L.createElement("div",{className:W0.wrapper,"data-flume-component":"control"},X&&n!=="checkbox"&&n!=="custom"&&L.createElement("label",{"data-flume-component":"control-label",className:W0.controlLabel},X),J(n))},Ej=function(t){var n=t.from,r=t.to,o=t.id,a=t.lineRef,s=t.outputNodeId,i=t.outputPortName,c=t.inputNodeId,l=t.inputPortName,u=Qo(n,r);return L.createElement("svg",{className:e2.svg,"data-flume-component":"connection-svg"},L.createElement("path",{"data-connection-id":o,"data-output-node-id":s,"data-output-port-name":i,"data-input-node-id":c,"data-input-port-name":l,"data-flume-component":"connection-path",stroke:"rgb(185, 186, 189)",fill:"none",strokeWidth:3,strokeLinecap:"round",d:u,ref:a}))},Ri=function(t){var n=L.useRef();return L.useEffect(function(){n.current=t},[n.current]),n.current};function Q0(e,t,n,r,o){var a=L.useContext(oa),s=L.useContext($f),i=L.useMemo(function(){return Array.isArray(e)?e:e(r,o,s)},[e,r,o,s]),c=Ri(i);return L.useEffect(function(){if(!(!c||Array.isArray(e))){var l=function(x){var P=i.find(function(S){var O=S.name;return x.name===O});P||a({type:"DESTROY_TRANSPUT",transputType:t,transput:{nodeId:n,portName:""+x.name}})},u=!0,f=!1,h=void 0;try{for(var p=c[Symbol.iterator](),g;!(u=(g=p.next()).done);u=!0){var v=g.value;l(v)}}catch(m){f=!0,h=m}finally{try{!u&&p.return&&p.return()}finally{if(f)throw h}}}},[e,i,c,a,n,t]),i}var Aj=function(t){var n=t.nodeId,r=t.inputs,o=r===void 0?[]:r,a=t.outputs,s=a===void 0?[]:a,i=t.connections,c=t.inputData,l=t.updateNodeConnections,u=L.useContext(Tf),f=L.useContext(Ng),h=Q0(o,"input",n,c,i),p=Q0(s,"output",n,c,i);return L.createElement("div",{className:lr.wrapper,"data-flume-component":"ports"},h.length?L.createElement("div",{className:lr.inputs,"data-flume-component":"ports-inputs"},h.map(function(g){return L.createElement(Tj,Ze({},g,{data:c[g.name]||{},isConnected:!!i.inputs[g.name],triggerRecalculation:f,updateNodeConnections:l,inputTypes:u,nodeId:n,inputData:c,key:g.name}))})):null,!!p.length&&L.createElement("div",{className:lr.outputs,"data-flume-component":"ports-outputs"},p.map(function(g){return L.createElement($j,Ze({},g,{triggerRecalculation:f,inputTypes:u,nodeId:n,inputData:c,portOnRight:!0,key:g.name}))})))},Tj=function(t){var n=t.type,r=t.label,o=t.name,a=t.nodeId,s=t.data,i=t.controls,c=t.inputTypes,l=t.noControls,u=t.triggerRecalculation,f=t.updateNodeConnections,h=t.isConnected,p=t.inputData,g=t.hidePort,v=c[n]||{},m=v.label,x=v.color,P=v.controls,S=P===void 0?[]:P,O=Ri(h),R=i||S;return L.useEffect(function(){h!==O&&u()},[h,O,u]),L.createElement("div",{"data-flume-component":"port-input",className:lr.transput,"data-controlless":h||l||!R.length,onDragStart:function(I){I.preventDefault(),I.stopPropagation()}},g?null:L.createElement(o2,{type:n,color:x,name:o,nodeId:a,isInput:!0,triggerRecalculation:u}),(!R.length||l||h)&&L.createElement("label",{"data-flume-component":"port-label",className:lr.portLabel},r||m),!l&&!h?L.createElement("div",{className:lr.controls},R.map(function(N){return L.createElement(wj,Ze({},N,{nodeId:a,portName:o,triggerRecalculation:u,updateNodeConnections:f,inputLabel:r,data:s[N.name],allData:s,key:N.name,inputData:p,isMonoControl:R.length===1}))})):null)},$j=function(t){var n=t.label,r=t.name,o=t.nodeId,a=t.type,s=t.inputTypes,i=t.triggerRecalculation,c=s[a]||{},l=c.label,u=c.color;return L.createElement("div",{"data-flume-component":"port-output",className:lr.transput,"data-controlless":!0,onDragStart:function(h){h.preventDefault(),h.stopPropagation()}},L.createElement("label",{"data-flume-component":"port-label",className:lr.portLabel},n||l),L.createElement(o2,{type:a,name:r,color:u,nodeId:o,triggerRecalculation:i}))},o2=function(t){var n=t.color,r=n===void 0?"grey":n,o=t.name,a=o===void 0?"":o,s=t.type,i=t.isInput,c=t.nodeId,l=t.triggerRecalculation,u=L.useContext(oa),f=L.useContext(ac),h=L.useContext(Lg),p=""+Mf+h,g=L.useContext(Tf),v=L.useState(!1),m=wt(v,2),x=m[0],P=m[1],S=L.useState({x:0,y:0}),O=wt(S,2),R=O[0],N=O[1],I=L.useRef(R),X=L.useRef(),W=L.useRef(),J=L.useRef(),G=function(be){return 1/f.scale*be},ce=function(be){var Ve=document.getElementById(p).getBoundingClientRect();if(i){var Fe={x:G(be.clientX-Ve.x-Ve.width/2)+G(f.translate.x),y:G(be.clientY-Ve.y-Ve.height/2)+G(f.translate.y)};J.current.setAttribute("d",Qo(I.current,Fe))}else{var et={x:G(be.clientX-Ve.x-Ve.width/2)+G(f.translate.x),y:G(be.clientY-Ve.y-Ve.height/2)+G(f.translate.y)};W.current.setAttribute("d",Qo(I.current,et))}},_e=function De(be){var Ve=!!be.target.dataset.portName;if(i){var Fe=J.current.dataset,et=Fe.inputNodeId,dt=Fe.inputPortName,bt=Fe.outputNodeId,$t=Fe.outputPortName;if(u({type:"REMOVE_CONNECTION",input:{nodeId:et,portName:dt},output:{nodeId:bt,portName:$t}}),Ve){var en=be.target.dataset,sn=en.portName,cn=en.nodeId,Ct=en.portType,Lt=en.portTransputType,St=bt!==cn;if(St&&Lt!=="output"){var kt=g[Ct].acceptTypes.includes(s);kt&&u({type:"ADD_CONNECTION",input:{nodeId:cn,portName:sn},output:{nodeId:bt,portName:$t}})}}}else if(Ve){var Je=be.target.dataset,ze=Je.portName,rt=Je.nodeId,pt=Je.portType,ht=Je.portTransputType,xt=rt!==c;if(xt&&ht!=="output"){var Ut=g[pt].acceptTypes.includes(s);Ut&&(u({type:"ADD_CONNECTION",output:{nodeId:c,portName:a},input:{nodeId:rt,portName:ze}}),l())}}P(!1),document.removeEventListener("mouseup",De),document.removeEventListener("mousemove",ce)},de=function(be){be.preventDefault(),be.stopPropagation();var Ve=X.current.getBoundingClientRect(),Fe=document.getElementById(p).getBoundingClientRect();if(i){J.current=document.querySelector('[data-input-node-id="'+c+'"][data-input-port-name="'+a+'"]');var et=!!J.current;if(et){J.current.parentNode.style.zIndex=9999;var dt=ns(J.current.dataset.outputNodeId,J.current.dataset.outputPortName,"output"),bt={x:G(dt.x-Fe.x+dt.width/2-Fe.width/2)+G(f.translate.x),y:G(dt.y-Fe.y+dt.width/2-Fe.height/2)+G(f.translate.y)};N(bt),I.current=bt,P(!0),document.addEventListener("mouseup",_e),document.addEventListener("mousemove",ce)}}else{var $t={x:G(Ve.x-Fe.x+Ve.width/2-Fe.width/2)+G(f.translate.x),y:G(Ve.y-Fe.y+Ve.width/2-Fe.height/2)+G(f.translate.y)};N($t),I.current=$t,P(!0),document.addEventListener("mouseup",_e),document.addEventListener("mousemove",ce)}};return L.createElement(L.Fragment,null,L.createElement("div",{style:{zIndex:999},onMouseDown:de,className:lr.port,"data-port-color":r,"data-port-name":a,"data-port-type":s,"data-port-transput-type":i?"input":"output","data-node-id":c,"data-flume-component":"port-handle",onDragStart:function(be){be.preventDefault(),be.stopPropagation()},ref:X}),x&&!i?L.createElement(uo,{node:document.getElementById(""+Kg+h)},L.createElement(Ej,{from:R,to:R,lineRef:W})):null)},Sj=function(t){var n=t.id,r=t.width,o=t.x,a=t.y,s=t.stageRect,i=t.connections,c=t.type,l=t.inputData,u=t.root,f=t.onDragStart,h=t.renderNodeHeader,p=L.useContext(Mg),g=L.useContext(Af),v=L.useContext(oa),m=L.useContext(ac),x=g[c],P=x.label,S=x.deletable,O=x.inputs,R=O===void 0?[]:O,N=x.outputs,I=N===void 0?[]:N,X=L.useRef(),W=L.useState(!1),J=wt(W,2),G=J[0],ce=J[1],_e=L.useState({x:0,y:0}),de=wt(_e,2),De=de[0],be=de[1],Ve=function(St){return 1/m.scale*St},Fe=function(){var St=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},kt=arguments[1];Object.entries(St).forEach(function(Je){var ze=wt(Je,2),rt=ze[0],pt=ze[1];pt.forEach(function(ht){var xt=ns(n,rt,kt?"output":"input",p),Ut=ns(ht.nodeId,ht.portName,kt?"input":"output",p),Mn=Ut.width/2,_t=void 0;kt?_t=n+rt+ht.nodeId+ht.portName:_t=ht.nodeId+ht.portName+n+rt;var Gn=void 0,Dn=p.current.connections[_t];Dn?Gn=Dn:(Gn=document.querySelector('[data-connection-id="'+_t+'"]'),p.current.connections[_t]=Gn);var tr={x:Ve(xt.x-s.current.x+Mn-s.current.width/2)+Ve(m.translate.x),y:Ve(xt.y-s.current.y+Mn-s.current.height/2)+Ve(m.translate.y)},dr={x:Ve(Ut.x-s.current.x+Mn-s.current.width/2)+Ve(m.translate.x),y:Ve(Ut.y-s.current.y+Mn-s.current.height/2)+Ve(m.translate.y)};Gn.setAttribute("d",Qo(tr,dr))})})},et=function(){i&&(Fe(i.inputs),Fe(i.outputs,!0))},dt=function(St,kt){v(Ze({type:"SET_NODE_COORDINATES"},kt,{nodeId:n}))},bt=function(St){var kt=St.x,Je=St.y;X.current.style.transform="translate("+kt+"px,"+Je+"px)",et()},$t=function(St){f()},en=function(St){return St.preventDefault(),St.stopPropagation(),be({x:St.clientX,y:St.clientY}),ce(!0),!1},sn=function(){ce(!1)},cn=function(){v({type:"REMOVE_NODE",nodeId:n})},Ct=function(St){var kt=St.value;switch(kt){case"deleteNode":cn();break;default:return}};return L.createElement(Ci,{className:Jg.wrapper,style:{width:r,transform:"translate("+o+"px, "+a+"px)"},onDragStart:$t,onDrag:bt,onDragEnd:dt,innerRef:X,"data-node-id":n,"data-flume-component":"node","data-flume-node-type":x.type,"data-flume-component-is-root":!!u,onContextMenu:en,stageState:m,stageRect:s},h?h(J0,x,{openMenu:en,closeMenu:sn,deleteNode:cn}):L.createElement(J0,null,P),L.createElement(Aj,{nodeId:n,inputs:R,outputs:I,connections:i,updateNodeConnections:et,inputData:l}),G?L.createElement(uo,null,L.createElement(oc,{x:De.x,y:De.y,options:[].concat(Nn(S!==!1?[{label:"Delete Node",value:"deleteNode",description:"Deletes a node and all of its connections."}]:[])),onRequestClose:sn,onOptionSelected:Ct,hideFilter:!0,label:"Node Options",emptyText:"This node has no options."})):null)},J0=function(t){var n=t.children,r=t.className,o=r===void 0?"":r,a=ur(t,["children","className"]);return L.createElement("h2",Ze({},a,{className:Jg.label+(o?" "+o:""),"data-flume-component":"node-header"}),n)},Pj=`.Comment_wrapper__1Pnbd {
  position: absolute;
  left: 0px;
  top: 0px;
  padding: 5px;
  background: rgba(147, 154, 158, 0.7);
  border-radius: 5px;
  border-bottom-right-radius: 2px;
  box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
  min-width: 80px;
  font-size: 14px;
  display: flex;
  text-shadow: 0px 1px rgba(255,255,255,.1);
  border: 1px solid rgba(168, 176, 181, 0.7);
  user-select: none;
}
  .Comment_wrapper__1Pnbd[data-color="red"]{
    background: rgba(213, 84, 103, 0.65);
    border-color: rgba(227, 85, 119, 0.65);
  }
  .Comment_wrapper__1Pnbd[data-color="purple"]{
    background: rgba(153, 83, 196, 0.65);
    border-color: rgba(156, 85, 227, 0.65);
  }
  .Comment_wrapper__1Pnbd[data-color="blue"]{
    background: rgba(76, 142, 203, 0.65);
    border-color: rgba(85, 159, 227, 0.65);
  }
  .Comment_wrapper__1Pnbd[data-color="green"]{
    background: rgba(70, 200, 130, 0.65);
    border-color: rgba(85, 227, 150, 0.65);
  }
  .Comment_wrapper__1Pnbd[data-color="yellow"]{
    background: rgba(200, 167, 63, 0.65);
    border-color: rgba(227, 213, 85, 0.65);
  }
  .Comment_wrapper__1Pnbd[data-color="orange"]{
    background: rgba(215, 123, 64, 0.65);
    border-color: rgba(227, 149, 85, 0.65);
  }
  .Comment_wrapper__1Pnbd[data-color="pink"]{
    background: rgba(255, 102, 208, 0.65);
    border-color: rgba(242, 131, 228, 0.65);
  }
.Comment_text__Ie2nX{
  width: 100%;
  height: 100%;
  overflow: auto;
  white-space: pre-wrap;
  cursor: default;
}
.Comment_resizeThumb__20KWn {
  width: 10px;
  height: 10px;
  border-radius: 4px 0px 4px 0px;
  position: absolute;
  right: 0px;
  bottom: 0px;
  overflow: hidden;
  cursor: nwse-resize;
}
.Comment_resizeThumb__20KWn::before,
  .Comment_resizeThumb__20KWn::after {
    content: "";
    position: absolute;
    right: 0px;
    top: 0px;
    width: 250%;
    height: 0px;
    border-top: 1px solid rgba(0, 0, 0, 0.7);
    border-bottom: 2px solid rgba(255, 255, 255, 0.7);
    transform-origin: center right;
    transform: rotate(-45deg) scale(0.5);
  }
.Comment_resizeThumb__20KWn::after {
    transform: rotate(-45deg) translateY(3px) scale(0.5);
  }
.Comment_textarea__2Rze3 {
  resize: none;
  width: calc(100% + 2px);
  height: calc(100% + 2px);
  border-radius: 3px;
  background: rgba(255,255,255,.1);
  border: none;
  outline: none;
  margin: -2px;
  margin-top: -1px;
  padding-top: 0px;
  font-size: 14px;
}
.Comment_textarea__2Rze3::placeholder{
    color: rgba(0,0,0,.5);
  }
`,hi={wrapper:"Comment_wrapper__1Pnbd",text:"Comment_text__Ie2nX",resizeThumb:"Comment_resizeThumb__20KWn",textarea:"Comment_textarea__2Rze3"};An(Pj);var Cj=`.ColorPicker_wrapper__1M1j2{
  position: fixed;
  z-index: 9999;
  background: rgba(29, 32, 34, 0.95);
  border-radius: 5px;
  box-shadow: 0px 6px 7px rgba(0,0,0,.3);
  border: 1px solid rgba(0,0,0,.4);
  color: #fff;
  display: flex;
  width: 102px;
  flex-wrap: wrap;
  padding: 2px;
}
@supports (backdrop-filter: blur(6px)){
  .ColorPicker_wrapper__1M1j2{
    backdrop-filter: blur(6px);
    background: rgba(29, 32, 34, 0.8);
  }
}
.ColorPicker_colorButtonWrapper__1ijdj{
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 2px;
}
.ColorPicker_colorButton__1Qcuq{
  border-radius: 3px;
  border: none;
  width: 20px;
  height: 20px;
  background: rgba(204, 204, 204, 1);
}
.ColorPicker_colorButton__1Qcuq[data-color="red"]{
    background: rgba(210, 101, 111, 1)
  }
.ColorPicker_colorButton__1Qcuq[data-color="purple"]{
    background: rgba(159, 101, 210, 1)
  }
.ColorPicker_colorButton__1Qcuq[data-color="blue"]{
    background: rgba(101, 151, 210, 1)
  }
.ColorPicker_colorButton__1Qcuq[data-color="green"]{
    background: rgba(101, 210, 168, 1)
  }
.ColorPicker_colorButton__1Qcuq[data-color="orange"]{
    background: rgba(210, 137, 101, 1)
  }
.ColorPicker_colorButton__1Qcuq[data-color="yellow"]{
    background: rgba(210, 196, 101, 1)
  }
.ColorPicker_colorButton__1Qcuq[data-color="pink"]{
    background: rgba(241, 124, 226, 1)
  }
.ColorPicker_colorButton__1Qcuq:hover{
    opacity: .8;
  }
`,Xu={wrapper:"ColorPicker_wrapper__1M1j2",colorButtonWrapper:"ColorPicker_colorButtonWrapper__1ijdj",colorButton:"ColorPicker_colorButton__1Qcuq"};An(Cj);var jt=function(t,n){return t!==void 0?t:n},Go=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){return{}};return function(o){return n(o),Ze({type:t.type,label:jt(o.label,t.label||""),name:jt(o.name,t.name||""),defaultValue:jt(o.defaultValue,t.defaultValue),setValue:jt(o.setValue,void 0)},r(o))}},Oj={text:Go({type:"text",name:"text",defaultValue:""}),select:Go({type:"select",name:"select",options:[],defaultValue:""},function(){},function(e){return{options:jt(e.options,[]),getOptions:jt(e.getOptions,void 0),placeholder:jt(e.placeholder,void 0)}}),number:Go({type:"number",name:"number",defaultValue:0},function(){},function(e){return{step:jt(e.step,void 0)}}),checkbox:Go({type:"checkbox",name:"checkbox",defaultValue:!1}),multiselect:Go({type:"multiselect",name:"multiselect",options:[],defaultValue:[]},function(){},function(e){return{options:jt(e.options,[]),getOptions:jt(e.getOptions,void 0),placeholder:jt(e.placeholder,void 0)}}),custom:Go({type:"custom",name:"custom",render:function(){},defaultValue:void 0},function(){},function(e){return{render:jt(e.render,function(){})}})},Za={yellow:"yellow",orange:"orange",red:"red",pink:"pink",purple:"purple",blue:"blue",green:"green",grey:"grey"},em=function(t){return Object.values(t).reduce(function(n,r){return n[r.type]=function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return{type:r.type,name:o.name||r.name,label:o.label||r.label,noControls:jt(o.noControls,!1),color:o.color||r.color,hidePort:jt(o.hidePort,r.hidePort),controls:jt(o.controls,r.controls)}},n},{})},Rj=function(){function e(t){rc(this,e),t?(this.nodeTypes=Ze({},t.nodeTypes),this.portTypes=Ze({},t.portTypes)):(this.nodeTypes={},this.portTypes={})}return Rg(e,[{key:"addRootNodeType",value:function(n){return this.addNodeType(Ze({},n,{root:!0,addable:!1,deletable:!1})),this}},{key:"addNodeType",value:function(n){if((typeof n>"u"?"undefined":x0(n))!=="object"&&n!==null)throw new Error("You must provide a configuration object when calling addNodeType.");if(typeof n.type!="string")throw new Error('Required key, "type" must be a string when calling addNodeType.');if(typeof n.initialWidth<"u"&&typeof n.initialWidth!="number")throw new Error('Optional key, "initialWidth" must be a number when calling addNodeType.');if(this.nodeTypes[n.type]!==void 0)throw new Error('A node with type "'+n.type+'" has already been declared.');var r={type:n.type,label:jt(n.label,""),description:jt(n.description,""),addable:jt(n.addable,!0),deletable:jt(n.deletable,!0)};if(n.initialWidth&&(r.initialWidth=n.initialWidth),n.sortIndex!==void 0&&(r.sortIndex=n.sortIndex),typeof n.inputs=="function"){var o=n.inputs(em(this.portTypes));if(!Array.isArray(o)&&typeof n.inputs!="function")throw new Error('When providing a function to the "inputs" key, you must return either an array or a function.');r.inputs=o}else if(n.inputs===void 0)r.inputs=[];else if(Array.isArray(n.inputs))r.inputs=n.inputs;else throw new Error('Optional key, "inputs" must be an array.');if(typeof n.outputs=="function"){var a=n.outputs(em(this.portTypes));if(!Array.isArray(a)&&typeof n.outputs!="function")throw new Error('When providing a function to the "outputs" key, you must return either an array or a function.');r.outputs=a}else if(n.outputs===void 0)r.outputs=[];else{if(n.outputs!==void 0&&!Array.isArray(n.outputs))throw new Error('Optional key, "outputs" must be an array.');r.outputs=n.outputs}if(n.root!==void 0){if(typeof n.root!="boolean")throw new Error('Optional key, "root" must be a boolean.');r.root=n.root}return this.nodeTypes[n.type]=r,this}},{key:"removeNodeType",value:function(n){if(!this.nodeTypes[n])console.error('Non-existent node type "'+n+'" cannot be removed.');else{var r=this.nodeTypes;r[n];var o=ur(r,[n]);this.nodeTypes=o}return this}},{key:"addPortType",value:function(n){if((typeof n>"u"?"undefined":x0(n))!=="object"&&n!==null)throw new Error("You must provide a configuration object when calling addPortType");if(typeof n.type!="string")throw new Error('Required key, "type" must be a string when calling addPortType.');if(this.portTypes[n.type]!==void 0)throw new Error('A port with type "'+n.type+'" has already been declared.');if(typeof n.name!="string")throw new Error('Required key, "name" must be a string when calling addPortType.');var r={type:n.type,name:n.name,label:jt(n.label,""),color:jt(n.color,Za.grey),hidePort:jt(n.hidePort,!1)};if(n.acceptTypes===void 0)r.acceptTypes=[n.type];else if(Array.isArray(n.acceptTypes))r.acceptTypes=n.acceptTypes;else throw new Error('Optional key, "acceptTypes" must be an array.');if(n.controls===void 0)r.controls=[];else if(Array.isArray(n.controls))r.controls=n.controls;else throw new Error('Optional key, "controls" must be an array.');return this.portTypes[n.type]=r,this}},{key:"removePortType",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=r.skipDynamicNodesCheck,a=o===void 0?!1:o;if(!this.portTypes[n])console.error('Non-existent port type "'+n+'" cannot be removed.');else{if(!a){var s=Object.values(this.nodeTypes).filter(function(u){return typeof u.inputs=="function"||typeof u.outputs=="function"});s.length&&console.warn("We've detected that one or more of your nodes is using dynamic inputs/outputs. This is a potentially dangerous operation as we are unable to detect if this portType is being used in one of those nodes. You can quiet this message by passing { skipDynamicNodesCheck: true } in as the second argument.")}var i=Object.values(this.nodeTypes).filter(function(u){return Array.isArray(u.inputs)&&u.inputs.find(function(f){return f.type===n})||Array.isArray(u.outputs)&&u.outputs.find(function(f){return f.type===n})});if(i.length)throw new Error('Cannot delete port type "'+n+'" without first deleting all node types using these ports: ['+i.map(function(u){return""+u.type}).join(", ")+"]");var c=this.portTypes;c[n];var l=ur(c,[n]);this.portTypes=l}return this}}]),e}(),Nj=function(e){var t=e.x,n=e.y,r=e.onColorPicked,o=e.onRequestClose,a=L.useRef(),s=L.useCallback(function(c){a.current&&!a.current.contains(c.target)&&(o(),document.removeEventListener("click",s),document.removeEventListener("contextmenu",s))},[a,o]),i=L.useCallback(function(c){c.keyCode===27&&(o(),document.removeEventListener("keydown",i))},[o]);return L.useEffect(function(){return document.addEventListener("keydown",i),document.addEventListener("click",s),document.addEventListener("contextmenu",s),function(){document.removeEventListener("click",s),document.removeEventListener("contextmenu",s),document.removeEventListener("keydown",i)}},[s,i]),L.createElement("div",{"data-flume-component":"color-picker",ref:a,className:Xu.wrapper,style:{left:t,top:n}},Object.values(Za).map(function(c){return L.createElement(Mj,{onSelected:function(){r(c),o()},color:c,key:c})}))},Mj=function(t){var n=t.color,r=t.onSelected;return L.createElement("div",{className:Xu.colorButtonWrapper},L.createElement("button",{"data-flume-component":"color-button",className:Xu.colorButton,onClick:r,"data-color":n,"aria-label":n}))},Dj=function(e){var t=e.dispatch,n=e.id,r=e.x,o=e.y,a=e.width,s=e.height,i=e.color,c=e.text,l=e.stageRect,u=e.onDragStart,f=e.isNew,h=L.useContext(ac),p=L.useRef(),g=L.useRef(),v=L.useState(!1),m=wt(v,2),x=m[0],P=m[1],S=L.useState(!1),O=wt(S,2),R=O[0],N=O[1],I=L.useState(!1),X=wt(I,2),W=X[0],J=X[1],G=L.useState({x:0,y:0}),ce=wt(G,2),_e=ce[0],de=ce[1],De=L.useState({x:0,y:0}),be=wt(De,2),Ve=be[0],Fe=be[1],et=function(rt){return rt.preventDefault(),rt.stopPropagation(),de({x:rt.clientX,y:rt.clientY}),J(!0),!1},dt=function(){return J(!1)},bt=function(rt){u()},$t=function(rt){var pt=rt.x,ht=rt.y;p.current.style.transform="translate("+pt+"px,"+ht+"px)"},en=function(rt,pt){var ht=pt.x,xt=pt.y;t({type:"SET_COMMENT_COORDINATES",id:n,x:ht,y:xt})},sn=function(rt){var pt=Or(rt.x-r+10,80,1e4),ht=Or(rt.y-o+10,30,1e4);p.current.style.width=pt+"px",p.current.style.height=ht+"px"},cn=function(rt,pt){var ht=Or(pt.x-r+10,80,1e4),xt=Or(pt.y-o+10,30,1e4);t({type:"SET_COMMENT_DIMENSIONS",id:n,width:ht,height:xt})},Ct=function(rt,pt){switch(rt.value){case"edit":Lt();break;case"color":Fe(_e),N(!0);break;case"delete":t({type:"DELETE_COMMENT",id:n});break}},Lt=function(){P(!0)},St=function(){P(!1)},kt=function(rt){t({type:"SET_COMMENT_TEXT",id:n,text:rt.target.value})},Je=function(rt){t({type:"SET_COMMENT_COLOR",id:n,color:rt})};return L.useEffect(function(){f&&(P(!0),t({type:"REMOVE_COMMENT_NEW",id:n}))},[f,t,n]),L.createElement(Ci,{innerRef:p,className:hi.wrapper,style:{transform:"translate("+r+"px,"+o+"px)",width:a,height:s,zIndex:x?999:""},stageState:h,stageRect:l,onDragStart:bt,onDrag:$t,onDragEnd:en,onContextMenu:et,onDoubleClick:Lt,onWheel:function(rt){return rt.stopPropagation()},"data-color":i,"data-flume-component":"comment"},x?L.createElement("textarea",{"data-flume-component":"comment-textarea",className:hi.textarea,onChange:kt,onMouseDown:function(rt){return rt.stopPropagation()},onBlur:St,placeholder:"Text of the comment...",autoFocus:!0,value:c,ref:g}):L.createElement("div",{"data-flume-component":"comment-text","data-comment":!0,className:hi.text},c),L.createElement(Ci,{className:hi.resizeThumb,stageState:h,stageRect:l,onDrag:sn,onDragEnd:cn,"data-flume-component":"comment-resize-handle"}),W?L.createElement(uo,null,L.createElement(oc,{hideFilter:!0,label:"Comment Options",x:_e.x,y:_e.y,options:[{value:"edit",label:"Edit Comment",description:"Edit the text of the comment"},{value:"color",label:"Change Color",description:"Change the color of the comment"},{value:"delete",label:"Delete Comment",description:"Delete the comment"}],onRequestClose:dt,onOptionSelected:Ct})):null,R?L.createElement(uo,null,L.createElement(Nj,{x:Ve.x,y:Ve.y,onRequestClose:function(){return N(!1)},onColorPicked:Je})):null)},Lj=`.Toaster_toaster__1eC3T{
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 100%;
  height: 1px;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding-bottom: 15px;
  box-shadow: 0px 5px 10px -2px rgba(0,0,0,.3);
  pointer-events: none;
}
.Toaster_toast__3YHVS{
  position: absolute;
  left: calc(50% - 200px);
  top: 0px;
  pointer-events: all;
  width: 400px;
  padding: 10px;
  padding-top: 7px;
  padding-right: 16px;
  border-radius: 6px;
  background: rgba(231, 231, 231, 1);
  border: 1px solid;
  margin-bottom: 5px;
  transition: transform 300ms;
  flex: 0 0 auto;
  animation: Toaster_fade-in__2526Y 150ms;
  user-select: none;
  font-size: 14px;
  display: flex;
  flex-direction: column;
  will-change: transform;
}
.Toaster_toast__3YHVS[data-type="danger"]{
    background: rgb(255, 116, 137);
    border-color: rgb(254, 99, 136);
    color: rgb(66, 6, 20);
  }
.Toaster_toast__3YHVS[data-type="info"]{
    background: rgb(76, 193, 250);
    border-color: rgb(103, 182, 255);
    color: rgb(5, 36, 64);
  }
.Toaster_toast__3YHVS[data-type="success"]{
    background: rgb(81, 230, 150);
    border-color: rgb(85, 227, 150);
    color: rgb(7, 57, 30);
  }
.Toaster_toast__3YHVS[data-type="warning"]{
    background: rgb(245, 208, 93);
    border-color: rgb(247, 235, 125);
    color: rgb(83, 75, 8);
  }
.Toaster_toast__3YHVS[data-exiting=true]{
    animation: Toaster_fade-out__2lM6E 150ms;
    animation-fill-mode: forwards;
  }
.Toaster_toast__3YHVS p{
  margin: 0px;
}
.Toaster_title__4InNr{
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 5px;
}
.Toaster_timer__3dGzF{
  position: absolute;
  bottom: -1px;
  left: -1px;
  width: calc(100% + 2px);
  height: 3px;
  background: rgba(0,0,0,.4);
  transform-origin: left center;
  animation: Toaster_timer__3dGzF 1000ms linear;
  animation-fill-mode: forwards;
  z-index: 9;
}
.Toaster_exitButton__1S_Ks{
  position: absolute;
  right: 0px;
  top: 0px;
  width: 20px;
  height: 20px;
  padding: 0px;
  background: none;
  border: none;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 14px;
  color: inherit;
  opacity: .6;
}
.Toaster_exitButton__1S_Ks:hover{
  opacity: .9;
}

@keyframes Toaster_fade-in__2526Y {
  from{
    opacity: 0;
  }
  to{
    opacity: 1;
  }
}

@keyframes Toaster_fade-out__2lM6E {
  from{
    opacity: 1;
  }
  to{
    opacity: 0;
  }
}

@keyframes Toaster_timer__3dGzF {
  from{
    transform: scaleX(1);
  }
  to{
    transform: scaleX(0);
  }
}
`,Ya={toaster:"Toaster_toaster__1eC3T",toast:"Toaster_toast__3YHVS","fade-in":"Toaster_fade-in__2526Y","fade-out":"Toaster_fade-out__2lM6E",title:"Toaster_title__4InNr",timer:"Toaster_timer__3dGzF",exitButton:"Toaster_exitButton__1S_Ks"};An(Lj);var kj=function(e){var t=e.toasts,n=t===void 0?[]:t,r=e.dispatchToasts,o=L.useCallback(function(i,c){r({type:"SET_HEIGHT",id:i,height:c})},[r]),a=L.useCallback(function(i){r({type:"SET_EXITING",id:i})},[r]),s=L.useCallback(function(i){r({type:"REMOVE_TOAST",id:i})},[r]);return L.createElement("div",{className:Ya.toaster},n.map(function(i,c){return L.createElement(Ij,Ze({},i,{onHeightReceived:o,onExitRequested:a,onRemoveRequested:s,y:n.slice(0,c+1).reduce(function(l,u){return u.height+l+5},0),key:i.id}))}))},Ij=function(t){var n=t.id,r=t.title,o=t.message,a=t.duration,s=t.type,i=t.exiting,c=t.y,l=t.onHeightReceived,u=t.onExitRequested,f=t.onRemoveRequested,h=L.useState(!1),p=wt(h,2),g=p[0],v=p[1],m=L.useRef(),x=L.useRef(),P=L.useCallback(function(){v(!0),clearTimeout(x.current)},[]),S=L.useCallback(function(){v(!1),x.current=setTimeout(function(){return u(n)},a)},[n,a,u]);L.useLayoutEffect(function(){var R=m.current.getBoundingClientRect(),N=R.height;l(n,N)},[l,n]),L.useEffect(function(){return S(),P},[S,P]);var O=function(){i&&f(n)};return L.createElement("div",{"data-flume-component":"toast",ref:m,className:Ya.toast,"data-type":s,style:{transform:"translateY(-"+c+"px)"},"data-exiting":i,onAnimationEnd:O,onMouseEnter:P,onMouseLeave:S,role:"alert"},r?L.createElement("span",{"data-flume-component":"toast-title",className:Ya.title},r):null,L.createElement("p",{"data-flume-component":"toast-message"},o),!g&&L.createElement("div",{className:Ya.timer,style:{animationDuration:a+"ms"},onAnimationEnd:function(N){return N.stopPropagation()}}),L.createElement("button",{"data-flume-component":"toast-close",className:Ya.exitButton,onClick:function(){P(),u(n)}},""))},Fj=`.Connections_svgWrapper__3mXcU{
  position: absolute;
  left: 0px;
  height: 0px;
}
`,Gj={svgWrapper:"Connections_svgWrapper__3mXcU"};An(Fj);var Bj=function(t){t.nodes;var n=t.editorId;return L.createElement("div",{className:Gj.svgWrapper,id:""+Qg+n})},zj=function(t,n){var r=!1,o=function a(s){for(var i=Object.values(t[s].connections.outputs),c=0;c<i.length&&!r;c++)for(var l=i[c],u=0;u<l.length;u++){var f=l[u];if(f.nodeId===n){r=!0;break}else a(f.nodeId)}};return o(n),r},Vj=function(t,n,r,o){var a,s=Ze({},t,(a={},gn(a,n.nodeId,Ze({},t[n.nodeId],{connections:Ze({},t[n.nodeId].connections,{inputs:Ze({},t[n.nodeId].connections.inputs,gn({},n.portName,[].concat(Nn(t[n.nodeId].connections.inputs[n.portName]||[]),[{nodeId:r.nodeId,portName:r.portName}])))})})),gn(a,r.nodeId,Ze({},t[r.nodeId],{connections:Ze({},t[r.nodeId].connections,{outputs:Ze({},t[r.nodeId].connections.outputs,gn({},r.portName,[].concat(Nn(t[r.nodeId].connections.outputs[r.portName]||[]),[{nodeId:n.nodeId,portName:n.portName}])))})})),a));return s},tm=function(t,n,r){var o,a=t[n.nodeId],s=a.connections.inputs;s[n.portName];var i=ur(s,[n.portName]),c=Ze({},a,{connections:Ze({},a.connections,{inputs:i})}),l=t[r.nodeId],u=l.connections.outputs[r.portName].filter(function(h){return h.nodeId===n.nodeId?h.portName!==n.portName:!0}),f=Ze({},l,{connections:Ze({},l.connections,{outputs:Ze({},l.connections.outputs,gn({},r.portName,u))})});return Ze({},t,(o={},gn(o,n.nodeId,c),gn(o,r.nodeId,f),o))},nm=function(t,n){return Object.entries(t).reduce(function(r,o){var a=wt(o,2),s=a[0],i=a[1],c=i.filter(function(l){return l.nodeId!==n});return c.length&&(r[s]=c),r},{})},jj=function(t,n){return{inputs:nm(t.inputs,n),outputs:nm(t.outputs,n)}},Uj=function(t,n){t[n];var r=ur(t,[n]);return r=Object.values(r).reduce(function(o,a){return o[a.id]=Ze({},a,{connections:jj(a.connections,n)}),o},{}),lj(n),r},qj=function(t,n,r,o){var a=Ze({},t),s=Object.values(a).map(function(c){return n[c.type]?void 0:c.id}).filter(function(c){return c});s.forEach(function(c){a=Df(a,{type:"REMOVE_NODE",nodeId:c},{nodeTypes:n,portTypes:r,context:o})});var i=Object.values(a).reduce(function(c,l){var u=n[l.type],f=a2({node:l,nodeType:u,portTypes:r,context:o}),h=Object.entries(l.inputData).reduce(function(g,v){var m=wt(v,2),x=m[0],P=m[1];return f[x]!==void 0&&(g[x]=P),g},{}),p=Ze({},f,h);return c[l.id]=Ze({},l,{inputData:p}),c},{});return i=Object.values(i).reduce(function(c,l){var u=Ze({},l),f=n[l.type];return f.root!==l.root&&(f.root&&!l.root?u.root=f.root:!f.root&&l.root&&delete u.root),c[l.id]=u,c},{}),i},Xj=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],r=arguments[2],o=arguments[3],a=arguments[4],s=qj(t,r,o,a);return Ze({},s,n.reduce(function(i,c,l){var u=!Object.values(t).find(function(f){return f.type===c.type});return u&&(i=Df(i,{type:"ADD_NODE",id:"default-"+l,defaultNode:!0,x:c.x||0,y:c.y||0,nodeType:c.type},{nodeTypes:r,portTypes:o,context:a})),i},{}))},a2=function(t){var n=t.node,r=t.nodeType,o=t.portTypes,a=t.context,s=Array.isArray(r.inputs)?r.inputs:r.inputs(n.inputData,n.connections,a);return s.reduce(function(i,c){var l=o[c.type];return i[c.name||l.name]=(c.controls||l.controls||[]).reduce(function(u,f){return u[f.name]=f.defaultValue,u},{}),i},{})},Df=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments[2],o=r.nodeTypes,a=r.portTypes,s=r.cache,i=r.circularBehavior,c=r.context,l=arguments[3];switch(n.type){case"ADD_CONNECTION":{var u=n.input,f=n.output,h=!t[u.nodeId].connections.inputs[u.portName];if(h){var p=i==="warn"||i==="allow",g=Vj(t,u,f),v=zj(g,f.nodeId);return v&&!p?(l({type:"ADD_TOAST",title:"Unable to connect",message:"Connecting these nodes would result in an infinite loop.",toastType:"warning",duration:5e3}),t):(v&&i==="warn"&&l({type:"ADD_TOAST",title:"Circular Connection Detected",message:"Connecting these nodes has created an infinite loop.",toastType:"warning",duration:5e3}),g)}else return t}case"REMOVE_CONNECTION":{var m=n.input,x=n.output,P=x.nodeId+x.portName+m.nodeId+m.portName;return delete s.current.connections[P],H0({id:P}),tm(t,m,x)}case"DESTROY_TRANSPUT":{var S=n.transput,O=n.transputType,R=S.nodeId+S.portName+O;delete s.current.ports[R];var N=O==="input"?"inputs":"outputs",I=t[S.nodeId].connections[N][S.portName];return!I||!I.length?t:I.reduce(function(Je,ze){var rt=O==="input"?[S,ze]:[ze,S],pt=wt(rt,2),ht=pt[0],xt=pt[1],Ut=xt.nodeId+xt.portName+ht.nodeId+ht.portName;return delete s.current.connections[Ut],H0({id:Ut}),tm(Je,ht,xt)},t)}case"ADD_NODE":{var X=n.x,W=n.y,J=n.nodeType,G=n.id,ce=n.defaultNode,_e=G||Ko(10),de={id:_e,x:X,y:W,type:J,width:o[J].initialWidth||200,connections:{inputs:{},outputs:{}},inputData:{}};return de.inputData=a2({node:de,nodeType:o[J],portTypes:a,context:c}),ce&&(de.defaultNode=!0),o[J].root&&(de.root=!0),Ze({},t,gn({},_e,de))}case"REMOVE_NODE":{var De=n.nodeId;return Uj(t,De)}case"HYDRATE_DEFAULT_NODES":{var be=Ze({},t);for(var Ve in be)if(be[Ve].defaultNode){var Fe=Ko(10),et=be[Ve];et.id,et.defaultNode;var dt=ur(et,["id","defaultNode"]);be[Fe]=Ze({},dt,{id:Fe}),delete be[Ve]}return be}case"SET_PORT_DATA":{var bt=n.nodeId,$t=n.portName,en=n.controlName,sn=n.data,cn=n.setValue,Ct=Ze({},t[bt].inputData,gn({},$t,Ze({},t[bt].inputData[$t],gn({},en,sn))));return cn&&(Ct=cn(Ct,t[bt].inputData)),Ze({},t,gn({},bt,Ze({},t[bt],{inputData:Ct})))}case"SET_NODE_COORDINATES":{var Lt=n.x,St=n.y,kt=n.nodeId;return Ze({},t,gn({},kt,Ze({},t[kt],{x:Lt,y:St})))}default:return t}},Hj=function(t,n,r){return function(o,a){return t(o,a,n,r)}},pi=function(t,n,r){return Ze({},t,gn({},n,Ze({},t[n],r)))},Wj=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments[1];switch(t.type){case"ADD_COMMENT":{var n={id:Ko(10),text:"",x:t.x,y:t.y,width:200,height:30,color:"blue",isNew:!0};return Ze({},e,gn({},n.id,n))}case"REMOVE_COMMENT_NEW":var r=e[t.id];r.isNew;var o=ur(r,["isNew"]);return Ze({},e,gn({},t.id,o));case"SET_COMMENT_COORDINATES":return pi(e,t.id,{x:t.x,y:t.y});case"SET_COMMENT_DIMENSIONS":return pi(e,t.id,{width:t.width,height:t.height});case"SET_COMMENT_TEXT":return pi(e,t.id,{text:t.text});case"SET_COMMENT_COLOR":return pi(e,t.id,{color:t.color});case"DELETE_COMMENT":{e[t.id];var a=ur(e,[t.id]);return a}default:return e}},Yj=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments[1];switch(t.type){case"ADD_TOAST":return[{id:Ko(5),title:t.title,message:t.message,type:t.toastType||"info",duration:t.duration||1e4,height:0,exiting:!1}].concat(Nn(e));case"SET_HEIGHT":{var n=e.findIndex(function(a){return a.id===t.id});return[].concat(Nn(e.slice(0,n)),[Ze({},e[n],{height:t.height})],Nn(e.slice(n+1)))}case"SET_EXITING":{var r=e.findIndex(function(a){return a.id===t.id});return[].concat(Nn(e.slice(0,r)),[Ze({},e[r],{exiting:!0})],Nn(e.slice(r+1)))}case"REMOVE_TOAST":{var o=e.findIndex(function(a){return a.id===t.id});return[].concat(Nn(e.slice(0,o)),Nn(e.slice(o+1)))}default:return e}},Zj=function(e,t){var n=typeof t=="function"?t(e):t;switch(n.type){case"SET_SCALE":return Ze({},e,{scale:n.scale});case"SET_TRANSLATE":return Ze({},e,{translate:n.translate});case"SET_TRANSLATE_SCALE":return Ze({},e,{translate:n.translate,scale:n.scale});default:return e}},Kj=function e(){rc(this,e),this.ports={},this.connections={}},Qj=`.styles_dragWrapper__1P7RD{
  z-index: 9999;
  position: absolute;
  left: 0px;
  top: 0px;
}
.styles_debugWrapper__2OSbY{
  display: flex;
  position: absolute;
  left: 10px;
  bottom: 10px;
  gap: 15px;
}
`,ja={dragWrapper:"styles_dragWrapper__1P7RD",debugWrapper:"styles_debugWrapper__2OSbY"};An(Qj);var xi=function(e){j7(t,e);function t(n,r){rc(this,t);var o=U7(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return o.code=r,o}return t}(Error);xi.maxLoopsExceeded=1;var Jj=function(){function e(t,n,r){var o=this;rc(this,e),this.resetLoops=function(a){o.maxLoops=a!==void 0?a:1e3,o.loops=0},this.checkLoops=function(){if(o.maxLoops>=0&&o.loops>o.maxLoops)throw new xi("Max loop count exceeded.",xi.maxLoopsExceeded);o.loops++},this.getRootNode=function(a){var s=Object.values(a).filter(function(i){return i.root});if(s.length>1)throw new Error("The root engine must not be called with more than one root node.");return s[0]},this.reduceRootInputs=function(a,s){return Object.entries(a).reduce(function(i,c){var l=wt(c,2),u=l[0],f=l[1],h=s(u,f);return i[h.name]=h.value,i},{})},this.resolveInputValues=function(a,s,i,c){var l=s.inputs;return typeof l=="function"&&(l=l(a.inputData,a.connections,c)),l.reduce(function(u,f){var h=a.connections.inputs[f.name]||[];return h.length>0?u[f.name]=o.getValueOfConnection(h[0],i,c):u[f.name]=o.resolveInputControls(f.type,a.inputData[f.name]||{},c),u},{})},this.getValueOfConnection=function(a,s,i){o.checkLoops();var c=s[a.nodeId],l=o.config.nodeTypes[c.type],u=o.resolveInputValues(c,l,s,i),f=o.fireNodeFunction(c,u,l,i)[a.portName];return f},this.config=t,this.fireNodeFunction=r,this.resolveInputControls=n,this.loops=0,this.maxLoops=1e3}return Rg(e,[{key:"resolveRootNode",value:function(n){var r=this,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=o.rootNodeId?n[o.rootNodeId]:this.getRootNode(n);if(a){var s=this.config.nodeTypes[a.type].inputs;typeof s=="function"&&(s=s(a.inputData,a.connections,o.context));var i=s.reduce(function(l,u){return l[u.name]=r.resolveInputControls(u.type,a.inputData[u.name]||{},o.context),l},{}),c=this.reduceRootInputs(a.connections.inputs,function(l,u){r.resetLoops(o.maxLoops);var f=void 0;try{f=r.getValueOfConnection(u[0],n,o.context)}catch(h){h.code===xi.maxLoopsExceeded?console.error(h.message+" Circular nodes detected in "+l+" port."):console.error(h)}finally{return{name:l,value:f}}});return o.onlyResolveConnected?c:Ze({},i,c)}else return console.error("A root node was not found. The Root Engine requires that exactly one node be marked as the root node."),{}}}]),e}(),eU={},Hu=function(t,n){var r=t.comments,o=t.nodes,a=t.nodeTypes,s=a===void 0?{}:a,i=t.portTypes,c=i===void 0?{}:i,l=t.defaultNodes,u=l===void 0?[]:l,f=t.context,h=f===void 0?eU:f,p=t.onChange,g=t.onCommentsChange,v=t.initialScale,m=t.spaceToPan,x=m===void 0?!1:m,P=t.hideComments,S=P===void 0?!1:P,O=t.disableComments,R=O===void 0?!1:O,N=t.disableZoom,I=N===void 0?!1:N,X=t.disablePan,W=X===void 0?!1:X,J=t.circularBehavior,G=t.renderNodeHeader,ce=t.debug,_e=XF(),de=L.useRef(new Kj),De=L.useRef(),be=L.useState(),Ve=wt(be,2),Fe=Ve[0],et=Ve[1],dt=L.useReducer(Yj,[]),bt=wt(dt,2),$t=bt[0],en=bt[1],sn=L.useReducer(Hj(Df,{nodeTypes:s,portTypes:c,cache:de,circularBehavior:J,context:h},et),{},function(){return Xj(o,u,s,c,h)}),cn=wt(sn,2),Ct=cn[0],Lt=cn[1],St=L.useReducer(Wj,r||{}),kt=wt(St,2),Je=kt[0],ze=kt[1];L.useEffect(function(){Lt({type:"HYDRATE_DEFAULT_NODES"})},[]);var rt=L.useState(!0),pt=wt(rt,2),ht=pt[0],xt=pt[1],Ut=L.useReducer(Zj,{scale:typeof v=="number"?Or(v,.1,7):1,translate:{x:0,y:0}}),Mn=wt(Ut,2),_t=Mn[0],Gn=Mn[1],Dn=L.useCallback(function(){hj(Ct,_t,_e)},[Ct,_e,_t]),tr=L.useCallback(function(){De.current=document.getElementById(""+Mf+_e).getBoundingClientRect()},[_e]);L.useLayoutEffect(function(){ht&&(Dn(),xt(!1))},[ht,Dn]);var dr=L.useCallback(function(){xt(!0)},[]);L.useImperativeHandle(n,function(){return{getNodes:function(){return Ct},getComments:function(){return Je}}});var _=Ri(Ct);L.useEffect(function(){_&&p&&Ct!==_&&p(Ct)},[Ct,_,p]);var Mr=Ri(Je);return L.useEffect(function(){Mr&&g&&Je!==Mr&&g(Je)},[Je,Mr,g]),L.useEffect(function(){Fe&&(en(Fe),et(null))},[Fe]),L.createElement(Tf.Provider,{value:c},L.createElement(Af.Provider,{value:s},L.createElement(oa.Provider,{value:Lt},L.createElement(Ng.Provider,{value:dr},L.createElement($f.Provider,{value:h},L.createElement(ac.Provider,{value:_t},L.createElement(Mg.Provider,{value:de},L.createElement(Lg.Provider,{value:_e},L.createElement(Dg.Provider,{value:tr},L.createElement(ej,{editorId:_e,scale:_t.scale,translate:_t.translate,spaceToPan:x,disablePan:W,disableZoom:I,dispatchStageState:Gn,dispatchComments:ze,disableComments:R||S,stageRef:De,numNodes:Object.keys(Ct).length,outerStageChildren:L.createElement(L.Fragment,null,ce&&L.createElement("div",{className:ja.debugWrapper},L.createElement("button",{className:ja.debugButton,onClick:function(){return console.log(Ct)}},"Log Nodes"),L.createElement("button",{className:ja.debugButton,onClick:function(){return console.log(JSON.stringify(Ct))}},"Export Nodes"),L.createElement("button",{className:ja.debugButton,onClick:function(){return console.log(Je)}},"Log Comments")),L.createElement(kj,{toasts:$t,dispatchToasts:en}))},!S&&Object.values(Je).map(function(yn){return L.createElement(Dj,Ze({},yn,{stageRect:De,dispatch:ze,onDragStart:tr,key:yn.id}))}),Object.values(Ct).map(function(yn){return L.createElement(Sj,Ze({},yn,{stageRect:De,onDragEnd:dr,onDragStart:tr,renderNodeHeader:G,key:yn.id}))}),L.createElement(Bj,{nodes:Ct,editorId:_e}),L.createElement("div",{className:ja.dragWrapper,id:""+Kg+_e})))))))))))};Hu=L.forwardRef(Hu);var tU=function(t,n,r){var o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return Object.keys(t).length?n.resolveRootNode(t,Ze({},o,{context:r})):{}};const Ni=new Rj;Ni.addPortType({type:"number",name:"number",label:"Number",color:Za.red,controls:[Oj.number({name:"number",label:"Number"})]}).addPortType({type:"vec3",name:"vec3",label:"Vector 3D",color:Za.blue}).addPortType({type:"geometry",name:"geometry",label:"Geometry",color:Za.green}).addRootNodeType({type:"geometry",label:"Output",initialWidth:170,inputs:e=>[e.geometry({name:"geometry",label:"Geometry"})]}).addNodeType({type:"number",label:"Number",initialWidth:150,inputs:e=>[e.number()],outputs:e=>[e.number()]}).addNodeType({type:"vec3",label:"Vector 3D",initialWidth:150,inputs:e=>[e.number({name:"x"}),e.number({name:"y"}),e.number({name:"z"})],outputs:e=>[e.vec3()]}).addNodeType({type:"cube",label:"Cube",initialWidth:150,inputs:e=>[e.number({name:"size"})],outputs:e=>[e.geometry()]}).addNodeType({type:"sphere",label:"Sphere",initialWidth:150,inputs:e=>[e.number({name:"radius"})],outputs:e=>[e.geometry()]}).addNodeType({type:"rotate",label:"Rotate",initialWidth:150,inputs:e=>[e.vec3({name:"vector"}),e.geometry({name:"geometry"})],outputs:e=>[e.geometry()]}).addNodeType({type:"scale",label:"Scale",initialWidth:150,inputs:e=>[e.vec3({name:"vector"}),e.geometry({name:"geometry"})],outputs:e=>[e.geometry()]}).addNodeType({type:"translate",label:"Translate",initialWidth:150,inputs:e=>[e.vec3({name:"vector"}),e.geometry({name:"geometry"})],outputs:e=>[e.geometry()]}).addNodeType({type:"intersect",label:"Intersect",initialWidth:150,inputs:e=>[e.geometry({name:"x"}),e.geometry({name:"y"})],outputs:e=>[e.geometry()]}).addNodeType({type:"subtract",label:"Subtract",initialWidth:150,inputs:e=>[e.geometry({name:"x",label:"From"}),e.geometry({name:"y"})],outputs:e=>[e.geometry()]}).addNodeType({type:"union",label:"Union",initialWidth:150,inputs:e=>[e.geometry({name:"x"}),e.geometry({name:"y"})],outputs:e=>[e.geometry()]});function nU(e,t){switch(e){case"geometry":return t.geometry;case"number":return t.number;default:return t}}function rU(e,t,n,r){const{cube:o,sphere:a}=io.primitives,{rotate:s,scale:i,translate:c}=io.transforms,{intersect:l,subtract:u,union:f}=io.booleans;switch(e.type){case"number":return{number:t.number};case"vec3":return{vec3:[t.x,t.y,t.z]};case"cube":return{geometry:o({size:t.size})};case"sphere":return{geometry:a({radius:t.radius})};case"rotate":return{geometry:s(t.vector,t.geometry)};case"scale":return{geometry:i(t.vector,t.geometry)};case"translate":return{geometry:c(t.vector,t.geometry)};case"intersect":return{geometry:l(t.x,t.y)};case"subtract":return{geometry:u(t.x,t.y)};case"union":return{geometry:f(t.x,t.y)};default:return t}}const oU=new Jj(Ni,nU,rU);function aU({onChange:e}){return fn.jsx(Hu,{defaultNodes:[{type:"geometry",x:0,y:0}],nodeTypes:Ni.nodeTypes,onChange:t=>e(tU(t,oU,{}).geometry),portTypes:Ni.portTypes})}var sU=iU;function iU(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var cU=lU;function lU(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}var uU=fU;function fU(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var s2=dU;function dU(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var hU=pU;function pU(e,t){if(e===t){var n=t[1],r=t[2],o=t[3],a=t[6],s=t[7],i=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=o,e[13]=s,e[14]=i}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}var mU=vU;function vU(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],i=t[5],c=t[6],l=t[7],u=t[8],f=t[9],h=t[10],p=t[11],g=t[12],v=t[13],m=t[14],x=t[15],P=n*i-r*s,S=n*c-o*s,O=n*l-a*s,R=r*c-o*i,N=r*l-a*i,I=o*l-a*c,X=u*v-f*g,W=u*m-h*g,J=u*x-p*g,G=f*m-h*v,ce=f*x-p*v,_e=h*x-p*m,de=P*_e-S*ce+O*G+R*J-N*W+I*X;return de?(de=1/de,e[0]=(i*_e-c*ce+l*G)*de,e[1]=(o*ce-r*_e-a*G)*de,e[2]=(v*I-m*N+x*R)*de,e[3]=(h*N-f*I-p*R)*de,e[4]=(c*J-s*_e-l*W)*de,e[5]=(n*_e-o*J+a*W)*de,e[6]=(m*O-g*I-x*S)*de,e[7]=(u*I-h*O+p*S)*de,e[8]=(s*ce-i*J+l*X)*de,e[9]=(r*J-n*ce-a*X)*de,e[10]=(g*N-v*O+x*P)*de,e[11]=(f*O-u*N-p*P)*de,e[12]=(i*W-s*G-c*X)*de,e[13]=(n*G-r*W+o*X)*de,e[14]=(v*S-g*R-m*P)*de,e[15]=(u*R-f*S+h*P)*de,e):null}var gU=yU;function yU(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],s=t[4],i=t[5],c=t[6],l=t[7],u=t[8],f=t[9],h=t[10],p=t[11],g=t[12],v=t[13],m=t[14],x=t[15];return e[0]=i*(h*x-p*m)-f*(c*x-l*m)+v*(c*p-l*h),e[1]=-(r*(h*x-p*m)-f*(o*x-a*m)+v*(o*p-a*h)),e[2]=r*(c*x-l*m)-i*(o*x-a*m)+v*(o*l-a*c),e[3]=-(r*(c*p-l*h)-i*(o*p-a*h)+f*(o*l-a*c)),e[4]=-(s*(h*x-p*m)-u*(c*x-l*m)+g*(c*p-l*h)),e[5]=n*(h*x-p*m)-u*(o*x-a*m)+g*(o*p-a*h),e[6]=-(n*(c*x-l*m)-s*(o*x-a*m)+g*(o*l-a*c)),e[7]=n*(c*p-l*h)-s*(o*p-a*h)+u*(o*l-a*c),e[8]=s*(f*x-p*v)-u*(i*x-l*v)+g*(i*p-l*f),e[9]=-(n*(f*x-p*v)-u*(r*x-a*v)+g*(r*p-a*f)),e[10]=n*(i*x-l*v)-s*(r*x-a*v)+g*(r*l-a*i),e[11]=-(n*(i*p-l*f)-s*(r*p-a*f)+u*(r*l-a*i)),e[12]=-(s*(f*m-h*v)-u*(i*m-c*v)+g*(i*h-c*f)),e[13]=n*(f*m-h*v)-u*(r*m-o*v)+g*(r*h-o*f),e[14]=-(n*(i*m-c*v)-s*(r*m-o*v)+g*(r*c-o*i)),e[15]=n*(i*h-c*f)-s*(r*h-o*f)+u*(r*c-o*i),e}var bU=_U;function _U(e){var t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],s=e[5],i=e[6],c=e[7],l=e[8],u=e[9],f=e[10],h=e[11],p=e[12],g=e[13],v=e[14],m=e[15],x=t*s-n*a,P=t*i-r*a,S=t*c-o*a,O=n*i-r*s,R=n*c-o*s,N=r*c-o*i,I=l*g-u*p,X=l*v-f*p,W=l*m-h*p,J=u*v-f*g,G=u*m-h*g,ce=f*m-h*v;return x*ce-P*G+S*J+O*W-R*X+N*I}var xU=wU;function wU(e,t,n){var r=t[0],o=t[1],a=t[2],s=t[3],i=t[4],c=t[5],l=t[6],u=t[7],f=t[8],h=t[9],p=t[10],g=t[11],v=t[12],m=t[13],x=t[14],P=t[15],S=n[0],O=n[1],R=n[2],N=n[3];return e[0]=S*r+O*i+R*f+N*v,e[1]=S*o+O*c+R*h+N*m,e[2]=S*a+O*l+R*p+N*x,e[3]=S*s+O*u+R*g+N*P,S=n[4],O=n[5],R=n[6],N=n[7],e[4]=S*r+O*i+R*f+N*v,e[5]=S*o+O*c+R*h+N*m,e[6]=S*a+O*l+R*p+N*x,e[7]=S*s+O*u+R*g+N*P,S=n[8],O=n[9],R=n[10],N=n[11],e[8]=S*r+O*i+R*f+N*v,e[9]=S*o+O*c+R*h+N*m,e[10]=S*a+O*l+R*p+N*x,e[11]=S*s+O*u+R*g+N*P,S=n[12],O=n[13],R=n[14],N=n[15],e[12]=S*r+O*i+R*f+N*v,e[13]=S*o+O*c+R*h+N*m,e[14]=S*a+O*l+R*p+N*x,e[15]=S*s+O*u+R*g+N*P,e}var EU=AU;function AU(e,t,n){var r=n[0],o=n[1],a=n[2],s,i,c,l,u,f,h,p,g,v,m,x;return t===e?(e[12]=t[0]*r+t[4]*o+t[8]*a+t[12],e[13]=t[1]*r+t[5]*o+t[9]*a+t[13],e[14]=t[2]*r+t[6]*o+t[10]*a+t[14],e[15]=t[3]*r+t[7]*o+t[11]*a+t[15]):(s=t[0],i=t[1],c=t[2],l=t[3],u=t[4],f=t[5],h=t[6],p=t[7],g=t[8],v=t[9],m=t[10],x=t[11],e[0]=s,e[1]=i,e[2]=c,e[3]=l,e[4]=u,e[5]=f,e[6]=h,e[7]=p,e[8]=g,e[9]=v,e[10]=m,e[11]=x,e[12]=s*r+u*o+g*a+t[12],e[13]=i*r+f*o+v*a+t[13],e[14]=c*r+h*o+m*a+t[14],e[15]=l*r+p*o+x*a+t[15]),e}var TU=$U;function $U(e,t,n){var r=n[0],o=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*o,e[5]=t[5]*o,e[6]=t[6]*o,e[7]=t[7]*o,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}var SU=PU;function PU(e,t,n,r){var o=r[0],a=r[1],s=r[2],i=Math.sqrt(o*o+a*a+s*s),c,l,u,f,h,p,g,v,m,x,P,S,O,R,N,I,X,W,J,G,ce,_e,de,De;return Math.abs(i)<1e-6?null:(i=1/i,o*=i,a*=i,s*=i,c=Math.sin(n),l=Math.cos(n),u=1-l,f=t[0],h=t[1],p=t[2],g=t[3],v=t[4],m=t[5],x=t[6],P=t[7],S=t[8],O=t[9],R=t[10],N=t[11],I=o*o*u+l,X=a*o*u+s*c,W=s*o*u-a*c,J=o*a*u-s*c,G=a*a*u+l,ce=s*a*u+o*c,_e=o*s*u+a*c,de=a*s*u-o*c,De=s*s*u+l,e[0]=f*I+v*X+S*W,e[1]=h*I+m*X+O*W,e[2]=p*I+x*X+R*W,e[3]=g*I+P*X+N*W,e[4]=f*J+v*G+S*ce,e[5]=h*J+m*G+O*ce,e[6]=p*J+x*G+R*ce,e[7]=g*J+P*G+N*ce,e[8]=f*_e+v*de+S*De,e[9]=h*_e+m*de+O*De,e[10]=p*_e+x*de+R*De,e[11]=g*_e+P*de+N*De,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}var CU=OU;function OU(e,t,n){var r=Math.sin(n),o=Math.cos(n),a=t[4],s=t[5],i=t[6],c=t[7],l=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*o+l*r,e[5]=s*o+u*r,e[6]=i*o+f*r,e[7]=c*o+h*r,e[8]=l*o-a*r,e[9]=u*o-s*r,e[10]=f*o-i*r,e[11]=h*o-c*r,e}var RU=NU;function NU(e,t,n){var r=Math.sin(n),o=Math.cos(n),a=t[0],s=t[1],i=t[2],c=t[3],l=t[8],u=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o-l*r,e[1]=s*o-u*r,e[2]=i*o-f*r,e[3]=c*o-h*r,e[8]=a*r+l*o,e[9]=s*r+u*o,e[10]=i*r+f*o,e[11]=c*r+h*o,e}var MU=DU;function DU(e,t,n){var r=Math.sin(n),o=Math.cos(n),a=t[0],s=t[1],i=t[2],c=t[3],l=t[4],u=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*o+l*r,e[1]=s*o+u*r,e[2]=i*o+f*r,e[3]=c*o+h*r,e[4]=l*o-a*r,e[5]=u*o-s*r,e[6]=f*o-i*r,e[7]=h*o-c*r,e}var LU=kU;function kU(e,t,n){var r,o,a,s=n[0],i=n[1],c=n[2],l=Math.sqrt(s*s+i*i+c*c);return Math.abs(l)<1e-6?null:(l=1/l,s*=l,i*=l,c*=l,r=Math.sin(t),o=Math.cos(t),a=1-o,e[0]=s*s*a+o,e[1]=i*s*a+c*r,e[2]=c*s*a-i*r,e[3]=0,e[4]=s*i*a-c*r,e[5]=i*i*a+o,e[6]=c*i*a+s*r,e[7]=0,e[8]=s*c*a+i*r,e[9]=i*c*a-s*r,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}var IU=FU;function FU(e,t,n){var r=t[0],o=t[1],a=t[2],s=t[3],i=r+r,c=o+o,l=a+a,u=r*i,f=r*c,h=r*l,p=o*c,g=o*l,v=a*l,m=s*i,x=s*c,P=s*l;return e[0]=1-(p+v),e[1]=f+P,e[2]=h-x,e[3]=0,e[4]=f-P,e[5]=1-(u+v),e[6]=g+m,e[7]=0,e[8]=h+x,e[9]=g-m,e[10]=1-(u+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}var GU=BU;function BU(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var zU=VU;function VU(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}var jU=UU;function UU(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var qU=XU;function XU(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var HU=WU;function WU(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var YU=ZU;function ZU(e,t){var n=t[0],r=t[1],o=t[2],a=t[3],s=n+n,i=r+r,c=o+o,l=n*s,u=r*s,f=r*i,h=o*s,p=o*i,g=o*c,v=a*s,m=a*i,x=a*c;return e[0]=1-f-g,e[1]=u+x,e[2]=h-m,e[3]=0,e[4]=u-x,e[5]=1-l-g,e[6]=p+v,e[7]=0,e[8]=h+m,e[9]=p-v,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var KU=QU;function QU(e,t,n,r,o,a,s){var i=1/(n-t),c=1/(o-r),l=1/(a-s);return e[0]=a*2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*i,e[9]=(o+r)*c,e[10]=(s+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*l,e[15]=0,e}var JU=eq;function eq(e,t,n,r,o){var a=1/Math.tan(t/2),s=1/(r-o);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+r)*s,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*r*s,e[15]=0,e}var tq=nq;function nq(e,t,n,r){var o=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),i=Math.tan(t.rightDegrees*Math.PI/180),c=2/(s+i),l=2/(o+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((s-i)*c*.5),e[9]=(o-a)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}var rq=oq;function oq(e,t,n,r,o,a,s){var i=1/(t-n),c=1/(r-o),l=1/(a-s);return e[0]=-2*i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*i,e[13]=(o+r)*c,e[14]=(s+a)*l,e[15]=1,e}var aq=s2,sq=iq;function iq(e,t,n,r){var o,a,s,i,c,l,u,f,h,p,g=t[0],v=t[1],m=t[2],x=r[0],P=r[1],S=r[2],O=n[0],R=n[1],N=n[2];return Math.abs(g-O)<1e-6&&Math.abs(v-R)<1e-6&&Math.abs(m-N)<1e-6?aq(e):(u=g-O,f=v-R,h=m-N,p=1/Math.sqrt(u*u+f*f+h*h),u*=p,f*=p,h*=p,o=P*h-S*f,a=S*u-x*h,s=x*f-P*u,p=Math.sqrt(o*o+a*a+s*s),p?(p=1/p,o*=p,a*=p,s*=p):(o=0,a=0,s=0),i=f*s-h*a,c=h*o-u*s,l=u*a-f*o,p=Math.sqrt(i*i+c*c+l*l),p?(p=1/p,i*=p,c*=p,l*=p):(i=0,c=0,l=0),e[0]=o,e[1]=i,e[2]=u,e[3]=0,e[4]=a,e[5]=c,e[6]=f,e[7]=0,e[8]=s,e[9]=l,e[10]=h,e[11]=0,e[12]=-(o*g+a*v+s*m),e[13]=-(i*g+c*v+l*m),e[14]=-(u*g+f*v+h*m),e[15]=1,e)}var cq=lq;function lq(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}var Fn={create:sU,clone:cU,copy:uU,identity:s2,transpose:hU,invert:mU,adjoint:gU,determinant:bU,multiply:xU,translate:EU,scale:TU,rotate:SU,rotateX:CU,rotateY:RU,rotateZ:MU,fromRotation:LU,fromRotationTranslation:IU,fromScaling:GU,fromTranslation:zU,fromXRotation:jU,fromYRotation:qU,fromZRotation:HU,fromQuat:YU,frustum:KU,perspective:JU,perspectiveFromFieldOfView:tq,ortho:rq,lookAt:sq,str:cq};const lu=Fn,uq=(e,t={})=>{const{fbo:n}=t,r={cull:{enable:!0},context:{lightDirection:[.2,.2,1]},uniforms:{view:(o,a)=>a.camera.view,eye:(o,a)=>a.camera.position,projection:(o,a)=>a.camera.projection,camNear:(o,a)=>a.camera.near,camFar:(o,a)=>a.camera.far,invertedView:(o,a)=>lu.invert([],a.camera.view),lightPosition:(o,a)=>a&&a.rendering&&a.rendering.lightPosition?a.rendering.lightPosition:[100,200,100],lightDirection:(o,a)=>a&&a.rendering&&a.rendering.lightDirection?a.rendering.lightDirection:o.lightDirection||[0,0,0],lightView:o=>lu.lookAt([],o.lightDirection,[0,0,0],[0,0,1]),lightProjection:lu.ortho([],-25,-25,-20,20,-25,25),lightColor:(o,a)=>a&&a.rendering&&a.rendering.lightColor?a.rendering.lightColor:[1,.8,0],ambientLightAmount:(o,a)=>a&&a.rendering&&a.rendering.ambientLightAmount?a.rendering.ambientLightAmount:.3,diffuseLightAmount:(o,a)=>a&&a.rendering&&a.rendering.diffuseLightAmount?a&&a.rendering&&a.rendering.diffuseLightAmount:.89,specularLightAmount:(o,a)=>a&&a.rendering&&a.rendering.specularLightAmount?a.rendering.specularLightAmount:.16,uMaterialShininess:(o,a)=>a&&a.rendering&&a.rendering.materialShininess?a.rendering.materialShininess:8,materialAmbient:[.5,.8,.3],materialDiffuse:[.5,.8,.3],materialSpecular:[.5,.8,.3]},framebuffer:n};return e(Object.assign({},r,t.extras))};var fq=uq,fc={background:[1,1,1,1],meshColor:[0,.6,1,1],lightColor:[1,1,1,1],lightDirection:[.2,.2,1],lightPosition:[100,200,100],ambientLightAmount:.3,diffuseLightAmount:.89,specularLightAmount:.16,materialShininess:8},uu={exports:{}},rm;function dq(){return rm||(rm=1,function(e,t){(function(n,r){e.exports=r()})(D_,function(){var n=function(d){return d instanceof Uint8Array||d instanceof Uint16Array||d instanceof Uint32Array||d instanceof Int8Array||d instanceof Int16Array||d instanceof Int32Array||d instanceof Float32Array||d instanceof Float64Array||d instanceof Uint8ClampedArray},r=function(d,b){for(var C=Object.keys(b),Y=0;Y<C.length;++Y)d[C[Y]]=b[C[Y]];return d},o=`
`;function a(d){return typeof atob<"u"?atob(d):"base64:"+d}function s(d){var b=new Error("(regl) "+d);throw console.error(b),b}function i(d,b){d||s(b)}function c(d){return d?": "+d:""}function l(d,b,C){d in b||s("unknown parameter ("+d+")"+c(C)+". possible values: "+Object.keys(b).join())}function u(d,b){n(d)||s("invalid parameter type"+c(b)+". must be a typed array")}function f(d,b){switch(b){case"number":return typeof d=="number";case"object":return typeof d=="object";case"string":return typeof d=="string";case"boolean":return typeof d=="boolean";case"function":return typeof d=="function";case"undefined":return typeof d>"u";case"symbol":return typeof d=="symbol"}}function h(d,b,C){f(d,b)||s("invalid parameter type"+c(C)+". expected "+b+", got "+typeof d)}function p(d,b){d>=0&&(d|0)===d||s("invalid parameter type, ("+d+")"+c(b)+". must be a nonnegative integer")}function g(d,b,C){b.indexOf(d)<0&&s("invalid value"+c(C)+". must be one of: "+b)}var v=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function m(d){Object.keys(d).forEach(function(b){v.indexOf(b)<0&&s('invalid regl constructor argument "'+b+'". must be one of '+v)})}function x(d,b){for(d=d+"";d.length<b;)d=" "+d;return d}function P(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function S(d,b){this.number=d,this.line=b,this.errors=[]}function O(d,b,C){this.file=d,this.line=b,this.message=C}function R(){var d=new Error,b=(d.stack||d).toString(),C=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(b);if(C)return C[1];var Y=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(b);return Y?Y[1]:"unknown"}function N(){var d=new Error,b=(d.stack||d).toString(),C=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(b);if(C)return C[1];var Y=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(b);return Y?Y[1]:"unknown"}function I(d,b){var C=d.split(`
`),Y=1,re=0,H={unknown:new P,0:new P};H.unknown.name=H[0].name=b||R(),H.unknown.lines.push(new S(0,""));for(var Q=0;Q<C.length;++Q){var ue=C[Q],le=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(ue);if(le)switch(le[1]){case"line":var ve=/(\d+)(\s+\d+)?/.exec(le[2]);ve&&(Y=ve[1]|0,ve[2]&&(re=ve[2]|0,re in H||(H[re]=new P)));break;case"define":var ye=/SHADER_NAME(_B64)?\s+(.*)$/.exec(le[2]);ye&&(H[re].name=ye[1]?a(ye[2]):ye[2]);break}H[re].lines.push(new S(Y++,ue))}return Object.keys(H).forEach(function(ge){var we=H[ge];we.lines.forEach(function(fe){we.index[fe.number]=fe})}),H}function X(d){var b=[];return d.split(`
`).forEach(function(C){if(!(C.length<5)){var Y=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(C);Y?b.push(new O(Y[1]|0,Y[2]|0,Y[3].trim())):C.length>0&&b.push(new O("unknown",0,C))}}),b}function W(d,b){b.forEach(function(C){var Y=d[C.file];if(Y){var re=Y.index[C.line];if(re){re.errors.push(C),Y.hasErrors=!0;return}}d.unknown.hasErrors=!0,d.unknown.lines[0].errors.push(C)})}function J(d,b,C,Y,re){if(!d.getShaderParameter(b,d.COMPILE_STATUS)){var H=d.getShaderInfoLog(b),Q=Y===d.FRAGMENT_SHADER?"fragment":"vertex";Ve(C,"string",Q+" shader source must be a string",re);var ue=I(C,re),le=X(H);W(ue,le),Object.keys(ue).forEach(function(ve){var ye=ue[ve];if(!ye.hasErrors)return;var ge=[""],we=[""];function fe(me,z){ge.push(me),we.push(z||"")}fe("file number "+ve+": "+ye.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ye.lines.forEach(function(me){if(me.errors.length>0){fe(x(me.number,4)+"|  ","background-color:yellow; font-weight:bold"),fe(me.line+o,"color:red; background-color:yellow; font-weight:bold");var z=0;me.errors.forEach(function(K){var pe=K.message,Oe=/^\s*'(.*)'\s*:\s*(.*)$/.exec(pe);if(Oe){var ie=Oe[1];switch(pe=Oe[2],ie){case"assign":ie="=";break}z=Math.max(me.line.indexOf(ie,z),0)}else z=0;fe(x("| ",6)),fe(x("^^^",z+3)+o,"font-weight:bold"),fe(x("| ",6)),fe(pe+o,"font-weight:bold")}),fe(x("| ",6)+o)}else fe(x(me.number,4)+"|  "),fe(me.line+o,"color:red")}),typeof document<"u"&&!window.chrome?(we[0]=ge.join("%c"),console.log.apply(console,we)):console.log(ge.join(""))}),i.raise("Error compiling "+Q+" shader, "+ue[0].name)}}function G(d,b,C,Y,re){if(!d.getProgramParameter(b,d.LINK_STATUS)){var H=d.getProgramInfoLog(b),Q=I(C,re),ue=I(Y,re),le='Error linking program with vertex shader, "'+ue[0].name+'", and fragment shader "'+Q[0].name+'"';typeof document<"u"?console.log("%c"+le+o+"%c"+H,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(le+o+H),i.raise(le)}}function ce(d){d._commandRef=R()}function _e(d,b,C,Y){ce(d);function re(le){return le?Y.id(le):0}d._fragId=re(d.static.frag),d._vertId=re(d.static.vert);function H(le,ve){Object.keys(ve).forEach(function(ye){le[Y.id(ye)]=!0})}var Q=d._uniformSet={};H(Q,b.static),H(Q,b.dynamic);var ue=d._attributeSet={};H(ue,C.static),H(ue,C.dynamic),d._hasCount="count"in d.static||"count"in d.dynamic||"elements"in d.static||"elements"in d.dynamic}function de(d,b){var C=N();s(d+" in command "+(b||R())+(C==="unknown"?"":" called from "+C))}function De(d,b,C){d||de(b,C||R())}function be(d,b,C,Y){d in b||de("unknown parameter ("+d+")"+c(C)+". possible values: "+Object.keys(b).join(),Y||R())}function Ve(d,b,C,Y){f(d,b)||de("invalid parameter type"+c(C)+". expected "+b+", got "+typeof d,Y||R())}function Fe(d){d()}function et(d,b,C){d.texture?g(d.texture._texture.internalformat,b,"unsupported texture format for attachment"):g(d.renderbuffer._renderbuffer.format,C,"unsupported renderbuffer format for attachment")}var dt=33071,bt=9728,$t=9984,en=9985,sn=9986,cn=9987,Ct=5120,Lt=5121,St=5122,kt=5123,Je=5124,ze=5125,rt=5126,pt=32819,ht=32820,xt=33635,Ut=34042,Mn=36193,_t={};_t[Ct]=_t[Lt]=1,_t[St]=_t[kt]=_t[Mn]=_t[xt]=_t[pt]=_t[ht]=2,_t[Je]=_t[ze]=_t[rt]=_t[Ut]=4;function Gn(d,b){return d===ht||d===pt||d===xt?2:d===Ut?4:_t[d]*b}function Dn(d){return!(d&d-1)&&!!d}function tr(d,b,C){var Y,re=b.width,H=b.height,Q=b.channels;i(re>0&&re<=C.maxTextureSize&&H>0&&H<=C.maxTextureSize,"invalid texture shape"),(d.wrapS!==dt||d.wrapT!==dt)&&i(Dn(re)&&Dn(H),"incompatible wrap mode for texture, both width and height must be power of 2"),b.mipmask===1?re!==1&&H!==1&&i(d.minFilter!==$t&&d.minFilter!==sn&&d.minFilter!==en&&d.minFilter!==cn,"min filter requires mipmap"):(i(Dn(re)&&Dn(H),"texture must be a square power of 2 to support mipmapping"),i(b.mipmask===(re<<1)-1,"missing or incomplete mipmap data")),b.type===rt&&(C.extensions.indexOf("oes_texture_float_linear")<0&&i(d.minFilter===bt&&d.magFilter===bt,"filter not supported, must enable oes_texture_float_linear"),i(!d.genMipmaps,"mipmap generation not supported with float textures"));var ue=b.images;for(Y=0;Y<16;++Y)if(ue[Y]){var le=re>>Y,ve=H>>Y;i(b.mipmask&1<<Y,"missing mipmap data");var ye=ue[Y];if(i(ye.width===le&&ye.height===ve,"invalid shape for mip images"),i(ye.format===b.format&&ye.internalformat===b.internalformat&&ye.type===b.type,"incompatible type for mip image"),!ye.compressed)if(ye.data){var ge=Math.ceil(Gn(ye.type,Q)*le/ye.unpackAlignment)*ye.unpackAlignment;i(ye.data.byteLength===ge*ve,"invalid data for image, buffer size is inconsistent with image format")}else ye.element||ye.copy}else d.genMipmaps||i((b.mipmask&1<<Y)===0,"extra mipmap data");b.compressed&&i(!d.genMipmaps,"mipmap generation for compressed images not supported")}function dr(d,b,C,Y){var re=d.width,H=d.height,Q=d.channels;i(re>0&&re<=Y.maxTextureSize&&H>0&&H<=Y.maxTextureSize,"invalid texture shape"),i(re===H,"cube map must be square"),i(b.wrapS===dt&&b.wrapT===dt,"wrap mode not supported by cube map");for(var ue=0;ue<C.length;++ue){var le=C[ue];i(le.width===re&&le.height===H,"inconsistent cube map face shape"),b.genMipmaps&&(i(!le.compressed,"can not generate mipmap for compressed textures"),i(le.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var ve=le.images,ye=0;ye<16;++ye){var ge=ve[ye];if(ge){var we=re>>ye,fe=H>>ye;i(le.mipmask&1<<ye,"missing mipmap data"),i(ge.width===we&&ge.height===fe,"invalid shape for mip images"),i(ge.format===d.format&&ge.internalformat===d.internalformat&&ge.type===d.type,"incompatible type for mip image"),ge.compressed||(ge.data?i(ge.data.byteLength===we*fe*Math.max(Gn(ge.type,Q),ge.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):ge.element||ge.copy)}}}}var _=r(i,{optional:Fe,raise:s,commandRaise:de,command:De,parameter:l,commandParameter:be,constructor:m,type:h,commandType:Ve,isTypedArray:u,nni:p,oneOf:g,shaderError:J,linkError:G,callSite:N,saveCommandRef:ce,saveDrawInfo:_e,framebufferFormat:et,guessCommand:R,texture2D:tr,textureCube:dr}),Mr=0,yn=0,ua=5,w2=6;function Dr(d,b){this.id=Mr++,this.type=d,this.data=b}function kf(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function fa(d){if(d.length===0)return[];var b=d.charAt(0),C=d.charAt(d.length-1);if(d.length>1&&b===C&&(b==='"'||b==="'"))return['"'+kf(d.substr(1,d.length-2))+'"'];var Y=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(d);if(Y)return fa(d.substr(0,Y.index)).concat(fa(Y[1])).concat(fa(d.substr(Y.index+Y[0].length)));var re=d.split(".");if(re.length===1)return['"'+kf(d)+'"'];for(var H=[],Q=0;Q<re.length;++Q)H=H.concat(fa(re[Q]));return H}function If(d){return"["+fa(d).join("][")+"]"}function E2(d,b){return new Dr(d,If(b+""))}function A2(d){return typeof d=="function"&&!d._reglType||d instanceof Dr}function Ff(d,b){if(typeof d=="function")return new Dr(yn,d);if(typeof d=="number"||typeof d=="boolean")return new Dr(ua,d);if(Array.isArray(d))return new Dr(w2,d.map(function(C,Y){return Ff(C,b+"["+Y+"]")}));if(d instanceof Dr)return d;_(!1,"invalid option type in uniform "+b)}var Tn={DynamicVariable:Dr,define:E2,isDynamic:A2,unbox:Ff,accessor:If},dc={next:typeof requestAnimationFrame=="function"?function(d){return requestAnimationFrame(d)}:function(d){return setTimeout(d,16)},cancel:typeof cancelAnimationFrame=="function"?function(d){return cancelAnimationFrame(d)}:clearTimeout},Gf=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function T2(){var d={"":0},b=[""];return{id:function(C){var Y=d[C];return Y||(Y=d[C]=b.length,b.push(C),Y)},str:function(C){return b[C]}}}function $2(d,b,C){var Y=document.createElement("canvas");r(Y.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),d.appendChild(Y),d===document.body&&(Y.style.position="absolute",r(d.style,{margin:0,padding:0}));function re(){var ue=window.innerWidth,le=window.innerHeight;if(d!==document.body){var ve=Y.getBoundingClientRect();ue=ve.right-ve.left,le=ve.bottom-ve.top}Y.width=C*ue,Y.height=C*le}var H;d!==document.body&&typeof ResizeObserver=="function"?(H=new ResizeObserver(function(){setTimeout(re)}),H.observe(d)):window.addEventListener("resize",re,!1);function Q(){H?H.disconnect():window.removeEventListener("resize",re),d.removeChild(Y)}return re(),{canvas:Y,onDestroy:Q}}function S2(d,b){function C(Y){try{return d.getContext(Y,b)}catch{return null}}return C("webgl")||C("experimental-webgl")||C("webgl-experimental")}function P2(d){return typeof d.nodeName=="string"&&typeof d.appendChild=="function"&&typeof d.getBoundingClientRect=="function"}function C2(d){return typeof d.drawArrays=="function"||typeof d.drawElements=="function"}function Bf(d){return typeof d=="string"?d.split():(_(Array.isArray(d),"invalid extension array"),d)}function zf(d){return typeof d=="string"?(_(typeof document<"u","not supported outside of DOM"),document.querySelector(d)):d}function O2(d){var b=d||{},C,Y,re,H,Q={},ue=[],le=[],ve=typeof window>"u"?1:window.devicePixelRatio,ye=!1,ge=function(me){me&&_.raise(me)},we=function(){};if(typeof b=="string"?(_(typeof document<"u","selector queries only supported in DOM enviroments"),C=document.querySelector(b),_(C,"invalid query string for element")):typeof b=="object"?P2(b)?C=b:C2(b)?(H=b,re=H.canvas):(_.constructor(b),"gl"in b?H=b.gl:"canvas"in b?re=zf(b.canvas):"container"in b&&(Y=zf(b.container)),"attributes"in b&&(Q=b.attributes,_.type(Q,"object","invalid context attributes")),"extensions"in b&&(ue=Bf(b.extensions)),"optionalExtensions"in b&&(le=Bf(b.optionalExtensions)),"onDone"in b&&(_.type(b.onDone,"function","invalid or missing onDone callback"),ge=b.onDone),"profile"in b&&(ye=!!b.profile),"pixelRatio"in b&&(ve=+b.pixelRatio,_(ve>0,"invalid pixel ratio"))):_.raise("invalid arguments to regl"),C&&(C.nodeName.toLowerCase()==="canvas"?re=C:Y=C),!H){if(!re){_(typeof document<"u","must manually specify webgl context outside of DOM environments");var fe=$2(Y||document.body,ge,ve);if(!fe)return null;re=fe.canvas,we=fe.onDestroy}Q.premultipliedAlpha===void 0&&(Q.premultipliedAlpha=!0),H=S2(re,Q)}return H?{gl:H,canvas:re,container:Y,extensions:ue,optionalExtensions:le,pixelRatio:ve,profile:ye,onDone:ge,onDestroy:we}:(we(),ge("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function R2(d,b){var C={};function Y(Q){_.type(Q,"string","extension name must be string");var ue=Q.toLowerCase(),le;try{le=C[ue]=d.getExtension(ue)}catch{}return!!le}for(var re=0;re<b.extensions.length;++re){var H=b.extensions[re];if(!Y(H))return b.onDestroy(),b.onDone('"'+H+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return b.optionalExtensions.forEach(Y),{extensions:C,restore:function(){Object.keys(C).forEach(function(Q){if(C[Q]&&!Y(Q))throw new Error("(regl): error restoring extension "+Q)})}}}function $n(d,b){for(var C=Array(d),Y=0;Y<d;++Y)C[Y]=b(Y);return C}var N2=5120,M2=5121,D2=5122,L2=5123,k2=5124,I2=5125,F2=5126;function G2(d){for(var b=16;b<=1<<28;b*=16)if(d<=b)return b;return 0}function Vf(d){var b,C;return b=(d>65535)<<4,d>>>=b,C=(d>255)<<3,d>>>=C,b|=C,C=(d>15)<<2,d>>>=C,b|=C,C=(d>3)<<1,d>>>=C,b|=C,b|d>>1}function jf(){var d=$n(8,function(){return[]});function b(H){var Q=G2(H),ue=d[Vf(Q)>>2];return ue.length>0?ue.pop():new ArrayBuffer(Q)}function C(H){d[Vf(H.byteLength)>>2].push(H)}function Y(H,Q){var ue=null;switch(H){case N2:ue=new Int8Array(b(Q),0,Q);break;case M2:ue=new Uint8Array(b(Q),0,Q);break;case D2:ue=new Int16Array(b(2*Q),0,Q);break;case L2:ue=new Uint16Array(b(2*Q),0,Q);break;case k2:ue=new Int32Array(b(4*Q),0,Q);break;case I2:ue=new Uint32Array(b(4*Q),0,Q);break;case F2:ue=new Float32Array(b(4*Q),0,Q);break;default:return null}return ue.length!==Q?ue.subarray(0,Q):ue}function re(H){C(H.buffer)}return{alloc:b,free:C,allocType:Y,freeType:re}}var Bt=jf();Bt.zero=jf();var B2=3408,z2=3410,V2=3411,j2=3412,U2=3413,q2=3414,X2=3415,H2=33901,W2=33902,Y2=3379,Z2=3386,K2=34921,Q2=36347,J2=36348,ey=35661,ty=35660,ny=34930,ry=36349,oy=34076,ay=34024,sy=7936,iy=7937,cy=7938,ly=35724,uy=34047,fy=36063,dy=34852,ds=3553,Uf=34067,hy=34069,py=33984,da=6408,hc=5126,qf=5121,pc=36160,my=36053,vy=36064,gy=16384,yy=function(d,b){var C=1;b.ext_texture_filter_anisotropic&&(C=d.getParameter(uy));var Y=1,re=1;b.webgl_draw_buffers&&(Y=d.getParameter(dy),re=d.getParameter(fy));var H=!!b.oes_texture_float;if(H){var Q=d.createTexture();d.bindTexture(ds,Q),d.texImage2D(ds,0,da,1,1,0,da,hc,null);var ue=d.createFramebuffer();if(d.bindFramebuffer(pc,ue),d.framebufferTexture2D(pc,vy,ds,Q,0),d.bindTexture(ds,null),d.checkFramebufferStatus(pc)!==my)H=!1;else{d.viewport(0,0,1,1),d.clearColor(1,0,0,1),d.clear(gy);var le=Bt.allocType(hc,4);d.readPixels(0,0,1,1,da,hc,le),d.getError()?H=!1:(d.deleteFramebuffer(ue),d.deleteTexture(Q),H=le[0]===1),Bt.freeType(le)}}var ve=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ye=!0;if(!ve){var ge=d.createTexture(),we=Bt.allocType(qf,36);d.activeTexture(py),d.bindTexture(Uf,ge),d.texImage2D(hy,0,da,3,3,0,da,qf,we),Bt.freeType(we),d.bindTexture(Uf,null),d.deleteTexture(ge),ye=!d.getError()}return{colorBits:[d.getParameter(z2),d.getParameter(V2),d.getParameter(j2),d.getParameter(U2)],depthBits:d.getParameter(q2),stencilBits:d.getParameter(X2),subpixelBits:d.getParameter(B2),extensions:Object.keys(b).filter(function(fe){return!!b[fe]}),maxAnisotropic:C,maxDrawbuffers:Y,maxColorAttachments:re,pointSizeDims:d.getParameter(H2),lineWidthDims:d.getParameter(W2),maxViewportDims:d.getParameter(Z2),maxCombinedTextureUnits:d.getParameter(ey),maxCubeMapSize:d.getParameter(oy),maxRenderbufferSize:d.getParameter(ay),maxTextureUnits:d.getParameter(ny),maxTextureSize:d.getParameter(Y2),maxAttributes:d.getParameter(K2),maxVertexUniforms:d.getParameter(Q2),maxVertexTextureUnits:d.getParameter(ty),maxVaryingVectors:d.getParameter(J2),maxFragmentUniforms:d.getParameter(ry),glsl:d.getParameter(ly),renderer:d.getParameter(iy),vendor:d.getParameter(sy),version:d.getParameter(cy),readFloat:H,npotTextureCube:ye}};function Bn(d){return!!d&&typeof d=="object"&&Array.isArray(d.shape)&&Array.isArray(d.stride)&&typeof d.offset=="number"&&d.shape.length===d.stride.length&&(Array.isArray(d.data)||n(d.data))}var Sn=function(d){return Object.keys(d).map(function(b){return d[b]})},hs={shape:wy,flatten:xy};function by(d,b,C){for(var Y=0;Y<b;++Y)C[Y]=d[Y]}function _y(d,b,C,Y){for(var re=0,H=0;H<b;++H)for(var Q=d[H],ue=0;ue<C;++ue)Y[re++]=Q[ue]}function Xf(d,b,C,Y,re,H){for(var Q=H,ue=0;ue<b;++ue)for(var le=d[ue],ve=0;ve<C;++ve)for(var ye=le[ve],ge=0;ge<Y;++ge)re[Q++]=ye[ge]}function Hf(d,b,C,Y,re){for(var H=1,Q=C+1;Q<b.length;++Q)H*=b[Q];var ue=b[C];if(b.length-C===4){var le=b[C+1],ve=b[C+2],ye=b[C+3];for(Q=0;Q<ue;++Q)Xf(d[Q],le,ve,ye,Y,re),re+=H}else for(Q=0;Q<ue;++Q)Hf(d[Q],b,C+1,Y,re),re+=H}function xy(d,b,C,Y){var re=1;if(b.length)for(var H=0;H<b.length;++H)re*=b[H];else re=0;var Q=Y||Bt.allocType(C,re);switch(b.length){case 0:break;case 1:by(d,b[0],Q);break;case 2:_y(d,b[0],b[1],Q);break;case 3:Xf(d,b[0],b[1],b[2],Q,0);break;default:Hf(d,b,0,Q,0)}return Q}function wy(d){for(var b=[],C=d;C.length;C=C[0])b.push(C.length);return b}var mc={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ey=5120,Ay=5122,Ty=5124,$y=5121,Sy=5123,Py=5125,Cy=5126,Oy=5126,Lr={int8:Ey,int16:Ay,int32:Ty,uint8:$y,uint16:Sy,uint32:Py,float:Cy,float32:Oy},Ry=35048,Ny=35040,ps={dynamic:Ry,stream:Ny,static:35044},vc=hs.flatten,Wf=hs.shape,Yf=35044,My=35040,gc=5121,yc=5126,hr=[];hr[5120]=1,hr[5122]=2,hr[5124]=4,hr[5121]=1,hr[5123]=2,hr[5125]=4,hr[5126]=4;function ms(d){return mc[Object.prototype.toString.call(d)]|0}function Zf(d,b){for(var C=0;C<b.length;++C)d[C]=b[C]}function Kf(d,b,C,Y,re,H,Q){for(var ue=0,le=0;le<C;++le)for(var ve=0;ve<Y;++ve)d[ue++]=b[re*le+H*ve+Q]}function Dy(d,b,C,Y){var re=0,H={};function Q(z){this.id=re++,this.buffer=d.createBuffer(),this.type=z,this.usage=Yf,this.byteLength=0,this.dimension=1,this.dtype=gc,this.persistentData=null,C.profile&&(this.stats={size:0})}Q.prototype.bind=function(){d.bindBuffer(this.type,this.buffer)},Q.prototype.destroy=function(){we(this)};var ue=[];function le(z,K){var pe=ue.pop();return pe||(pe=new Q(z)),pe.bind(),ge(pe,K,My,0,1,!1),pe}function ve(z){ue.push(z)}function ye(z,K,pe){z.byteLength=K.byteLength,d.bufferData(z.type,K,pe)}function ge(z,K,pe,Oe,ie,Pe){var $e;if(z.usage=pe,Array.isArray(K)){if(z.dtype=Oe||yc,K.length>0){var Be;if(Array.isArray(K[0])){$e=Wf(K);for(var oe=1,ne=1;ne<$e.length;++ne)oe*=$e[ne];z.dimension=oe,Be=vc(K,$e,z.dtype),ye(z,Be,pe),Pe?z.persistentData=Be:Bt.freeType(Be)}else if(typeof K[0]=="number"){z.dimension=ie;var Me=Bt.allocType(z.dtype,K.length);Zf(Me,K),ye(z,Me,pe),Pe?z.persistentData=Me:Bt.freeType(Me)}else n(K[0])?(z.dimension=K[0].length,z.dtype=Oe||ms(K[0])||yc,Be=vc(K,[K.length,K[0].length],z.dtype),ye(z,Be,pe),Pe?z.persistentData=Be:Bt.freeType(Be)):_.raise("invalid buffer data")}}else if(n(K))z.dtype=Oe||ms(K),z.dimension=ie,ye(z,K,pe),Pe&&(z.persistentData=new Uint8Array(new Uint8Array(K.buffer)));else if(Bn(K)){$e=K.shape;var Ee=K.stride,he=K.offset,Ae=0,Te=0,Ke=0,Ye=0;$e.length===1?(Ae=$e[0],Te=1,Ke=Ee[0],Ye=0):$e.length===2?(Ae=$e[0],Te=$e[1],Ke=Ee[0],Ye=Ee[1]):_.raise("invalid shape"),z.dtype=Oe||ms(K.data)||yc,z.dimension=Te;var Se=Bt.allocType(z.dtype,Ae*Te);Kf(Se,K.data,Ae,Te,Ke,Ye,he),ye(z,Se,pe),Pe?z.persistentData=Se:Bt.freeType(Se)}else K instanceof ArrayBuffer?(z.dtype=gc,z.dimension=ie,ye(z,K,pe),Pe&&(z.persistentData=new Uint8Array(new Uint8Array(K)))):_.raise("invalid buffer data")}function we(z){b.bufferCount--,Y(z);var K=z.buffer;_(K,"buffer must not be deleted already"),d.deleteBuffer(K),z.buffer=null,delete H[z.id]}function fe(z,K,pe,Oe){b.bufferCount++;var ie=new Q(K);H[ie.id]=ie;function Pe(oe){var ne=Yf,Me=null,Ee=0,he=0,Ae=1;return Array.isArray(oe)||n(oe)||Bn(oe)||oe instanceof ArrayBuffer?Me=oe:typeof oe=="number"?Ee=oe|0:oe&&(_.type(oe,"object","buffer arguments must be an object, a number or an array"),"data"in oe&&(_(Me===null||Array.isArray(Me)||n(Me)||Bn(Me),"invalid data for buffer"),Me=oe.data),"usage"in oe&&(_.parameter(oe.usage,ps,"invalid buffer usage"),ne=ps[oe.usage]),"type"in oe&&(_.parameter(oe.type,Lr,"invalid buffer type"),he=Lr[oe.type]),"dimension"in oe&&(_.type(oe.dimension,"number","invalid dimension"),Ae=oe.dimension|0),"length"in oe&&(_.nni(Ee,"buffer length must be a nonnegative integer"),Ee=oe.length|0)),ie.bind(),Me?ge(ie,Me,ne,he,Ae,Oe):(Ee&&d.bufferData(ie.type,Ee,ne),ie.dtype=he||gc,ie.usage=ne,ie.dimension=Ae,ie.byteLength=Ee),C.profile&&(ie.stats.size=ie.byteLength*hr[ie.dtype]),Pe}function $e(oe,ne){_(ne+oe.byteLength<=ie.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+oe.byteLength+" starting from offset "+ne+" to a buffer of size "+ie.byteLength),d.bufferSubData(ie.type,ne,oe)}function Be(oe,ne){var Me=(ne||0)|0,Ee;if(ie.bind(),n(oe)||oe instanceof ArrayBuffer)$e(oe,Me);else if(Array.isArray(oe)){if(oe.length>0)if(typeof oe[0]=="number"){var he=Bt.allocType(ie.dtype,oe.length);Zf(he,oe),$e(he,Me),Bt.freeType(he)}else if(Array.isArray(oe[0])||n(oe[0])){Ee=Wf(oe);var Ae=vc(oe,Ee,ie.dtype);$e(Ae,Me),Bt.freeType(Ae)}else _.raise("invalid buffer data")}else if(Bn(oe)){Ee=oe.shape;var Te=oe.stride,Ke=0,Ye=0,Se=0,Ce=0;Ee.length===1?(Ke=Ee[0],Ye=1,Se=Te[0],Ce=0):Ee.length===2?(Ke=Ee[0],Ye=Ee[1],Se=Te[0],Ce=Te[1]):_.raise("invalid shape");var Ue=Array.isArray(oe.data)?ie.dtype:ms(oe.data),Qe=Bt.allocType(Ue,Ke*Ye);Kf(Qe,oe.data,Ke,Ye,Se,Ce,oe.offset),$e(Qe,Me),Bt.freeType(Qe)}else _.raise("invalid data for buffer subdata");return Pe}return pe||Pe(z),Pe._reglType="buffer",Pe._buffer=ie,Pe.subdata=Be,C.profile&&(Pe.stats=ie.stats),Pe.destroy=function(){we(ie)},Pe}function me(){Sn(H).forEach(function(z){z.buffer=d.createBuffer(),d.bindBuffer(z.type,z.buffer),d.bufferData(z.type,z.persistentData||z.byteLength,z.usage)})}return C.profile&&(b.getTotalBufferSize=function(){var z=0;return Object.keys(H).forEach(function(K){z+=H[K].stats.size}),z}),{create:fe,createStream:le,destroyStream:ve,clear:function(){Sn(H).forEach(we),ue.forEach(we)},getBuffer:function(z){return z&&z._buffer instanceof Q?z._buffer:null},restore:me,_initBuffer:ge}}var Ly=0,ky=0,Iy=1,Fy=1,Gy=4,By=4,pr={points:Ly,point:ky,lines:Iy,line:Fy,triangles:Gy,triangle:By,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},zy=0,Vy=1,ha=4,jy=5120,mo=5121,Qf=5122,vo=5123,Jf=5124,kr=5125,bc=34963,Uy=35040,qy=35044;function Xy(d,b,C,Y){var re={},H=0,Q={uint8:mo,uint16:vo};b.oes_element_index_uint&&(Q.uint32=kr);function ue(me){this.id=H++,re[this.id]=this,this.buffer=me,this.primType=ha,this.vertCount=0,this.type=0}ue.prototype.bind=function(){this.buffer.bind()};var le=[];function ve(me){var z=le.pop();return z||(z=new ue(C.create(null,bc,!0,!1)._buffer)),ge(z,me,Uy,-1,-1,0,0),z}function ye(me){le.push(me)}function ge(me,z,K,pe,Oe,ie,Pe){me.buffer.bind();var $e;if(z){var Be=Pe;!Pe&&(!n(z)||Bn(z)&&!n(z.data))&&(Be=b.oes_element_index_uint?kr:vo),C._initBuffer(me.buffer,z,K,Be,3)}else d.bufferData(bc,ie,K),me.buffer.dtype=$e||mo,me.buffer.usage=K,me.buffer.dimension=3,me.buffer.byteLength=ie;if($e=Pe,!Pe){switch(me.buffer.dtype){case mo:case jy:$e=mo;break;case vo:case Qf:$e=vo;break;case kr:case Jf:$e=kr;break;default:_.raise("unsupported type for element array")}me.buffer.dtype=$e}me.type=$e,_($e!==kr||!!b.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var oe=Oe;oe<0&&(oe=me.buffer.byteLength,$e===vo?oe>>=1:$e===kr&&(oe>>=2)),me.vertCount=oe;var ne=pe;if(pe<0){ne=ha;var Me=me.buffer.dimension;Me===1&&(ne=zy),Me===2&&(ne=Vy),Me===3&&(ne=ha)}me.primType=ne}function we(me){Y.elementsCount--,_(me.buffer!==null,"must not double destroy elements"),delete re[me.id],me.buffer.destroy(),me.buffer=null}function fe(me,z){var K=C.create(null,bc,!0),pe=new ue(K._buffer);Y.elementsCount++;function Oe(ie){if(!ie)K(),pe.primType=ha,pe.vertCount=0,pe.type=mo;else if(typeof ie=="number")K(ie),pe.primType=ha,pe.vertCount=ie|0,pe.type=mo;else{var Pe=null,$e=qy,Be=-1,oe=-1,ne=0,Me=0;Array.isArray(ie)||n(ie)||Bn(ie)?Pe=ie:(_.type(ie,"object","invalid arguments for elements"),"data"in ie&&(Pe=ie.data,_(Array.isArray(Pe)||n(Pe)||Bn(Pe),"invalid data for element buffer")),"usage"in ie&&(_.parameter(ie.usage,ps,"invalid element buffer usage"),$e=ps[ie.usage]),"primitive"in ie&&(_.parameter(ie.primitive,pr,"invalid element buffer primitive"),Be=pr[ie.primitive]),"count"in ie&&(_(typeof ie.count=="number"&&ie.count>=0,"invalid vertex count for elements"),oe=ie.count|0),"type"in ie&&(_.parameter(ie.type,Q,"invalid buffer type"),Me=Q[ie.type]),"length"in ie?ne=ie.length|0:(ne=oe,Me===vo||Me===Qf?ne*=2:(Me===kr||Me===Jf)&&(ne*=4))),ge(pe,Pe,$e,Be,oe,ne,Me)}return Oe}return Oe(me),Oe._reglType="elements",Oe._elements=pe,Oe.subdata=function(ie,Pe){return K.subdata(ie,Pe),Oe},Oe.destroy=function(){we(pe)},Oe}return{create:fe,createStream:ve,destroyStream:ye,getElements:function(me){return typeof me=="function"&&me._elements instanceof ue?me._elements:null},clear:function(){Sn(re).forEach(we)}}}var ed=new Float32Array(1),Hy=new Uint32Array(ed.buffer),Wy=5123;function td(d){for(var b=Bt.allocType(Wy,d.length),C=0;C<d.length;++C)if(isNaN(d[C]))b[C]=65535;else if(d[C]===1/0)b[C]=31744;else if(d[C]===-1/0)b[C]=64512;else{ed[0]=d[C];var Y=Hy[0],re=Y>>>31<<15,H=(Y<<1>>>24)-127,Q=Y>>13&1024-1;if(H<-24)b[C]=re;else if(H<-14){var ue=-14-H;b[C]=re+(Q+1024>>ue)}else H>15?b[C]=re+31744:b[C]=re+(H+15<<10)+Q}return b}function Ot(d){return Array.isArray(d)||n(d)}var nd=function(d){return!(d&d-1)&&!!d},Yy=34467,qn=3553,_c=34067,vs=34069,Ir=6408,xc=6406,gs=6407,pa=6409,ys=6410,rd=32854,wc=32855,od=36194,Zy=32819,Ky=32820,Qy=33635,Jy=34042,Ec=6402,bs=34041,Ac=35904,Tc=35906,go=36193,$c=33776,Sc=33777,Pc=33778,Cc=33779,ad=35986,sd=35987,id=34798,cd=35840,ld=35841,ud=35842,fd=35843,dd=36196,yo=5121,Oc=5123,Rc=5125,ma=5126,eb=10242,tb=10243,nb=10497,Nc=33071,rb=33648,ob=10240,ab=10241,Mc=9728,sb=9729,Dc=9984,hd=9985,pd=9986,Lc=9987,ib=33170,_s=4352,cb=4353,lb=4354,ub=34046,fb=3317,db=37440,hb=37441,pb=37443,md=37444,va=33984,mb=[Dc,pd,hd,Lc],xs=[0,pa,ys,gs,Ir],Ln={};Ln[pa]=Ln[xc]=Ln[Ec]=1,Ln[bs]=Ln[ys]=2,Ln[gs]=Ln[Ac]=3,Ln[Ir]=Ln[Tc]=4;function bo(d){return"[object "+d+"]"}var vd=bo("HTMLCanvasElement"),gd=bo("OffscreenCanvas"),yd=bo("CanvasRenderingContext2D"),bd=bo("ImageBitmap"),_d=bo("HTMLImageElement"),xd=bo("HTMLVideoElement"),vb=Object.keys(mc).concat([vd,gd,yd,bd,_d,xd]),_o=[];_o[yo]=1,_o[ma]=4,_o[go]=2,_o[Oc]=2,_o[Rc]=4;var tn=[];tn[rd]=2,tn[wc]=2,tn[od]=2,tn[bs]=4,tn[$c]=.5,tn[Sc]=.5,tn[Pc]=1,tn[Cc]=1,tn[ad]=.5,tn[sd]=1,tn[id]=1,tn[cd]=.5,tn[ld]=.25,tn[ud]=.5,tn[fd]=.25,tn[dd]=.5;function wd(d){return Array.isArray(d)&&(d.length===0||typeof d[0]=="number")}function Ed(d){if(!Array.isArray(d))return!1;var b=d.length;return!(b===0||!Ot(d[0]))}function Fr(d){return Object.prototype.toString.call(d)}function Ad(d){return Fr(d)===vd}function Td(d){return Fr(d)===gd}function gb(d){return Fr(d)===yd}function yb(d){return Fr(d)===bd}function bb(d){return Fr(d)===_d}function _b(d){return Fr(d)===xd}function kc(d){if(!d)return!1;var b=Fr(d);return vb.indexOf(b)>=0?!0:wd(d)||Ed(d)||Bn(d)}function $d(d){return mc[Object.prototype.toString.call(d)]|0}function xb(d,b){var C=b.length;switch(d.type){case yo:case Oc:case Rc:case ma:var Y=Bt.allocType(d.type,C);Y.set(b),d.data=Y;break;case go:d.data=td(b);break;default:_.raise("unsupported texture type, must specify a typed array")}}function Sd(d,b){return Bt.allocType(d.type===go?ma:d.type,b)}function Pd(d,b){d.type===go?(d.data=td(b),Bt.freeType(b)):d.data=b}function wb(d,b,C,Y,re,H){for(var Q=d.width,ue=d.height,le=d.channels,ve=Q*ue*le,ye=Sd(d,ve),ge=0,we=0;we<ue;++we)for(var fe=0;fe<Q;++fe)for(var me=0;me<le;++me)ye[ge++]=b[C*fe+Y*we+re*me+H];Pd(d,ye)}function ws(d,b,C,Y,re,H){var Q;if(typeof tn[d]<"u"?Q=tn[d]:Q=Ln[d]*_o[b],H&&(Q*=6),re){for(var ue=0,le=C;le>=1;)ue+=Q*le*le,le/=2;return ue}else return Q*C*Y}function Eb(d,b,C,Y,re,H,Q){var ue={"don't care":_s,"dont care":_s,nice:lb,fast:cb},le={repeat:nb,clamp:Nc,mirror:rb},ve={nearest:Mc,linear:sb},ye=r({mipmap:Lc,"nearest mipmap nearest":Dc,"linear mipmap nearest":hd,"nearest mipmap linear":pd,"linear mipmap linear":Lc},ve),ge={none:0,browser:md},we={uint8:yo,rgba4:Zy,rgb565:Qy,"rgb5 a1":Ky},fe={alpha:xc,luminance:pa,"luminance alpha":ys,rgb:gs,rgba:Ir,rgba4:rd,"rgb5 a1":wc,rgb565:od},me={};b.ext_srgb&&(fe.srgb=Ac,fe.srgba=Tc),b.oes_texture_float&&(we.float32=we.float=ma),b.oes_texture_half_float&&(we.float16=we["half float"]=go),b.webgl_depth_texture&&(r(fe,{depth:Ec,"depth stencil":bs}),r(we,{uint16:Oc,uint32:Rc,"depth stencil":Jy})),b.webgl_compressed_texture_s3tc&&r(me,{"rgb s3tc dxt1":$c,"rgba s3tc dxt1":Sc,"rgba s3tc dxt3":Pc,"rgba s3tc dxt5":Cc}),b.webgl_compressed_texture_atc&&r(me,{"rgb atc":ad,"rgba atc explicit alpha":sd,"rgba atc interpolated alpha":id}),b.webgl_compressed_texture_pvrtc&&r(me,{"rgb pvrtc 4bppv1":cd,"rgb pvrtc 2bppv1":ld,"rgba pvrtc 4bppv1":ud,"rgba pvrtc 2bppv1":fd}),b.webgl_compressed_texture_etc1&&(me["rgb etc1"]=dd);var z=Array.prototype.slice.call(d.getParameter(Yy));Object.keys(me).forEach(function(T){var Z=me[T];z.indexOf(Z)>=0&&(fe[T]=Z)});var K=Object.keys(fe);C.textureFormats=K;var pe=[];Object.keys(fe).forEach(function(T){var Z=fe[T];pe[Z]=T});var Oe=[];Object.keys(we).forEach(function(T){var Z=we[T];Oe[Z]=T});var ie=[];Object.keys(ve).forEach(function(T){var Z=ve[T];ie[Z]=T});var Pe=[];Object.keys(ye).forEach(function(T){var Z=ye[T];Pe[Z]=T});var $e=[];Object.keys(le).forEach(function(T){var Z=le[T];$e[Z]=T});var Be=K.reduce(function(T,Z){var q=fe[Z];return q===pa||q===xc||q===pa||q===ys||q===Ec||q===bs||b.ext_srgb&&(q===Ac||q===Tc)?T[q]=q:q===wc||Z.indexOf("rgba")>=0?T[q]=Ir:T[q]=gs,T},{});function oe(){this.internalformat=Ir,this.format=Ir,this.type=yo,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=md,this.width=0,this.height=0,this.channels=0}function ne(T,Z){T.internalformat=Z.internalformat,T.format=Z.format,T.type=Z.type,T.compressed=Z.compressed,T.premultiplyAlpha=Z.premultiplyAlpha,T.flipY=Z.flipY,T.unpackAlignment=Z.unpackAlignment,T.colorSpace=Z.colorSpace,T.width=Z.width,T.height=Z.height,T.channels=Z.channels}function Me(T,Z){if(!(typeof Z!="object"||!Z)){if("premultiplyAlpha"in Z&&(_.type(Z.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),T.premultiplyAlpha=Z.premultiplyAlpha),"flipY"in Z&&(_.type(Z.flipY,"boolean","invalid texture flip"),T.flipY=Z.flipY),"alignment"in Z&&(_.oneOf(Z.alignment,[1,2,4,8],"invalid texture unpack alignment"),T.unpackAlignment=Z.alignment),"colorSpace"in Z&&(_.parameter(Z.colorSpace,ge,"invalid colorSpace"),T.colorSpace=ge[Z.colorSpace]),"type"in Z){var q=Z.type;_(b.oes_texture_float||!(q==="float"||q==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),_(b.oes_texture_half_float||!(q==="half float"||q==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),_(b.webgl_depth_texture||!(q==="uint16"||q==="uint32"||q==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),_.parameter(q,we,"invalid texture type"),T.type=we[q]}var Ne=T.width,ot=T.height,w=T.channels,y=!1;"shape"in Z?(_(Array.isArray(Z.shape)&&Z.shape.length>=2,"shape must be an array"),Ne=Z.shape[0],ot=Z.shape[1],Z.shape.length===3&&(w=Z.shape[2],_(w>0&&w<=4,"invalid number of channels"),y=!0),_(Ne>=0&&Ne<=C.maxTextureSize,"invalid width"),_(ot>=0&&ot<=C.maxTextureSize,"invalid height")):("radius"in Z&&(Ne=ot=Z.radius,_(Ne>=0&&Ne<=C.maxTextureSize,"invalid radius")),"width"in Z&&(Ne=Z.width,_(Ne>=0&&Ne<=C.maxTextureSize,"invalid width")),"height"in Z&&(ot=Z.height,_(ot>=0&&ot<=C.maxTextureSize,"invalid height")),"channels"in Z&&(w=Z.channels,_(w>0&&w<=4,"invalid number of channels"),y=!0)),T.width=Ne|0,T.height=ot|0,T.channels=w|0;var M=!1;if("format"in Z){var B=Z.format;_(b.webgl_depth_texture||!(B==="depth"||B==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),_.parameter(B,fe,"invalid texture format");var V=T.internalformat=fe[B];T.format=Be[V],B in we&&("type"in Z||(T.type=we[B])),B in me&&(T.compressed=!0),M=!0}!y&&M?T.channels=Ln[T.format]:y&&!M?T.channels!==xs[T.format]&&(T.format=T.internalformat=xs[T.channels]):M&&y&&_(T.channels===Ln[T.format],"number of channels inconsistent with specified format")}}function Ee(T){d.pixelStorei(db,T.flipY),d.pixelStorei(hb,T.premultiplyAlpha),d.pixelStorei(pb,T.colorSpace),d.pixelStorei(fb,T.unpackAlignment)}function he(){oe.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Ae(T,Z){var q=null;if(kc(Z)?q=Z:Z&&(_.type(Z,"object","invalid pixel data type"),Me(T,Z),"x"in Z&&(T.xOffset=Z.x|0),"y"in Z&&(T.yOffset=Z.y|0),kc(Z.data)&&(q=Z.data)),_(!T.compressed||q instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Z.copy){_(!q,"can not specify copy and data field for the same texture");var Ne=re.viewportWidth,ot=re.viewportHeight;T.width=T.width||Ne-T.xOffset,T.height=T.height||ot-T.yOffset,T.needsCopy=!0,_(T.xOffset>=0&&T.xOffset<Ne&&T.yOffset>=0&&T.yOffset<ot&&T.width>0&&T.width<=Ne&&T.height>0&&T.height<=ot,"copy texture read out of bounds")}else if(!q)T.width=T.width||1,T.height=T.height||1,T.channels=T.channels||4;else if(n(q))T.channels=T.channels||4,T.data=q,!("type"in Z)&&T.type===yo&&(T.type=$d(q));else if(wd(q))T.channels=T.channels||4,xb(T,q),T.alignment=1,T.needsFree=!0;else if(Bn(q)){var w=q.data;!Array.isArray(w)&&T.type===yo&&(T.type=$d(w));var y=q.shape,M=q.stride,B,V,k,D,F,E;y.length===3?(k=y[2],E=M[2]):(_(y.length===2,"invalid ndarray pixel data, must be 2 or 3D"),k=1,E=1),B=y[0],V=y[1],D=M[0],F=M[1],T.alignment=1,T.width=B,T.height=V,T.channels=k,T.format=T.internalformat=xs[k],T.needsFree=!0,wb(T,w,D,F,E,q.offset)}else if(Ad(q)||Td(q)||gb(q))Ad(q)||Td(q)?T.element=q:T.element=q.canvas,T.width=T.element.width,T.height=T.element.height,T.channels=4;else if(yb(q))T.element=q,T.width=q.width,T.height=q.height,T.channels=4;else if(bb(q))T.element=q,T.width=q.naturalWidth,T.height=q.naturalHeight,T.channels=4;else if(_b(q))T.element=q,T.width=q.videoWidth,T.height=q.videoHeight,T.channels=4;else if(Ed(q)){var $=T.width||q[0].length,A=T.height||q.length,U=T.channels;Ot(q[0][0])?U=U||q[0][0].length:U=U||1;for(var j=hs.shape(q),te=1,ae=0;ae<j.length;++ae)te*=j[ae];var xe=Sd(T,te);hs.flatten(q,j,"",xe),Pd(T,xe),T.alignment=1,T.width=$,T.height=A,T.channels=U,T.format=T.internalformat=xs[U],T.needsFree=!0}T.type===ma?_(C.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):T.type===go&&_(C.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Te(T,Z,q){var Ne=T.element,ot=T.data,w=T.internalformat,y=T.format,M=T.type,B=T.width,V=T.height;Ee(T),Ne?d.texImage2D(Z,q,y,y,M,Ne):T.compressed?d.compressedTexImage2D(Z,q,w,B,V,0,ot):T.needsCopy?(Y(),d.copyTexImage2D(Z,q,y,T.xOffset,T.yOffset,B,V,0)):d.texImage2D(Z,q,y,B,V,0,y,M,ot||null)}function Ke(T,Z,q,Ne,ot){var w=T.element,y=T.data,M=T.internalformat,B=T.format,V=T.type,k=T.width,D=T.height;Ee(T),w?d.texSubImage2D(Z,ot,q,Ne,B,V,w):T.compressed?d.compressedTexSubImage2D(Z,ot,q,Ne,M,k,D,y):T.needsCopy?(Y(),d.copyTexSubImage2D(Z,ot,q,Ne,T.xOffset,T.yOffset,k,D)):d.texSubImage2D(Z,ot,q,Ne,k,D,B,V,y)}var Ye=[];function Se(){return Ye.pop()||new he}function Ce(T){T.needsFree&&Bt.freeType(T.data),he.call(T),Ye.push(T)}function Ue(){oe.call(this),this.genMipmaps=!1,this.mipmapHint=_s,this.mipmask=0,this.images=Array(16)}function Qe(T,Z,q){var Ne=T.images[0]=Se();T.mipmask=1,Ne.width=T.width=Z,Ne.height=T.height=q,Ne.channels=T.channels=4}function it(T,Z){var q=null;if(kc(Z))q=T.images[0]=Se(),ne(q,T),Ae(q,Z),T.mipmask=1;else if(Me(T,Z),Array.isArray(Z.mipmap))for(var Ne=Z.mipmap,ot=0;ot<Ne.length;++ot)q=T.images[ot]=Se(),ne(q,T),q.width>>=ot,q.height>>=ot,Ae(q,Ne[ot]),T.mipmask|=1<<ot;else q=T.images[0]=Se(),ne(q,T),Ae(q,Z),T.mipmask=1;ne(T,T.images[0]),T.compressed&&(T.internalformat===$c||T.internalformat===Sc||T.internalformat===Pc||T.internalformat===Cc)&&_(T.width%4===0&&T.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Rt(T,Z){for(var q=T.images,Ne=0;Ne<q.length;++Ne){if(!q[Ne])return;Te(q[Ne],Z,Ne)}}var Nt=[];function lt(){var T=Nt.pop()||new Ue;oe.call(T),T.mipmask=0;for(var Z=0;Z<16;++Z)T.images[Z]=null;return T}function qt(T){for(var Z=T.images,q=0;q<Z.length;++q)Z[q]&&Ce(Z[q]),Z[q]=null;Nt.push(T)}function At(){this.minFilter=Mc,this.magFilter=Mc,this.wrapS=Nc,this.wrapT=Nc,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=_s}function Vt(T,Z){if("min"in Z){var q=Z.min;_.parameter(q,ye),T.minFilter=ye[q],mb.indexOf(T.minFilter)>=0&&!("faces"in Z)&&(T.genMipmaps=!0)}if("mag"in Z){var Ne=Z.mag;_.parameter(Ne,ve),T.magFilter=ve[Ne]}var ot=T.wrapS,w=T.wrapT;if("wrap"in Z){var y=Z.wrap;typeof y=="string"?(_.parameter(y,le),ot=w=le[y]):Array.isArray(y)&&(_.parameter(y[0],le),_.parameter(y[1],le),ot=le[y[0]],w=le[y[1]])}else{if("wrapS"in Z){var M=Z.wrapS;_.parameter(M,le),ot=le[M]}if("wrapT"in Z){var B=Z.wrapT;_.parameter(B,le),w=le[B]}}if(T.wrapS=ot,T.wrapT=w,"anisotropic"in Z){var V=Z.anisotropic;_(typeof V=="number"&&V>=1&&V<=C.maxAnisotropic,"aniso samples must be between 1 and "),T.anisotropic=Z.anisotropic}if("mipmap"in Z){var k=!1;switch(typeof Z.mipmap){case"string":_.parameter(Z.mipmap,ue,"invalid mipmap hint"),T.mipmapHint=ue[Z.mipmap],T.genMipmaps=!0,k=!0;break;case"boolean":k=T.genMipmaps=Z.mipmap;break;case"object":_(Array.isArray(Z.mipmap),"invalid mipmap type"),T.genMipmaps=!1,k=!0;break;default:_.raise("invalid mipmap type")}k&&!("min"in Z)&&(T.minFilter=Dc)}}function Xt(T,Z){d.texParameteri(Z,ab,T.minFilter),d.texParameteri(Z,ob,T.magFilter),d.texParameteri(Z,eb,T.wrapS),d.texParameteri(Z,tb,T.wrapT),b.ext_texture_filter_anisotropic&&d.texParameteri(Z,ub,T.anisotropic),T.genMipmaps&&(d.hint(ib,T.mipmapHint),d.generateMipmap(Z))}var Ht=0,Qt={},nn=C.maxTextureUnits,It=Array(nn).map(function(){return null});function tt(T){oe.call(this),this.mipmask=0,this.internalformat=Ir,this.id=Ht++,this.refCount=1,this.target=T,this.texture=d.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new At,Q.profile&&(this.stats={size:0})}function rn(T){d.activeTexture(va),d.bindTexture(T.target,T.texture)}function gt(){var T=It[0];T?d.bindTexture(T.target,T.texture):d.bindTexture(qn,null)}function je(T){var Z=T.texture;_(Z,"must not double destroy texture");var q=T.unit,Ne=T.target;q>=0&&(d.activeTexture(va+q),d.bindTexture(Ne,null),It[q]=null),d.deleteTexture(Z),T.texture=null,T.params=null,T.pixels=null,T.refCount=0,delete Qt[T.id],H.textureCount--}r(tt.prototype,{bind:function(){var T=this;T.bindCount+=1;var Z=T.unit;if(Z<0){for(var q=0;q<nn;++q){var Ne=It[q];if(Ne){if(Ne.bindCount>0)continue;Ne.unit=-1}It[q]=T,Z=q;break}Z>=nn&&_.raise("insufficient number of texture units"),Q.profile&&H.maxTextureUnits<Z+1&&(H.maxTextureUnits=Z+1),T.unit=Z,d.activeTexture(va+Z),d.bindTexture(T.target,T.texture)}return Z},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&je(this)}});function ct(T,Z){var q=new tt(qn);Qt[q.id]=q,H.textureCount++;function Ne(y,M){var B=q.texInfo;At.call(B);var V=lt();return typeof y=="number"?typeof M=="number"?Qe(V,y|0,M|0):Qe(V,y|0,y|0):y?(_.type(y,"object","invalid arguments to regl.texture"),Vt(B,y),it(V,y)):Qe(V,1,1),B.genMipmaps&&(V.mipmask=(V.width<<1)-1),q.mipmask=V.mipmask,ne(q,V),_.texture2D(B,V,C),q.internalformat=V.internalformat,Ne.width=V.width,Ne.height=V.height,rn(q),Rt(V,qn),Xt(B,qn),gt(),qt(V),Q.profile&&(q.stats.size=ws(q.internalformat,q.type,V.width,V.height,B.genMipmaps,!1)),Ne.format=pe[q.internalformat],Ne.type=Oe[q.type],Ne.mag=ie[B.magFilter],Ne.min=Pe[B.minFilter],Ne.wrapS=$e[B.wrapS],Ne.wrapT=$e[B.wrapT],Ne}function ot(y,M,B,V){_(!!y,"must specify image data");var k=M|0,D=B|0,F=V|0,E=Se();return ne(E,q),E.width=0,E.height=0,Ae(E,y),E.width=E.width||(q.width>>F)-k,E.height=E.height||(q.height>>F)-D,_(q.type===E.type&&q.format===E.format&&q.internalformat===E.internalformat,"incompatible format for texture.subimage"),_(k>=0&&D>=0&&k+E.width<=q.width&&D+E.height<=q.height,"texture.subimage write out of bounds"),_(q.mipmask&1<<F,"missing mipmap data"),_(E.data||E.element||E.needsCopy,"missing image data"),rn(q),Ke(E,qn,k,D,F),gt(),Ce(E),Ne}function w(y,M){var B=y|0,V=M|0||B;if(B===q.width&&V===q.height)return Ne;Ne.width=q.width=B,Ne.height=q.height=V,rn(q);for(var k=0;q.mipmask>>k;++k){var D=B>>k,F=V>>k;if(!D||!F)break;d.texImage2D(qn,k,q.format,D,F,0,q.format,q.type,null)}return gt(),Q.profile&&(q.stats.size=ws(q.internalformat,q.type,B,V,!1,!1)),Ne}return Ne(T,Z),Ne.subimage=ot,Ne.resize=w,Ne._reglType="texture2d",Ne._texture=q,Q.profile&&(Ne.stats=q.stats),Ne.destroy=function(){q.decRef()},Ne}function ft(T,Z,q,Ne,ot,w){var y=new tt(_c);Qt[y.id]=y,H.cubeCount++;var M=new Array(6);function B(D,F,E,$,A,U){var j,te=y.texInfo;for(At.call(te),j=0;j<6;++j)M[j]=lt();if(typeof D=="number"||!D){var ae=D|0||1;for(j=0;j<6;++j)Qe(M[j],ae,ae)}else if(typeof D=="object")if(F)it(M[0],D),it(M[1],F),it(M[2],E),it(M[3],$),it(M[4],A),it(M[5],U);else if(Vt(te,D),Me(y,D),"faces"in D){var xe=D.faces;for(_(Array.isArray(xe)&&xe.length===6,"cube faces must be a length 6 array"),j=0;j<6;++j)_(typeof xe[j]=="object"&&!!xe[j],"invalid input for cube map face"),ne(M[j],y),it(M[j],xe[j])}else for(j=0;j<6;++j)it(M[j],D);else _.raise("invalid arguments to cube map");for(ne(y,M[0]),_.optional(function(){C.npotTextureCube||_(nd(y.width)&&nd(y.height),"your browser does not support non power or two texture dimensions")}),te.genMipmaps?y.mipmask=(M[0].width<<1)-1:y.mipmask=M[0].mipmask,_.textureCube(y,te,M,C),y.internalformat=M[0].internalformat,B.width=M[0].width,B.height=M[0].height,rn(y),j=0;j<6;++j)Rt(M[j],vs+j);for(Xt(te,_c),gt(),Q.profile&&(y.stats.size=ws(y.internalformat,y.type,B.width,B.height,te.genMipmaps,!0)),B.format=pe[y.internalformat],B.type=Oe[y.type],B.mag=ie[te.magFilter],B.min=Pe[te.minFilter],B.wrapS=$e[te.wrapS],B.wrapT=$e[te.wrapT],j=0;j<6;++j)qt(M[j]);return B}function V(D,F,E,$,A){_(!!F,"must specify image data"),_(typeof D=="number"&&D===(D|0)&&D>=0&&D<6,"invalid face");var U=E|0,j=$|0,te=A|0,ae=Se();return ne(ae,y),ae.width=0,ae.height=0,Ae(ae,F),ae.width=ae.width||(y.width>>te)-U,ae.height=ae.height||(y.height>>te)-j,_(y.type===ae.type&&y.format===ae.format&&y.internalformat===ae.internalformat,"incompatible format for texture.subimage"),_(U>=0&&j>=0&&U+ae.width<=y.width&&j+ae.height<=y.height,"texture.subimage write out of bounds"),_(y.mipmask&1<<te,"missing mipmap data"),_(ae.data||ae.element||ae.needsCopy,"missing image data"),rn(y),Ke(ae,vs+D,U,j,te),gt(),Ce(ae),B}function k(D){var F=D|0;if(F!==y.width){B.width=y.width=F,B.height=y.height=F,rn(y);for(var E=0;E<6;++E)for(var $=0;y.mipmask>>$;++$)d.texImage2D(vs+E,$,y.format,F>>$,F>>$,0,y.format,y.type,null);return gt(),Q.profile&&(y.stats.size=ws(y.internalformat,y.type,B.width,B.height,!1,!0)),B}}return B(T,Z,q,Ne,ot,w),B.subimage=V,B.resize=k,B._reglType="textureCube",B._texture=y,Q.profile&&(B.stats=y.stats),B.destroy=function(){y.decRef()},B}function Ft(){for(var T=0;T<nn;++T)d.activeTexture(va+T),d.bindTexture(qn,null),It[T]=null;Sn(Qt).forEach(je),H.cubeCount=0,H.textureCount=0}Q.profile&&(H.getTotalTextureSize=function(){var T=0;return Object.keys(Qt).forEach(function(Z){T+=Qt[Z].stats.size}),T});function Hn(){for(var T=0;T<nn;++T){var Z=It[T];Z&&(Z.bindCount=0,Z.unit=-1,It[T]=null)}Sn(Qt).forEach(function(q){q.texture=d.createTexture(),d.bindTexture(q.target,q.texture);for(var Ne=0;Ne<32;++Ne)if(q.mipmask&1<<Ne)if(q.target===qn)d.texImage2D(qn,Ne,q.internalformat,q.width>>Ne,q.height>>Ne,0,q.internalformat,q.type,null);else for(var ot=0;ot<6;++ot)d.texImage2D(vs+ot,Ne,q.internalformat,q.width>>Ne,q.height>>Ne,0,q.internalformat,q.type,null);Xt(q.texInfo,q.target)})}function qr(){for(var T=0;T<nn;++T){var Z=It[T];Z&&(Z.bindCount=0,Z.unit=-1,It[T]=null),d.activeTexture(va+T),d.bindTexture(qn,null),d.bindTexture(_c,null)}}return{create2D:ct,createCube:ft,clear:Ft,getTexture:function(T){return null},restore:Hn,refresh:qr}}var mr=36161,Es=32854,Cd=32855,Od=36194,Rd=33189,Nd=36168,Md=34041,Dd=35907,Ld=34836,kd=34842,Id=34843,zn=[];zn[Es]=2,zn[Cd]=2,zn[Od]=2,zn[Rd]=2,zn[Nd]=1,zn[Md]=4,zn[Dd]=4,zn[Ld]=16,zn[kd]=8,zn[Id]=6;function Fd(d,b,C){return zn[d]*b*C}var Ab=function(d,b,C,Y,re){var H={rgba4:Es,rgb565:Od,"rgb5 a1":Cd,depth:Rd,stencil:Nd,"depth stencil":Md};b.ext_srgb&&(H.srgba=Dd),b.ext_color_buffer_half_float&&(H.rgba16f=kd,H.rgb16f=Id),b.webgl_color_buffer_float&&(H.rgba32f=Ld);var Q=[];Object.keys(H).forEach(function(fe){var me=H[fe];Q[me]=fe});var ue=0,le={};function ve(fe){this.id=ue++,this.refCount=1,this.renderbuffer=fe,this.format=Es,this.width=0,this.height=0,re.profile&&(this.stats={size:0})}ve.prototype.decRef=function(){--this.refCount<=0&&ye(this)};function ye(fe){var me=fe.renderbuffer;_(me,"must not double destroy renderbuffer"),d.bindRenderbuffer(mr,null),d.deleteRenderbuffer(me),fe.renderbuffer=null,fe.refCount=0,delete le[fe.id],Y.renderbufferCount--}function ge(fe,me){var z=new ve(d.createRenderbuffer());le[z.id]=z,Y.renderbufferCount++;function K(Oe,ie){var Pe=0,$e=0,Be=Es;if(typeof Oe=="object"&&Oe){var oe=Oe;if("shape"in oe){var ne=oe.shape;_(Array.isArray(ne)&&ne.length>=2,"invalid renderbuffer shape"),Pe=ne[0]|0,$e=ne[1]|0}else"radius"in oe&&(Pe=$e=oe.radius|0),"width"in oe&&(Pe=oe.width|0),"height"in oe&&($e=oe.height|0);"format"in oe&&(_.parameter(oe.format,H,"invalid renderbuffer format"),Be=H[oe.format])}else typeof Oe=="number"?(Pe=Oe|0,typeof ie=="number"?$e=ie|0:$e=Pe):Oe?_.raise("invalid arguments to renderbuffer constructor"):Pe=$e=1;if(_(Pe>0&&$e>0&&Pe<=C.maxRenderbufferSize&&$e<=C.maxRenderbufferSize,"invalid renderbuffer size"),!(Pe===z.width&&$e===z.height&&Be===z.format))return K.width=z.width=Pe,K.height=z.height=$e,z.format=Be,d.bindRenderbuffer(mr,z.renderbuffer),d.renderbufferStorage(mr,Be,Pe,$e),_(d.getError()===0,"invalid render buffer format"),re.profile&&(z.stats.size=Fd(z.format,z.width,z.height)),K.format=Q[z.format],K}function pe(Oe,ie){var Pe=Oe|0,$e=ie|0||Pe;return Pe===z.width&&$e===z.height||(_(Pe>0&&$e>0&&Pe<=C.maxRenderbufferSize&&$e<=C.maxRenderbufferSize,"invalid renderbuffer size"),K.width=z.width=Pe,K.height=z.height=$e,d.bindRenderbuffer(mr,z.renderbuffer),d.renderbufferStorage(mr,z.format,Pe,$e),_(d.getError()===0,"invalid render buffer format"),re.profile&&(z.stats.size=Fd(z.format,z.width,z.height))),K}return K(fe,me),K.resize=pe,K._reglType="renderbuffer",K._renderbuffer=z,re.profile&&(K.stats=z.stats),K.destroy=function(){z.decRef()},K}re.profile&&(Y.getTotalRenderbufferSize=function(){var fe=0;return Object.keys(le).forEach(function(me){fe+=le[me].stats.size}),fe});function we(){Sn(le).forEach(function(fe){fe.renderbuffer=d.createRenderbuffer(),d.bindRenderbuffer(mr,fe.renderbuffer),d.renderbufferStorage(mr,fe.format,fe.width,fe.height)}),d.bindRenderbuffer(mr,null)}return{create:ge,clear:function(){Sn(le).forEach(ye)},restore:we}},nr=36160,Ic=36161,Gr=3553,As=34069,Gd=36064,Bd=36096,zd=36128,Vd=33306,jd=36053,Tb=36054,$b=36055,Sb=36057,Pb=36061,Cb=36193,Ob=5121,Rb=5126,Ud=6407,qd=6408,Nb=6402,Mb=[Ud,qd],Fc=[];Fc[qd]=4,Fc[Ud]=3;var Ts=[];Ts[Ob]=1,Ts[Rb]=4,Ts[Cb]=2;var Db=32854,Lb=32855,kb=36194,Ib=33189,Fb=36168,Xd=34041,Gb=35907,Bb=34836,zb=34842,Vb=34843,jb=[Db,Lb,kb,Gb,zb,Vb,Bb],xo={};xo[jd]="complete",xo[Tb]="incomplete attachment",xo[Sb]="incomplete dimensions",xo[$b]="incomplete, missing attachment",xo[Pb]="unsupported";function Ub(d,b,C,Y,re,H){var Q={cur:null,next:null,dirty:!1,setFBO:null},ue=["rgba"],le=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&le.push("srgba"),b.ext_color_buffer_half_float&&le.push("rgba16f","rgb16f"),b.webgl_color_buffer_float&&le.push("rgba32f");var ve=["uint8"];b.oes_texture_half_float&&ve.push("half float","float16"),b.oes_texture_float&&ve.push("float","float32");function ye(he,Ae,Te){this.target=he,this.texture=Ae,this.renderbuffer=Te;var Ke=0,Ye=0;Ae?(Ke=Ae.width,Ye=Ae.height):Te&&(Ke=Te.width,Ye=Te.height),this.width=Ke,this.height=Ye}function ge(he){he&&(he.texture&&he.texture._texture.decRef(),he.renderbuffer&&he.renderbuffer._renderbuffer.decRef())}function we(he,Ae,Te){if(he)if(he.texture){var Ke=he.texture._texture,Ye=Math.max(1,Ke.width),Se=Math.max(1,Ke.height);_(Ye===Ae&&Se===Te,"inconsistent width/height for supplied texture"),Ke.refCount+=1}else{var Ce=he.renderbuffer._renderbuffer;_(Ce.width===Ae&&Ce.height===Te,"inconsistent width/height for renderbuffer"),Ce.refCount+=1}}function fe(he,Ae){Ae&&(Ae.texture?d.framebufferTexture2D(nr,he,Ae.target,Ae.texture._texture.texture,0):d.framebufferRenderbuffer(nr,he,Ic,Ae.renderbuffer._renderbuffer.renderbuffer))}function me(he){var Ae=Gr,Te=null,Ke=null,Ye=he;typeof he=="object"&&(Ye=he.data,"target"in he&&(Ae=he.target|0)),_.type(Ye,"function","invalid attachment data");var Se=Ye._reglType;return Se==="texture2d"?(Te=Ye,_(Ae===Gr)):Se==="textureCube"?(Te=Ye,_(Ae>=As&&Ae<As+6,"invalid cube map target")):Se==="renderbuffer"?(Ke=Ye,Ae=Ic):_.raise("invalid regl object for attachment"),new ye(Ae,Te,Ke)}function z(he,Ae,Te,Ke,Ye){if(Te){var Se=Y.create2D({width:he,height:Ae,format:Ke,type:Ye});return Se._texture.refCount=0,new ye(Gr,Se,null)}else{var Ce=re.create({width:he,height:Ae,format:Ke});return Ce._renderbuffer.refCount=0,new ye(Ic,null,Ce)}}function K(he){return he&&(he.texture||he.renderbuffer)}function pe(he,Ae,Te){he&&(he.texture?he.texture.resize(Ae,Te):he.renderbuffer&&he.renderbuffer.resize(Ae,Te),he.width=Ae,he.height=Te)}var Oe=0,ie={};function Pe(){this.id=Oe++,ie[this.id]=this,this.framebuffer=d.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function $e(he){he.colorAttachments.forEach(ge),ge(he.depthAttachment),ge(he.stencilAttachment),ge(he.depthStencilAttachment)}function Be(he){var Ae=he.framebuffer;_(Ae,"must not double destroy framebuffer"),d.deleteFramebuffer(Ae),he.framebuffer=null,H.framebufferCount--,delete ie[he.id]}function oe(he){var Ae;d.bindFramebuffer(nr,he.framebuffer);var Te=he.colorAttachments;for(Ae=0;Ae<Te.length;++Ae)fe(Gd+Ae,Te[Ae]);for(Ae=Te.length;Ae<C.maxColorAttachments;++Ae)d.framebufferTexture2D(nr,Gd+Ae,Gr,null,0);d.framebufferTexture2D(nr,Vd,Gr,null,0),d.framebufferTexture2D(nr,Bd,Gr,null,0),d.framebufferTexture2D(nr,zd,Gr,null,0),fe(Bd,he.depthAttachment),fe(zd,he.stencilAttachment),fe(Vd,he.depthStencilAttachment);var Ke=d.checkFramebufferStatus(nr);!d.isContextLost()&&Ke!==jd&&_.raise("framebuffer configuration not supported, status = "+xo[Ke]),d.bindFramebuffer(nr,Q.next?Q.next.framebuffer:null),Q.cur=Q.next,d.getError()}function ne(he,Ae){var Te=new Pe;H.framebufferCount++;function Ke(Se,Ce){var Ue;_(Q.next!==Te,"can not update framebuffer which is currently in use");var Qe=0,it=0,Rt=!0,Nt=!0,lt=null,qt=!0,At="rgba",Vt="uint8",Xt=1,Ht=null,Qt=null,nn=null,It=!1;if(typeof Se=="number")Qe=Se|0,it=Ce|0||Qe;else if(!Se)Qe=it=1;else{_.type(Se,"object","invalid arguments for framebuffer");var tt=Se;if("shape"in tt){var rn=tt.shape;_(Array.isArray(rn)&&rn.length>=2,"invalid shape for framebuffer"),Qe=rn[0],it=rn[1]}else"radius"in tt&&(Qe=it=tt.radius),"width"in tt&&(Qe=tt.width),"height"in tt&&(it=tt.height);("color"in tt||"colors"in tt)&&(lt=tt.color||tt.colors,Array.isArray(lt)&&_(lt.length===1||b.webgl_draw_buffers,"multiple render targets not supported")),lt||("colorCount"in tt&&(Xt=tt.colorCount|0,_(Xt>0,"invalid color buffer count")),"colorTexture"in tt&&(qt=!!tt.colorTexture,At="rgba4"),"colorType"in tt&&(Vt=tt.colorType,qt?(_(b.oes_texture_float||!(Vt==="float"||Vt==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),_(b.oes_texture_half_float||!(Vt==="half float"||Vt==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Vt==="half float"||Vt==="float16"?(_(b.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),At="rgba16f"):(Vt==="float"||Vt==="float32")&&(_(b.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),At="rgba32f"),_.oneOf(Vt,ve,"invalid color type")),"colorFormat"in tt&&(At=tt.colorFormat,ue.indexOf(At)>=0?qt=!0:le.indexOf(At)>=0?qt=!1:_.optional(function(){qt?_.oneOf(tt.colorFormat,ue,"invalid color format for texture"):_.oneOf(tt.colorFormat,le,"invalid color format for renderbuffer")}))),("depthTexture"in tt||"depthStencilTexture"in tt)&&(It=!!(tt.depthTexture||tt.depthStencilTexture),_(!It||b.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in tt&&(typeof tt.depth=="boolean"?Rt=tt.depth:(Ht=tt.depth,Nt=!1)),"stencil"in tt&&(typeof tt.stencil=="boolean"?Nt=tt.stencil:(Qt=tt.stencil,Rt=!1)),"depthStencil"in tt&&(typeof tt.depthStencil=="boolean"?Rt=Nt=tt.depthStencil:(nn=tt.depthStencil,Rt=!1,Nt=!1))}var gt=null,je=null,ct=null,ft=null;if(Array.isArray(lt))gt=lt.map(me);else if(lt)gt=[me(lt)];else for(gt=new Array(Xt),Ue=0;Ue<Xt;++Ue)gt[Ue]=z(Qe,it,qt,At,Vt);_(b.webgl_draw_buffers||gt.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),_(gt.length<=C.maxColorAttachments,"too many color attachments, not supported"),Qe=Qe||gt[0].width,it=it||gt[0].height,Ht?je=me(Ht):Rt&&!Nt&&(je=z(Qe,it,It,"depth","uint32")),Qt?ct=me(Qt):Nt&&!Rt&&(ct=z(Qe,it,!1,"stencil","uint8")),nn?ft=me(nn):!Ht&&!Qt&&Nt&&Rt&&(ft=z(Qe,it,It,"depth stencil","depth stencil")),_(!!Ht+!!Qt+!!nn<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ft=null;for(Ue=0;Ue<gt.length;++Ue)if(we(gt[Ue],Qe,it),_(!gt[Ue]||gt[Ue].texture&&Mb.indexOf(gt[Ue].texture._texture.format)>=0||gt[Ue].renderbuffer&&jb.indexOf(gt[Ue].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Ue+" is invalid"),gt[Ue]&&gt[Ue].texture){var Hn=Fc[gt[Ue].texture._texture.format]*Ts[gt[Ue].texture._texture.type];Ft===null?Ft=Hn:_(Ft===Hn,"all color attachments much have the same number of bits per pixel.")}return we(je,Qe,it),_(!je||je.texture&&je.texture._texture.format===Nb||je.renderbuffer&&je.renderbuffer._renderbuffer.format===Ib,"invalid depth attachment for framebuffer object"),we(ct,Qe,it),_(!ct||ct.renderbuffer&&ct.renderbuffer._renderbuffer.format===Fb,"invalid stencil attachment for framebuffer object"),we(ft,Qe,it),_(!ft||ft.texture&&ft.texture._texture.format===Xd||ft.renderbuffer&&ft.renderbuffer._renderbuffer.format===Xd,"invalid depth-stencil attachment for framebuffer object"),$e(Te),Te.width=Qe,Te.height=it,Te.colorAttachments=gt,Te.depthAttachment=je,Te.stencilAttachment=ct,Te.depthStencilAttachment=ft,Ke.color=gt.map(K),Ke.depth=K(je),Ke.stencil=K(ct),Ke.depthStencil=K(ft),Ke.width=Te.width,Ke.height=Te.height,oe(Te),Ke}function Ye(Se,Ce){_(Q.next!==Te,"can not resize a framebuffer which is currently in use");var Ue=Math.max(Se|0,1),Qe=Math.max(Ce|0||Ue,1);if(Ue===Te.width&&Qe===Te.height)return Ke;for(var it=Te.colorAttachments,Rt=0;Rt<it.length;++Rt)pe(it[Rt],Ue,Qe);return pe(Te.depthAttachment,Ue,Qe),pe(Te.stencilAttachment,Ue,Qe),pe(Te.depthStencilAttachment,Ue,Qe),Te.width=Ke.width=Ue,Te.height=Ke.height=Qe,oe(Te),Ke}return Ke(he,Ae),r(Ke,{resize:Ye,_reglType:"framebuffer",_framebuffer:Te,destroy:function(){Be(Te),$e(Te)},use:function(Se){Q.setFBO({framebuffer:Ke},Se)}})}function Me(he){var Ae=Array(6);function Te(Ye){var Se;_(Ae.indexOf(Q.next)<0,"can not update framebuffer which is currently in use");var Ce={color:null},Ue=0,Qe=null,it="rgba",Rt="uint8",Nt=1;if(typeof Ye=="number")Ue=Ye|0;else if(!Ye)Ue=1;else{_.type(Ye,"object","invalid arguments for framebuffer");var lt=Ye;if("shape"in lt){var qt=lt.shape;_(Array.isArray(qt)&&qt.length>=2,"invalid shape for framebuffer"),_(qt[0]===qt[1],"cube framebuffer must be square"),Ue=qt[0]}else"radius"in lt&&(Ue=lt.radius|0),"width"in lt?(Ue=lt.width|0,"height"in lt&&_(lt.height===Ue,"must be square")):"height"in lt&&(Ue=lt.height|0);("color"in lt||"colors"in lt)&&(Qe=lt.color||lt.colors,Array.isArray(Qe)&&_(Qe.length===1||b.webgl_draw_buffers,"multiple render targets not supported")),Qe||("colorCount"in lt&&(Nt=lt.colorCount|0,_(Nt>0,"invalid color buffer count")),"colorType"in lt&&(_.oneOf(lt.colorType,ve,"invalid color type"),Rt=lt.colorType),"colorFormat"in lt&&(it=lt.colorFormat,_.oneOf(lt.colorFormat,ue,"invalid color format for texture"))),"depth"in lt&&(Ce.depth=lt.depth),"stencil"in lt&&(Ce.stencil=lt.stencil),"depthStencil"in lt&&(Ce.depthStencil=lt.depthStencil)}var At;if(Qe)if(Array.isArray(Qe))for(At=[],Se=0;Se<Qe.length;++Se)At[Se]=Qe[Se];else At=[Qe];else{At=Array(Nt);var Vt={radius:Ue,format:it,type:Rt};for(Se=0;Se<Nt;++Se)At[Se]=Y.createCube(Vt)}for(Ce.color=Array(At.length),Se=0;Se<At.length;++Se){var Xt=At[Se];_(typeof Xt=="function"&&Xt._reglType==="textureCube","invalid cube map"),Ue=Ue||Xt.width,_(Xt.width===Ue&&Xt.height===Ue,"invalid cube map shape"),Ce.color[Se]={target:As,data:At[Se]}}for(Se=0;Se<6;++Se){for(var Ht=0;Ht<At.length;++Ht)Ce.color[Ht].target=As+Se;Se>0&&(Ce.depth=Ae[0].depth,Ce.stencil=Ae[0].stencil,Ce.depthStencil=Ae[0].depthStencil),Ae[Se]?Ae[Se](Ce):Ae[Se]=ne(Ce)}return r(Te,{width:Ue,height:Ue,color:At})}function Ke(Ye){var Se,Ce=Ye|0;if(_(Ce>0&&Ce<=C.maxCubeMapSize,"invalid radius for cube fbo"),Ce===Te.width)return Te;var Ue=Te.color;for(Se=0;Se<Ue.length;++Se)Ue[Se].resize(Ce);for(Se=0;Se<6;++Se)Ae[Se].resize(Ce);return Te.width=Te.height=Ce,Te}return Te(he),r(Te,{faces:Ae,resize:Ke,_reglType:"framebufferCube",destroy:function(){Ae.forEach(function(Ye){Ye.destroy()})}})}function Ee(){Q.cur=null,Q.next=null,Q.dirty=!0,Sn(ie).forEach(function(he){he.framebuffer=d.createFramebuffer(),oe(he)})}return r(Q,{getFramebuffer:function(he){if(typeof he=="function"&&he._reglType==="framebuffer"){var Ae=he._framebuffer;if(Ae instanceof Pe)return Ae}return null},create:ne,createCube:Me,clear:function(){Sn(ie).forEach(Be)},restore:Ee})}var qb=5126,Hd=34962,$s=34963,Wd=["attributes","elements","offset","count","primitive","instances"];function Gc(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=qb,this.offset=0,this.stride=0,this.divisor=0}function Xb(d,b,C,Y,re,H,Q){for(var ue=C.maxAttributes,le=new Array(ue),ve=0;ve<ue;++ve)le[ve]=new Gc;var ye=0,ge={},we={Record:Gc,scope:{},state:le,currentVAO:null,targetVAO:null,restore:me()?$e:function(){},createVAO:Be,getVAO:K,destroyBuffer:fe,setVAO:me()?pe:Oe,clear:me()?ie:function(){}};function fe(oe){for(var ne=0;ne<le.length;++ne){var Me=le[ne];Me.buffer===oe&&(d.disableVertexAttribArray(ne),Me.buffer=null)}}function me(){return b.oes_vertex_array_object}function z(){return b.angle_instanced_arrays}function K(oe){return typeof oe=="function"&&oe._vao?oe._vao:null}function pe(oe){if(oe!==we.currentVAO){var ne=me();oe?ne.bindVertexArrayOES(oe.vao):ne.bindVertexArrayOES(null),we.currentVAO=oe}}function Oe(oe){if(oe!==we.currentVAO){if(oe)oe.bindAttrs();else{for(var ne=z(),Me=0;Me<le.length;++Me){var Ee=le[Me];Ee.buffer?(d.enableVertexAttribArray(Me),Ee.buffer.bind(),d.vertexAttribPointer(Me,Ee.size,Ee.type,Ee.normalized,Ee.stride,Ee.offfset),ne&&Ee.divisor&&ne.vertexAttribDivisorANGLE(Me,Ee.divisor)):(d.disableVertexAttribArray(Me),d.vertexAttrib4f(Me,Ee.x,Ee.y,Ee.z,Ee.w))}Q.elements?d.bindBuffer($s,Q.elements.buffer.buffer):d.bindBuffer($s,null)}we.currentVAO=oe}}function ie(){Sn(ge).forEach(function(oe){oe.destroy()})}function Pe(){this.id=++ye,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var oe=me();oe?this.vao=oe.createVertexArrayOES():this.vao=null,ge[this.id]=this,this.buffers=[]}Pe.prototype.bindAttrs=function(){for(var oe=z(),ne=this.attributes,Me=0;Me<ne.length;++Me){var Ee=ne[Me];Ee.buffer?(d.enableVertexAttribArray(Me),d.bindBuffer(Hd,Ee.buffer.buffer),d.vertexAttribPointer(Me,Ee.size,Ee.type,Ee.normalized,Ee.stride,Ee.offset),oe&&Ee.divisor&&oe.vertexAttribDivisorANGLE(Me,Ee.divisor)):(d.disableVertexAttribArray(Me),d.vertexAttrib4f(Me,Ee.x,Ee.y,Ee.z,Ee.w))}for(var he=ne.length;he<ue;++he)d.disableVertexAttribArray(he);var Ae=H.getElements(this.elements);Ae?d.bindBuffer($s,Ae.buffer.buffer):d.bindBuffer($s,null)},Pe.prototype.refresh=function(){var oe=me();oe&&(oe.bindVertexArrayOES(this.vao),this.bindAttrs(),we.currentVAO=null,oe.bindVertexArrayOES(null))},Pe.prototype.destroy=function(){if(this.vao){var oe=me();this===we.currentVAO&&(we.currentVAO=null,oe.bindVertexArrayOES(null)),oe.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),ge[this.id]&&(delete ge[this.id],Y.vaoCount-=1)};function $e(){var oe=me();oe&&Sn(ge).forEach(function(ne){ne.refresh()})}function Be(oe){var ne=new Pe;Y.vaoCount+=1;function Me(Ee){var he;if(Array.isArray(Ee))he=Ee,ne.elements&&ne.ownsElements&&ne.elements.destroy(),ne.elements=null,ne.ownsElements=!1,ne.offset=0,ne.count=0,ne.instances=-1,ne.primitive=4;else{if(_(typeof Ee=="object","invalid arguments for create vao"),_("attributes"in Ee,"must specify attributes for vao"),Ee.elements){var Ae=Ee.elements;ne.ownsElements?typeof Ae=="function"&&Ae._reglType==="elements"?(ne.elements.destroy(),ne.ownsElements=!1):(ne.elements(Ae),ne.ownsElements=!1):H.getElements(Ee.elements)?(ne.elements=Ee.elements,ne.ownsElements=!1):(ne.elements=H.create(Ee.elements),ne.ownsElements=!0)}else ne.elements=null,ne.ownsElements=!1;he=Ee.attributes,ne.offset=0,ne.count=-1,ne.instances=-1,ne.primitive=4,ne.elements&&(ne.count=ne.elements._elements.vertCount,ne.primitive=ne.elements._elements.primType),"offset"in Ee&&(ne.offset=Ee.offset|0),"count"in Ee&&(ne.count=Ee.count|0),"instances"in Ee&&(ne.instances=Ee.instances|0),"primitive"in Ee&&(_(Ee.primitive in pr,"bad primitive type: "+Ee.primitive),ne.primitive=pr[Ee.primitive]),_.optional(()=>{for(var Rt=Object.keys(Ee),Nt=0;Nt<Rt.length;++Nt)_(Wd.indexOf(Rt[Nt])>=0,'invalid option for vao: "'+Rt[Nt]+'" valid options are '+Wd)}),_(Array.isArray(he),"attributes must be an array")}_(he.length<ue,"too many attributes"),_(he.length>0,"must specify at least one attribute");var Te={},Ke=ne.attributes;Ke.length=he.length;for(var Ye=0;Ye<he.length;++Ye){var Se=he[Ye],Ce=Ke[Ye]=new Gc,Ue=Se.data||Se;if(Array.isArray(Ue)||n(Ue)||Bn(Ue)){var Qe;ne.buffers[Ye]&&(Qe=ne.buffers[Ye],n(Ue)&&Qe._buffer.byteLength>=Ue.byteLength?Qe.subdata(Ue):(Qe.destroy(),ne.buffers[Ye]=null)),ne.buffers[Ye]||(Qe=ne.buffers[Ye]=re.create(Se,Hd,!1,!0)),Ce.buffer=re.getBuffer(Qe),Ce.size=Ce.buffer.dimension|0,Ce.normalized=!1,Ce.type=Ce.buffer.dtype,Ce.offset=0,Ce.stride=0,Ce.divisor=0,Ce.state=1,Te[Ye]=1}else re.getBuffer(Se)?(Ce.buffer=re.getBuffer(Se),Ce.size=Ce.buffer.dimension|0,Ce.normalized=!1,Ce.type=Ce.buffer.dtype,Ce.offset=0,Ce.stride=0,Ce.divisor=0,Ce.state=1):re.getBuffer(Se.buffer)?(Ce.buffer=re.getBuffer(Se.buffer),Ce.size=(+Se.size||Ce.buffer.dimension)|0,Ce.normalized=!!Se.normalized||!1,"type"in Se?(_.parameter(Se.type,Lr,"invalid buffer type"),Ce.type=Lr[Se.type]):Ce.type=Ce.buffer.dtype,Ce.offset=(Se.offset||0)|0,Ce.stride=(Se.stride||0)|0,Ce.divisor=(Se.divisor||0)|0,Ce.state=1,_(Ce.size>=1&&Ce.size<=4,"size must be between 1 and 4"),_(Ce.offset>=0,"invalid offset"),_(Ce.stride>=0&&Ce.stride<=255,"stride must be between 0 and 255"),_(Ce.divisor>=0,"divisor must be positive"),_(!Ce.divisor||!!b.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Se?(_(Ye>0,"first attribute must not be a constant"),Ce.x=+Se.x||0,Ce.y=+Se.y||0,Ce.z=+Se.z||0,Ce.w=+Se.w||0,Ce.state=2):_(!1,"invalid attribute spec for location "+Ye)}for(var it=0;it<ne.buffers.length;++it)!Te[it]&&ne.buffers[it]&&(ne.buffers[it].destroy(),ne.buffers[it]=null);return ne.refresh(),Me}return Me.destroy=function(){for(var Ee=0;Ee<ne.buffers.length;++Ee)ne.buffers[Ee]&&ne.buffers[Ee].destroy();ne.buffers.length=0,ne.ownsElements&&(ne.elements.destroy(),ne.elements=null,ne.ownsElements=!1),ne.destroy()},Me._vao=ne,Me._reglType="vao",Me(oe)}return we}var Yd=35632,Hb=35633,Wb=35718,Yb=35721;function Zb(d,b,C,Y){var re={},H={};function Q(z,K,pe,Oe){this.name=z,this.id=K,this.location=pe,this.info=Oe}function ue(z,K){for(var pe=0;pe<z.length;++pe)if(z[pe].id===K.id){z[pe].location=K.location;return}z.push(K)}function le(z,K,pe){var Oe=z===Yd?re:H,ie=Oe[K];if(!ie){var Pe=b.str(K);ie=d.createShader(z),d.shaderSource(ie,Pe),d.compileShader(ie),_.shaderError(d,ie,Pe,z,pe),Oe[K]=ie}return ie}var ve={},ye=[],ge=0;function we(z,K){this.id=ge++,this.fragId=z,this.vertId=K,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Y.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function fe(z,K,pe){var Oe,ie,Pe=le(Yd,z.fragId),$e=le(Hb,z.vertId),Be=z.program=d.createProgram();if(d.attachShader(Be,Pe),d.attachShader(Be,$e),pe)for(Oe=0;Oe<pe.length;++Oe){var oe=pe[Oe];d.bindAttribLocation(Be,oe[0],oe[1])}d.linkProgram(Be),_.linkError(d,Be,b.str(z.fragId),b.str(z.vertId),K);var ne=d.getProgramParameter(Be,Wb);Y.profile&&(z.stats.uniformsCount=ne);var Me=z.uniforms;for(Oe=0;Oe<ne;++Oe)if(ie=d.getActiveUniform(Be,Oe),ie){if(ie.size>1)for(var Ee=0;Ee<ie.size;++Ee){var he=ie.name.replace("[0]","["+Ee+"]");ue(Me,new Q(he,b.id(he),d.getUniformLocation(Be,he),ie))}var Ae=ie.name;ie.size>1&&(Ae=Ae.replace("[0]","")),ue(Me,new Q(Ae,b.id(Ae),d.getUniformLocation(Be,Ae),ie))}var Te=d.getProgramParameter(Be,Yb);Y.profile&&(z.stats.attributesCount=Te);var Ke=z.attributes;for(Oe=0;Oe<Te;++Oe)ie=d.getActiveAttrib(Be,Oe),ie&&ue(Ke,new Q(ie.name,b.id(ie.name),d.getAttribLocation(Be,ie.name),ie))}Y.profile&&(C.getMaxUniformsCount=function(){var z=0;return ye.forEach(function(K){K.stats.uniformsCount>z&&(z=K.stats.uniformsCount)}),z},C.getMaxAttributesCount=function(){var z=0;return ye.forEach(function(K){K.stats.attributesCount>z&&(z=K.stats.attributesCount)}),z});function me(){re={},H={};for(var z=0;z<ye.length;++z)fe(ye[z],null,ye[z].attributes.map(function(K){return[K.location,K.name]}))}return{clear:function(){var z=d.deleteShader.bind(d);Sn(re).forEach(z),re={},Sn(H).forEach(z),H={},ye.forEach(function(K){d.deleteProgram(K.program)}),ye.length=0,ve={},C.shaderCount=0},program:function(z,K,pe,Oe){_.command(z>=0,"missing vertex shader",pe),_.command(K>=0,"missing fragment shader",pe);var ie=ve[K];ie||(ie=ve[K]={});var Pe=ie[z];if(Pe&&(Pe.refCount++,!Oe))return Pe;var $e=new we(K,z);return C.shaderCount++,fe($e,pe,Oe),Pe||(ie[z]=$e),ye.push($e),r($e,{destroy:function(){if($e.refCount--,$e.refCount<=0){d.deleteProgram($e.program);var Be=ye.indexOf($e);ye.splice(Be,1),C.shaderCount--}ie[$e.vertId].refCount<=0&&(d.deleteShader(H[$e.vertId]),delete H[$e.vertId],delete ve[$e.fragId][$e.vertId]),Object.keys(ve[$e.fragId]).length||(d.deleteShader(re[$e.fragId]),delete re[$e.fragId],delete ve[$e.fragId])}})},restore:me,shader:le,frag:-1,vert:-1}}var Kb=6408,ga=5121,Qb=3333,Ss=5126;function Jb(d,b,C,Y,re,H,Q){function ue(ye){var ge;b.next===null?(_(re.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),ge=ga):(_(b.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),ge=b.next.colorAttachments[0].texture._texture.type,_.optional(function(){H.oes_texture_float?(_(ge===ga||ge===Ss,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),ge===Ss&&_(Q.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):_(ge===ga,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var we=0,fe=0,me=Y.framebufferWidth,z=Y.framebufferHeight,K=null;n(ye)?K=ye:ye&&(_.type(ye,"object","invalid arguments to regl.read()"),we=ye.x|0,fe=ye.y|0,_(we>=0&&we<Y.framebufferWidth,"invalid x offset for regl.read"),_(fe>=0&&fe<Y.framebufferHeight,"invalid y offset for regl.read"),me=(ye.width||Y.framebufferWidth-we)|0,z=(ye.height||Y.framebufferHeight-fe)|0,K=ye.data||null),K&&(ge===ga?_(K instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):ge===Ss&&_(K instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),_(me>0&&me+we<=Y.framebufferWidth,"invalid width for read pixels"),_(z>0&&z+fe<=Y.framebufferHeight,"invalid height for read pixels"),C();var pe=me*z*4;return K||(ge===ga?K=new Uint8Array(pe):ge===Ss&&(K=K||new Float32Array(pe))),_.isTypedArray(K,"data buffer for regl.read() must be a typedarray"),_(K.byteLength>=pe,"data buffer for regl.read() too small"),d.pixelStorei(Qb,4),d.readPixels(we,fe,me,z,Kb,ge,K),K}function le(ye){var ge;return b.setFBO({framebuffer:ye.framebuffer},function(){ge=ue(ye)}),ge}function ve(ye){return!ye||!("framebuffer"in ye)?ue(ye):le(ye)}return ve}function wo(d){return Array.prototype.slice.call(d)}function Eo(d){return wo(d).join("")}function e_(){var d=0,b=[],C=[];function Y(ge){for(var we=0;we<C.length;++we)if(C[we]===ge)return b[we];var fe="g"+d++;return b.push(fe),C.push(ge),fe}function re(){var ge=[];function we(){ge.push.apply(ge,wo(arguments))}var fe=[];function me(){var z="v"+d++;return fe.push(z),arguments.length>0&&(ge.push(z,"="),ge.push.apply(ge,wo(arguments)),ge.push(";")),z}return r(we,{def:me,toString:function(){return Eo([fe.length>0?"var "+fe.join(",")+";":"",Eo(ge)])}})}function H(){var ge=re(),we=re(),fe=ge.toString,me=we.toString;function z(K,pe){we(K,pe,"=",ge.def(K,pe),";")}return r(function(){ge.apply(ge,wo(arguments))},{def:ge.def,entry:ge,exit:we,save:z,set:function(K,pe,Oe){z(K,pe),ge(K,pe,"=",Oe,";")},toString:function(){return fe()+me()}})}function Q(){var ge=Eo(arguments),we=H(),fe=H(),me=we.toString,z=fe.toString;return r(we,{then:function(){return we.apply(we,wo(arguments)),this},else:function(){return fe.apply(fe,wo(arguments)),this},toString:function(){var K=z();return K&&(K="else{"+K+"}"),Eo(["if(",ge,"){",me(),"}",K])}})}var ue=re(),le={};function ve(ge,we){var fe=[];function me(){var ie="a"+fe.length;return fe.push(ie),ie}we=we||0;for(var z=0;z<we;++z)me();var K=H(),pe=K.toString,Oe=le[ge]=r(K,{arg:me,toString:function(){return Eo(["function(",fe.join(),"){",pe(),"}"])}});return Oe}function ye(){var ge=['"use strict";',ue,"return {"];Object.keys(le).forEach(function(me){ge.push('"',me,'":',le[me].toString(),",")}),ge.push("}");var we=Eo(ge).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),fe=Function.apply(null,b.concat(we));return fe.apply(null,C)}return{global:ue,link:Y,block:re,proc:ve,scope:H,cond:Q,compile:ye}}var Ao="xyzw".split(""),Zd=5121,To=1,Bc=2,zc=0,Vc=1,jc=2,Uc=3,Ps=4,Kd=5,Qd=6,Jd="dither",e1="blend.enable",t1="blend.color",qc="blend.equation",Xc="blend.func",n1="depth.enable",r1="depth.func",o1="depth.range",a1="depth.mask",Hc="colorMask",s1="cull.enable",i1="cull.face",Wc="frontFace",Yc="lineWidth",c1="polygonOffset.enable",Zc="polygonOffset.offset",l1="sample.alpha",u1="sample.enable",Kc="sample.coverage",f1="stencil.enable",d1="stencil.mask",Qc="stencil.func",Jc="stencil.opFront",ya="stencil.opBack",h1="scissor.enable",Cs="scissor.box",rr="viewport",ba="profile",Br="framebuffer",_a="vert",xa="frag",zr="elements",Vr="primitive",jr="count",Os="offset",Rs="instances",wa="vao",el="Width",tl="Height",$o=Br+el,So=Br+tl,t_=rr+el,n_=rr+tl,p1="drawingBuffer",m1=p1+el,v1=p1+tl,r_=[Xc,qc,Qc,Jc,ya,Kc,rr,Cs,Zc],Po=34962,nl=34963,o_=35632,a_=35633,g1=3553,s_=34067,i_=2884,c_=3042,l_=3024,u_=2960,f_=2929,d_=3089,h_=32823,p_=32926,m_=32928,rl=5126,Ns=35664,Ms=35665,Ds=35666,ol=5124,Ls=35667,ks=35668,Is=35669,al=35670,Fs=35671,Gs=35672,Bs=35673,Ea=35674,Aa=35675,Ta=35676,$a=35678,Sa=35680,sl=4,Pa=1028,Ur=1029,y1=2304,il=2305,v_=32775,g_=32776,y_=519,vr=7680,b1=0,_1=1,x1=32774,b_=513,w1=36160,__=36064,Xn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},E1=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Co={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},gr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},A1={frag:o_,vert:a_},cl={cw:y1,ccw:il};function zs(d){return Array.isArray(d)||n(d)||Bn(d)}function T1(d){return d.sort(function(b,C){return b===rr?-1:C===rr?1:b<C?-1:1})}function Yt(d,b,C,Y){this.thisDep=d,this.contextDep=b,this.propDep=C,this.append=Y}function yr(d){return d&&!(d.thisDep||d.contextDep||d.propDep)}function zt(d){return new Yt(!1,!1,!1,d)}function bn(d,b){var C=d.type;if(C===zc){var Y=d.data.length;return new Yt(!0,Y>=1,Y>=2,b)}else if(C===Ps){var re=d.data;return new Yt(re.thisDep,re.contextDep,re.propDep,b)}else{if(C===Kd)return new Yt(!1,!1,!1,b);if(C===Qd){for(var H=!1,Q=!1,ue=!1,le=0;le<d.data.length;++le){var ve=d.data[le];if(ve.type===Vc)ue=!0;else if(ve.type===jc)Q=!0;else if(ve.type===Uc)H=!0;else if(ve.type===zc){H=!0;var ye=ve.data;ye>=1&&(Q=!0),ye>=2&&(ue=!0)}else ve.type===Ps&&(H=H||ve.data.thisDep,Q=Q||ve.data.contextDep,ue=ue||ve.data.propDep)}return new Yt(H,Q,ue,b)}else return new Yt(C===Uc,C===jc,C===Vc,b)}}var $1=new Yt(!1,!1,!1,function(){});function x_(d,b,C,Y,re,H,Q,ue,le,ve,ye,ge,we,fe,me){var z=ve.Record,K={add:32774,subtract:32778,"reverse subtract":32779};C.ext_blend_minmax&&(K.min=v_,K.max=g_);var pe=C.angle_instanced_arrays,Oe=C.webgl_draw_buffers,ie=C.oes_vertex_array_object,Pe={dirty:!0,profile:me.profile},$e={},Be=[],oe={},ne={};function Me(w){return w.replace(".","_")}function Ee(w,y,M){var B=Me(w);Be.push(w),$e[B]=Pe[B]=!!M,oe[B]=y}function he(w,y,M){var B=Me(w);Be.push(w),Array.isArray(M)?(Pe[B]=M.slice(),$e[B]=M.slice()):Pe[B]=$e[B]=M,ne[B]=y}Ee(Jd,l_),Ee(e1,c_),he(t1,"blendColor",[0,0,0,0]),he(qc,"blendEquationSeparate",[x1,x1]),he(Xc,"blendFuncSeparate",[_1,b1,_1,b1]),Ee(n1,f_,!0),he(r1,"depthFunc",b_),he(o1,"depthRange",[0,1]),he(a1,"depthMask",!0),he(Hc,Hc,[!0,!0,!0,!0]),Ee(s1,i_),he(i1,"cullFace",Ur),he(Wc,Wc,il),he(Yc,Yc,1),Ee(c1,h_),he(Zc,"polygonOffset",[0,0]),Ee(l1,p_),Ee(u1,m_),he(Kc,"sampleCoverage",[1,!1]),Ee(f1,u_),he(d1,"stencilMask",-1),he(Qc,"stencilFunc",[y_,0,-1]),he(Jc,"stencilOpSeparate",[Pa,vr,vr,vr]),he(ya,"stencilOpSeparate",[Ur,vr,vr,vr]),Ee(h1,d_),he(Cs,"scissor",[0,0,d.drawingBufferWidth,d.drawingBufferHeight]),he(rr,rr,[0,0,d.drawingBufferWidth,d.drawingBufferHeight]);var Ae={gl:d,context:we,strings:b,next:$e,current:Pe,draw:ge,elements:H,buffer:re,shader:ye,attributes:ve.state,vao:ve,uniforms:le,framebuffer:ue,extensions:C,timer:fe,isBufferArgs:zs},Te={primTypes:pr,compareFuncs:Co,blendFuncs:Xn,blendEquations:K,stencilOps:gr,glTypes:Lr,orientationType:cl};_.optional(function(){Ae.isArrayLike=Ot}),Oe&&(Te.backBuffer=[Ur],Te.drawBuffer=$n(Y.maxDrawbuffers,function(w){return w===0?[0]:$n(w,function(y){return __+y})}));var Ke=0;function Ye(){var w=e_(),y=w.link,M=w.global;w.id=Ke++,w.batchId="0";var B=y(Ae),V=w.shared={props:"a0"};Object.keys(Ae).forEach(function($){V[$]=M.def(B,".",$)}),_.optional(function(){w.CHECK=y(_),w.commandStr=_.guessCommand(),w.command=y(w.commandStr),w.assert=function($,A,U){$("if(!(",A,"))",this.CHECK,".commandRaise(",y(U),",",this.command,");")},Te.invalidBlendCombinations=E1});var k=w.next={},D=w.current={};Object.keys(ne).forEach(function($){Array.isArray(Pe[$])&&(k[$]=M.def(V.next,".",$),D[$]=M.def(V.current,".",$))});var F=w.constants={};Object.keys(Te).forEach(function($){F[$]=M.def(JSON.stringify(Te[$]))}),w.invoke=function($,A){switch(A.type){case zc:var U=["this",V.context,V.props,w.batchId];return $.def(y(A.data),".call(",U.slice(0,Math.max(A.data.length+1,4)),")");case Vc:return $.def(V.props,A.data);case jc:return $.def(V.context,A.data);case Uc:return $.def("this",A.data);case Ps:return A.data.append(w,$),A.data.ref;case Kd:return A.data.toString();case Qd:return A.data.map(function(j){return w.invoke($,j)})}},w.attribCache={};var E={};return w.scopeAttrib=function($){var A=b.id($);if(A in E)return E[A];var U=ve.scope[A];U||(U=ve.scope[A]=new z);var j=E[A]=y(U);return j},w}function Se(w){var y=w.static,M=w.dynamic,B;if(ba in y){var V=!!y[ba];B=zt(function(D,F){return V}),B.enable=V}else if(ba in M){var k=M[ba];B=bn(k,function(D,F){return D.invoke(F,k)})}return B}function Ce(w,y){var M=w.static,B=w.dynamic;if(Br in M){var V=M[Br];return V?(V=ue.getFramebuffer(V),_.command(V,"invalid framebuffer object"),zt(function(D,F){var E=D.link(V),$=D.shared;F.set($.framebuffer,".next",E);var A=$.context;return F.set(A,"."+$o,E+".width"),F.set(A,"."+So,E+".height"),E})):zt(function(D,F){var E=D.shared;F.set(E.framebuffer,".next","null");var $=E.context;return F.set($,"."+$o,$+"."+m1),F.set($,"."+So,$+"."+v1),"null"})}else if(Br in B){var k=B[Br];return bn(k,function(D,F){var E=D.invoke(F,k),$=D.shared,A=$.framebuffer,U=F.def(A,".getFramebuffer(",E,")");_.optional(function(){D.assert(F,"!"+E+"||"+U,"invalid framebuffer object")}),F.set(A,".next",U);var j=$.context;return F.set(j,"."+$o,U+"?"+U+".width:"+j+"."+m1),F.set(j,"."+So,U+"?"+U+".height:"+j+"."+v1),U})}else return null}function Ue(w,y,M){var B=w.static,V=w.dynamic;function k(E){if(E in B){var $=B[E];_.commandType($,"object","invalid "+E,M.commandStr);var A=!0,U=$.x|0,j=$.y|0,te,ae;return"width"in $?(te=$.width|0,_.command(te>=0,"invalid "+E,M.commandStr)):A=!1,"height"in $?(ae=$.height|0,_.command(ae>=0,"invalid "+E,M.commandStr)):A=!1,new Yt(!A&&y&&y.thisDep,!A&&y&&y.contextDep,!A&&y&&y.propDep,function(Ge,Re){var se=Ge.shared.context,ee=te;"width"in $||(ee=Re.def(se,".",$o,"-",U));var Ie=ae;return"height"in $||(Ie=Re.def(se,".",So,"-",j)),[U,j,ee,Ie]})}else if(E in V){var xe=V[E],Xe=bn(xe,function(Ge,Re){var se=Ge.invoke(Re,xe);_.optional(function(){Ge.assert(Re,se+"&&typeof "+se+'==="object"',"invalid "+E)});var ee=Ge.shared.context,Ie=Re.def(se,".x|0"),Le=Re.def(se,".y|0"),qe=Re.def('"width" in ',se,"?",se,".width|0:","(",ee,".",$o,"-",Ie,")"),yt=Re.def('"height" in ',se,"?",se,".height|0:","(",ee,".",So,"-",Le,")");return _.optional(function(){Ge.assert(Re,qe+">=0&&"+yt+">=0","invalid "+E)}),[Ie,Le,qe,yt]});return y&&(Xe.thisDep=Xe.thisDep||y.thisDep,Xe.contextDep=Xe.contextDep||y.contextDep,Xe.propDep=Xe.propDep||y.propDep),Xe}else return y?new Yt(y.thisDep,y.contextDep,y.propDep,function(Ge,Re){var se=Ge.shared.context;return[0,0,Re.def(se,".",$o),Re.def(se,".",So)]}):null}var D=k(rr);if(D){var F=D;D=new Yt(D.thisDep,D.contextDep,D.propDep,function(E,$){var A=F.append(E,$),U=E.shared.context;return $.set(U,"."+t_,A[2]),$.set(U,"."+n_,A[3]),A})}return{viewport:D,scissor_box:k(Cs)}}function Qe(w,y){var M=w.static,B=typeof M[xa]=="string"&&typeof M[_a]=="string";if(B){if(Object.keys(y.dynamic).length>0)return null;var V=y.static,k=Object.keys(V);if(k.length>0&&typeof V[k[0]]=="number"){for(var D=[],F=0;F<k.length;++F)_(typeof V[k[F]]=="number","must specify all vertex attribute locations when using vaos"),D.push([V[k[F]]|0,k[F]]);return D}}return null}function it(w,y,M){var B=w.static,V=w.dynamic;function k(A){if(A in B){var U=b.id(B[A]);_.optional(function(){ye.shader(A1[A],U,_.guessCommand())});var j=zt(function(){return U});return j.id=U,j}else if(A in V){var te=V[A];return bn(te,function(ae,xe){var Xe=ae.invoke(xe,te),Ge=xe.def(ae.shared.strings,".id(",Xe,")");return _.optional(function(){xe(ae.shared.shader,".shader(",A1[A],",",Ge,",",ae.command,");")}),Ge})}return null}var D=k(xa),F=k(_a),E=null,$;return yr(D)&&yr(F)?(E=ye.program(F.id,D.id,null,M),$=zt(function(A,U){return A.link(E)})):$=new Yt(D&&D.thisDep||F&&F.thisDep,D&&D.contextDep||F&&F.contextDep,D&&D.propDep||F&&F.propDep,function(A,U){var j=A.shared.shader,te;D?te=D.append(A,U):te=U.def(j,".",xa);var ae;F?ae=F.append(A,U):ae=U.def(j,".",_a);var xe=j+".program("+ae+","+te;return _.optional(function(){xe+=","+A.command}),U.def(xe+")")}),{frag:D,vert:F,progVar:$,program:E}}function Rt(w,y){var M=w.static,B=w.dynamic,V={},k=!1;function D(){if(wa in M){var Re=M[wa];return Re!==null&&ve.getVAO(Re)===null&&(Re=ve.createVAO(Re)),k=!0,V.vao=Re,zt(function(ee){var Ie=ve.getVAO(Re);return Ie?ee.link(Ie):"null"})}else if(wa in B){k=!0;var se=B[wa];return bn(se,function(ee,Ie){var Le=ee.invoke(Ie,se);return Ie.def(ee.shared.vao+".getVAO("+Le+")")})}return null}var F=D(),E=!1;function $(){if(zr in M){var Re=M[zr];if(V.elements=Re,zs(Re)){var se=V.elements=H.create(Re,!0);Re=H.getElements(se),E=!0}else Re&&(Re=H.getElements(Re),E=!0,_.command(Re,"invalid elements",y.commandStr));var ee=zt(function(Le,qe){if(Re){var yt=Le.link(Re);return Le.ELEMENTS=yt,yt}return Le.ELEMENTS=null,null});return ee.value=Re,ee}else if(zr in B){E=!0;var Ie=B[zr];return bn(Ie,function(Le,qe){var yt=Le.shared,on=yt.isBufferArgs,Xr=yt.elements,or=Le.invoke(qe,Ie),Wn=qe.def("null"),br=qe.def(on,"(",or,")"),Hr=Le.cond(br).then(Wn,"=",Xr,".createStream(",or,");").else(Wn,"=",Xr,".getElements(",or,");");return _.optional(function(){Le.assert(Hr.else,"!"+or+"||"+Wn,"invalid elements")}),qe.entry(Hr),qe.exit(Le.cond(br).then(Xr,".destroyStream(",Wn,");")),Le.ELEMENTS=Wn,Wn})}else if(k)return new Yt(F.thisDep,F.contextDep,F.propDep,function(Le,qe){return qe.def(Le.shared.vao+".currentVAO?"+Le.shared.elements+".getElements("+Le.shared.vao+".currentVAO.elements):null")});return null}var A=$();function U(){if(Vr in M){var Re=M[Vr];return V.primitive=Re,_.commandParameter(Re,pr,"invalid primitve",y.commandStr),zt(function(ee,Ie){return pr[Re]})}else if(Vr in B){var se=B[Vr];return bn(se,function(ee,Ie){var Le=ee.constants.primTypes,qe=ee.invoke(Ie,se);return _.optional(function(){ee.assert(Ie,qe+" in "+Le,"invalid primitive, must be one of "+Object.keys(pr))}),Ie.def(Le,"[",qe,"]")})}else{if(E)return yr(A)?A.value?zt(function(ee,Ie){return Ie.def(ee.ELEMENTS,".primType")}):zt(function(){return sl}):new Yt(A.thisDep,A.contextDep,A.propDep,function(ee,Ie){var Le=ee.ELEMENTS;return Ie.def(Le,"?",Le,".primType:",sl)});if(k)return new Yt(F.thisDep,F.contextDep,F.propDep,function(ee,Ie){return Ie.def(ee.shared.vao+".currentVAO?"+ee.shared.vao+".currentVAO.primitive:"+sl)})}return null}function j(Re,se){if(Re in M){var ee=M[Re]|0;return se?V.offset=ee:V.instances=ee,_.command(!se||ee>=0,"invalid "+Re,y.commandStr),zt(function(Le,qe){return se&&(Le.OFFSET=ee),ee})}else if(Re in B){var Ie=B[Re];return bn(Ie,function(Le,qe){var yt=Le.invoke(qe,Ie);return se&&(Le.OFFSET=yt,_.optional(function(){Le.assert(qe,yt+">=0","invalid "+Re)})),yt})}else if(se){if(E)return zt(function(Le,qe){return Le.OFFSET=0,0});if(k)return new Yt(F.thisDep,F.contextDep,F.propDep,function(Le,qe){return qe.def(Le.shared.vao+".currentVAO?"+Le.shared.vao+".currentVAO.offset:0")})}else if(k)return new Yt(F.thisDep,F.contextDep,F.propDep,function(Le,qe){return qe.def(Le.shared.vao+".currentVAO?"+Le.shared.vao+".currentVAO.instances:-1")});return null}var te=j(Os,!0);function ae(){if(jr in M){var Re=M[jr]|0;return V.count=Re,_.command(typeof Re=="number"&&Re>=0,"invalid vertex count",y.commandStr),zt(function(){return Re})}else if(jr in B){var se=B[jr];return bn(se,function(qe,yt){var on=qe.invoke(yt,se);return _.optional(function(){qe.assert(yt,"typeof "+on+'==="number"&&'+on+">=0&&"+on+"===("+on+"|0)","invalid vertex count")}),on})}else if(E)if(yr(A)){if(A)return te?new Yt(te.thisDep,te.contextDep,te.propDep,function(qe,yt){var on=yt.def(qe.ELEMENTS,".vertCount-",qe.OFFSET);return _.optional(function(){qe.assert(yt,on+">=0","invalid vertex offset/element buffer too small")}),on}):zt(function(qe,yt){return yt.def(qe.ELEMENTS,".vertCount")});var ee=zt(function(){return-1});return _.optional(function(){ee.MISSING=!0}),ee}else{var Ie=new Yt(A.thisDep||te.thisDep,A.contextDep||te.contextDep,A.propDep||te.propDep,function(qe,yt){var on=qe.ELEMENTS;return qe.OFFSET?yt.def(on,"?",on,".vertCount-",qe.OFFSET,":-1"):yt.def(on,"?",on,".vertCount:-1")});return _.optional(function(){Ie.DYNAMIC=!0}),Ie}else if(k){var Le=new Yt(F.thisDep,F.contextDep,F.propDep,function(qe,yt){return yt.def(qe.shared.vao,".currentVAO?",qe.shared.vao,".currentVAO.count:-1")});return Le}return null}var xe=U(),Xe=ae(),Ge=j(Rs,!1);return{elements:A,primitive:xe,count:Xe,instances:Ge,offset:te,vao:F,vaoActive:k,elementsActive:E,static:V}}function Nt(w,y){var M=w.static,B=w.dynamic,V={};return Be.forEach(function(k){var D=Me(k);function F(E,$){if(k in M){var A=E(M[k]);V[D]=zt(function(){return A})}else if(k in B){var U=B[k];V[D]=bn(U,function(j,te){return $(j,te,j.invoke(te,U))})}}switch(k){case s1:case e1:case Jd:case f1:case n1:case h1:case c1:case l1:case u1:case a1:return F(function(E){return _.commandType(E,"boolean",k,y.commandStr),E},function(E,$,A){return _.optional(function(){E.assert($,"typeof "+A+'==="boolean"',"invalid flag "+k,E.commandStr)}),A});case r1:return F(function(E){return _.commandParameter(E,Co,"invalid "+k,y.commandStr),Co[E]},function(E,$,A){var U=E.constants.compareFuncs;return _.optional(function(){E.assert($,A+" in "+U,"invalid "+k+", must be one of "+Object.keys(Co))}),$.def(U,"[",A,"]")});case o1:return F(function(E){return _.command(Ot(E)&&E.length===2&&typeof E[0]=="number"&&typeof E[1]=="number"&&E[0]<=E[1],"depth range is 2d array",y.commandStr),E},function(E,$,A){_.optional(function(){E.assert($,E.shared.isArrayLike+"("+A+")&&"+A+".length===2&&typeof "+A+'[0]==="number"&&typeof '+A+'[1]==="number"&&'+A+"[0]<="+A+"[1]","depth range must be a 2d array")});var U=$.def("+",A,"[0]"),j=$.def("+",A,"[1]");return[U,j]});case Xc:return F(function(E){_.commandType(E,"object","blend.func",y.commandStr);var $="srcRGB"in E?E.srcRGB:E.src,A="srcAlpha"in E?E.srcAlpha:E.src,U="dstRGB"in E?E.dstRGB:E.dst,j="dstAlpha"in E?E.dstAlpha:E.dst;return _.commandParameter($,Xn,D+".srcRGB",y.commandStr),_.commandParameter(A,Xn,D+".srcAlpha",y.commandStr),_.commandParameter(U,Xn,D+".dstRGB",y.commandStr),_.commandParameter(j,Xn,D+".dstAlpha",y.commandStr),_.command(E1.indexOf($+", "+U)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+$+", "+U+")",y.commandStr),[Xn[$],Xn[U],Xn[A],Xn[j]]},function(E,$,A){var U=E.constants.blendFuncs;_.optional(function(){E.assert($,A+"&&typeof "+A+'==="object"',"invalid blend func, must be an object")});function j(se,ee){var Ie=$.def('"',se,ee,'" in ',A,"?",A,".",se,ee,":",A,".",se);return _.optional(function(){E.assert($,Ie+" in "+U,"invalid "+k+"."+se+ee+", must be one of "+Object.keys(Xn))}),Ie}var te=j("src","RGB"),ae=j("dst","RGB");_.optional(function(){var se=E.constants.invalidBlendCombinations;E.assert($,se+".indexOf("+te+'+", "+'+ae+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var xe=$.def(U,"[",te,"]"),Xe=$.def(U,"[",j("src","Alpha"),"]"),Ge=$.def(U,"[",ae,"]"),Re=$.def(U,"[",j("dst","Alpha"),"]");return[xe,Ge,Xe,Re]});case qc:return F(function(E){if(typeof E=="string")return _.commandParameter(E,K,"invalid "+k,y.commandStr),[K[E],K[E]];if(typeof E=="object")return _.commandParameter(E.rgb,K,k+".rgb",y.commandStr),_.commandParameter(E.alpha,K,k+".alpha",y.commandStr),[K[E.rgb],K[E.alpha]];_.commandRaise("invalid blend.equation",y.commandStr)},function(E,$,A){var U=E.constants.blendEquations,j=$.def(),te=$.def(),ae=E.cond("typeof ",A,'==="string"');return _.optional(function(){function xe(Xe,Ge,Re){E.assert(Xe,Re+" in "+U,"invalid "+Ge+", must be one of "+Object.keys(K))}xe(ae.then,k,A),E.assert(ae.else,A+"&&typeof "+A+'==="object"',"invalid "+k),xe(ae.else,k+".rgb",A+".rgb"),xe(ae.else,k+".alpha",A+".alpha")}),ae.then(j,"=",te,"=",U,"[",A,"];"),ae.else(j,"=",U,"[",A,".rgb];",te,"=",U,"[",A,".alpha];"),$(ae),[j,te]});case t1:return F(function(E){return _.command(Ot(E)&&E.length===4,"blend.color must be a 4d array",y.commandStr),$n(4,function($){return+E[$]})},function(E,$,A){return _.optional(function(){E.assert($,E.shared.isArrayLike+"("+A+")&&"+A+".length===4","blend.color must be a 4d array")}),$n(4,function(U){return $.def("+",A,"[",U,"]")})});case d1:return F(function(E){return _.commandType(E,"number",D,y.commandStr),E|0},function(E,$,A){return _.optional(function(){E.assert($,"typeof "+A+'==="number"',"invalid stencil.mask")}),$.def(A,"|0")});case Qc:return F(function(E){_.commandType(E,"object",D,y.commandStr);var $=E.cmp||"keep",A=E.ref||0,U="mask"in E?E.mask:-1;return _.commandParameter($,Co,k+".cmp",y.commandStr),_.commandType(A,"number",k+".ref",y.commandStr),_.commandType(U,"number",k+".mask",y.commandStr),[Co[$],A,U]},function(E,$,A){var U=E.constants.compareFuncs;_.optional(function(){function xe(){E.assert($,Array.prototype.join.call(arguments,""),"invalid stencil.func")}xe(A+"&&typeof ",A,'==="object"'),xe('!("cmp" in ',A,")||(",A,".cmp in ",U,")")});var j=$.def('"cmp" in ',A,"?",U,"[",A,".cmp]",":",vr),te=$.def(A,".ref|0"),ae=$.def('"mask" in ',A,"?",A,".mask|0:-1");return[j,te,ae]});case Jc:case ya:return F(function(E){_.commandType(E,"object",D,y.commandStr);var $=E.fail||"keep",A=E.zfail||"keep",U=E.zpass||"keep";return _.commandParameter($,gr,k+".fail",y.commandStr),_.commandParameter(A,gr,k+".zfail",y.commandStr),_.commandParameter(U,gr,k+".zpass",y.commandStr),[k===ya?Ur:Pa,gr[$],gr[A],gr[U]]},function(E,$,A){var U=E.constants.stencilOps;_.optional(function(){E.assert($,A+"&&typeof "+A+'==="object"',"invalid "+k)});function j(te){return _.optional(function(){E.assert($,'!("'+te+'" in '+A+")||("+A+"."+te+" in "+U+")","invalid "+k+"."+te+", must be one of "+Object.keys(gr))}),$.def('"',te,'" in ',A,"?",U,"[",A,".",te,"]:",vr)}return[k===ya?Ur:Pa,j("fail"),j("zfail"),j("zpass")]});case Zc:return F(function(E){_.commandType(E,"object",D,y.commandStr);var $=E.factor|0,A=E.units|0;return _.commandType($,"number",D+".factor",y.commandStr),_.commandType(A,"number",D+".units",y.commandStr),[$,A]},function(E,$,A){_.optional(function(){E.assert($,A+"&&typeof "+A+'==="object"',"invalid "+k)});var U=$.def(A,".factor|0"),j=$.def(A,".units|0");return[U,j]});case i1:return F(function(E){var $=0;return E==="front"?$=Pa:E==="back"&&($=Ur),_.command(!!$,D,y.commandStr),$},function(E,$,A){return _.optional(function(){E.assert($,A+'==="front"||'+A+'==="back"',"invalid cull.face")}),$.def(A,'==="front"?',Pa,":",Ur)});case Yc:return F(function(E){return _.command(typeof E=="number"&&E>=Y.lineWidthDims[0]&&E<=Y.lineWidthDims[1],"invalid line width, must be a positive number between "+Y.lineWidthDims[0]+" and "+Y.lineWidthDims[1],y.commandStr),E},function(E,$,A){return _.optional(function(){E.assert($,"typeof "+A+'==="number"&&'+A+">="+Y.lineWidthDims[0]+"&&"+A+"<="+Y.lineWidthDims[1],"invalid line width")}),A});case Wc:return F(function(E){return _.commandParameter(E,cl,D,y.commandStr),cl[E]},function(E,$,A){return _.optional(function(){E.assert($,A+'==="cw"||'+A+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),$.def(A+'==="cw"?'+y1+":"+il)});case Hc:return F(function(E){return _.command(Ot(E)&&E.length===4,"color.mask must be length 4 array",y.commandStr),E.map(function($){return!!$})},function(E,$,A){return _.optional(function(){E.assert($,E.shared.isArrayLike+"("+A+")&&"+A+".length===4","invalid color.mask")}),$n(4,function(U){return"!!"+A+"["+U+"]"})});case Kc:return F(function(E){_.command(typeof E=="object"&&E,D,y.commandStr);var $="value"in E?E.value:1,A=!!E.invert;return _.command(typeof $=="number"&&$>=0&&$<=1,"sample.coverage.value must be a number between 0 and 1",y.commandStr),[$,A]},function(E,$,A){_.optional(function(){E.assert($,A+"&&typeof "+A+'==="object"',"invalid sample.coverage")});var U=$.def('"value" in ',A,"?+",A,".value:1"),j=$.def("!!",A,".invert");return[U,j]})}}),V}function lt(w,y){var M=w.static,B=w.dynamic,V={};return Object.keys(M).forEach(function(k){var D=M[k],F;if(typeof D=="number"||typeof D=="boolean")F=zt(function(){return D});else if(typeof D=="function"){var E=D._reglType;E==="texture2d"||E==="textureCube"?F=zt(function($){return $.link(D)}):E==="framebuffer"||E==="framebufferCube"?(_.command(D.color.length>0,'missing color attachment for framebuffer sent to uniform "'+k+'"',y.commandStr),F=zt(function($){return $.link(D.color[0])})):_.commandRaise('invalid data for uniform "'+k+'"',y.commandStr)}else Ot(D)?F=zt(function($){var A=$.global.def("[",$n(D.length,function(U){return _.command(typeof D[U]=="number"||typeof D[U]=="boolean","invalid uniform "+k,$.commandStr),D[U]}),"]");return A}):_.commandRaise('invalid or missing data for uniform "'+k+'"',y.commandStr);F.value=D,V[k]=F}),Object.keys(B).forEach(function(k){var D=B[k];V[k]=bn(D,function(F,E){return F.invoke(E,D)})}),V}function qt(w,y){var M=w.static,B=w.dynamic,V={};return Object.keys(M).forEach(function(k){var D=M[k],F=b.id(k),E=new z;if(zs(D))E.state=To,E.buffer=re.getBuffer(re.create(D,Po,!1,!0)),E.type=0;else{var $=re.getBuffer(D);if($)E.state=To,E.buffer=$,E.type=0;else if(_.command(typeof D=="object"&&D,"invalid data for attribute "+k,y.commandStr),"constant"in D){var A=D.constant;E.buffer="null",E.state=Bc,typeof A=="number"?E.x=A:(_.command(Ot(A)&&A.length>0&&A.length<=4,"invalid constant for attribute "+k,y.commandStr),Ao.forEach(function(Ge,Re){Re<A.length&&(E[Ge]=A[Re])}))}else{zs(D.buffer)?$=re.getBuffer(re.create(D.buffer,Po,!1,!0)):$=re.getBuffer(D.buffer),_.command(!!$,'missing buffer for attribute "'+k+'"',y.commandStr);var U=D.offset|0;_.command(U>=0,'invalid offset for attribute "'+k+'"',y.commandStr);var j=D.stride|0;_.command(j>=0&&j<256,'invalid stride for attribute "'+k+'", must be integer betweeen [0, 255]',y.commandStr);var te=D.size|0;_.command(!("size"in D)||te>0&&te<=4,'invalid size for attribute "'+k+'", must be 1,2,3,4',y.commandStr);var ae=!!D.normalized,xe=0;"type"in D&&(_.commandParameter(D.type,Lr,"invalid type for attribute "+k,y.commandStr),xe=Lr[D.type]);var Xe=D.divisor|0;_.optional(function(){"divisor"in D&&(_.command(Xe===0||pe,'cannot specify divisor for attribute "'+k+'", instancing not supported',y.commandStr),_.command(Xe>=0,'invalid divisor for attribute "'+k+'"',y.commandStr));var Ge=y.commandStr,Re=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(D).forEach(function(se){_.command(Re.indexOf(se)>=0,'unknown parameter "'+se+'" for attribute pointer "'+k+'" (valid parameters are '+Re+")",Ge)})}),E.buffer=$,E.state=To,E.size=te,E.normalized=ae,E.type=xe||$.dtype,E.offset=U,E.stride=j,E.divisor=Xe}}V[k]=zt(function(Ge,Re){var se=Ge.attribCache;if(F in se)return se[F];var ee={isStream:!1};return Object.keys(E).forEach(function(Ie){ee[Ie]=E[Ie]}),E.buffer&&(ee.buffer=Ge.link(E.buffer),ee.type=ee.type||ee.buffer+".dtype"),se[F]=ee,ee})}),Object.keys(B).forEach(function(k){var D=B[k];function F(E,$){var A=E.invoke($,D),U=E.shared,j=E.constants,te=U.isBufferArgs,ae=U.buffer;_.optional(function(){E.assert($,A+"&&(typeof "+A+'==="object"||typeof '+A+'==="function")&&('+te+"("+A+")||"+ae+".getBuffer("+A+")||"+ae+".getBuffer("+A+".buffer)||"+te+"("+A+'.buffer)||("constant" in '+A+"&&(typeof "+A+'.constant==="number"||'+U.isArrayLike+"("+A+".constant))))",'invalid dynamic attribute "'+k+'"')});var xe={isStream:$.def(!1)},Xe=new z;Xe.state=To,Object.keys(Xe).forEach(function(ee){xe[ee]=$.def(""+Xe[ee])});var Ge=xe.buffer,Re=xe.type;$("if(",te,"(",A,")){",xe.isStream,"=true;",Ge,"=",ae,".createStream(",Po,",",A,");",Re,"=",Ge,".dtype;","}else{",Ge,"=",ae,".getBuffer(",A,");","if(",Ge,"){",Re,"=",Ge,".dtype;",'}else if("constant" in ',A,"){",xe.state,"=",Bc,";","if(typeof "+A+'.constant === "number"){',xe[Ao[0]],"=",A,".constant;",Ao.slice(1).map(function(ee){return xe[ee]}).join("="),"=0;","}else{",Ao.map(function(ee,Ie){return xe[ee]+"="+A+".constant.length>"+Ie+"?"+A+".constant["+Ie+"]:0;"}).join(""),"}}else{","if(",te,"(",A,".buffer)){",Ge,"=",ae,".createStream(",Po,",",A,".buffer);","}else{",Ge,"=",ae,".getBuffer(",A,".buffer);","}",Re,'="type" in ',A,"?",j.glTypes,"[",A,".type]:",Ge,".dtype;",xe.normalized,"=!!",A,".normalized;");function se(ee){$(xe[ee],"=",A,".",ee,"|0;")}return se("size"),se("offset"),se("stride"),se("divisor"),$("}}"),$.exit("if(",xe.isStream,"){",ae,".destroyStream(",Ge,");","}"),xe}V[k]=bn(D,F)}),V}function At(w){var y=w.static,M=w.dynamic,B={};return Object.keys(y).forEach(function(V){var k=y[V];B[V]=zt(function(D,F){return typeof k=="number"||typeof k=="boolean"?""+k:D.link(k)})}),Object.keys(M).forEach(function(V){var k=M[V];B[V]=bn(k,function(D,F){return D.invoke(F,k)})}),B}function Vt(w,y,M,B,V){var k=w.static,D=w.dynamic;_.optional(function(){var se=[Br,_a,xa,zr,Vr,Os,jr,Rs,ba,wa].concat(Be);function ee(Ie){Object.keys(Ie).forEach(function(Le){_.command(se.indexOf(Le)>=0,'unknown parameter "'+Le+'"',V.commandStr)})}ee(k),ee(D)});var F=Qe(w,y),E=Ce(w),$=Ue(w,E,V),A=Rt(w,V),U=Nt(w,V),j=it(w,V,F);function te(se){var ee=$[se];ee&&(U[se]=ee)}te(rr),te(Me(Cs));var ae=Object.keys(U).length>0,xe={framebuffer:E,draw:A,shader:j,state:U,dirty:ae,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(xe.profile=Se(w),xe.uniforms=lt(M,V),xe.drawVAO=xe.scopeVAO=A.vao,!xe.drawVAO&&j.program&&!F&&C.angle_instanced_arrays&&A.static.elements){var Xe=!0,Ge=j.program.attributes.map(function(se){var ee=y.static[se];return Xe=Xe&&!!ee,ee});if(Xe&&Ge.length>0){var Re=ve.getVAO(ve.createVAO({attributes:Ge,elements:A.static.elements}));xe.drawVAO=new Yt(null,null,null,function(se,ee){return se.link(Re)}),xe.useVAO=!0}}return F?xe.useVAO=!0:xe.attributes=qt(y,V),xe.context=At(B),xe}function Xt(w,y,M){var B=w.shared,V=B.context,k=w.scope();Object.keys(M).forEach(function(D){y.save(V,"."+D);var F=M[D],E=F.append(w,y);Array.isArray(E)?k(V,".",D,"=[",E.join(),"];"):k(V,".",D,"=",E,";")}),y(k)}function Ht(w,y,M,B){var V=w.shared,k=V.gl,D=V.framebuffer,F;Oe&&(F=y.def(V.extensions,".webgl_draw_buffers"));var E=w.constants,$=E.drawBuffer,A=E.backBuffer,U;M?U=M.append(w,y):U=y.def(D,".next"),B||y("if(",U,"!==",D,".cur){"),y("if(",U,"){",k,".bindFramebuffer(",w1,",",U,".framebuffer);"),Oe&&y(F,".drawBuffersWEBGL(",$,"[",U,".colorAttachments.length]);"),y("}else{",k,".bindFramebuffer(",w1,",null);"),Oe&&y(F,".drawBuffersWEBGL(",A,");"),y("}",D,".cur=",U,";"),B||y("}")}function Qt(w,y,M){var B=w.shared,V=B.gl,k=w.current,D=w.next,F=B.current,E=B.next,$=w.cond(F,".dirty");Be.forEach(function(A){var U=Me(A);if(!(U in M.state)){var j,te;if(U in D){j=D[U],te=k[U];var ae=$n(Pe[U].length,function(Xe){return $.def(j,"[",Xe,"]")});$(w.cond(ae.map(function(Xe,Ge){return Xe+"!=="+te+"["+Ge+"]"}).join("||")).then(V,".",ne[U],"(",ae,");",ae.map(function(Xe,Ge){return te+"["+Ge+"]="+Xe}).join(";"),";"))}else{j=$.def(E,".",U);var xe=w.cond(j,"!==",F,".",U);$(xe),U in oe?xe(w.cond(j).then(V,".enable(",oe[U],");").else(V,".disable(",oe[U],");"),F,".",U,"=",j,";"):xe(V,".",ne[U],"(",j,");",F,".",U,"=",j,";")}}}),Object.keys(M.state).length===0&&$(F,".dirty=false;"),y($)}function nn(w,y,M,B){var V=w.shared,k=w.current,D=V.current,F=V.gl;T1(Object.keys(M)).forEach(function(E){var $=M[E];if(!(B&&!B($))){var A=$.append(w,y);if(oe[E]){var U=oe[E];yr($)?A?y(F,".enable(",U,");"):y(F,".disable(",U,");"):y(w.cond(A).then(F,".enable(",U,");").else(F,".disable(",U,");")),y(D,".",E,"=",A,";")}else if(Ot(A)){var j=k[E];y(F,".",ne[E],"(",A,");",A.map(function(te,ae){return j+"["+ae+"]="+te}).join(";"),";")}else y(F,".",ne[E],"(",A,");",D,".",E,"=",A,";")}})}function It(w,y){pe&&(w.instancing=y.def(w.shared.extensions,".angle_instanced_arrays"))}function tt(w,y,M,B,V){var k=w.shared,D=w.stats,F=k.current,E=k.timer,$=M.profile;function A(){return typeof performance>"u"?"Date.now()":"performance.now()"}var U,j;function te(se){U=y.def(),se(U,"=",A(),";"),typeof V=="string"?se(D,".count+=",V,";"):se(D,".count++;"),fe&&(B?(j=y.def(),se(j,"=",E,".getNumPendingQueries();")):se(E,".beginQuery(",D,");"))}function ae(se){se(D,".cpuTime+=",A(),"-",U,";"),fe&&(B?se(E,".pushScopeStats(",j,",",E,".getNumPendingQueries(),",D,");"):se(E,".endQuery();"))}function xe(se){var ee=y.def(F,".profile");y(F,".profile=",se,";"),y.exit(F,".profile=",ee,";")}var Xe;if($){if(yr($)){$.enable?(te(y),ae(y.exit),xe("true")):xe("false");return}Xe=$.append(w,y),xe(Xe)}else Xe=y.def(F,".profile");var Ge=w.block();te(Ge),y("if(",Xe,"){",Ge,"}");var Re=w.block();ae(Re),y.exit("if(",Xe,"){",Re,"}")}function rn(w,y,M,B,V){var k=w.shared;function D(E){switch(E){case Ns:case Ls:case Fs:return 2;case Ms:case ks:case Gs:return 3;case Ds:case Is:case Bs:return 4;default:return 1}}function F(E,$,A){var U=k.gl,j=y.def(E,".location"),te=y.def(k.attributes,"[",j,"]"),ae=A.state,xe=A.buffer,Xe=[A.x,A.y,A.z,A.w],Ge=["buffer","normalized","offset","stride"];function Re(){y("if(!",te,".buffer){",U,".enableVertexAttribArray(",j,");}");var ee=A.type,Ie;if(A.size?Ie=y.def(A.size,"||",$):Ie=$,y("if(",te,".type!==",ee,"||",te,".size!==",Ie,"||",Ge.map(function(qe){return te+"."+qe+"!=="+A[qe]}).join("||"),"){",U,".bindBuffer(",Po,",",xe,".buffer);",U,".vertexAttribPointer(",[j,Ie,ee,A.normalized,A.stride,A.offset],");",te,".type=",ee,";",te,".size=",Ie,";",Ge.map(function(qe){return te+"."+qe+"="+A[qe]+";"}).join(""),"}"),pe){var Le=A.divisor;y("if(",te,".divisor!==",Le,"){",w.instancing,".vertexAttribDivisorANGLE(",[j,Le],");",te,".divisor=",Le,";}")}}function se(){y("if(",te,".buffer){",U,".disableVertexAttribArray(",j,");",te,".buffer=null;","}if(",Ao.map(function(ee,Ie){return te+"."+ee+"!=="+Xe[Ie]}).join("||"),"){",U,".vertexAttrib4f(",j,",",Xe,");",Ao.map(function(ee,Ie){return te+"."+ee+"="+Xe[Ie]+";"}).join(""),"}")}ae===To?Re():ae===Bc?se():(y("if(",ae,"===",To,"){"),Re(),y("}else{"),se(),y("}"))}B.forEach(function(E){var $=E.name,A=M.attributes[$],U;if(A){if(!V(A))return;U=A.append(w,y)}else{if(!V($1))return;var j=w.scopeAttrib($);_.optional(function(){w.assert(y,j+".state","missing attribute "+$)}),U={},Object.keys(new z).forEach(function(te){U[te]=y.def(j,".",te)})}F(w.link(E),D(E.info.type),U)})}function gt(w,y,M,B,V,k){for(var D=w.shared,F=D.gl,E={},$,A=0;A<B.length;++A){var U=B[A],j=U.name,te=U.info.type,ae=U.info.size,xe=M.uniforms[j];if(ae>1){if(!xe)continue;var Xe=j.replace("[0]","");if(E[Xe])continue;E[Xe]=1}var Ge=w.link(U),Re=Ge+".location",se;if(xe){if(!V(xe))continue;if(yr(xe)){var ee=xe.value;if(_.command(ee!==null&&typeof ee<"u",'missing uniform "'+j+'"',w.commandStr),te===$a||te===Sa){_.command(typeof ee=="function"&&(te===$a&&(ee._reglType==="texture2d"||ee._reglType==="framebuffer")||te===Sa&&(ee._reglType==="textureCube"||ee._reglType==="framebufferCube")),"invalid texture for uniform "+j,w.commandStr);var Ie=w.link(ee._texture||ee.color[0]._texture);y(F,".uniform1i(",Re,",",Ie+".bind());"),y.exit(Ie,".unbind();")}else if(te===Ea||te===Aa||te===Ta){_.optional(function(){_.command(Ot(ee),"invalid matrix for uniform "+j,w.commandStr),_.command(te===Ea&&ee.length===4||te===Aa&&ee.length===9||te===Ta&&ee.length===16,"invalid length for matrix uniform "+j,w.commandStr)});var Le=w.global.def("new Float32Array(["+Array.prototype.slice.call(ee)+"])"),qe=2;te===Aa?qe=3:te===Ta&&(qe=4),y(F,".uniformMatrix",qe,"fv(",Re,",false,",Le,");")}else{switch(te){case rl:ae===1?_.commandType(ee,"number","uniform "+j,w.commandStr):_.command(Ot(ee)&&ee.length===ae,"uniform "+j,w.commandStr),$="1f";break;case Ns:_.command(Ot(ee)&&ee.length&&ee.length%2===0&&ee.length<=ae*2,"uniform "+j,w.commandStr),$="2f";break;case Ms:_.command(Ot(ee)&&ee.length&&ee.length%3===0&&ee.length<=ae*3,"uniform "+j,w.commandStr),$="3f";break;case Ds:_.command(Ot(ee)&&ee.length&&ee.length%4===0&&ee.length<=ae*4,"uniform "+j,w.commandStr),$="4f";break;case al:ae===1?_.commandType(ee,"boolean","uniform "+j,w.commandStr):_.command(Ot(ee)&&ee.length===ae,"uniform "+j,w.commandStr),$="1i";break;case ol:ae===1?_.commandType(ee,"number","uniform "+j,w.commandStr):_.command(Ot(ee)&&ee.length===ae,"uniform "+j,w.commandStr),$="1i";break;case Fs:_.command(Ot(ee)&&ee.length&&ee.length%2===0&&ee.length<=ae*2,"uniform "+j,w.commandStr),$="2i";break;case Ls:_.command(Ot(ee)&&ee.length&&ee.length%2===0&&ee.length<=ae*2,"uniform "+j,w.commandStr),$="2i";break;case Gs:_.command(Ot(ee)&&ee.length&&ee.length%3===0&&ee.length<=ae*3,"uniform "+j,w.commandStr),$="3i";break;case ks:_.command(Ot(ee)&&ee.length&&ee.length%3===0&&ee.length<=ae*3,"uniform "+j,w.commandStr),$="3i";break;case Bs:_.command(Ot(ee)&&ee.length&&ee.length%4===0&&ee.length<=ae*4,"uniform "+j,w.commandStr),$="4i";break;case Is:_.command(Ot(ee)&&ee.length&&ee.length%4===0&&ee.length<=ae*4,"uniform "+j,w.commandStr),$="4i";break}ae>1?($+="v",ee=w.global.def("["+Array.prototype.slice.call(ee)+"]")):ee=Ot(ee)?Array.prototype.slice.call(ee):ee,y(F,".uniform",$,"(",Re,",",ee,");")}continue}else se=xe.append(w,y)}else{if(!V($1))continue;se=y.def(D.uniforms,"[",b.id(j),"]")}te===$a?(_(!Array.isArray(se),"must specify a scalar prop for textures"),y("if(",se,"&&",se,'._reglType==="framebuffer"){',se,"=",se,".color[0];","}")):te===Sa&&(_(!Array.isArray(se),"must specify a scalar prop for cube maps"),y("if(",se,"&&",se,'._reglType==="framebufferCube"){',se,"=",se,".color[0];","}")),_.optional(function(){function Pn(_n,Vs){w.assert(y,_n,'bad data or missing for uniform "'+j+'".  '+Vs)}function Wr(_n,Vs){Vs===1&&_(!Array.isArray(se),"must not specify an array type for uniform"),Pn("Array.isArray("+se+") && typeof "+se+'[0]===" '+_n+'" || typeof '+se+'==="'+_n+'"',"invalid type, expected "+_n)}function kn(_n,Vs,js){Array.isArray(se)?_(se.length&&se.length%_n===0&&se.length<=_n*js,"must have length of "+(js===1?"":"n * ")+_n):Pn(D.isArrayLike+"("+se+")&&"+se+".length && "+se+".length % "+_n+" === 0 && "+se+".length<="+_n*js,"invalid vector, should have length of "+(js===1?"":"n * ")+_n,w.commandStr)}function M1(_n){_(!Array.isArray(se),"must not specify a value type"),Pn("typeof "+se+'==="function"&&'+se+'._reglType==="texture'+(_n===g1?"2d":"Cube")+'"',"invalid texture type",w.commandStr)}switch(te){case ol:Wr("number",ae);break;case Ls:kn(2,"number",ae);break;case ks:kn(3,"number",ae);break;case Is:kn(4,"number",ae);break;case rl:Wr("number",ae);break;case Ns:kn(2,"number",ae);break;case Ms:kn(3,"number",ae);break;case Ds:kn(4,"number",ae);break;case al:Wr("boolean",ae);break;case Fs:kn(2,"boolean",ae);break;case Gs:kn(3,"boolean",ae);break;case Bs:kn(4,"boolean",ae);break;case Ea:kn(4,"number",ae);break;case Aa:kn(9,"number",ae);break;case Ta:kn(16,"number",ae);break;case $a:M1(g1);break;case Sa:M1(s_);break}});var yt=1;switch(te){case $a:case Sa:var on=y.def(se,"._texture");y(F,".uniform1i(",Re,",",on,".bind());"),y.exit(on,".unbind();");continue;case ol:case al:$="1i";break;case Ls:case Fs:$="2i",yt=2;break;case ks:case Gs:$="3i",yt=3;break;case Is:case Bs:$="4i",yt=4;break;case rl:$="1f";break;case Ns:$="2f",yt=2;break;case Ms:$="3f",yt=3;break;case Ds:$="4f",yt=4;break;case Ea:$="Matrix2fv";break;case Aa:$="Matrix3fv";break;case Ta:$="Matrix4fv";break}if($.indexOf("Matrix")===-1&&ae>1&&($+="v",yt=1),$.charAt(0)==="M"){y(F,".uniform",$,"(",Re,",");var Xr=Math.pow(te-Ea+2,2),or=w.global.def("new Float32Array(",Xr,")");Array.isArray(se)?y("false,(",$n(Xr,function(Pn){return or+"["+Pn+"]="+se[Pn]}),",",or,")"):y("false,(Array.isArray(",se,")||",se," instanceof Float32Array)?",se,":(",$n(Xr,function(Pn){return or+"["+Pn+"]="+se+"["+Pn+"]"}),",",or,")"),y(");")}else if(yt>1){for(var Wn=[],br=[],Hr=0;Hr<yt;++Hr)Array.isArray(se)?br.push(se[Hr]):br.push(y.def(se+"["+Hr+"]")),k&&Wn.push(y.def());k&&y("if(!",w.batchId,"||",Wn.map(function(Pn,Wr){return Pn+"!=="+br[Wr]}).join("||"),"){",Wn.map(function(Pn,Wr){return Pn+"="+br[Wr]+";"}).join("")),y(F,".uniform",$,"(",Re,",",br.join(","),");"),k&&y("}")}else{if(_(!Array.isArray(se),"uniform value must not be an array"),k){var N1=y.def();y("if(!",w.batchId,"||",N1,"!==",se,"){",N1,"=",se,";")}y(F,".uniform",$,"(",Re,",",se,");"),k&&y("}")}}}function je(w,y,M,B){var V=w.shared,k=V.gl,D=V.draw,F=B.draw;function E(){var Ie=F.elements,Le,qe=y;return Ie?((Ie.contextDep&&B.contextDynamic||Ie.propDep)&&(qe=M),Le=Ie.append(w,qe),F.elementsActive&&qe("if("+Le+")"+k+".bindBuffer("+nl+","+Le+".buffer.buffer);")):(Le=qe.def(),qe(Le,"=",D,".",zr,";","if(",Le,"){",k,".bindBuffer(",nl,",",Le,".buffer.buffer);}","else if(",V.vao,".currentVAO){",Le,"=",w.shared.elements+".getElements("+V.vao,".currentVAO.elements);",ie?"":"if("+Le+")"+k+".bindBuffer("+nl+","+Le+".buffer.buffer);","}")),Le}function $(){var Ie=F.count,Le,qe=y;return Ie?((Ie.contextDep&&B.contextDynamic||Ie.propDep)&&(qe=M),Le=Ie.append(w,qe),_.optional(function(){Ie.MISSING&&w.assert(y,"false","missing vertex count"),Ie.DYNAMIC&&w.assert(qe,Le+">=0","missing vertex count")})):(Le=qe.def(D,".",jr),_.optional(function(){w.assert(qe,Le+">=0","missing vertex count")})),Le}var A=E();function U(Ie){var Le=F[Ie];return Le?Le.contextDep&&B.contextDynamic||Le.propDep?Le.append(w,M):Le.append(w,y):y.def(D,".",Ie)}var j=U(Vr),te=U(Os),ae=$();if(typeof ae=="number"){if(ae===0)return}else M("if(",ae,"){"),M.exit("}");var xe,Xe;pe&&(xe=U(Rs),Xe=w.instancing);var Ge=A+".type",Re=F.elements&&yr(F.elements)&&!F.vaoActive;function se(){function Ie(){M(Xe,".drawElementsInstancedANGLE(",[j,ae,Ge,te+"<<(("+Ge+"-"+Zd+")>>1)",xe],");")}function Le(){M(Xe,".drawArraysInstancedANGLE(",[j,te,ae,xe],");")}A&&A!=="null"?Re?Ie():(M("if(",A,"){"),Ie(),M("}else{"),Le(),M("}")):Le()}function ee(){function Ie(){M(k+".drawElements("+[j,ae,Ge,te+"<<(("+Ge+"-"+Zd+")>>1)"]+");")}function Le(){M(k+".drawArrays("+[j,te,ae]+");")}A&&A!=="null"?Re?Ie():(M("if(",A,"){"),Ie(),M("}else{"),Le(),M("}")):Le()}pe&&(typeof xe!="number"||xe>=0)?typeof xe=="string"?(M("if(",xe,">0){"),se(),M("}else if(",xe,"<0){"),ee(),M("}")):se():ee()}function ct(w,y,M,B,V){var k=Ye(),D=k.proc("body",V);return _.optional(function(){k.commandStr=y.commandStr,k.command=k.link(y.commandStr)}),pe&&(k.instancing=D.def(k.shared.extensions,".angle_instanced_arrays")),w(k,D,M,B),k.compile().body}function ft(w,y,M,B){It(w,y),M.useVAO?M.drawVAO?y(w.shared.vao,".setVAO(",M.drawVAO.append(w,y),");"):y(w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"):(y(w.shared.vao,".setVAO(null);"),rn(w,y,M,B.attributes,function(){return!0})),gt(w,y,M,B.uniforms,function(){return!0},!1),je(w,y,y,M)}function Ft(w,y){var M=w.proc("draw",1);It(w,M),Xt(w,M,y.context),Ht(w,M,y.framebuffer),Qt(w,M,y),nn(w,M,y.state),tt(w,M,y,!1,!0);var B=y.shader.progVar.append(w,M);if(M(w.shared.gl,".useProgram(",B,".program);"),y.shader.program)ft(w,M,y,y.shader.program);else{M(w.shared.vao,".setVAO(null);");var V=w.global.def("{}"),k=M.def(B,".id"),D=M.def(V,"[",k,"]");M(w.cond(D).then(D,".call(this,a0);").else(D,"=",V,"[",k,"]=",w.link(function(F){return ct(ft,w,y,F,1)}),"(",B,");",D,".call(this,a0);"))}Object.keys(y.state).length>0&&M(w.shared.current,".dirty=true;"),w.shared.vao&&M(w.shared.vao,".setVAO(null);")}function Hn(w,y,M,B){w.batchId="a1",It(w,y);function V(){return!0}rn(w,y,M,B.attributes,V),gt(w,y,M,B.uniforms,V,!1),je(w,y,y,M)}function qr(w,y,M,B){It(w,y);var V=M.contextDep,k=y.def(),D="a0",F="a1",E=y.def();w.shared.props=E,w.batchId=k;var $=w.scope(),A=w.scope();y($.entry,"for(",k,"=0;",k,"<",F,";++",k,"){",E,"=",D,"[",k,"];",A,"}",$.exit);function U(Ge){return Ge.contextDep&&V||Ge.propDep}function j(Ge){return!U(Ge)}if(M.needsContext&&Xt(w,A,M.context),M.needsFramebuffer&&Ht(w,A,M.framebuffer),nn(w,A,M.state,U),M.profile&&U(M.profile)&&tt(w,A,M,!1,!0),B)M.useVAO?M.drawVAO?U(M.drawVAO)?A(w.shared.vao,".setVAO(",M.drawVAO.append(w,A),");"):$(w.shared.vao,".setVAO(",M.drawVAO.append(w,$),");"):$(w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"):($(w.shared.vao,".setVAO(null);"),rn(w,$,M,B.attributes,j),rn(w,A,M,B.attributes,U)),gt(w,$,M,B.uniforms,j,!1),gt(w,A,M,B.uniforms,U,!0),je(w,$,A,M);else{var te=w.global.def("{}"),ae=M.shader.progVar.append(w,A),xe=A.def(ae,".id"),Xe=A.def(te,"[",xe,"]");A(w.shared.gl,".useProgram(",ae,".program);","if(!",Xe,"){",Xe,"=",te,"[",xe,"]=",w.link(function(Ge){return ct(Hn,w,M,Ge,2)}),"(",ae,");}",Xe,".call(this,a0[",k,"],",k,");")}}function T(w,y){var M=w.proc("batch",2);w.batchId="0",It(w,M);var B=!1,V=!0;Object.keys(y.context).forEach(function(te){B=B||y.context[te].propDep}),B||(Xt(w,M,y.context),V=!1);var k=y.framebuffer,D=!1;k?(k.propDep?B=D=!0:k.contextDep&&B&&(D=!0),D||Ht(w,M,k)):Ht(w,M,null),y.state.viewport&&y.state.viewport.propDep&&(B=!0);function F(te){return te.contextDep&&B||te.propDep}Qt(w,M,y),nn(w,M,y.state,function(te){return!F(te)}),(!y.profile||!F(y.profile))&&tt(w,M,y,!1,"a1"),y.contextDep=B,y.needsContext=V,y.needsFramebuffer=D;var E=y.shader.progVar;if(E.contextDep&&B||E.propDep)qr(w,M,y,null);else{var $=E.append(w,M);if(M(w.shared.gl,".useProgram(",$,".program);"),y.shader.program)qr(w,M,y,y.shader.program);else{M(w.shared.vao,".setVAO(null);");var A=w.global.def("{}"),U=M.def($,".id"),j=M.def(A,"[",U,"]");M(w.cond(j).then(j,".call(this,a0,a1);").else(j,"=",A,"[",U,"]=",w.link(function(te){return ct(qr,w,y,te,2)}),"(",$,");",j,".call(this,a0,a1);"))}}Object.keys(y.state).length>0&&M(w.shared.current,".dirty=true;"),w.shared.vao&&M(w.shared.vao,".setVAO(null);")}function Z(w,y){var M=w.proc("scope",3);w.batchId="a2";var B=w.shared,V=B.current;Xt(w,M,y.context),y.framebuffer&&y.framebuffer.append(w,M),T1(Object.keys(y.state)).forEach(function(D){var F=y.state[D],E=F.append(w,M);Ot(E)?E.forEach(function($,A){M.set(w.next[D],"["+A+"]",$)}):M.set(B.next,"."+D,E)}),tt(w,M,y,!0,!0),[zr,Os,jr,Rs,Vr].forEach(function(D){var F=y.draw[D];F&&M.set(B.draw,"."+D,""+F.append(w,M))}),Object.keys(y.uniforms).forEach(function(D){var F=y.uniforms[D].append(w,M);Array.isArray(F)&&(F="["+F.join()+"]"),M.set(B.uniforms,"["+b.id(D)+"]",F)}),Object.keys(y.attributes).forEach(function(D){var F=y.attributes[D].append(w,M),E=w.scopeAttrib(D);Object.keys(new z).forEach(function($){M.set(E,"."+$,F[$])})}),y.scopeVAO&&M.set(B.vao,".targetVAO",y.scopeVAO.append(w,M));function k(D){var F=y.shader[D];F&&M.set(B.shader,"."+D,F.append(w,M))}k(_a),k(xa),Object.keys(y.state).length>0&&(M(V,".dirty=true;"),M.exit(V,".dirty=true;")),M("a1(",w.shared.context,",a0,",w.batchId,");")}function q(w){if(!(typeof w!="object"||Ot(w))){for(var y=Object.keys(w),M=0;M<y.length;++M)if(Tn.isDynamic(w[y[M]]))return!0;return!1}}function Ne(w,y,M){var B=y.static[M];if(!B||!q(B))return;var V=w.global,k=Object.keys(B),D=!1,F=!1,E=!1,$=w.global.def("{}");k.forEach(function(U){var j=B[U];if(Tn.isDynamic(j)){typeof j=="function"&&(j=B[U]=Tn.unbox(j));var te=bn(j,null);D=D||te.thisDep,E=E||te.propDep,F=F||te.contextDep}else{switch(V($,".",U,"="),typeof j){case"number":V(j);break;case"string":V('"',j,'"');break;case"object":Array.isArray(j)&&V("[",j.join(),"]");break;default:V(w.link(j));break}V(";")}});function A(U,j){k.forEach(function(te){var ae=B[te];if(Tn.isDynamic(ae)){var xe=U.invoke(j,ae);j($,".",te,"=",xe,";")}})}y.dynamic[M]=new Tn.DynamicVariable(Ps,{thisDep:D,contextDep:F,propDep:E,ref:$,append:A}),delete y.static[M]}function ot(w,y,M,B,V){var k=Ye();k.stats=k.link(V),Object.keys(y.static).forEach(function(F){Ne(k,y,F)}),r_.forEach(function(F){Ne(k,w,F)});var D=Vt(w,y,M,B,k);return Ft(k,D),Z(k,D),T(k,D),r(k.compile(),{destroy:function(){D.shader.program.destroy()}})}return{next:$e,current:Pe,procs:function(){var w=Ye(),y=w.proc("poll"),M=w.proc("refresh"),B=w.block();y(B),M(B);var V=w.shared,k=V.gl,D=V.next,F=V.current;B(F,".dirty=false;"),Ht(w,y),Ht(w,M,null,!0);var E;pe&&(E=w.link(pe)),C.oes_vertex_array_object&&M(w.link(C.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var $=0;$<Y.maxAttributes;++$){var A=M.def(V.attributes,"[",$,"]"),U=w.cond(A,".buffer");U.then(k,".enableVertexAttribArray(",$,");",k,".bindBuffer(",Po,",",A,".buffer.buffer);",k,".vertexAttribPointer(",$,",",A,".size,",A,".type,",A,".normalized,",A,".stride,",A,".offset);").else(k,".disableVertexAttribArray(",$,");",k,".vertexAttrib4f(",$,",",A,".x,",A,".y,",A,".z,",A,".w);",A,".buffer=null;"),M(U),pe&&M(E,".vertexAttribDivisorANGLE(",$,",",A,".divisor);")}return M(w.shared.vao,".currentVAO=null;",w.shared.vao,".setVAO(",w.shared.vao,".targetVAO);"),Object.keys(oe).forEach(function(j){var te=oe[j],ae=B.def(D,".",j),xe=w.block();xe("if(",ae,"){",k,".enable(",te,")}else{",k,".disable(",te,")}",F,".",j,"=",ae,";"),M(xe),y("if(",ae,"!==",F,".",j,"){",xe,"}")}),Object.keys(ne).forEach(function(j){var te=ne[j],ae=Pe[j],xe,Xe,Ge=w.block();if(Ge(k,".",te,"("),Ot(ae)){var Re=ae.length;xe=w.global.def(D,".",j),Xe=w.global.def(F,".",j),Ge($n(Re,function(se){return xe+"["+se+"]"}),");",$n(Re,function(se){return Xe+"["+se+"]="+xe+"["+se+"];"}).join("")),y("if(",$n(Re,function(se){return xe+"["+se+"]!=="+Xe+"["+se+"]"}).join("||"),"){",Ge,"}")}else xe=B.def(D,".",j),Xe=B.def(F,".",j),Ge(xe,");",F,".",j,"=",xe,";"),y("if(",xe,"!==",Xe,"){",Ge,"}");M(Ge)}),w.compile()}(),compile:ot}}function w_(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var E_=34918,A_=34919,S1=35007,T_=function(d,b){if(!b.ext_disjoint_timer_query)return null;var C=[];function Y(){return C.pop()||b.ext_disjoint_timer_query.createQueryEXT()}function re(pe){C.push(pe)}var H=[];function Q(pe){var Oe=Y();b.ext_disjoint_timer_query.beginQueryEXT(S1,Oe),H.push(Oe),fe(H.length-1,H.length,pe)}function ue(){b.ext_disjoint_timer_query.endQueryEXT(S1)}function le(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var ve=[];function ye(){return ve.pop()||new le}function ge(pe){ve.push(pe)}var we=[];function fe(pe,Oe,ie){var Pe=ye();Pe.startQueryIndex=pe,Pe.endQueryIndex=Oe,Pe.sum=0,Pe.stats=ie,we.push(Pe)}var me=[],z=[];function K(){var pe,Oe,ie=H.length;if(ie!==0){z.length=Math.max(z.length,ie+1),me.length=Math.max(me.length,ie+1),me[0]=0,z[0]=0;var Pe=0;for(pe=0,Oe=0;Oe<H.length;++Oe){var $e=H[Oe];b.ext_disjoint_timer_query.getQueryObjectEXT($e,A_)?(Pe+=b.ext_disjoint_timer_query.getQueryObjectEXT($e,E_),re($e)):H[pe++]=$e,me[Oe+1]=Pe,z[Oe+1]=pe}for(H.length=pe,pe=0,Oe=0;Oe<we.length;++Oe){var Be=we[Oe],oe=Be.startQueryIndex,ne=Be.endQueryIndex;Be.sum+=me[ne]-me[oe];var Me=z[oe],Ee=z[ne];Ee===Me?(Be.stats.gpuTime+=Be.sum/1e6,ge(Be)):(Be.startQueryIndex=Me,Be.endQueryIndex=Ee,we[pe++]=Be)}we.length=pe}}return{beginQuery:Q,endQuery:ue,pushScopeStats:fe,update:K,getNumPendingQueries:function(){return H.length},clear:function(){C.push.apply(C,H);for(var pe=0;pe<C.length;pe++)b.ext_disjoint_timer_query.deleteQueryEXT(C[pe]);H.length=0,C.length=0},restore:function(){H.length=0,C.length=0}}},$_=16384,S_=256,P_=1024,C_=34962,P1="webglcontextlost",C1="webglcontextrestored",O1=1,O_=2,R_=3;function R1(d,b){for(var C=0;C<d.length;++C)if(d[C]===b)return C;return-1}function N_(d){var b=O2(d);if(!b)return null;var C=b.gl,Y=C.getContextAttributes(),re=C.isContextLost(),H=R2(C,b);if(!H)return null;var Q=T2(),ue=w_(),le=H.extensions,ve=T_(C,le),ye=Gf(),ge=C.drawingBufferWidth,we=C.drawingBufferHeight,fe={tick:0,time:0,viewportWidth:ge,viewportHeight:we,framebufferWidth:ge,framebufferHeight:we,drawingBufferWidth:ge,drawingBufferHeight:we,pixelRatio:b.pixelRatio},me={},z={elements:null,primitive:4,count:-1,offset:0,instances:-1},K=yy(C,le),pe=Dy(C,ue,b,Pe),Oe=Xy(C,le,pe,ue),ie=Xb(C,le,K,ue,pe,Oe,z);function Pe(je){return ie.destroyBuffer(je)}var $e=Zb(C,Q,ue,b),Be=Eb(C,le,K,function(){Me.procs.poll()},fe,ue,b),oe=Ab(C,le,K,ue,b),ne=Ub(C,le,K,Be,oe,ue),Me=x_(C,Q,le,K,pe,Oe,Be,ne,me,ie,$e,z,fe,ve,b),Ee=Jb(C,ne,Me.procs.poll,fe,Y,le,K),he=Me.next,Ae=C.canvas,Te=[],Ke=[],Ye=[],Se=[b.onDestroy],Ce=null;function Ue(){if(Te.length===0){ve&&ve.update(),Ce=null;return}Ce=dc.next(Ue),nn();for(var je=Te.length-1;je>=0;--je){var ct=Te[je];ct&&ct(fe,null,0)}C.flush(),ve&&ve.update()}function Qe(){!Ce&&Te.length>0&&(Ce=dc.next(Ue))}function it(){Ce&&(dc.cancel(Ue),Ce=null)}function Rt(je){je.preventDefault(),re=!0,it(),Ke.forEach(function(ct){ct()})}function Nt(je){C.getError(),re=!1,H.restore(),$e.restore(),pe.restore(),Be.restore(),oe.restore(),ne.restore(),ie.restore(),ve&&ve.restore(),Me.procs.refresh(),Qe(),Ye.forEach(function(ct){ct()})}Ae&&(Ae.addEventListener(P1,Rt,!1),Ae.addEventListener(C1,Nt,!1));function lt(){Te.length=0,it(),Ae&&(Ae.removeEventListener(P1,Rt),Ae.removeEventListener(C1,Nt)),$e.clear(),ne.clear(),oe.clear(),ie.clear(),Be.clear(),Oe.clear(),pe.clear(),ve&&ve.clear(),Se.forEach(function(je){je()})}function qt(je){_(!!je,"invalid args to regl({...})"),_.type(je,"object","invalid args to regl({...})");function ct(V){var k=r({},V);delete k.uniforms,delete k.attributes,delete k.context,delete k.vao,"stencil"in k&&k.stencil.op&&(k.stencil.opBack=k.stencil.opFront=k.stencil.op,delete k.stencil.op);function D(F){if(F in k){var E=k[F];delete k[F],Object.keys(E).forEach(function($){k[F+"."+$]=E[$]})}}return D("blend"),D("depth"),D("cull"),D("stencil"),D("polygonOffset"),D("scissor"),D("sample"),"vao"in V&&(k.vao=V.vao),k}function ft(V,k){var D={},F={};return Object.keys(V).forEach(function(E){var $=V[E];if(Tn.isDynamic($)){F[E]=Tn.unbox($,E);return}else if(k&&Array.isArray($)){for(var A=0;A<$.length;++A)if(Tn.isDynamic($[A])){F[E]=Tn.unbox($,E);return}}D[E]=$}),{dynamic:F,static:D}}var Ft=ft(je.context||{},!0),Hn=ft(je.uniforms||{},!0),qr=ft(je.attributes||{},!1),T=ft(ct(je),!1),Z={gpuTime:0,cpuTime:0,count:0},q=Me.compile(T,qr,Hn,Ft,Z),Ne=q.draw,ot=q.batch,w=q.scope,y=[];function M(V){for(;y.length<V;)y.push(null);return y}function B(V,k){var D;if(re&&_.raise("context lost"),typeof V=="function")return w.call(this,null,V,0);if(typeof k=="function")if(typeof V=="number")for(D=0;D<V;++D)w.call(this,null,k,D);else if(Array.isArray(V))for(D=0;D<V.length;++D)w.call(this,V[D],k,D);else return w.call(this,V,k,0);else if(typeof V=="number"){if(V>0)return ot.call(this,M(V|0),V|0)}else if(Array.isArray(V)){if(V.length)return ot.call(this,V,V.length)}else return Ne.call(this,V)}return r(B,{stats:Z,destroy:function(){q.destroy()}})}var At=ne.setFBO=qt({framebuffer:Tn.define.call(null,O1,"framebuffer")});function Vt(je,ct){var ft=0;Me.procs.poll();var Ft=ct.color;Ft&&(C.clearColor(+Ft[0]||0,+Ft[1]||0,+Ft[2]||0,+Ft[3]||0),ft|=$_),"depth"in ct&&(C.clearDepth(+ct.depth),ft|=S_),"stencil"in ct&&(C.clearStencil(ct.stencil|0),ft|=P_),_(!!ft,"called regl.clear with no buffer specified"),C.clear(ft)}function Xt(je){if(_(typeof je=="object"&&je,"regl.clear() takes an object as input"),"framebuffer"in je)if(je.framebuffer&&je.framebuffer_reglType==="framebufferCube")for(var ct=0;ct<6;++ct)At(r({framebuffer:je.framebuffer.faces[ct]},je),Vt);else At(je,Vt);else Vt(null,je)}function Ht(je){_.type(je,"function","regl.frame() callback must be a function"),Te.push(je);function ct(){var ft=R1(Te,je);_(ft>=0,"cannot cancel a frame twice");function Ft(){var Hn=R1(Te,Ft);Te[Hn]=Te[Te.length-1],Te.length-=1,Te.length<=0&&it()}Te[ft]=Ft}return Qe(),{cancel:ct}}function Qt(){var je=he.viewport,ct=he.scissor_box;je[0]=je[1]=ct[0]=ct[1]=0,fe.viewportWidth=fe.framebufferWidth=fe.drawingBufferWidth=je[2]=ct[2]=C.drawingBufferWidth,fe.viewportHeight=fe.framebufferHeight=fe.drawingBufferHeight=je[3]=ct[3]=C.drawingBufferHeight}function nn(){fe.tick+=1,fe.time=tt(),Qt(),Me.procs.poll()}function It(){Be.refresh(),Qt(),Me.procs.refresh(),ve&&ve.update()}function tt(){return(Gf()-ye)/1e3}It();function rn(je,ct){_.type(ct,"function","listener callback must be a function");var ft;switch(je){case"frame":return Ht(ct);case"lost":ft=Ke;break;case"restore":ft=Ye;break;case"destroy":ft=Se;break;default:_.raise("invalid event, must be one of frame,lost,restore,destroy")}return ft.push(ct),{cancel:function(){for(var Ft=0;Ft<ft.length;++Ft)if(ft[Ft]===ct){ft[Ft]=ft[ft.length-1],ft.pop();return}}}}var gt=r(qt,{clear:Xt,prop:Tn.define.bind(null,O1),context:Tn.define.bind(null,O_),this:Tn.define.bind(null,R_),draw:qt({}),buffer:function(je){return pe.create(je,C_,!1,!1)},elements:function(je){return Oe.create(je,!1)},texture:Be.create2D,cube:Be.createCube,renderbuffer:oe.create,framebuffer:ne.create,framebufferCube:ne.createCube,vao:ie.createVAO,attributes:Y,frame:Ht,on:rn,limits:K,hasExtension:function(je){return K.extensions.indexOf(je.toLowerCase())>=0},read:Ee,destroy:lt,_gl:C,_refresh:It,poll:function(){nn(),ve&&ve.update()},now:tt,stats:ue});return b.onDone(null,gt),gt}return N_})}(uu)),uu.exports}const hq=fq,pq=fc,mq=e=>{const n=Object.assign({},{},e.glOptions,{onDone:(s,i)=>{if(s)throw s}}),r=dq()(n),o=new Map,a=s=>{s.rendering=Object.assign({},pq,s.rendering),hq(r)(s,i=>{r.clear({color:s.rendering.background,depth:1}),s.entities&&s.entities.sort((c,l)=>{const u="transparent"in c.visuals?c.visuals.transparent:!1,f="transparent"in l.visuals?l.visuals.transparent:!1;return u===f?0:u?1:-1}).forEach(c=>{const{visuals:l}=c;if(("show"in l?l.show:!0)&&l.drawCmd&&s.drawCommands[l.drawCmd]){let f;l.cacheId?f=o.get(l.cacheId):(l.cacheId=o.size,f=s.drawCommands[l.drawCmd](r,c),o.set(l.cacheId,f));const h={...c,...l,camera:s.camera};f(h)}})})};return function(i){r.poll(),a(i)}};var vq=mq,fu,om;function am(){if(om)return fu;om=1;const e=Fn;return fu=(n,r={})=>{const o=[],a={visuals:{color:[0,0,1,1],fadeOut:!1},ticks:1,size:[16,16],centered:!1,lineWidth:2},s=Object.assign({},a.visuals,r.visuals||{}),{fadeOut:i,color:c}=s,{size:l,ticks:u,centered:f,lineWidth:h}=Object.assign({},a,r),p=l[0],g=l[1];if(f){const v=p*.5,m=g*.5,x=v%u,P=-v+x,S=-P,O=m%u,R=-m+O,N=-R,I=0;for(let X=P,W=0;X<=S;X+=u,W+=1)W%I!==0&&(o.push(R,X,0),o.push(N,X,0),o.push(R,X,0));for(let X=R,W=0;X<=N;X+=u,W+=1)W%I!==0&&(o.push(X,P,0),o.push(X,S,0),o.push(X,P,0))}else{for(let v=-p*.5;v<=p*.5;v+=u)o.push(-g*.5,v,0),o.push(g*.5,v,0),o.push(-g*.5,v,0);for(let v=-g*.5;v<=g*.5;v+=u)o.push(v,-p*.5,0),o.push(v,p*.5,0),o.push(v,-p*.5,0)}return n({vert:`precision mediump float;

    uniform float camNear, camFar;
    uniform mat4 model, view, projection;

    attribute vec3 position;
    varying vec3 fragNormal, fragPosition;
    varying vec4 worldPosition;

    void main() {
      fragPosition = position;
      worldPosition = model * vec4(position, 1);
      vec4 glPosition = projection * view * worldPosition;
      gl_Position = glPosition;
    }`,frag:`precision mediump float;
    uniform vec4 color;
    varying vec3 fragNormal, fragPosition;
    varying vec4 worldPosition;

    uniform vec4 fogColor;
    uniform bool fadeOut;
    void main() {
      float dist = .5;
      if(fadeOut){
        dist = distance( vec2(0.,0.), vec2(worldPosition.x, worldPosition.y));
        dist *= 0.0025;
        dist = sqrt(dist);
      }

      gl_FragColor = mix(color, fogColor, dist);
    }
    `,attributes:{position:n.buffer(o)},count:o.length/3,uniforms:{model:(v,m)=>m&&m.model?m.model:e.identity([]),color:(v,m)=>m&&m.color?m.color:c,fogColor:(v,m)=>m&&m.color?[m.color[0],m.color[1],m.color[2],0]:[c[0],c[1],c[2],0],fadeOut:(v,m)=>m&&m.fadeOut!==void 0?m.fadeOut:i},lineWidth:(v,m)=>Math.min(m&&m.lineWidth?m.lineWidth:h,n.limits.lineWidthDims[1]),primitive:"lines",cull:{enable:!0,face:"front"},polygonOffset:{enable:!0,offset:{factor:1,units:Math.random()*10}},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}})},fu}const gq=(e,t)=>{const n={size:[50,50],ticks:[10,1]},{size:r,ticks:o}=Object.assign({},n,t),a=am()(e,{size:r,ticks:o[0]}),s=am()(e,{size:r,ticks:o[1]});return c=>{a(c),s({color:c.subColor,fadeOut:c.fadeOut})}};var yq=gq;const pn=Fn,bq=(e,t)=>{const n={xColor:[1,0,0,1],yColor:[0,1,0,1],zColor:[0,0,1,1],size:10,lineWidth:3,alwaysVisible:!0};let{size:r,xColor:o,yColor:a,zColor:s,lineWidth:i,alwaysVisible:c}=Object.assign({},n,t);i>e.limits.lineWidthDims[1]&&(i=e.limits.lineWidthDims[1]);const l=[0,0,0,r,0,0],u={frag:`precision mediump float;
    uniform vec4 color;
    void main() {
      gl_FragColor = color;
    }`,vert:`
    precision mediump float;
    attribute vec3 position;
    uniform mat4 model, view, projection;
    void main() {
      gl_Position = projection * view * model * vec4(position, 1);
    }`,uniforms:{model:(v,m)=>m&&m.model?m.model:pn.identity([]),color:(v,m)=>m.color,angle:(v,m)=>m.angle},attributes:{position:l},count:l.length/3,primitive:"line loop",lineWidth:i,depth:{enable:!c}},f=pn.identity([]),h=pn.rotateZ(pn.create(),pn.identity([]),Math.PI/2),p=pn.rotateY(pn.create(),pn.identity([]),-Math.PI/2),g=e(u);return v=>{const m={model:pn.identity([])};return v=Object.assign({},m,v),g([{color:o,model:pn.multiply(pn.create(),v.model,f)},{color:a,model:pn.multiply(pn.create(),v.model,h)},{color:s,model:pn.multiply(pn.create(),v.model,p)}])}};var _q=bq,du,sm;function im(){return sm||(sm=1,du={frag:`
precision mediump float;
varying vec3 surfaceNormal, surfacePosition;

uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform float specularLightAmount;

uniform vec3 lightDirection;
uniform vec4 lightColor;
uniform vec3 opacity;
uniform float uMaterialShininess;

varying vec4 vColor;
uniform vec4 ucolor;
uniform float vColorToggler;

uniform vec2 printableArea;
vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);//vec4(0.15, 0.15, 0.15, 0.3);
varying vec4 _worldSpacePosition;
varying float ambientAo;

void main () {
  vec4 depth = gl_FragCoord;
  vec4 endColor = vColor * vColorToggler + ucolor * (1.0 - vColorToggler);

  vec3 ambient = ambientLightAmount * endColor.rgb ; //ambientAo * 

  float diffuseWeight = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(diffuseWeight , 0.0, 1.0 );

  //specular
  
  vec4 specularColor = vec4(lightColor);
  vec3 eyeDirection = normalize(surfacePosition.xyz);
  vec3 reflectionDirection = reflect(-lightDirection, -surfaceNormal);
  float specularLightWeight = pow(max(dot(reflectionDirection, eyeDirection), 0.0), uMaterialShininess);
  vec3 specular = specularColor.rgb * specularLightWeight * specularLightAmount;

  gl_FragColor = vec4((ambient + diffuse + specular), endColor.a);
}
`,vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection, unormal;

attribute vec3 position, normal;
attribute vec4 color;

attribute float ao;
varying float ambientAo;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;
varying vec4 vColor;

void main() {
  surfacePosition = (unormal * vec4(position, 1.0)).xyz;
  surfaceNormal = normalize((unormal * vec4(normal, 1.0)).xyz); //vec4 transformedNormal = uNormalMatrix * vec4(aVertexNormal, 1.0);
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;
  //gl_Position = projection * view * worldSpacePosition;

  vColor = color;

  //ambientAo = (1. - ao) * (0.5 * max(normal.x, 0.) + 0.5);

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
  //gl_Position = zBufferAdjust(glPosition, camNear, camFar);
}
`}),du}var hu,cm;function lm(){return cm||(cm=1,hu={vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;

void main() {
  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`,frag:`
precision mediump float;
varying vec3 surfaceNormal;
uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform vec4 ucolor;
uniform vec3 lightDirection;
uniform vec3 opacity;

varying vec4 _worldSpacePosition;

uniform vec2 printableArea;

vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);

void main () {
  vec4 depth = gl_FragCoord;

  float v = 0.8; // shadow value
  vec4 endColor = ucolor;

  vec3 ambient = ambientLightAmount * endColor.rgb;
  float cosTheta = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );

  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));
  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );

  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);
}`}),hu}const $r=Fn,{meshColor:xq}=fc,wq=(e,t={extras:{}})=>{const n={useVertexColors:!0,dynamicCulling:!0,geometry:void 0,color:xq,visuals:{}},{geometry:r,dynamicCulling:o,useVertexColors:a,color:s,visuals:i}=Object.assign({},n,t),c=e.buffer([]),l=!!(r.indices&&r.indices.length>0),u=!!(r.normals&&r.normals.length>0),f="transparent"in i?i.transparent:!1,h=!!(a&&r.colors&&r.colors.length>0),p=r.transforms||$r.create(),g=$r.determinant(p)<0,v=o&&g?"front":"back",m=h?im().vert:lm().vert,x=h?im().frag:lm().frag,P=$r.invert($r.create(),p);let S={primitive:"triangles",vert:m,frag:x,uniforms:{model:(O,R)=>p,ucolor:(O,R)=>R&&R.color?R.color:s,vColorToggler:(O,R)=>R&&R.useVertexColors&&R.useVertexColors===!0?1:0,unormal:(O,R)=>{const N=$r.invert($r.create(),R.camera.view);return $r.multiply(N,P,N),$r.transpose(N,N),N}},attributes:{position:e.buffer({usage:"static",type:"float",data:r.positions}),ao:c},cull:{enable:!0,face:v}};return f&&(S.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),r.cells?S.elements=r.cells:l?S.elements=e.elements({usage:"static",type:"uint16",data:r.indices}):r.triangles?S.elements=r.triangles:S.count=r.positions.length/3,u&&(S.attributes.normal=e.buffer({usage:"static",type:"float",data:r.normals})),h&&(S.attributes.color=e.buffer({usage:"static",type:"float",data:r.colors})),S=Object.assign({},S,t.extras),e(S)};var Eq=wq,pu,um;function fm(){return um||(um=1,pu={frag:`
precision mediump float;
varying vec4 vColor;

void main () {
  gl_FragColor = vColor;
}
`,vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;
attribute vec4 color;

varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;
varying vec4 vColor;

void main() {
  vColor = color;

  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`}),pu}var mu,dm;function Aq(){return dm||(dm=1,mu={vert:`
precision mediump float;

uniform float camNear, camFar;
uniform mat4 model, view, projection;

attribute vec3 position, normal;


varying vec3 surfaceNormal, surfacePosition;
varying vec4 _worldSpacePosition;


void main() {


  surfacePosition = position;
  surfaceNormal = normal;
  vec4 worldSpacePosition = model * vec4(position, 1);
  _worldSpacePosition = worldSpacePosition;

  vec4 glPosition = projection * view * model * vec4(position, 1);
  gl_Position = glPosition;
}
`,frag:`
precision mediump float;
varying vec3 surfaceNormal;
uniform float ambientLightAmount;
uniform float diffuseLightAmount;
uniform vec4 ucolor;
uniform vec3 lightDirection;
uniform vec3 opacity;

varying vec4 _worldSpacePosition;

uniform vec2 printableArea;

vec4 errorColor = vec4(0.15, 0.15, 0.15, 0.3);

void main () {
  vec4 depth = gl_FragCoord;

  float v = 0.8; // shadow value
  vec4 endColor = ucolor;

  vec3 ambient = ambientLightAmount * endColor.rgb;
  float cosTheta = dot(surfaceNormal, lightDirection);
  vec3 diffuse = diffuseLightAmount * endColor.rgb * clamp(cosTheta , 0.0, 1.0 );

  float cosTheta2 = dot(surfaceNormal, vec3(-lightDirection.x, -lightDirection.y, lightDirection.z));
  vec3 diffuse2 = diffuseLightAmount * endColor.rgb * clamp(cosTheta2 , 0.0, 1.0 );

  gl_FragColor = vec4((ambient + diffuse + diffuse2 * v), endColor.a);
}`}),mu}var vu,hm;function Tq(){return hm||(hm=1,vu={frag:`
precision mediump float;
uniform vec4 ucolor;

void main () {
  gl_FragColor = ucolor;
}
`}),vu}const $q=Fn,{meshColor:Sq}=fc,Pq=(e,t={})=>{const n={color:Sq,geometry:void 0};let{geometry:r,color:o,transparent:a}=Object.assign({},n,t);"color"in r&&(o=r.color);const s=!!(r.indices&&r.indices.length>0),i=!!(r.normals&&r.normals.length>0),c=!!(r.colors&&r.colors.length>0),l=c?fm().vert:Aq().vert,u=c?fm().frag:Tq().frag,f={primitive:"lines",vert:l,frag:u,uniforms:{model:(h,p)=>p.model||r.transforms||$q.create(),ucolor:(h,p)=>p&&p.color?p.color:o},attributes:{position:e.buffer({usage:"static",type:"float",data:r.positions})}};return a&&(f.blend={enable:!0,func:{src:"src alpha",dst:"one minus src alpha"}}),c&&(f.attributes.color=e.buffer({usage:"static",type:"float",data:r.colors})),s&&(f.elements=e.elements({usage:"static",type:"uint16",data:r.indices})),i&&(f.attributes.normal=e.buffer({usage:"static",type:"float",data:r.normals})),e(f)};var Cq=Pq,i2=1e-6,c2=Oq;function Oq(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}var Rq=Nq;function Nq(e){var t=new Float32Array(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}var l2=Mq;function Mq(e,t,n){var r=new Float32Array(3);return r[0]=e,r[1]=t,r[2]=n,r}var u2=Dq;function Dq(e,t){var n=t[0],r=t[1],o=t[2],a=n*n+r*r+o*o;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}var f2=Lq;function Lq(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var kq=Fq,pm=l2,mm=u2,Iq=f2;function Fq(e,t){var n=pm(e[0],e[1],e[2]),r=pm(t[0],t[1],t[2]);mm(n,n),mm(r,r);var o=Iq(n,r);return o>1?0:Math.acos(o)}var Gq=Bq;function Bq(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}var zq=Vq;function Vq(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}var jq=Uq,gu=i2;function Uq(e,t){var n=e[0],r=e[1],o=e[2],a=t[0],s=t[1],i=t[2];return Math.abs(n-a)<=gu*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-s)<=gu*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(o-i)<=gu*Math.max(1,Math.abs(o),Math.abs(i))}var qq=Xq;function Xq(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var Hq=Wq;function Wq(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}var d2=Yq;function Yq(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}var Zq=d2,h2=Kq;function Kq(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}var Qq=h2,p2=Jq;function Jq(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}var eX=p2,tX=nX;function nX(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}var rX=oX;function oX(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}var aX=sX;function sX(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}var iX=cX;function cX(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}var lX=uX;function uX(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}var fX=dX;function dX(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}var hX=pX;function pX(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}var m2=mX;function mX(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return Math.sqrt(n*n+r*r+o*o)}var vX=m2,v2=gX;function gX(e,t){var n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return n*n+r*r+o*o}var yX=v2,g2=bX;function bX(e){var t=e[0],n=e[1],r=e[2];return Math.sqrt(t*t+n*n+r*r)}var _X=g2,y2=xX;function xX(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}var wX=y2,EX=AX;function AX(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}var TX=$X;function $X(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}var SX=PX;function PX(e,t,n){var r=t[0],o=t[1],a=t[2],s=n[0],i=n[1],c=n[2];return e[0]=o*c-a*i,e[1]=a*s-r*c,e[2]=r*i-o*s,e}var CX=OX;function OX(e,t,n,r){var o=t[0],a=t[1],s=t[2];return e[0]=o+r*(n[0]-o),e[1]=a+r*(n[1]-a),e[2]=s+r*(n[2]-s),e}var RX=NX;function NX(e,t){t=t||1;var n=Math.random()*2*Math.PI,r=Math.random()*2-1,o=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=r*t,e}var MX=DX;function DX(e,t,n){var r=t[0],o=t[1],a=t[2],s=n[3]*r+n[7]*o+n[11]*a+n[15];return s=s||1,e[0]=(n[0]*r+n[4]*o+n[8]*a+n[12])/s,e[1]=(n[1]*r+n[5]*o+n[9]*a+n[13])/s,e[2]=(n[2]*r+n[6]*o+n[10]*a+n[14])/s,e}var LX=kX;function kX(e,t,n){var r=t[0],o=t[1],a=t[2];return e[0]=r*n[0]+o*n[3]+a*n[6],e[1]=r*n[1]+o*n[4]+a*n[7],e[2]=r*n[2]+o*n[5]+a*n[8],e}var IX=FX;function FX(e,t,n){var r=t[0],o=t[1],a=t[2],s=n[0],i=n[1],c=n[2],l=n[3],u=l*r+i*a-c*o,f=l*o+c*r-s*a,h=l*a+s*o-i*r,p=-s*r-i*o-c*a;return e[0]=u*l+p*-s+f*-c-h*-i,e[1]=f*l+p*-i+h*-s-u*-c,e[2]=h*l+p*-c+u*-i-f*-s,e}var GX=BX;function BX(e,t,n,r){var o=n[1],a=n[2],s=t[1]-o,i=t[2]-a,c=Math.sin(r),l=Math.cos(r);return e[0]=t[0],e[1]=o+s*l-i*c,e[2]=a+s*c+i*l,e}var zX=VX;function VX(e,t,n,r){var o=n[0],a=n[2],s=t[0]-o,i=t[2]-a,c=Math.sin(r),l=Math.cos(r);return e[0]=o+i*c+s*l,e[1]=t[1],e[2]=a+i*l-s*c,e}var jX=UX;function UX(e,t,n,r){var o=n[0],a=n[1],s=t[0]-o,i=t[1]-a,c=Math.sin(r),l=Math.cos(r);return e[0]=o+s*l-i*c,e[1]=a+s*c+i*l,e[2]=t[2],e}var qX=XX,Sr=c2();function XX(e,t,n,r,o,a){var s,i;for(t||(t=3),n||(n=0),r?i=Math.min(r*t+n,e.length):i=e.length,s=n;s<i;s+=t)Sr[0]=e[s],Sr[1]=e[s+1],Sr[2]=e[s+2],o(Sr,Sr,a),e[s]=Sr[0],e[s+1]=Sr[1],e[s+2]=Sr[2];return e}var fs={EPSILON:i2,create:c2,clone:Rq,angle:kq,fromValues:l2,copy:Gq,set:zq,equals:jq,exactEquals:qq,add:Hq,subtract:d2,sub:Zq,multiply:h2,mul:Qq,divide:p2,div:eX,min:tX,max:rX,floor:aX,ceil:iX,round:lX,scale:fX,scaleAndAdd:hX,distance:m2,dist:vX,squaredDistance:v2,sqrDist:yX,length:g2,len:_X,squaredLength:y2,sqrLen:wX,negate:EX,inverse:TX,normalize:u2,dot:f2,cross:SX,lerp:CX,random:RX,transformMat4:MX,transformMat3:LX,transformQuat:IX,rotateX:GX,rotateY:zX,rotateZ:jX,forEach:qX};const co=Fn,yu=fs,b2={view:co.identity(new Float32Array(16)),projection:co.identity(new Float32Array(16)),matrix:co.identity(new Float32Array(16)),near:1,far:18e3,up:[0,0,1],eye:new Float32Array(3),position:[450,550,700],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],projectionType:"perspective"},_2={},HX=Object.assign({},b2,_2),WX=(e,t,n)=>{const r=n.width/n.height,o=co.perspective(co.identity([]),t.fov,r,t.near,t.far),a=[0,0,n.width,n.height],s=e||{};return s.projection=o,s.aspect=r,s.viewport=a,s},YX=(e,t)=>{t||(t=e);const{position:n,target:r,up:o}=t,a=yu.subtract([],n,r),s=yu.add(yu.create(),r,a),i=co.lookAt(co.create(),s,r,o),c=e||{};return c.position=s,c.view=i,c};var Wu={cameraState:b2,cameraProps:_2,defaults:HX,setProjection:WX,update:YX};const wi=Fn,ZX={view:wi.identity(new Float32Array(16)),projection:wi.identity(new Float32Array(16)),matrix:wi.identity(new Float32Array(16)),near:1,far:1300,up:[0,0,1],eye:new Float32Array(3),position:[150,250,200],target:[0,0,0],fov:Math.PI/4,aspect:1,viewport:[0,0,0,0],zoom:1,projectionType:"orthographic"},KX={},QX=(e,t)=>{const{width:n,height:r}=t,o=n/r,a=[0,0,n,r],s=e.zoom,i=-n*s,c=n*s,l=-r*s,u=r*s;return{projection:wi.ortho([],i,c,l,u,e.near,e.far),aspect:o,viewport:a}};var Mi={cameraState:ZX,cameraProps:KX,setProjection:QX};const Uo=fs,Di=Fn,JX=e=>{const{near:t,far:n,fov:r,zoom:o}=e,{viewport:a}=e,s=Wu.setProjection(e,{width:a[2],height:a[3]}),{projectionType:i}=Wu.cameraState;return Object.assign({},e,s,{projectionType:i},{near:t,far:n,fov:r})},eH=e=>{const{fov:t,aspect:n}=e,r=Uo.length(Uo.subtract([],e.position,e.target))*.3,o=Math.tan(t)*r*n,a=Math.tan(t)*r,{near:s,far:i,viewport:c}=e,l={zoom:1,near:s,far:i},u=Mi.cameraState,f=Mi.setProjection(l,{width:o,height:a});return Object.assign({},u,e,f,{projectionType:u.projectionType,viewport:c})},tH=({camera:e})=>{const n=Uo.distance(e.position,e.target),r=[n,n,n];return{view:Di.lookAt(Di.create(),r,e.target,e.up),position:r}},nH=(e,{camera:t})=>{const n={top:[0,-1e-6,1],bottom:[0,0,-1],front:[0,1,0],back:[0,-1,0],left:[-1,0,0],right:[1,0,0],undefined:[0,0,0]},r=Uo.distance(t.position,t.target),o=Uo.add(Uo.create(),n[e].map(s=>s*r),t.target);return{view:Di.lookAt(Di.create(),o,t.target,t.up),position:o}};var rH={toPerspectiveView:tH,toPresetView:nH,fromOrthographicToPerspective:JX,fromPerspectiveToOrthographic:eH};const oH=e=>{if(e.length===0)return[[0,0,0],[0,0,0]];const t=Array.isArray(e)&&Array.isArray(e[0]),n=t?e[0].length:3,r=new Array(n),o=new Array(n);for(let a=0;a<n;a+=1)r[a]=1/0,o[a]=-1/0;if(t)e.forEach(a=>{for(let s=0;s<n;s+=1){const i=t?a[s]:a;o[s]=i>o[s]?i:o[s],r[s]=i<r[s]?i:r[s]}});else for(let a=0;a<e.length;a+=n)for(let s=0;s<n;s+=1){const i=e[s+a];o[s]=i>o[s]?i:o[s],r[s]=i<r[s]?i:r[s]}return[r,o]};var aH=oH;const Rn=fs,{flatten:sH}=nc,iH=aH,cH=(...e)=>{e=sH(e);let t;e.forEach(c=>{let l=iH(c.positions);l=l.map(u=>Rn.transformMat4(u,u,c.transforms)),t?(Rn.min(t[0],t[0],l[0]),Rn.max(t[1],t[1],l[1])):t=l});const n=Rn.min(Rn.create(),t[1],t[0]),r=Rn.max(Rn.create(),t[1],t[0]),o=Rn.subtract(Rn.create(),r,n);let a=Rn.scale(Rn.create(),o,.5);return a=Rn.add(a,n,a),{dia:Rn.distance(a,r),center:[...a],min:[...n],max:[...r],size:[...o]}};var lH=cH,bu,vm;function uH(){if(vm)return bu;vm=1,bu=e;function e(t,n,r){var o=n[0],a=n[1],s=n[2],i=r[0],c=r[1],l=r[2],u=r[3],f=r[4],h=r[5],p=r[6],g=r[7],v=r[8],m=r[9],x=r[10],P=r[11],S=r[12],O=r[13],R=r[14],N=r[15],I=1/(o*u+a*g+s*P+N);return t[0]=(o*i+a*f+s*v+S)*I,t[1]=(o*c+a*h+s*m+O)*I,t[2]=(o*l+a*p+s*x+R)*I,t}return bu}var _u,gm;function fH(){if(gm)return _u;gm=1;var e=uH();_u=t;function t(n,r,o,a){var s=o[0],i=o[1],c=o[2],l=o[3],u=r[0],f=r[1],h=r[2];return u=u-s,f=l-f-1,f=f-i,n[0]=2*u/c-1,n[1]=2*f/l-1,n[2]=2*h-1,e(n,n,a)}return _u}const vn=fs,os=Fn,{max:xu,min:wu,sqrt:ym,PI:dH,sin:Bo,cos:mi,atan2:vi}=Math,hH=lH,Lf={limits:{minDistance:.01,maxDistance:1e4},drag:.27,EPS:1e-6,zoomToFit:{auto:!0,targets:"all",tightness:1.5},userControl:{zoom:!0,zoomSpeed:1,rotate:!0,rotateSpeed:1,pan:!0,panSpeed:1},autoRotate:{enabled:!1,speed:1},autoAdjustPlanes:!0},x2={thetaDelta:0,phiDelta:0,scale:1},pH=Object.assign({},x2,Lf),mH=({controls:e,camera:t},n)=>{const{EPS:r,drag:o}=e,{position:a,target:s}=t,i=e.up?e.up:t.up;let c=e.thetaDelta;const l=e.phiDelta,u=e.scale,f=vn.subtract([],a,s);let h,p;i[2]===1?(h=vi(f[0],f[1]),p=vi(ym(f[0]*f[0]+f[1]*f[1]),f[2])):(h=vi(f[0],f[2]),p=vi(ym(f[0]*f[0]+f[2]*f[2]),f[1])),e.autoRotate.enabled&&e.userControl.rotate&&(c+=2*Math.PI/60/60*e.autoRotate.speed),h+=c,p+=l,p=xu(r,wu(dH-r,p));const g=xu(e.limits.minDistance,wu(e.limits.maxDistance,vn.length(f)*u));i[2]===1?(f[0]=g*Bo(p)*Bo(h),f[2]=g*mi(p),f[1]=g*Bo(p)*mi(h)):(f[0]=g*Bo(p)*Bo(h),f[1]=g*mi(p),f[2]=g*Bo(p)*mi(h));const v=vn.add(vn.create(),s,f),m=os.lookAt(os.create(),v,s,i),x=1-xu(wu(o,1),.01),P=vn.distance(a,v)>.001;return{controls:{thetaDelta:c*x,phiDelta:l*x,scale:1,changed:P},camera:{position:v,view:m}}},vH=({controls:e,camera:t,speed:n=1},r)=>{let{thetaDelta:o,phiDelta:a}=e;return e.userControl.rotate&&(o+=r[0]*n,a+=r[1]*n),{controls:{thetaDelta:o,phiDelta:a},camera:t}},gH=({controls:e,camera:t,speed:n=1},r=0)=>{let{scale:o}=e;if(e.userControl.zoom&&t&&r!==void 0&&r!==0&&!isNaN(r)){const a=Math.sign(r)===0?1:Math.sign(r);r=r/r*a*n;const s=r+e.scale,i=vn.distance(t.position,t.target)*s;if(i>e.limits.minDistance&&i<e.limits.maxDistance&&(o+=r),t.projectionType==="orthographic"){const c=vn.length(vn.subtract([],t.position,t.target))*.3,l=Math.tan(t.fov)*c*t.aspect,u=Math.tan(t.fov)*c;t=Mi.setProjection(t,{width:l,height:u})}}return{controls:{scale:o},camera:t}},yH=({controls:e,camera:t,speed:n=1},r)=>{const o=fH(),{projection:a,view:s,viewport:i}=t,c=os.multiply([],a,s),l=os.invert([],c),u=[i[2],i[3],0],f=[i[2]-r[0],i[3]+r[1],0],h=o([],u,i,l),p=o([],f,i,l),g=vn.distance(t.position,t.eye),v=vn.subtract([],h,p).map(m=>m*n*g*e.scale);return{controls:e,camera:{position:vn.add(vn.create(),t.position,v),target:vn.add(vn.create(),t.target,v)}}},bH=({controls:e,camera:t,entities:n})=>{const{zoomToFit:r}=e;if(r.targets!=="all")return{controls:e,camera:t};if(n.length===0)return{controls:e,camera:t};const o=n.map(p=>p.geometry),a=hH(o),{fov:s,target:i,position:c}=t,{tightness:l}=Object.assign({},r,Lf.zoomToFit),u=a.dia*l/Math.tan(s/2),f=vn.distance(i,c),h=u/f;return{camera:{target:a.center},controls:{scale:h}}},_H=({controls:e,camera:t},n)=>({camera:{position:n.camera.position,target:n.camera.target,projection:os.perspective([],t.fov,t.aspect,t.near,t.far),view:n.camera.view},controls:{thetaDelta:n.controls.thetaDelta,phiDelta:n.controls.phiDelta,scale:n.controls.scale}});var xH={controlsProps:Lf,controlsState:x2,defaults:pH,update:mH,rotate:vH,zoom:gH,pan:yH,zoomToFit:bH,reset:_H};const bm=Fn,Eu=Math.floor(65535/2),wH=(e,t)=>{let{color:n}=e;const r=t.sides;if(r.length===0)return[];"color"in t&&(n=t.color);const o=n[3]<1,a=[],s=Math.floor(r.length/Eu)+1,i=(l,u)=>{a.push(l,u||l)},c=[];for(let l=0;l<s;l++){const u=l*Eu,f=Math.min(u+Eu,r.length),h=[];for(let m=u;m<f;m++){const x=r[m];if(x.color){if(a.length===0&&h.length>0){const P=h.length;for(let S=0;S<P;S++)a.push(n)}i(x.color,x.endColor)}else a.length&&i(n);h.push([x[0][0],x[0][1],0]),h.push([x[1][0],x[1][1],0])}const p=h.map(m=>[0,0,-1]),g=h.map((m,x)=>x),v=t.transforms?bm.clone(t.transforms):bm.create();c.push({type:"2d",positions:h,normals:p,indices:g,transforms:v,color:n,colors:a,isTransparent:o})}return c};var EH=wH;const Pr=fs,_m=Fn,AH=65535,TH=(e,t)=>{let{color:n,smoothLighting:r}=e;"color"in t&&(n=t.color);const o=t.polygons,a=t.transforms?_m.clone(t.transforms):_m.create(),s=[];let i=0;for(;i<o.length;){let c=0,l=i;for(let m=i;m<o.length&&(c+=o[m].vertices.length,!(c>AH));m++)l++;const u=[],f=[],h=[],p=[],g=n[3]<1;for(let m=i;m<l;m++){const x=o[m],P=x.vertices,S=SH(x),O=$H(x,n),R=[];for(let N=0;N<P.length;N++){const I=P[N];u.push(I),f.push(S),p.push(O);const X=u.length-1;R.push(X)}for(let N=2;N<R.length;N++)h.push([R[0],R[N-1],R[N]])}const v={type:"3d",positions:u,normals:f,indices:h,colors:p,transforms:a,isTransparent:g};s.push(v),i=l}return s},$H=(e,t)=>{let n=t;return e.color&&(n=e.color),n&&n.length<4&&n.push(1),n},SH=e=>{if(e.plane)return Pr.clone(e.plane);const t=e.vertices,n=Pr.create();Pr.subtract(n,t[1],t[0]);const r=Pr.create();Pr.subtract(r,t[2],t[0]);const o=Pr.create();return Pr.cross(o,n,r),Pr.normalize(o,o),o};var PH=TH;const xm=Fn,Au=Math.floor(65535/2)-2,CH=(e,t)=>{let{color:n}=e;const r=t.points;if(r.length===0)return[];"color"in t&&(n=t.color);const o=n[3]<1,a=Math.floor(r.length/Au)+1,s=[];for(let i=0;i<a;i++){const c=i*Au,l=Math.min(c+Au,r.length),u=[];let f;for(let v=c;v<l;v++){const m=r[v];f&&(u.push([f[0],f[1],0]),u.push([m[0],m[1],0])),f=m}if(i+1===a&&t.isClosed&&f){const v=r[0];u.push([f[0],f[1],0]),u.push([v[0],v[1],0])}const h=u.map(v=>[0,0,-1]),p=u.map((v,m)=>m),g=t.transforms?xm.clone(t.transforms):xm.create();s.push({type:"2d",positions:u,normals:h,indices:p,transforms:g,color:n,isTransparent:o})}return s};var OH=CH;const{flatten:RH,toArray:NH}=nc,{meshColor:MH}=fc,DH=EH,LH=PH,kH=OH,IH=e=>e.map(n=>{const r={drawCmd:n.type==="2d"?"drawLines":"drawMesh",show:!0,transparent:n.isTransparent,useVertexColors:!0};return{geometry:n,visuals:r}}),FH=(e,...t)=>{const n={color:MH,smoothNormals:!0},{color:r,smoothNormals:o}=Object.assign({},n,e);t=RH(NH(t)),t=t.filter(s=>s&&s instanceof Object);const a=[];return t.forEach(s=>{let i=[];"sides"in s?i=DH({color:r},s):"points"in s?i=kH({color:r},s):"polygons"in s&&(i=LH({smoothLighting:o,normalThreshold:.3,color:r},s)),a.push(...IH(i))}),a};var GH=FH,eo={prepareRender:vq,drawCommands:{drawGrid:yq,drawAxis:_q,drawMesh:Eq,drawLines:Cq},cameras:{camera:rH,orthographic:Mi,perspective:Wu},controls:{orbit:xH},entitiesFromSolids:GH};function BH({geometry:e}){const t=jn.useRef(null),n=jn.useRef(),r=jn.useRef(),o=jn.useRef({}),a=jn.useCallback(function(){r.current(o.current),n.current=window.requestAnimationFrame(a)},[]);return jn.useEffect(function(){const i=t.current.getContext("webgl");return r.current=eo.prepareRender({glOptions:{gl:i}}),n.current=window.requestAnimationFrame(a),()=>window.cancelAnimationFrame(n.current)},[t,a]),jn.useEffect(function(){const s=t.current,i=s.clientWidth,c=s.clientHeight,l=eo.cameras.perspective,u=Object.assign({},l.defaults);l.setProjection(u,u,{width:i,height:c}),l.update(u,u);const f=eo.entitiesFromSolids({},e);o.current={camera:u,drawCommands:{drawAxis:eo.drawCommands.drawAxis,drawGrid:eo.drawCommands.drawGrid,drawLines:eo.drawCommands.drawLines,drawMesh:eo.drawCommands.drawMesh},entities:f}},[e]),fn.jsx("canvas",{ref:t,style:{width:"100%",height:"100%"}})}async function wm(e,t){const n=document.createElement("a");n.download=e,n.href=URL.createObjectURL(t),n.addEventListener("click",function(){setTimeout(()=>URL.revokeObjectURL(n.href),30*1e3)}),n.click()}function zH(){const[e,t]=jn.useState(null),n=function(a){t(function(s){return JSON.stringify(a)===JSON.stringify(s)?s:a})};function r(){const a=IF.serialize({binary:!0},e),s=new Blob(a);wm("geometry.stl",s)}function o(){const a=_F.serialize({binary:!0},e),s=new Blob(a);wm("geometry.obj",s)}return fn.jsxs(fn.Fragment,{children:[fn.jsx("div",{className:"editor",children:fn.jsx(aU,{onChange:n})}),fn.jsx("div",{className:"aside",children:e&&fn.jsxs(fn.Fragment,{children:[fn.jsx("div",{className:"viewport",children:fn.jsx(BH,{geometry:e})}),fn.jsxs("div",{children:[fn.jsx("button",{onClick:r,children:"Download STL"}),fn.jsx("button",{onClick:o,children:"Download OBJ"})]})]})})]})}Tu.createRoot(document.getElementById("root")).render(fn.jsx(L.StrictMode,{children:fn.jsx(zH,{})}));
